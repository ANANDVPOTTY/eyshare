'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[59],{1436:function(u,E,a){a.r(E);var c=a(0),b=a(15),e=a(84),f=a(848),d=a(187),h=a(553);class m{constructor(bc,Zc,gd=null){this.id=bc.Id;gd||(gd="");this.u$i=gd;this.sensitivityLabel=bc}}Object(c.a)(m,"AutoPolicyLabelData",null,[]);class l{constructor(bc,Zc){this.BM=bc;this.displayName=Zc}}Object(c.a)(l,"PolicyLabelRequestState",null,[]);var w=a(146),n=a(4),y=a(152),t=a(14),r=a(45),v=a(30);class B{static get Ztd(){return B.eui}}
B.eui="<div class='WACDialogRow' id='JustificationMessageBlock'> <div class='WACDialogIcon' id='JustificationIconArea'> <div class='clip32x32' id='JustificationIconClip' unselectable='on' style='z-index: 0; display: inline-block;'> <img id='iconJustification' class='{1}' role='presentation' src={0} /> </div> </div> <div class='WACDialogTextPanel WACJustificationDialogMessage' id='JustificationMessageArea'> <label id='messageJustification' class='WACDialogLabel' >{2}</label> </div> </div> <br/> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock0'> <input type='radio' id='radiobox0' name='ListRadioBox' class='WACDialogRadio' alt='{3}' title='{3}'></input> <label id='JustificationDlgList0' class='WACDialogLabel' for='radiobox0' >{3}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock1'> <input type='radio' id='radiobox1' name='ListRadioBox' class='WACDialogRadio' alt='{4}' title='{4}'></input> <label id='JustificationDlgList1' class='WACDialogLabel' for='radiobox1' >{4}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow' id='JustificationDlgBlock2'> <input type='radio' id='radiobox2' name='ListRadioBox' class='WACDialogRadio' alt='{5}' title='{5}'></input> <label id='JustificationDlgList2' class='WACDialogLabel' for='radiobox2' >{5}</label> </div> <div class='WACDialogTextPanel WACJustificationDialogRow WACJustificationDialogTextAreaRow' id='JustificationTextAreaBlock'> <textarea id='txtJustification' class='JustificationTextArea' placeholder='{6}' style='border:solid 1px grey;resize:none;' autocomplete=\"off\"></textarea> </div>";
Object(c.a)(B,"JustificationDialogHtml",null,[]);class A extends w.a{constructor(bc,Zc){super(!1,!1,A.Uu);this.Mqa=[CommonUIStrings.l_SensitivityJustificationNoLongerApplies,CommonUIStrings.l_SensitivityJustificationIncorrect,CommonUIStrings.l_SensitivityJustificationOther];this.KWb=null;this.IWb=!1;this.vXb=bc;this.nE=Zc;this.qg=this.HVg();this.Rb=1;this.Fe=A.id;this.oc(1,CommonUIStrings.l_DialogChange);this.AL(1,!1);this.Q0(0)}CUd(){if(A.Uu)this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,
Object(e.a)(this,this.aQf,"reactJustificationDialogHandler"),this.p5e(this.IWb));else{const bc={};for(let Zc=0;Zc<this.Mqa.length;Zc++)bc[A.pId+Zc]=!1;bc[A.POb]="";this.initializeAndShow(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.dui,"justificationDialogHandler"),bc);this.obj();r.a.addHandler($get(A.POb),t.a.input,Object(e.a)(this,this.XMj,"textAreaHandler"))}}validate(){if(A.Uu)return this.Ljg(this.KWb);const bc=$get(A.POb);return bc.disabled?!0:this.Ljg(bc.value)}Ljg(bc){const Zc=
2>bc.length,gd=500<bc.length,Sc=RegExp("[{|}|;|\\\\]").test(bc);bc=""===v.a.Mtc(bc);return!Zc&&!gd&&!Sc&&!bc}dui(bc,Zc){let gd="";if(1===bc)for(let Sc=0;Sc<this.Mqa.length;Sc++)if(Zc[A.pId+Sc]){gd=Sc===this.Mqa.length-1?Zc[A.POb]:this.Mqa[Sc];break}this.nE(bc,this.vXb,gd)}aQf(bc){let Zc="";1===bc&&this.KWb&&(Zc=this.KWb);this.nE(bc,this.vXb,Zc)}QRi(bc){this.KWb=bc;bc=this.validate();this.IWb!==bc&&(this.IWb=bc,this.MUa(CommonUIStrings.l_SensitivityJustificationTitle,Object(e.a)(this,this.aQf,"reactJustificationDialogHandler"),
this.p5e(this.IWb)))}p5e(bc){return{["id"]:this.Fe,["bodyControls"]:{["choiceGroupProps"]:{},["textAreaProps"]:{["placeholder"]:CommonUIStrings.l_SensitivityJustificationPlaceholder}},["actionButtonProps"]:{["label"]:CommonUIStrings.l_DialogChange,["disabled"]:!bc},["infoMessage"]:CommonUIStrings.l_SensitivityJustificationMessage,["justificationIrrelevantLabel"]:CommonUIStrings.l_SensitivityJustificationNoLongerApplies,["justificationIncorrectLabel"]:CommonUIStrings.l_SensitivityJustificationIncorrect,
["justificationOtherLabel"]:CommonUIStrings.l_SensitivityJustificationOther,["onJustificationUpdated"]:Object(e.a)(this,this.QRi,"onJustificationUpdated")}}XMj(bc){bc.target&&this.AL(1,this.validate())}HVg(){return w.a.gq(A.Ztd,n.AFrameworkApplication.sB,y.getImageClass(A.iconName),CommonUIStrings.l_SensitivityJustificationMessage,this.Mqa[0],this.Mqa[1],this.Mqa[2],CommonUIStrings.l_SensitivityJustificationPlaceholder)}obj(){const bc=document.getElementsByName(A.Ewi);for(let Zc=0;Zc<bc.length;Zc++)r.a.addHandler(bc[Zc],
t.a.focus,Object(e.a)(this,this.HOf,"radioButtonFocusHandler")),r.a.addHandler(bc[Zc],t.a.click,Object(e.a)(this,this.HOf,"radioButtonFocusHandler"))}HOf(bc){if(bc=bc.target){bc.checked=!0;var Zc=$get(A.POb);bc.id===A.pId+(this.Mqa.length-1)?(Zc.disabled=!1,Sys.UI.DomElement.setVisible(Zc,!0),Zc.focus()):(Zc.disabled=!0,bc.focus());this.AL(1,this.validate())}}static get Uu(){return n.AFrameworkApplication.sa.Pa.Hv&&n.AFrameworkApplication.sa.Pa.Lrd}}A.Ztd=B.Ztd;A.Ewi="ListRadioBox";A.pId="radiobox";
A.POb="txtJustification";A.iconName="Info_32x32x32";A.id="JustificationDialog";Object(c.a)(A,"JustificationDialog",w.a,[]);class z extends w.a{constructor(bc,Zc,gd){super(!1,!1,!0);if(bc&&gd){var Sc={["id"]:"MandatoryLabellingDialog"};this.ktg=gd;this.dOc=Zc;if(!n.AFrameworkApplication.fa.qa("MandatoryLabelingDialogLearnMoreSwitchIsEnabled")||this.dOc&&""!==this.dOc)Sc.learnMoreLink={["type"]:"AppLinkProps",["id"]:"mandatoryLabellingLearnMoreLink",["text"]:CommonUIStrings.l_LearnMore,["handler"]:{["href"]:this.dOc,
["target"]:"_blank"},["customTooltip"]:CommonUIStrings.L_LearnMoreTooltip};Zc={["sections"]:[],["shouldAutoOpen"]:!1};Array.add(Zc.sections,{["id"]:"mandatoryLabellingFlyoutMenuSection",["controls"]:bc});Sc.labelFlyout={["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabellingFyout",["label"]:"Pick a label",["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!0,["menuDefinition"]:Zc};bc={["id"]:"MandatoryLabellingDialog",["bodyControls"]:Sc};Sc.initialLabelText=CommonUIStrings.l_MandatoryLabellingDialogInitialLabelText;
Sc.descriptionText=CommonUIStrings.l_MandatoryLabellingDialogDescriptionText;this.initializeAndShow(CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,Object(e.a)(this,this.ECi,"mandatoryLabellingDialogHandler"),bc)}else b.ULS.sendTraceTag(560547850,306,10,"MandatoryLabelingDialog was triggered with invalid inputs")}ECi(bc,Zc){1===bc&&Zc.selectedLabel&&(bc=Zc.selectedLabel,""!==bc&&this.ktg(bc))}}Object(c.a)(z,"MandatoryLabellingDialog",w.a,[]);class x{constructor(){this.ekb=!!n.AFrameworkApplication.sa&&
n.AFrameworkApplication.sa.Pa.Hv}Sbh(bc,Zc,gd){this.ekb&&new z(bc,Zc,gd)}static get instance(){return x.Ma||(x.Ma=new x)}}x.Ma=null;Object(c.a)(x,"MandatoryLabellingDialogFactory",null,[710]);class D{}D.bKj="sbProtectForm14";D.dKj="SBStatusBarMarkAsReadOnly14";D.Pvi="Info_16x16x32";D.crb="QuickSearchCompletedToday_16x16x32";D.QId="CommonControlCheckboxCheck_16";D.adg="On";D.visible="Visible";D.MGh="ImageIsVisible";D.uG="SourceControlId";D.menuItemId="MenuItemId";D.menu="Menu";D.TXc="AppLockId";D.value=
"Value";D.ui="LabelText";D.alt="Alt";D.zcf="Image16by16";D.o6a="Image16by16Class";D.aKj="SBProtectForm_16";D.cKj="SBStatusBarMarkAsReadOnly_16";D.icon="Icon";D.iconColor="IconColor";D.customTooltip="CustomTooltip";D.O9i="MipTagDynamicFillWithOutline_20";D.P9i="MipTagLockDynamicFillWithOutline_20";D.N9i="MipTagErrorOutline_20";D.Q9i="MipTagQuestionOutline_20";D.FZd="transparent";D.OSj="UILocation";Object(c.a)(D,"PolicyConstants",null,[]);class J extends w.a{constructor(bc,Zc,gd){super(!1,!1,J.Uu);
this.vXb=bc;this.nXa=Zc;this.nE=gd;this.Rb=1;this.Fe=J.id;this.Q0(1);this.Q0(0)}aVd(){const bc={["id"]:"UserDefinedPermissionsDialog"};J.Uu&&this.initializeAndShow("Defined Permissions",Object(e.a)(this,this.tZj,"userDefinedPermissionsDialogHandler"),bc)}tZj(bc){1!==bc&&this.nE(bc,this.vXb,"",this.nXa)}static get Uu(){return n.AFrameworkApplication.sa.Pa.Hv&&n.AFrameworkApplication.sa.Pa.Lrd}}J.id="UserDefinedPermissionsDialog";Object(c.a)(J,"UserDefinedPermissionsDialog",w.a,[]);var L=a(590),T=a(375),
O=a(313),G=a(566),C=a(97),H=a(145),I=a(561),M=a(558),Q=a(137),U=a(428),N=a(134),W=a(86),X=a(200),sa=a(331),da=a(82),S=a(105),oa=a(25),K=a(72),ea=a(55);class ya{constructor(bc,Zc,gd,Sc){this.ENc=this.FNc=null;this.nbe=this.VMc=this.oNc=this.hkb=this.sce=this.Sde=this.TIc=!1;this.eWa=this.ufa=this.lga=this.Kpa=this.nXa=this.ft=this.z9=this.nf=null;this.Fsg=this.LGc=0;this.m9d=this.lNc=this.XGc=null;this.La=bc;this.ef=Zc;this.lb=gd;this.ah=Sc;this.Rkb={};this.Rge={};this.Tde={};this.Pzb=gd.qa("WacApplyManualPolicyLabelIsEnabled");
this.ah.value.xre(Object(e.a)(this,this.FHd,"processAutoSensitivityLabel"));this.ah.value.YWc(Object(e.a)(this,this.FHd,"processAutoSensitivityLabel"));this.ah.value.J_b(Object(e.a)(this,this.JXi,"onUpdateLabelInfo"));n.AFrameworkApplication.sa&&n.AFrameworkApplication.sa.hLg(Object(e.a)(this,this.xaj,"refreshDocumentPolicyLabelsOnModeChange"));gd.qa("SupportsPolicies")&&gd.Xa("AppliedPolicyId")&&(this.FNc=gd.Xa("IrmPolicyTitle"),this.ENc=gd.Xa("IrmPolicyDescription"));this.GQc=gd.qa("ProtectedFile");
this.Tqg=this.lb.rd("SetPolicyLabelAwaitFileExistsOnHostMaxRetries",6);this.Uqg=this.lb.rd("SetPolicyLabelAwaitFileExistsOnHostRetryDelayMs",5E3)}get I7a(){return n.AFrameworkApplication.I7a||!!this.lNc&&this.lNc()}Hg(){this.La.Nb(oa.a.fJf,S.a.frame,Object(e.a)(this,this.wMe,"documentLabelPaneHandler"));this.La.Ne(oa.a.Fbb,S.a.frame,Object(e.a)(this,this.Fbb,"queryPolicyLabel"),96);this.La.Nb(oa.a.tUa,S.a.frame,Object(e.a)(this,this.tUa,"toggleSensitivity"));this.La.Nb(oa.a.Tza,S.a.frame,Object(e.a)(this,
this.Tza,"populateSensitivityFlyout"));this.La.Nb(oa.a.setSensitivity,S.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.Ne(oa.a.Gbb,S.a.frame,Object(e.a)(this,this.Gbb,"querySensitivity"),96);this.La.Nb(oa.a.i7,S.a.frame,Object(e.a)(this,this.i7,"querySensitivityToggleButton"));this.La.Nb(oa.a.h7,S.a.frame,Object(e.a)(this,this.h7,"querySensitivitySubFlyout"));this.snb(oa.a.tUa)||this.La.Fdb(oa.a.tUa,4);this.snb(oa.a.Tza)||this.La.Fdb(oa.a.Tza,4);this.snb(oa.a.setSensitivity)||
this.La.Fdb(oa.a.setSensitivity,4);this.snb(oa.a.i7)||this.La.Fdb(oa.a.i7,4);this.snb(oa.a.h7)||this.La.Fdb(oa.a.h7,4);this.ef.updateCommandUI();n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Q.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")&&this.ah.value.$fj(Object(e.a)(this,this.TRf,"registerActionsHandler"))}TRf(){this.Hg()}LPb(){this.La.XD(oa.a.fJf,
S.a.frame,Object(e.a)(this,this.wMe,"documentLabelPaneHandler"));this.La.XD(oa.a.Fbb,S.a.frame,Object(e.a)(this,this.Fbb,"queryPolicyLabel"));this.La.XD(oa.a.tUa,S.a.frame,Object(e.a)(this,this.tUa,"toggleSensitivity"));this.La.XD(oa.a.Tza,S.a.frame,Object(e.a)(this,this.Tza,"populateSensitivityFlyout"));this.La.XD(oa.a.setSensitivity,S.a.frame,Object(e.a)(this,this.setSensitivity,"setSensitivity"));this.La.XD(oa.a.Gbb,S.a.frame,Object(e.a)(this,this.Gbb,"querySensitivity"));this.La.XD(oa.a.i7,S.a.frame,
Object(e.a)(this,this.i7,"querySensitivityToggleButton"));this.La.XD(oa.a.h7,S.a.frame,Object(e.a)(this,this.h7,"querySensitivitySubFlyout"))}tUa(){return 32}l_e(bc){const Zc="mandatoryLabelling_"+bc.Id;this.Tde[Zc]=bc.Id;return{["type"]:"AppToggleButtonProps",["id"]:Zc,["label"]:bc.DisplayName,["hideLabel"]:!1,["customTooltip"]:bc.Tooltip}}QNa(){return this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UDPEnabled",!1)}aWh(){const bc=[],Zc=this.z9;for(let Sc in Zc){var gd=Zc[Sc];const Gd=
this.ft[Sc];if(this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!Gd||!Gd.Enabled||Gd.HasUserDefinedPermissions)continue}else if(!Gd||!Gd.Enabled)continue;if(gd.count){const Vd={["sections"]:[],["shouldAutoOpen"]:!1},Ed={["id"]:"mandatoryLabelling_flyoutMenuSection_"+Gd.Id,["controls"]:[]};for(let Od of gd){gd=this.ft[Od];if(this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HideUDPFromMandatoryDialogEnabled",!1)){if(!gd||!gd.Enabled||
gd.HasUserDefinedPermissions)continue}else if(!gd||!gd.Enabled)continue;Array.add(Ed.controls,this.l_e(gd))}Array.add(Vd.sections,Ed);Array.add(bc,{["type"]:"AppFlyoutAnchorProps",["id"]:"mandatoryLabelling_"+Gd.Id,["label"]:Gd.DisplayName,["hideLabel"]:!1,["hideChevron"]:!1,["hideIcon"]:!1,["menuDefinition"]:Vd})}else Array.add(bc,this.l_e(Gd))}return bc}Tza(bc,Zc,gd,Sc,Gd){if(1===gd||!this.ah.value.qha(!0))return 32;Gd.MenuItems=Object.assign(new I.a,{Id:"SensitivityList",MenuSectionList:[],UpdateDynamically:!0});
Array.add(Gd.MenuItems.MenuSectionList,this.Ec(!this.isReactRibbonEnabled()));this.nf.CustomUrl&&Array.add(Gd.MenuItems.MenuSectionList,this.Hbh(this.isReactRibbonEnabled()?this.nf.CustomUrl:v.a.df(this.nf.CustomUrl)));this.isReactRibbonEnabled()||(Gd.PopulationXML=O.q(Gd.MenuItems));return 32}Gbb(bc,Zc,gd,Sc,Gd){if(1===gd||!Gd||!this.Pzb)return 32;this.nf=this.ah.value.pn;if(this.ah.value.qha(!0)&&(Gd[D.visible]=!0,this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.LabelsAvailableActivityControlEnabled",
!1)?this.sce||(H.a("MipLabelsAvailable"),this.sce=!0):H.a("MipLabelsAvailable"),this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelTUIEnabled",!1)&&this.nf&&this.nf.AreLabelsAvailable&&(bc=da.a.instance.Ub("Common.ISystemInitiatedFeedback")))){const Vd=ya.Dh(this.nf.AppliedPolicyId)?"LouderLabel_NoLabelAppliedOnLoadActivity":"LouderLabel_LabelExistsOnLoadActivity";bc.execute(Ed=>{Ed.logActivity(Vd,null)})}return 32}i7(bc,Zc,gd,Sc,Gd){if(1===gd||!Gd)return 32;let Vd,Ed;Gd[D.adg]=
!!(Vd=Gd[D.menuItemId])&&!!(Ed=this.Rkb[Vd])&&Ed===this.nf.AppliedPolicyId;return 32}h7(bc,Zc,gd,Sc,Gd){if(1===gd||!Gd)return 32;let Vd,Ed,Od;bc=!!(Vd=Gd[D.uG])&&!!(Ed=this.Rkb[Vd])&&!!(Od=this.z9[Ed])&&Od.contains(this.nf.AppliedPolicyId);Gd[D.MGh]=bc;Gd[D.adg]=bc;return 32}setSensitivity(bc,Zc,gd,Sc,Gd){if(1===gd||!Gd)return 32;bc=this.Rkb[Gd[D.uG]];Zc=this.PSj(Gd[D.OSj]);gd=new K.a;gd.name="SensitivityPickerLocation";gd.int64=Zc;H.a("SensitivityPickerUsage",void 0,void 0,[gd]);return this.Yna(bc,
Gd,2)}vhc(){return!!n.AFrameworkApplication.sa&&1===n.AFrameworkApplication.sa.mode}xaj(){this.VMc&&!this.vhc()&&(this.VMc=!1,this.ah.value.waj())}Udg(){this.nf.DefaultLabelId&&this.nf.MandatoryLabelingEnforced?this.TIc||this.vhc()?this.nf.AppliedPolicyId?this.w$c(""):(this.ah.value.Rpi(this.ah.value.PCb)||this.vhc())&&this.ROe():this.r2f():this.nf.DefaultLabelId?this.r2f():this.nf.MandatoryLabelingEnforced&&(this.nf.AppliedPolicyId?this.w$c(""):this.ROe())}Tif(){return this.nf.MandatoryLabelingEnforced?
this.nf&&this.nf.AreLabelsAvailable?this.lb.qa("TestOverrideIsReactDialogEnabled")||this.ef&&this.ef.Pa&&this.ef.Pa.Hv?!0:(b.ULS.sendTraceTag(539109065,306,50,"Mandatory labelling not invoked b/c react dialogs disabled!"),!1):(b.ULS.sendTraceTag(539109064,306,50,"Mandatory labelling not invoked b/c there are no sensitivity labels!"),!1):(b.ULS.sendTraceTag(539109063,306,50,"Mandatory labelling not invoked b/c user did not have policy!"),!1)}ROe(){!this.Tif()||n.AFrameworkApplication.u5||this.Sde||
(this.Sde=n.AFrameworkApplication.u5=!0,b.ULS.sendTraceTag(562837517,306,50,"Mandatory labelling is invoked successfully."),this.ah.value.$Of("",1),this.ah.value.UVc(37,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarTitle,CommonUIStrings.l_MandatoryLabellingDialogDescriptionText,CommonUIStrings.l_MandatoryLabellingDialogBusinessBarButton,()=>{this.CCi()}))}w$c(bc){this.Tif()&&n.AFrameworkApplication.u5&&(n.AFrameworkApplication.u5=!1,b.ULS.sendTraceTag(562837518,306,50,"Mandatory labelling is escaped successfully."),
this.ah.value.XKd(),this.ah.value.$Of(bc,2))}CCi(){x.instance.Sbh(this.aWh(),this.nf.CustomUrl,Object(e.a)(this,this.DCi,"mandatoryLabellingDialogCallback"))}DCi(bc){this.w$c(this.Tde[bc])}xwe(){return this.lb.qa("CoAuthForProtectedFilesEnabled")&&this.lb.qa("SupportsOfficeClientCoauthoring")&&this.lb.qa("SetPolicyLabelAwaitFileExistsOnHostIsEnabled")&&!!this.m9d&&this.I7a}Yna(bc,Zc,gd,Sc=null){this.ah.value.v8i(gd);let Gd=32,Vd=!1,Ed=!0;const Od=2===gd||8===gd||16===gd,se=bc===this.nf.AppliedPolicyId;
if(this.XGc&&this.XGc(bc,Od))b.ULS.sendTraceTag(42860829,306,15,"SetSensitivity : As app doesn't support changing the label, skipping SetSensitivity call. ApplyLabelFlag : {0}",gd),this.ef.updateCommandUI();else if(Zc&&D.TXc in Zc&&this.ah.value.Evj(Zc[D.TXc]),bc)if(this.ah.value.Zkf()||this.xwe()&&this.oNc)b.ULS.sendTraceTag(42796168,306,50,"Policy label cannot be set because a set policy label request is already in progress. ApplyLabelFlag: {0}",gd),this.ef.updateCommandUI(),Od&&this.w0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,
CommonUIStrings.l_SensitivityQuickApplicationErrorMessage);else if(this.lb.qa("HasDocumentEditRights"))if(this.ah.value.QZg(bc))if(!this.QNa()&&this.ft[bc]&&this.ft[bc].HasUserDefinedPermissions&&!se)b.ULS.sendTraceTag(540608323,306,50,"UDP label cannot be applied during UDP in WAC Phase 1. ApplyLabelFlag: {0}",gd),1!==gd&&4!==gd&&this.aOg();else if(Od&&this.nf.MandatoryLabelingEnforced&&se)b.ULS.sendTraceTag(570972054,306,50,"Policy label cannot be removed due to mandatory labeling. ApplyLabelFlag: {0}",
gd),this.w0b(CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogTitle,CommonUIStrings.l_MandatoryLabellingBlockLabelRemovalDialogDescriptionText);else{if(Od&&this.lb.qa("WacLabelingJustificationDialogIsEnabled")&&this.nf.RequiredDowngradeJustification&&(se||this.ft[bc].RequiredDowngradeJustification)&&(this.QNa()?!this.nbe&&!Sc:!this.nXa))return b.ULS.sendTraceTag(570972055,306,50,"Downgrade justification is required. ApplyLabelFlag: {0}",gd),this.CUd(bc),Gd;if(this.QNa()&&this.ft[bc].HasUserDefinedPermissions&&
!se)return b.ULS.sendTraceTag(523019968,306,50,"UDP Label is selected. ApplyLabelFlag: {0}",gd),this.aVd(bc,Sc),Gd;if(this.xwe()&&!this.m9d())this.LGc<this.Tqg?(b.ULS.sendTraceTag(577356770,306,50,"File does not exist on host, retrying after delay. RetryCount: {0} ApplyLabelFlag: {1}",this.LGc,gd),this.oNc=!0,this.LGc++,ea.Task.delay(this.Uqg).continueWith(()=>{this.oNc=!1;this.Yna(bc,Zc,gd)})):(b.ULS.sendTraceTag(577356771,306,15,"Policy label cannot be set because maximum retries were reached checking for file existence. ApplyLabelFlag: {0}",
gd),Vd=1!==gd,Ed=!1,Gd=8);else{if(this.xoi(bc)&&(b.ULS.sendTraceTag(553911752,306,15,"Policy label cannot be set because the selected label is a parent label. ApplyLabelFlag: {0}",gd),1===gd||8===gd||4===gd))return Gd;b.ULS.sendTraceTag(570972056,306,50,"SetSensitivityByPolicyId is succeeded. ApplyLabelFlag: {0}",gd);this.setPolicyLabel(se?"":bc,this.QNa()?Sc:this.nXa,"",gd);return Gd}}else b.ULS.sendTraceTag(42796169,306,50,"Policy label cannot be set because the user is in a coauth session. ApplyLabelFlag: {0}",
gd),this.ef.updateCommandUI(),Od&&this.w0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityCoauthApplicationErrorMessage);else b.ULS.sendTraceTag(558892739,306,50,"Policy label cannot be set because the user doesn't have edit rights. ApplyLabelFlag: {0}",gd),this.ef.updateCommandUI(),Od&&this.w0b(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityNoEditRightsErrorMessage);else b.ULS.sendTraceTag(42796167,306,15,"Policy label cannot be set because the selected policy ID is null. ApplyLabelFlag: {0}",
gd),this.ef.updateCommandUI(),Vd=Od,Ed=!1,Gd=8;this.ah.value.EId(0,gd,Vd,Ed);return Gd}h_a(bc,Zc,gd=null,Sc=!1){C.Health.instance.recordKpiUsage("MipAutoClassificationSetLabel",0,"wordclpfc",null);this.lb.qa("SupportsOfficeClientCoauthoring")&&this.lb.qa("CoAuthForProtectedFilesIsEnabled")?(this.hkb=!1,(this.nf=this.ah.value.pn)&&!this.nf.AppliedPolicyId?this.hkb=!0:this.nf&&this.nf.PolicyLabelAssignmentMethod&&(this.hkb=X.e(this.nf.PolicyLabelAssignmentMethod)===X.e("standard"))):this.hkb=Sc;bc=
ya.Dh(bc)?null:this.ft[bc];(Zc=ya.Dh(Zc)?null:this.ft[Zc])?this.lga=new m(Zc,!0,gd):(this.ah.value.Gda(29),this.ufa=null);bc?this.Kpa=new m(bc,!1):this.eWa=null;this.FHd(null,null);return 32}XPg(bc){""!==this.nf.AppliedPolicyId?this.ah.value.EId(14,16,!0):this.Yna(bc,null,16)}h3f(){this.ft={};if(this.nf=this.ah.value.pn)for(const bc of this.nf.SensitivityLabels)this.ft[bc.Id]=bc}xoi(bc){if(this.z9&&bc in this.z9){bc=this.z9[bc];for(let Zc of bc)if((bc=this.ft[Zc])&&bc.Enabled)return!0}return!1}O3f(){this.z9=
{};if(this.nf=this.ah.value.pn){for(const bc of this.nf.SensitivityLabels)bc.ParentId||(this.z9[bc.Id]=new d.a);for(const bc of this.nf.SensitivityLabels)bc.ParentId&&bc.ParentId in this.z9&&this.z9[bc.ParentId].add(bc.Id)}}vOf(){if(this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)){this.nf=this.ah.value.pn;const bc=this.Pzb&&this.isReactRibbonEnabled()&&this.ah.value.qha();ya.sRa(bc)}else this.Pzb&&this.isReactRibbonEnabled()?(this.nf=this.ah.value.pn,this.ah.value.qha()?
(ya.sRa(!0),appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!1))):ya.sRa(!1)):ya.sRa(!1)}Vaj(bc){this.XGc=bc}Jbj(bc){this.lNc=bc}r2f(){if(this.lb.qa("WacApplyDefaultPolicyLabelIsEnabled"))if(this.vhc())this.VMc=!0;else if(!this.TIc)if(this.TIc=!0,this.nf=this.ah.value.pn,this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",!1)){if(this.nf&&this.nf.DefaultLabelId)if(!this.nf.AppliedPolicyId)b.ULS.sendTraceTag(509732190,306,50,
"Default labeling triggered. DefaultLabelType: {0}",this.nf.DefaultLabelType),this.Yna(this.nf.DefaultLabelId,null,1);else if(h.a.Yj().equals(this.nf.DefaultLabelType,"documentLibraryDefault")){const bc=this.ft[this.nf.AppliedPolicyId],Zc=this.ft[this.nf.DefaultLabelId];this.nf.AppliedPolicyId!==this.nf.DefaultLabelId&&h.a.Yj().equals(this.nf.PolicyLabelAssignmentMethod,"standard")&&bc.Order<Zc.Order&&(b.ULS.sendTraceTag(509732189,306,50,"Default labeling triggered. DefaultLabelType: {0}",this.nf.DefaultLabelType),
this.Yna(this.nf.DefaultLabelId,null,1))}}else this.nf&&this.nf.DefaultLabelId&&!this.nf.AppliedPolicyId&&(b.ULS.sendTraceTag(593774210,306,50,"Default labeling triggered. DefaultLabel: {0}",this.nf.DefaultLabelId),this.Yna(this.nf.DefaultLabelId,null,1))}FHd(){if(!this.ah.value.Zkf()){var bc=this.ft[this.nf.AppliedPolicyId];this.hkb&&this.Kpa&&this.eWa!==this.Kpa.id&&(!bc||bc.Order<this.Kpa.sensitivityLabel.Order)&&(bc=this.Yna(this.Kpa.id,{},4),32!==bc?b.ULS.sendTraceTag(50868813,306,10,"ProcessAutoSensitivityLabel: SetSensitivityByPolicyId failed with response: "+
bc):(this.eWa=this.Kpa.id,this.ufa&&(bc=this.ft[this.ufa])&&bc.Order<=this.Kpa.sensitivityLabel.Order&&(this.ah.value.Gda(29),this.ufa=null)));bc=this.ft[this.ah.value.pn.AppliedPolicyId];if(this.lga&&this.ufa!==this.lga.id&&(!bc||bc.Order<this.lga.sensitivityLabel.Order)){const Zc=this.lga.id;this.ah.value.Gda(29);this.ah.value.WZb(29,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelRecommendationMessage,this.shd(this.lga.sensitivityLabel))+" "+this.lga.u$i,CommonUIStrings.l_PolicyLabelRecommendationButton,
()=>{this.Yna(Zc,{},8)});this.ufa=this.lga.id}this.lga=this.Kpa=null}}setPolicyLabel(bc,Zc,gd,Sc=2){this.QNa()?Zc&&(this.nbe=!0):this.nXa=Zc;this.ah.value.setPolicyLabel(bc);this.ef.updateCommandUI();gd=new l(Sc,this.shd(this.ft[bc]));this.ah.value.DRd(bc,this.QNa()?Zc:this.nXa,gd)}I7g(bc,Zc,gd,Sc){1===bc&&this.setPolicyLabel(Zc,Sc,gd)}H7g(bc,Zc,gd){1===bc?this.QNa()?this.Yna(Zc,null,2,gd):this.setPolicyLabel(Zc===this.nf.AppliedPolicyId?"":Zc,gd,""):this.ef.updateCommandUI()}CUd(bc){(new A(bc,Object(e.a)(this,
this.H7g,"continueToSetPolicyLabelFromJustificationDialog"))).CUd()}aVd(bc,Zc){(new J(bc,Zc,Object(e.a)(this,this.I7g,"continueToSetPolicyLabelFromUDPDialog"))).aVd()}w0b(bc="",Zc=""){const gd=new N.StandardDialog;gd.It=n.AFrameworkApplication.Wzb;gd.Rb=0;gd.oc(1,CommonUIStrings.l_DialogClose);gd.kX(bc,Zc,null)}RTg(bc){1===bc&&this.ah.value.z8i()}aOg(){const bc=new N.StandardDialog;bc.It=n.AFrameworkApplication.Wzb;bc.Rb=1;bc.oc(1,CommonUIStrings.l_OICDownLoadACopyDialogOpenButton);bc.oc(0,CommonUIStrings.l_DialogClose);
bc.kX(CommonUIStrings.l_SensitivityApplicationDialogErrorTitle,CommonUIStrings.l_SensitivityBlockUDPSetLabelMessage,Object(e.a)(this,this.RTg,"blockUDPSetLabelHandler"))}isReactRibbonEnabled(){return!!this.ef&&!!this.ef.Pa&&this.ef.Pa.Qi}ajc(){return this.ef&&this.ef.Pa?this.ef.Pa.ajc:!1}wMe(){return 32}Fbb(bc,Zc,gd,Sc,Gd){if(1===gd)return 32;this.nf=this.ah.value.pn;if(!this.nf||!Gd)return 32;Gd[D.value]="";Gd[D.ui]="";Gd[D.alt]=null;Gd[D.zcf]=null;Gd[D.o6a]=null;Gd[D.customTooltip]="";Gd[D.visible]=
!1;Gd[D.iconColor]="";gd=Zc=bc=Gd[D.icon]="";if(!this.nf.AreLabelsAvailable){if(!this.FNc)return 32;bc=this.FNc;gd=D.FZd;this.ENc&&(Zc=this.ENc)}else if(this.nf.AppliedPolicyId){Sc=null;for(const Vd of this.nf.SensitivityLabels)if(Vd.Id.toLowerCase()===this.nf.AppliedPolicyId.toLowerCase()){Sc=Vd;break}Sc&&(bc=this.shd(Sc),Zc=Sc.Tooltip,this.GQc=n.AFrameworkApplication.protectedFile=Sc.IsEndpointProtectionEnabled,gd=this.m0e(Sc))}this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",
!1)?(bc?(Gd[D.value]=bc,Gd[D.ui]=bc,Gd[D.customTooltip]=Zc,this.q3f(gd,this.GQc,Gd)):this.lb.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.ClpUseOutlineImageForNoLabel")?(Gd[D.iconColor]=D.FZd,this.nf.MandatoryLabelingEnforced?(Gd[D.value]=Gd[D.ui]=HeaderStrings.SelectASensitivityLabel,Gd[D.icon]=D.N9i):(Gd[D.value]=Gd[D.ui]=HeaderStrings.NoSensitivityLabel,Gd[D.icon]=D.Q9i)):(Gd[D.iconColor]="#000000",this.nf.MandatoryLabelingEnforced?(Gd[D.value]=Gd[D.ui]=HeaderStrings.SelectASensitivityLabel,
Gd[D.icon]="MipTagErrorDynamicColor_20"):(Gd[D.value]=Gd[D.ui]=HeaderStrings.NoSensitivityLabel,Gd[D.icon]="MipTagQuestionDynamicColor_20")),Gd[D.visible]=!0):bc&&(Gd[D.value]=bc,Gd[D.ui]=bc,this.ajc()?Gd[D.customTooltip]=Zc:Gd[D.alt]=Zc,this.q3f(gd,this.GQc,Gd),Gd[D.visible]=!0);return 32}shd(bc){return bc?this.ft?bc.ParentId&&this.ft[bc.ParentId]?this.ft[bc.ParentId].DisplayName+"\\"+bc.DisplayName:bc.DisplayName:(b.ULS.sendTraceTag(4282E4,306,15,"Policy ID to Sensitivity label dictionary has not been initialized."),
bc.DisplayName):""}q3f(bc,Zc,gd){this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(gd[D.icon]=this.Z6e(Zc),gd[D.iconColor]=this.$6e(bc)):this.ajc()?gd[D.icon]=Zc?D.aKj:D.cKj:(gd[D.zcf]=n.AFrameworkApplication.sB,gd[D.o6a]=Zc?y.getImageClass(D.bKj):y.getImageClass(D.dKj))}Hbh(bc){const Zc=this.$C("LearnMoreSection",!0);bc=Object.assign(new T.a,{Id:"SensitivityLearnMore",ExternalId:"SensitivityLearnMore",MenuItemId:bc,LabelText:CommonUIStrings.l_LearnMore,Command:"1959943459",
Image16by16:n.AFrameworkApplication.sB,Image16by16Class:y.getImageClass(D.Pvi),Visible:!0,Alt:CommonUIStrings.L_LearnMoreTooltip,KeyTip:"L"});Array.add(Zc.ControlList,bc);return Zc}FIe(bc,Zc,gd=!1){let Sc;Sc="Toggle_"+bc.Id;Sc="Sensitivity_"+Sc;const Gd=bc.DisplayName,Vd=bc.Tooltip;var Ed=bc.Id===this.nf.AppliedPolicyId,Od=gd?v.a.df(Sc):Sc;this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ClpLouderLabelEnabled",!1)?(Ed=this.m0e(bc),Zc=Object.assign(new U.a,{Id:Od,ExternalId:Od,LabelText:gd?
v.a.df(Gd):Gd,Command:"2935633379",MenuItemId:Od,QueryCommand:"991261903",Visible:!0,Alt:gd?v.a.df(Vd):Vd,AriaLabel:W.a.b1b,IconColor:this.$6e(Ed),KeyTip:Zc}),Zc.ExternalImageId=this.Z6e(bc.IsEndpointProtectionEnabled)):(Od=Object.assign(new L.a,{Id:Od,ExternalId:Od,LabelText:gd?v.a.df(Gd):Gd,Command:"2935633379",MenuItemId:Od,QueryCommand:"991261903",CheckedImage:n.AFrameworkApplication.sB,Visible:!0,Alt:gd?v.a.df(Vd):Vd,IsChecked:Ed,AriaLabel:W.a.b1b,KeyTip:Zc}),this.isReactRibbonEnabled()?(Od.CheckedImageClass=
y.getImageClass(D.QId),Od.ExternalImageId=D.QId):Od.CheckedImageClass=y.getImageClass(D.crb),Zc=Od);Od=Sc;this.Rkb[Od]=bc.Id;this.Rge[bc.Id]=Od;return Zc}$C(bc,Zc=!1){return Object.assign(new M.a,{Title:"",Id:bc,DisplayMode:D.menu,ShowMenuSectionSeparator:Zc,ControlsId:"Ctrl_"+bc,ControlList:[]})}Ieh(bc,Zc,gd,Sc){bc=ya.lVf()?this.$C(bc+"Sub"):this.$C(Zc+"Sub");Zc=1;for(let Gd of gd)(gd=this.ft[Gd])&&gd.Enabled&&(Array.add(bc.ControlList,this.FIe(gd,Zc.toString(),Sc)),Zc++);return bc}Ec(bc=!1){const Zc=
this.$C("SensitivitySection");let gd=1;const Sc=this.z9;for(let Vd in Sc){const Ed=Sc[Vd],Od=this.ft[Vd];if(Od&&Od.Enabled){if(Ed.count){const se="Sensitivity_"+Od.Name;var Gd=bc?v.a.df(se):se;Gd=ya.lVf()?"Label"+this.Fsg++:Gd;const Le=Object.assign(new G.a,{Id:Gd,ExternalId:Gd,LabelText:bc?v.a.df(Od.DisplayName):Od.DisplayName,Command:"798637440",QueryCommand:"2875864574",Menu:Object.assign(new I.a,{Title:"",MenuSectionList:[],UpdateDynamically:!0}),ImageIsVisible:!1,Toggled:!1,ImageUsesSpaceWhileInvisible:!0,
AriaLabel:W.a.b1b,KeyTip:gd.toString(),Alt:bc?v.a.df(Od.Tooltip):Od.Tooltip});this.isReactRibbonEnabled()?Le.ExternalImageId=D.QId:(Le.Image16by16=n.AFrameworkApplication.sB,Le.Image16by16Class=y.getImageClass(D.crb));Array.add(Le.Menu.MenuSectionList,this.Ieh(Gd,se,Ed,bc));Array.add(Zc.ControlList,Le);this.Rkb[Le.Id]=Od.Id;this.Rge[Od.Id]=Le.Id}else Array.add(Zc.ControlList,this.FIe(Od,gd.toString(),bc));gd++}}return Zc}snb(bc){return!!this.La.z4(bc)&&!!this.La.z4(bc).flags&&!!this.La.z4(bc).flags.length}JXi(bc,
Zc){Zc.onSuccess&&this.ft&&(bc=this.ft[this.ah.value.pn.AppliedPolicyId])&&(this.ufa&&(Zc=this.ft[this.ufa])&&Zc.Order<=bc.Order&&(this.ah.value.Gda(29),this.ufa=null),this.eWa&&this.eWa!==bc.Id&&(this.ah.value.Gda(28),this.eWa=null))}Z6e(bc){return bc?D.P9i:D.O9i}$6e(bc){return bc?bc:D.FZd}m0e(bc){if(bc.Color||!bc.ParentId)return bc.Color;const Zc=this.ft[bc.ParentId];return Zc?Zc.Color:bc.Color}PSj(bc){switch(bc){case 2:case 14:case 15:return 1;case 21:return 2;default:return 0}}static lVf(){if(null!=
ya.YWb)return ya.YWb;n.AFrameworkApplication.pya("ce2ai523-t;6f627846-c");ya.YWb=n.AFrameworkApplication.fa?n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.WordOnline.RenameCLPControlIds",!1):!1;return ya.YWb}static sRa(bc){n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||(bc?(sa.a.QAd("ribbon","sensitivity"),sa.a.KAd("ribbon","sensitivity")):sa.a.PAd("ribbon","sensitivity"));n.AFrameworkApplication.fa&&
n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Q.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",!bc))}static Dh(bc){return bc&&bc.length?!1:!0}}ya.YWb=null;Object(c.a)(ya,"PolicyActor",null,[660]);var ha=a(639),La=a(96),Ia;(function(bc){bc[bc.unknown=0]="unknown";bc[bc.boot=1]="boot";bc[bc.refresh=2]="refresh";bc[bc.selfSetPolicyLabel=3]="selfSetPolicyLabel"})(Ia||(Ia={}));Object(c.b)("GetPolicyLabelsReason",
Ia);class ra extends Sys.EventArgs{constructor(bc,Zc,gd,Sc,Gd,Vd){super();this.nqb=bc;this.title=Zc;this.message=gd;this.buttonText=Sc;this.j3=Gd;this.lBb=Vd}}Object(c.a)(ra,"AddAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class pa extends Sys.EventArgs{constructor(bc,Zc,gd,Sc,Gd){super();this.nqb=bc;this.title=Zc;this.message=gd;this.buttonText=Sc;this.j3=Gd}}Object(c.a)(pa,"AddMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);var ba;(function(bc){bc[bc.none=0]="none";bc[bc.reasonDefaultLabel=
1]="reasonDefaultLabel";bc[bc.reasonManual=2]="reasonManual";bc[bc.reasonAutomatic=4]="reasonAutomatic";bc[bc.reasonRecommended=8]="reasonRecommended";bc[bc.reasonMandatory=16]="reasonMandatory"})(ba||(ba={}));Object(c.b)("ApplyLabelFlags",ba);class fa extends Sys.EventArgs{constructor(bc,Zc,gd){super();this.hDe=bc;this.gDe=Zc;this.existingLabelPriority=gd}}Object(c.a)(fa,"AutoCLPSecurityNodesEventArgs",Sys.EventArgs,[]);class Ka extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Ka,"GetPolicyLabelEventArgs",
Sys.EventArgs,[]);class aa extends Sys.EventArgs{constructor(){super()}}Object(c.a)(aa,"GetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class ja{constructor(){this.AreLabelsAvailable=!1;this.AppliedPolicyId=null;this.MandatoryLabelingEnforced=this.RequiredDowngradeJustification=!1;this.SensitivityLabels=this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.CustomUrl=this.DefaultLabelType=this.DefaultLabelId=null;this.AreLabelsAvailable=!1;this.AppliedPolicyId="";this.RequiredDowngradeJustification=
!1;this.PolicyLabelVersionToken=this.PolicyLabelAssignmentMethod=this.DefaultLabelType=this.DefaultLabelId="";this.SensitivityLabels=[];this.MandatoryLabelingEnforced=!1;this.CustomUrl=""}}Object(c.a)(ja,"GetPolicyLabelsData",null,[]);class Va extends Sys.EventArgs{constructor(bc=!1){super();this.onSuccess=bc}}Object(c.a)(Va,"LabelInfoUpdateEventArgs",Sys.EventArgs,[]);class bb extends Sys.EventArgs{constructor(bc,Zc){super();this.Eya=bc;this.xte=Zc}}Object(c.a)(bb,"MandatoryLabellingAppHandlerEventArgs",
Sys.EventArgs,[]);class wa extends Sys.EventArgs{constructor(bc,Zc,gd,Sc){super();this.title=bc;this.Erc=Zc;this.buttonText=gd;this.Pyf=Sc}}Object(c.a)(wa,"PolicyTipEventArgs",Sys.EventArgs,[]);class ka extends Sys.EventArgs{constructor(bc,Zc){super();this.nqb=bc;this.lBb=Zc}}Object(c.a)(ka,"RemoveAutoPolicyBusinessBarEntryEventArgs",Sys.EventArgs,[]);class ta extends Sys.EventArgs{constructor(){super()}}Object(c.a)(ta,"RemoveMandatoryLabellingBusinessBarEntryEventArgs",Sys.EventArgs,[]);class qa extends Sys.EventArgs{constructor(bc,
Zc){super();this.Drc=bc;this.BM=Zc}}Object(c.a)(qa,"SetPolicyLabelEventArgs",Sys.EventArgs,[]);class rb extends Sys.EventArgs{constructor(bc,Zc,gd,Sc=null,Gd=null,Vd=null,Ed=null){super();this.errorType=bc;this.V7f=gd;this.title=Sc;this.message=Gd;this.buttonText=Vd;this.j3=Ed}}Object(c.a)(rb,"SetPolicyLabelFailureEventArgs",Sys.EventArgs,[]);class Za extends Sys.EventArgs{constructor(){super()}}Object(c.a)(Za,"SetPolicyLabelTriggeredEventArgs",Sys.EventArgs,[]);class gb extends Sys.EventArgs{constructor(bc){super();
this.CBj=bc}}Object(c.a)(gb,"UDPLabelingAppHandlerEventArgs",Sys.EventArgs,[]);var mb=a(106),Ga=a(102),ib=a(41),cc=a(80),ic=a(40);class xb{constructor(bc,Zc,gd,Sc,Gd,Vd,Ed,Od=null,se=null,Le=!1,Id=null,fe=null,Yd=null,Ce=null,ye=!1,Ae=null,He=null,gf=null,Xe=null,$a=null,ac=null){this.url=bc;this.d0j=Zc;this.body=gd;this.headers=Sc;this.reb=Gd;this.priority=Vd;this.state=Ed;this.Tkg=Od;this.wO=se;this.kR=Le;this.j7i=Id;this.Orj=fe;this.name=Yd;this.dHb=Ce;this.$cd=ye;this.NJf=Ae;this.q$b=He;this.Egc=
gf;this.Zcb=Xe;this.fai=$a;this.responseType=ac}}Object(c.a)(xb,"ClientRequest",null,[]);var Vb=a(464),wb=a(263);class cb{static juj(bc,Zc){if(!bc||!Zc||bc.count!==Zc.count)return!1;for(let gd of bc)if(!Zc.contains(gd))return!1;return!0}static toArray(bc){if(!bc)return null;const Zc=Array(bc.count);let gd=0;for(let Sc of bc)Zc[gd]=Sc,gd++;return Zc}}Object(c.a)(cb,"HashSetUtils",null,[]);var lb=a(279),Y=a(189);class Oa{constructor(bc,Zc,gd,Sc=0,Gd=null){this.PIc=this.B8d=null;this.Ira=this.zjb=this.Bjb=
0;this.E8="";this.HFa=this.FGc=this.Nae=this.Hpa=this.pOc=null;this.obe=!1;this.mDa=null;this.qLc=0;this.zWb=this.JFa=this.pEa=this.yWb=null;this.fb=new La.a;this.zMb=this.oxb=this.EFa=null;this.fMc=!1;this.PCb=null;this.lb=bc;this.yh=Zc;this.Ah=gd;this.DVb=Sc;this.pn=new ja;this.Qge=this.lb.Xa("PolicyHandlerEndpointName")||"PolicyHandler.ashx";this.pP=Gd;this.Pzb=bc.qa("WacApplyManualPolicyLabelIsEnabled");this.bhc=bc.qa("CoAuthForProtectedFilesIsEnabled");this.supportsOfficeClientCoauthoring=bc.qa("SupportsOfficeClientCoauthoring");
this.Jqi=!1;this.swj=3E4;this.he=Ga.a.instance;bc.qa("SupportsPolicies")&&H.a("MipSupportsPolicies");this.bhc&&this.supportsOfficeClientCoauthoring&&H.a("MipSupportsOfficeClientCoauthoring")}get Cod(){return this.fMc}ire(bc){this.fb.addHandler("PolicyTipEvent",bc)}J_b(bc){this.fb.addHandler("LabelInfoUpdateEvent",bc)}$fj(bc){this.fb.removeHandler("LabelInfoUpdateEvent",bc)}xre(bc){this.fb.addHandler("SetPolicyLabelEventKey",bc)}lhj(bc){this.fb.removeHandler("SetPolicyLabelEventKey",bc)}YWc(bc){this.fb.addHandler("SetPolicyLabelFailureEventKey",
bc)}khj(bc){this.fb.removeHandler("SetPolicyLabelFailureEventKey",bc)}uKg(bc){this.fb.addHandler("GetPolicyLabelEventKey",bc)}tKg(bc){this.fb.addHandler("GetPolicyLabelFailureEventKey",bc)}rKg(bc){this.fb.addHandler("GetAutoPolicyLabelEventKey",bc);this.Cod&&(b.ULS.sendTraceTag(51668058,306,15,"GetAutoPolicyLabelHandler was registered after the AutoPolicyLabelHandlerEvent was raised"),this.tId(new Ka(0)))}Ffj(bc){this.fb.removeHandler("GetAutoPolicyLabelEventKey",bc)}RJg(bc){this.fb.addHandler("CreateAutoCLPSecurityNodesEventKey",
bc)}jfj(bc){this.fb.removeHandler("CreateAutoCLPSecurityNodesEventKey",bc)}JMg(bc){this.fb.addHandler("UpdateAutoCLPLabelPriorityNodeEventKey",bc)}Ahj(bc){this.fb.removeHandler("UpdateAutoCLPLabelPriorityNodeEventKey",bc)}KMg(bc){this.fb.addHandler("UpdateAutoCLPSITNodesEventKey",bc)}Bhj(bc){this.fb.removeHandler("UpdateAutoCLPSITNodesEventKey",bc)}Tpe(bc){this.fb.addHandler("AddAutoPolicyBusinessBarEntryEventKey",bc)}Bej(bc){this.fb.removeHandler("AddAutoPolicyBusinessBarEntryEventKey",bc)}lre(bc){this.fb.addHandler("RemoveAutoPolicyBusinessBarEntryEventKey",
bc)}Ugj(bc){this.fb.removeHandler("RemoveAutoPolicyBusinessBarEntryEventKey",bc)}Upe(bc){this.fb.addHandler("AddMandatoryLabellingBusinessBarEntryEventKey",bc)}Dej(bc){this.fb.removeHandler("AddMandatoryLabellingBusinessBarEntryEventKey",bc)}mre(bc){this.fb.addHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",bc)}Vgj(bc){this.fb.removeHandler("RemoveMandatoryLabellingBusinessBarEntryEventKey",bc)}cLg(bc){this.fb.addHandler("MandatoryLabellingAppHandlerEventKey",bc)}kgj(bc){this.fb.removeHandler("MandatoryLabellingAppHandlerEventKey",
bc)}FMg(bc){this.fb.addHandler("UDPLabelingAppHandlerEventKey",bc)}xhj(bc){this.fb.removeHandler("UDPLabelingAppHandlerEventKey",bc)}get Opd(){if(!this.B8d)return!1;for(const bc of this.B8d.a4j())if(!bc.Capabilities||!bc.Capabilities.SupportsClientIsMipTrusted)return!1;return!0}get dqi(){return!!this.EFa}i1g(){return this.Nae?this.Nae():!1}Raj(bc){this.FGc=bc}Bw(){return(new Date).getTime()}xfd(){this.Ah&&(this.yWb=this.Ah.Ac("WebServiceCall","Call Get Policy Endpoint On Server"));var bc=lb.a.pia(1,
1);this.lb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(bc=new xb(this.f5a("datalosspolicy"),1,null,null,!0,2,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,bc),this.yh.send(bc).aKd(Object(e.a)(this,this.lAf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.kAf,"onDataLossPolicyFailureCallback"))):this.yh.Pm(this.f5a("datalosspolicy"),1,null,null,!0,2,Object(e.a)(this,this.lAf,"onDataLossPolicySuccessCallback"),Object(e.a)(this,this.kAf,"onDataLossPolicyFailureCallback"),
null);this.Bjb++;b.ULS.sendTraceTag(25565151,306,50,"Policy request is sent to server. The endpoint used is {0}. Policy call times: {1}.",this.Qge,this.Bjb)}waj(){this.wfd(this.E8,2,this.Hpa)}wfd(bc,Zc=0,gd=null,Sc=!1){C.Health.instance.recordKpiUsage("MipGetPolicyLabel",0,"officewebclp",this.Lfd(void 0,Zc));this.oxb=this.Bw();const Gd=this.n5c(Zc);this.Wbc(bc,Gd,gd,Sc,Zc);this.uMd(!0)}lAf(bc){this.tLf();let Zc="";({data:Zc}=this.d_d(bc)).returnValue&&(b.ULS.sendTraceTag(25565153,306,50,"Request to get DataLossPrevention policy succeeded."),
this.Bjb=0,this.Ah&&(this.zWb=this.Ah.Ac("Task","Parse and Handle Get Policy Response")),this.M_i(Zc),this.zWb&&(this.zWb.stop(),this.zWb=null))}kAf(bc){this.tLf();this.Bjb<=this.DVb?this.xfd():(b.ULS.sendTraceTag(25565154,306,15,"Request to get DataLossPrevention policy failed with error response: {0}.",bc?bc.data?bc.data.ERa:null:null),this.Bjb=0)}Zkf(){return 0<this.Ira}setPolicyLabel(bc){this.pn.AppliedPolicyId=bc}DRd(bc,Zc,gd=null){const Sc=this.kbh(gd);this.rwj(bc,Zc,Sc,gd)}bHf(bc){this.JFa&&
(this.JFa.stop(),this.JFa=null);let Zc,gd;({o0f:Zc,V3f:gd}=this.g6e(bc));const Sc=bc.data.state,Gd=Sc?Sc.BM:2;let Vd="";({data:Vd}=this.d_d(bc)).returnValue?(b.ULS.sendTraceTag(41799707,306,50,"Request to set label policy data succeeded. ApplyLabelFlag: {0}",Gd),this.Ira=0,this.d0i(Vd,Zc,gd,Sc)):this.$Nd(Gd)}v8i(bc){C.Health.instance.recordKpiUsage("MipSetPolicyLabel",0,"officewebclp",this.Lfd(bc));this.zMb=this.Bw();b.ULS.sendTraceTag(575947405,306,50,"Raising set policy label triggered event.");
this.fb.raiseEvent("SetPolicyLabelTriggeredEventKey",new Za(bc))}cIi(){this.bhc&&this.supportsOfficeClientCoauthoring&&this.dqi&&this.EFa.bea(12,null,!0)}aHf(bc){this.JFa&&(this.JFa.stop(),this.JFa=null);let Zc;({o0f:gd,V3f:Zc}=this.g6e(bc));if(this.Ira<=this.DVb)this.DRd(gd,Zc);else{var gd=(gd=bc.data.state)?gd.BM:2;b.ULS.sendTraceTag(41799708,306,15,"Request to set label policy failed with error response: {0}. ApplyLabelFlag: {1}",bc?bc.data?bc.data.ERa:null:null,gd);this.PCb="WACServerConnectionFailed";
this.Ira=0;this.$Nd(gd)}}Rpi(bc){if(bc&&("LabelNotSupported"===bc||"LabelErrorRetryLater"===bc||"CoherencyFailure"===bc||"LabelIdNotFound"===bc||"LabelDisabled"===bc))return b.ULS.sendTraceTag(539103556,306,50,"LabelError is retriable: {0}",bc),!0;b.ULS.sendTraceTag(539103557,306,50,"LabelError is not retriable: {0}",bc);return!1}QZg(bc){if(!bc)return!1;let Zc=null,gd=null;for(const Sc of this.pn.SensitivityLabels)Sc.Id===bc&&(Zc=Sc),Sc.Id===this.E8&&(gd=Sc);if(!Zc)return!1;if(this.bhc&&this.supportsOfficeClientCoauthoring){if(this.FGc&&
this.FGc()||this.Opd)return!0}else if(n.AFrameworkApplication.qz&&n.AFrameworkApplication.qz.ewb||this.Hpa&&this.Hpa())return!0;return Zc.IsEndpointProtectionEnabled===(!!gd&&gd.IsEndpointProtectionEnabled)}WZb(bc,Zc,gd,Sc,Gd){28===bc?this.JOf(new ra(bc,Zc,gd,Sc,Gd,!1)):this.JOf(new ra(bc,Zc,gd,Sc,Gd,!0))}Gda(bc){28===bc?this.mPf(new ka(bc,!1)):this.mPf(new ka(bc,!0))}z7i(bc,Zc,gd){b.ULS.sendTraceTag(545280777,306,50,"Raising a CreateAutoCLPSecurityNodes event.");this.fb.raiseEvent("CreateAutoCLPSecurityNodesEventKey",
new fa(bc,Zc,gd))}A8i(bc){b.ULS.sendTraceTag(545280778,306,50,"Raising a UpdateAutoCLPLabelPriorityNode event.");this.fb.raiseEvent("UpdateAutoCLPLabelPriorityNodeEventKey",new fa(null,null,bc))}B8i(bc,Zc){b.ULS.sendTraceTag(545280779,306,50,"Raising a UpdateAutoCLPSITNodes event.");this.fb.raiseEvent("UpdateAutoCLPSITNodesEventKey",new fa(bc,Zc,null))}$Of(bc,Zc){b.ULS.sendTraceTag(572650527,306,50,"Raising a mandatory labelling"+(1===Zc?"Reading":"Edit")+" switch event.");this.fb.raiseEvent("MandatoryLabellingAppHandlerEventKey",
new bb(bc,Zc))}UVc(bc,Zc,gd,Sc,Gd){37===bc&&this.o7i(new pa(37,Zc,gd,Sc,Gd))}XKd(){this.p8i(new ta)}z8i(){b.ULS.sendTraceTag(540608322,306,50,"Raising a UDP labeling event.");this.fb.raiseEvent("UDPLabelingAppHandlerEventKey",new gb(!0))}qha(bc=!1){const Zc=!!this.pn&&this.pn.AreLabelsAvailable&&!!this.pn.SensitivityLabels&&0<this.pn.SensitivityLabels.length&&wb.a.any(this.pn.SensitivityLabels,gd=>!!gd&&gd.Enabled);Zc||bc||ya.sRa(!1);return Zc}hCf(bc){this.pEa&&(this.pEa.stop(),this.pEa=null);var Zc=
"";this.uMd(!1);({data:Zc}=this.d_d(bc)).returnValue?(b.ULS.sendTraceTag(34996493,306,50,"Request to get label policy data succeeded."),this.zjb=0,Zc=this.V_i(Zc),bc=this.U4e(bc.data),C.Health.instance.recordKpiSuccess("MipGetPolicyLabel",this.gbc(void 0,bc,this.oxb)),this.oxb=null,bc=new Ka(bc),this.O7i(bc),this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?Zc&&this.lAj()?this.Cod?this.PUj():(this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",
!1)||this.msb(),this.tId(bc),this.fMc=!0):Zc||this.Msc():!this.Cod&&Zc&&this.lb.qa("WacApplyManualPolicyLabelIsEnabled")&&this.Vue()?(this.tId(bc),this.fMc=!0):Zc||this.Msc()):this.Msc()}lAj(){if(!this.lb.qa("WacApplyManualPolicyLabelIsEnabled"))return b.ULS.sendTraceTag(539877667,306,50,"ShouldAutoClassificationRun returned false - Manual Labeling is not enabled"),!1;if(!this.Vue())return!1;if(""===this.E8)return b.ULS.sendTraceTag(539877696,306,50,"ShouldAutoClassificationRun returned true - document is not labeled"),
!0;if(this.mDa===this.qLc)return b.ULS.sendTraceTag(539877697,306,50,"ShouldAutoClassificationRun returned false - Applied label already has the highest priority"),!1;b.ULS.sendTraceTag(539877698,306,50,"ShouldAutoClassificationRun returned true - document is labeled but not with the highest priority label");return!0}msb(){this.zgg();b.ULS.sendTraceTag(545104324,306,50,"Creating AutoCLP Security nodes. HasSITs: {0}, LabelPriority: {1}",0<this.HFa.count,this.mDa);const bc=cb.toArray(this.HFa);this.z7i(bc,
bc,this.mDa)}PUj(){var bc=this.HFa;this.zgg();cb.juj(bc,this.HFa)||(b.ULS.sendTraceTag(545104325,306,50,"Updating AutoCLP SIT nodes. HasSITs: {0}",0<this.HFa.count),bc=cb.toArray(this.HFa),this.B8i(bc,bc));this.obe&&(b.ULS.sendTraceTag(545104326,306,50,"Updating AutoCLP Label Priority node. LabelPriority: {0}",this.mDa),this.A8i(this.mDa))}zgg(){const bc=new ha.a(h.a.Yj());for(const Zc of this.pn.SensitivityLabels)if(Zc&&Zc.AutoLabelingSensitiveTypeIds&&0<Zc.AutoLabelingSensitiveTypeIds.length)for(const gd of Zc.AutoLabelingSensitiveTypeIds)gd&&
bc.add(gd);this.HFa=bc}gCf(bc){const Zc=this.U4e(bc.data);C.Health.instance.recordKpiFailure("MipGetPolicyLabel","GetPolicyLabelsFailure",!1,!1,this.gbc(void 0,Zc,this.oxb));this.oxb=null;this.pEa&&(this.pEa.stop(),this.pEa=null);if(this.zjb<=this.DVb){if(this.lb.qa("SendHostAttributionInfoForPolicyLabelEnabled")){const gd=bc.data.request.get_headers();if("HostAttributionInfo.ScenarioParamName"in gd&&gd[lb.a.VOd]&&"HostAttributionInfo.ScenarioTypeParamName"in gd&&gd[lb.a.WOd]){bc.data.request.get_headers();
bc.data.request.get_headers();bc=this.n5c(Zc);this.Wbc(this.E8,bc,this.Hpa,void 0,Zc);return}}this.wfd(this.E8,Zc,this.Hpa)}else b.ULS.sendTraceTag(34996494,306,15,"Request to get label policy failed with error response: {0}.",bc?bc.data?bc.data.ERa:null:null),this.Msc(),this.zjb=0,this.uMd(!1)}U4e(bc){return bc.state?bc.state:0}f5a(bc,Zc=!1){let gd=String.format("{0}{1}?action={2}&{3}",this.lb.Xa("PolicyHandlerWebServiceBase")||n.AFrameworkApplication.sa.Pa.Z_,this.Qge,bc,n.AFrameworkApplication.Ii);
"setpolicylabel"===bc&&n.AFrameworkApplication.qz&&n.AFrameworkApplication.qz.rhf&&(gd=cc.a.Nl(gd,"sl","1"));Zc&&(gd=cc.a.Nl(gd,"cbd","1"));return gd}g6e(bc){let Zc,gd;Zc=gd=null;bc&&bc.data&&bc.data.request&&bc.data.request.get_headers()&&(Zc=bc.data.request.get_headers()[Vb.a.p0f],gd=bc.data.request.get_headers()[Vb.a.W3f]);return{o0f:Zc,V3f:gd}}d_d(bc){bc=bc?bc.data?bc.data.ue:null:null;return bc&&bc.length&&!this.Fqi(bc)?{returnValue:!0,data:bc}:(b.ULS.sendTraceTag(25565152,306,10,"No response data from policy endpoint."),
{returnValue:!1,data:bc})}M_i(bc){let Zc;try{Zc=ib.b(bc)}catch(gd){b.ULS.sendTraceTag(37880331,306,10,"Error when deserializing DataLossPrevention response.");return}if(Zc)if(Zc.IsPolicyTipAvailable)switch(Zc.IsPolicyTipAvailable.toLowerCase()){case "false":b.ULS.sendTraceTag(26007261,306,50,"policyData.IsPolicyTipAvailable is false so DLP policy tip is not present.");break;case "true":b.ULS.sendTraceTag(25565186,306,50,"DLP Policy is enabled on this document.");this.PIc=Zc.NavigateUrl;this.rFj(Zc.GeneralText,
Object(e.a)(this,this.NMi,"onDataLossPolicyOverrideButtonClick"));break;default:b.ULS.sendTraceTag(26007262,306,10,"policyData.IsPolicyTipAvailable is expected to be 'true' or 'false' but it is {0}",Zc.IsPolicyTipAvailable)}else b.ULS.sendTraceTag(26007260,306,10,"policyData.IsPolicyTipAvailable is null or empty whereas it should be 'true' or 'false'.");else b.ULS.sendTraceTag(25565185,306,10,"policyData is null after deserializing DataLossPrevention response.")}A8g(bc){switch(bc){case "CoherencyFailure":return 1;
case "DisabledByPolicy":return 2;case "FileCheckedOut":return 3;case "FileEncrypted":return 4;case "FileLocked":return 5;case "FileNotSupported":return 6;case "FileTooLarge":return 7;case "InvalidOperationOnZeroByteFile":return 8;case "LabelDisabled":return 9;case "LabelErrorRetryLater":return 10;case "LabelIdNotFound":return 11;case "LabelIrmDisabledByTenant":return 12;case "LabelNotSupported":return 13;case "MinorVersionLimitExceeded":return 15;default:return 0}}d0i(bc,Zc,gd,Sc){var Gd=Sc?Sc.BM:
2;let Vd=0,Ed="",Od;if(({At:Od}=ib.d(bc)).returnValue)if(Od){Ed="Success";bc=this.n5c(3);if(Od.IsSuccessful){C.Health.instance.recordKpiSuccess("MipSetPolicyLabel",this.gbc(Gd,void 0,this.zMb));this.PCb=this.zMb=null;b.ULS.sendTraceTag(51233632,306,50,"setPolicyLabel was successful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);2===Gd&&this.Gda(29);this.nxj(Zc,Gd);this.cIi();this.Gda(28);Sc&&4===Gd&&this.WZb(28,CommonUIStrings.l_PolicyBusinessBarTitle,String.format(CommonUIStrings.l_PolicyLabelAutomaticallyAppliedMessage,
Sc.displayName),CommonUIStrings.l_DialogOk,()=>{});H.a("MipAppliedLabels",void 0,void 0,[Object.assign(new K.a,{name:"SetPolicyLabelApplyFlag",string:ba[Gd]})]);this.Wbc(Zc,bc,this.Hpa,void 0,3);return}b.ULS.sendTraceTag(51233631,306,10,"setPolicyLabel was unsuccessful as seen after deserializing set policy label data response. ApplyLabelFlag: {0}, FailureReason: {1}",Gd,Od.FailureReason);this.PCb=Od.FailureReason;this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ImproveSetLabelFailureErrMsg",
!1)?Vd=this.A8g(Od.FailureReason):"FileTooLarge"===Od.FailureReason?Vd=7:"LabelNotSupported"===Od.FailureReason?Vd=13:"LabelDisabled"===Od.FailureReason?Vd=9:"MinorVersionLimitExceeded"===Od.FailureReason&&(Vd=15);this.Jqi&&0<=Od.FailureReason.indexOf("InvalidOperationOnZeroByteFile")&&(Sc=new mb.a(2,1,this.swj,()=>{b.ULS.sendTraceTag(575428443,306,15,"Retring SetPolicyLabelRequestAsync as previous called failed due to zero byte. Attempt number : {0}",this.Ira);this.Ira<=this.DVb&&this.DRd(Zc,gd)}),
this.he.Eg(Sc));this.bhc&&this.supportsOfficeClientCoauthoring&&this.Wbc(this.pn.AppliedPolicyId,bc,this.Hpa,!0,3)}else Ed="setPolicyLabelData null.",b.ULS.sendTraceTag(42467541,306,10,"setPolicyLabelData is null after deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);else Ed="TryDeserialize failed.",b.ULS.sendTraceTag(41799709,306,10,"Error when deserializing set policy label data response. ApplyLabelFlag: {0}",Gd);this.$Nd(Gd,Vd);Gd=this.gbc(Gd,void 0,this.zMb);this.zMb=null;
Gd.extendedProperties.set("SetPolicyLabelDataFailureReason",this.PCb);Gd.extendedProperties.set("SetPolicyLabelDataParseStatus",Ed.toString());C.Health.instance.recordKpiFailure("MipSetPolicyLabel","SetPolicyLabelFailure",!1,!1,Gd)}$Nd(bc,Zc=0){const gd=2===bc||8===bc||16===bc;this.setPolicyLabel(this.E8);this.YOf(new Va);this.EId(Zc,bc,gd,!1)}nxj(bc,Zc){this.setPolicyLabel(this.E8=bc);if(""===bc)n.AFrameworkApplication.protectedFile=!1,n.AFrameworkApplication.enableMacrosForProtectedFile=!1;else for(const gd of this.pn.SensitivityLabels)if(gd.Id===
bc){n.AFrameworkApplication.protectedFile=gd.IsEndpointProtectionEnabled;break}this.u8i(new qa(bc,Zc))}MWj(){for(const bc of this.pn.SensitivityLabels)bc&&bc.Enabled&&(bc.Id===this.E8&&(this.obe=this.mDa!==bc.Order,this.mDa=bc.Order),bc.Order>this.qLc&&(this.qLc=bc.Order))}V_i(bc){if(!({At:bc}=ib.d(bc)).returnValue)return b.ULS.sendTraceTag(34996495,306,10,"Error when deserializing label policy data response."),!1;if(!bc)return b.ULS.sendTraceTag(42467542,306,10,"policyData is null after deserializing label policy data response."),
!1;if(!bc.AreLabelsAvailable)return!1;this.pn=bc;this.E8=bc.AppliedPolicyId;this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)&&this.MWj();this.qha()&&b.ULS.sendTraceTag(51197846,306,50,"Labels are available for display after GetPolicyLabels call.");this.YOf(new Va(!0));return!0}Vue(){if(!this.qha())return b.ULS.sendTraceTag(539877699,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels to display"),!1;for(const bc of this.pn.SensitivityLabels)if(bc&&
bc.AutoLabelingSensitiveTypeIds&&0<bc.AutoLabelingSensitiveTypeIds.length)return!0;b.ULS.sendTraceTag(539877700,306,50,"AreAutoLabelingSensitiveTypesAvailable returned false - No labels with AutoClp SIT");return!1}YOf(bc){b.ULS.sendTraceTag(35393610,306,50,"Raising label info update event.");this.fb.raiseEvent("LabelInfoUpdateEvent",bc)}O7i(bc){b.ULS.sendTraceTag(50676305,306,50,"Raising get policy label event.");this.fb.raiseEvent("GetPolicyLabelEventKey",bc)}Msc(){ya.sRa(!1);this.fb.raiseEvent("GetPolicyLabelFailureEventKey",
new aa)}tId(bc){this.pP&&this.pP.execute(Zc=>{Zc=[Zc.isFeatureEnabled("MsoClpSpTwo",!0),Zc.isFeatureEnabled("MsoDrmPremiumSpTwo",!0)];Promise.all(Zc).then(gd=>{wb.a.any(gd,Sc=>Sc)&&(b.ULS.sendTraceTag(50944077,306,50,"Raising get auto policy label event."),this.fb.raiseEvent("GetAutoPolicyLabelEventKey",bc),this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.EnableSecurityNodesAfterLicenseCheck",!1)&&this.msb(),H.a("MipAutoClassificationEnabled"));return null})})}Lfd(bc=null,Zc=null){const gd=
new Map;gd.set("ClpCoauth",this.supportsOfficeClientCoauthoring.toString());null!=bc&&gd.set("ApplyLabelFlags",ba[bc]);null!=Zc&&gd.set("GetPolicyLabelsReason",Ia[Zc]);return gd}gbc(bc=null,Zc=null,gd=null){const Sc=new Y.a;Sc.extendedProperties=this.Lfd(bc,Zc);null!=gd&&(Sc.durationMs=this.Bw()-gd);return Sc}u8i(bc){b.ULS.sendTraceTag(41799710,306,50,"Raising set policy label event.");this.fb.raiseEvent("SetPolicyLabelEventKey",bc)}JOf(bc){b.ULS.sendTraceTag(51128227,306,50,"Raising an add auto policy business bar entry event.");
bc&&bc.lBb&&H.a("MipRecommendations");this.fb.raiseEvent("AddAutoPolicyBusinessBarEntryEventKey",bc)}mPf(bc){b.ULS.sendTraceTag(51128256,306,50,"Raising an remove auto policy business bar entry event.");this.fb.raiseEvent("RemoveAutoPolicyBusinessBarEntryEventKey",bc)}o7i(bc){b.ULS.sendTraceTag(573842331,306,50,"Raising an add mandatory labelling business bar entry event.");this.fb.raiseEvent("AddMandatoryLabellingBusinessBarEntryEventKey",bc)}p8i(bc){b.ULS.sendTraceTag(573842332,306,50,"Raising a remove mandatory labelling business bar entry event.");
this.fb.raiseEvent("RemoveMandatoryLabellingBusinessBarEntryEventKey",bc)}rFj(bc,Zc=null){b.ULS.sendTraceTag(34996496,306,50,"Showing policy tip to user.");this.fb.raiseEvent("PolicyTipEvent",new wa(CommonUIStrings.l_PolicyBusinessBarTitle,bc,CommonUIStrings.l_PolicyOverrideButton,Zc))}EId(bc,Zc,gd,Sc=!0){b.ULS.sendTraceTag(42074656,306,Sc?50:15,"Raising set policy label failure event. ApplyLabelFlags: {0}",Zc);Sc=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarTitle;let Gd=CommonUIStrings.l_SensitivityApplicationErrorBusinessBarMessage,
Vd=null,Ed=null;switch(bc){case 2:Sc=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorDisabledByPolicyBusinessBarMessage;break;case 5:Gd=CommonUIStrings.l_SensitivityApplicationErrorFileLockedBusinessBarMessage;break;case 7:Sc=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorFileTooLargeBusinessBarMessage;break;case 13:Sc=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarTitle;
Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelNotSupportedBusinessBarMessage;break;case 9:Sc=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarTitle;Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelDisabledBusinessBarMessage;break;case 10:Gd=CommonUIStrings.l_SensitivityApplicationErrorLabelErrorRetryLaterBusinessBarMessage;break;case 14:Sc=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorTitle;Gd=CommonUIStrings.l_SensitivityCoauthMandatoryApplicationErrorMessage;
break;case 15:Sc=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarTitle,Gd=CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedBusinessBarMessage,Vd=CommonUIStrings.l_LearnMore,Ed=()=>{this.twj()}}bc=new rb(bc,Zc,gd,Sc,Gd,Vd,Ed);this.fb.raiseEvent("SetPolicyLabelFailureEventKey",bc)}Evj(bc){this.pOc=bc}NMi(){this.PIc?(b.ULS.sendTraceTag(25565187,306,50,"DLP override button was clicked."),ic.a.YU(this.PIc)):b.ULS.sendTraceTag(25565188,306,10,"Null NavigateUrl got in policy response. Could not navigate to SPO.")}Fqi(bc){if(!bc.startsWith("<")||
-1===bc.indexOf("Error")&&-1===bc.indexOf("Unavailable"))return!1;b.ULS.sendTraceTag(25565189,306,10,"The response from server is not a valid JSON response and it matches the error page keyword. This might be the error response from a non-existing endpoint.");return!0}tLf(){this.yWb&&(this.yWb.stop(),this.yWb=null)}ALh(bc){if(!bc)return"manual";switch(bc.BM){case 0:return"manual";case 4:return"auto";case 1:return"default";case 16:return"mandatory";case 2:return"manual";case 8:return"recommended";
default:return"manual"}}HMh(bc){if(!bc)return"privileged";bc=bc.BM;let Zc="privileged";if(4===bc||1===bc)Zc="standard";return Zc}Wbc(bc,Zc,gd=null,Sc=!1,Gd=0){this.lb.qa("WacLabelingGetPolicyLabelsIsEnabled")&&(this.E8=bc,this.Hpa=gd,this.Ah&&(this.pEa=this.Ah.Ac("WebServiceCall","Call Get Policy Endpoint On Server")),gd={},gd[Vb.a.MPg]=bc,this.lb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(bc=new xb(this.f5a("getpolicylabels",Sc),1,null,gd,!0,2,Gd,void 0,void 0,void 0,void 0,void 0,void 0,
void 0,void 0,void 0,void 0,void 0,void 0,Zc),this.yh.send(bc).aKd(Object(e.a)(this,this.hCf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.gCf,"onGetPolicyLabelsFailureCallback"))):this.yh.Pm(this.f5a("getpolicylabels",Sc),1,null,gd,!0,2,Object(e.a)(this,this.hCf,"onGetPolicyLabelsSuccessCallback"),Object(e.a)(this,this.gCf,"onGetPolicyLabelsFailureCallback"),Gd,void 0,void 0,void 0,void 0,"22"),this.zjb++,b.ULS.sendTraceTag(34996492,306,50,"Policy label request sent to server. Policy call times: {0}",
this.zjb))}rwj(bc,Zc,gd,Sc=null){if(this.Pzb){this.Ah&&(this.JFa=this.Ah.Ac("WebServiceCall","Call Set Policy Endpoint On Server"));var Gd={};Gd[Vb.a.p0f]=bc;Zc&&(Gd[Vb.a.W3f]=encodeURIComponent(Zc));this.pOc&&(Gd[Vb.a.dPg]=this.pOc);Sc?(Gd[Vb.a.T3f]=this.ALh(Sc),Gd[Vb.a.U3f]=this.HMh(Sc)):(Gd[Vb.a.T3f]="manual",Gd[Vb.a.U3f]="privileged");this.supportsOfficeClientCoauthoring&&this.pn&&(Gd[Vb.a.S1i]=this.pn.PolicyLabelVersionToken);this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.DefaultLabelForSPODocLibEnabled",
!1)&&1===Sc.BM&&this.pn.DefaultLabelType&&(Gd[Vb.a.qwj]=this.pn.DefaultLabelType);this.lb.qa("SendHostAttributionInfoForPolicyLabelEnabled")?(bc=new xb(this.f5a("setpolicylabel",!0),1,null,Gd,!0,2,Sc,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,gd),this.yh.send(bc).aKd(Object(e.a)(this,this.bHf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.aHf,"onSetPolicyLabelFailureCallback"))):this.yh.Pm(this.f5a("setpolicylabel",!0),1,null,Gd,!0,2,Object(e.a)(this,
this.bHf,"onSetPolicyLabelSuccessCallback"),Object(e.a)(this,this.aHf,"onSetPolicyLabelFailureCallback"),Sc,void 0,void 0,void 0,void 0,"32");this.Ira++;b.ULS.sendTraceTag(41799706,306,50,"Set policy label request sent to server. Policy call times: {0}",this.Ira)}else b.ULS.sendTraceTag(570972052,306,50,"SetPolicyLabelRequestInternalAsync was exited - ApplyManualPolicyLabel was not enabled.")}twj(){const bc=new N.StandardDialog,Zc=this.lb.Xa("BreadcrumbFolderUrl");Zc?(bc.Rb=11,bc.oc(1,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoAction),
bc.oc(2,CommonUIStrings.l_DialogOk)):(bc.Rb=0,bc.oc(1,CommonUIStrings.l_DialogOk));bc.Moe(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoHelpText,"0f6cd105-974f-44a4-aadb-43ac5bdfd247");bc.Jdj();bc.kX(CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoTitle,CommonUIStrings.l_SensitivityApplicationErrorMinorVersionLimitReachedViewInfoMessage,gd=>{1===gd&&Zc&&ic.a.lf(Zc,"_blank",void 0,"SetPolicyLabelFailureBusinessBarActionCallback.BreadcrumbFolderUrl")})}n5c(bc){switch(bc){case 1:return lb.a.pia(1,
1);case 2:return lb.a.pia(7,1);case 3:return lb.a.pia(8,1);default:return lb.a.pia(7,0)}}kbh(bc=null){if(!bc)return lb.a.pia(8,0);switch(bc.BM){case 1:case 16:return lb.a.pia(1,1);case 4:case 2:case 8:return lb.a.pia(8,1);default:return lb.a.pia(8,0)}}uMd(bc){this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)&&appChrome.api.setAsyncRequestStatus("sensitivity",bc)}}Object(c.a)(Oa,"PolicyManager",null,[641]);var Wa=a(135),Ca=a(248);class Ra{constructor(){this.G1=
this.qra=this.gb=this.ah=null}get name(){return"Common.App.Policy"}init(){n.AFrameworkApplication.fa.qa("ShouldInitCommonPolicyPackage")&&(n.AFrameworkApplication.fa.qa("IsDataLossPreventionEnabledForUser")&&n.AFrameworkApplication.sa&&(this.ah=this.gb.resolve("Common.App.Policy.Contracts.IPolicyManager"),this.ah.ire(Object(e.a)(this,this.MUd,"showPolicyBusinessBar")),b.ULS.sendTraceTag(36537375,306,50,"PolicyManager is created successfully."),Wa.a.get_instance().Xj(6,()=>{this.ah.xfd()})),n.AFrameworkApplication.fa.qa("WacLabelingPoliciesIsEnabled")&&
n.AFrameworkApplication.fa.qa("SupportsPolicies")?Wa.a.get_instance().Xj(6,Object(e.a)(this,this.UJi,"onAfterRibbonBehaviorAttached")):ya.sRa(!1))}dispose(){}Wh(bc){bc.register(641,"Common.App.Policy.Contracts.IPolicyManager").xc().Fc(()=>new Oa(n.AFrameworkApplication.fa,n.AFrameworkApplication.Dd,n.AFrameworkApplication.sa.iE,n.AFrameworkApplication.fa.rd("MaxGetPolicyRetries",1),bc.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),n.AFrameworkApplication.sa.Pa.Gj));bc.register(ya,
"Common.App.Policy.PolicyActor").as("Common.App.Policy.Contracts.IPolicyActor").xc().Fc(()=>new ya(n.AFrameworkApplication.ub,n.AFrameworkApplication.sa,n.AFrameworkApplication.fa,bc.ENd("Common.App.Policy.Contracts.IPolicyManager")));this.gb=bc}UJi(){this.G1=this.gb.Kh("CommonUI.BusinessBar");this.ah||(this.ah=this.gb.resolve("Common.App.Policy.Contracts.IPolicyManager"));this.qra=this.gb.resolve("Common.App.Policy.PolicyActor");n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",
!1)&&Q.a("isSharedUxGateEnabled")&&appChrome.api.isSharedUxGateEnabled("SharedOnline.ChangeGate.DelayPolicyActionRegistration")?this.ah.J_b(Object(e.a)(this.qra,this.qra.TRf,"registerActionsHandler")):this.qra.Hg();this.ah.J_b(Object(e.a)(this,this.r0d,"updateLabelInfo"));n.AFrameworkApplication.fa.qa("WacApplyManualPolicyLabelIsEnabled")&&(this.ah.YWc(Object(e.a)(this,this.b8h,"handleSetPolicyLabelFailure")),this.ah.Tpe(Object(e.a)(this,this.WZb,"addAutoPolicyBusinessBarEntry")),this.ah.lre(Object(e.a)(this,
this.Gda,"removeAutoPolicyBusinessBarEntry")),this.ah.Upe(Object(e.a)(this,this.UVc,"addMandatoryLabellingBusinessBarEntry")),this.ah.mre(Object(e.a)(this,this.XKd,"removeMandatoryLabellingBusinessBarEntry")))}r0d(){this.qra.O3f();this.qra.h3f();this.qra.vOf();const bc=this.ah.i1g();n.AFrameworkApplication.fa.qa("HasDocumentEditRights")&&!bc?this.qra.Udg():b.ULS.sendTraceTag(558682911,306,50,"Default/Mandatory Labeling has been skipped because HasDocumentEditRights: {0}, IsClpBlockedByAppSpecificScenario: {1}",
n.AFrameworkApplication.fa.qa("HasDocumentEditRights"),bc);n.AFrameworkApplication.sa.updateCommandUI()}MUd(bc,Zc){this.S4e(Zc.title,Zc.Erc,38,Zc.Pyf,Zc.buttonText);b.ULS.sendTraceTag(34174784,306,10,"Failed to add entry to business bar. Policy message could not be shown to user.")}b8h(bc,Zc){Zc.V7f&&(this.S4e(Zc.title,Zc.message,21,null,null,Zc.j3,Zc.buttonText),b.ULS.sendTraceTag(42074654,306,10,"Failed to add entry to business bar. CLP policy message could not be shown to user."))}Gda(){}WZb(bc,
Zc){this.G1&&(this.ah.Gda(Zc.nqb),bc=new f.a(Zc.title,Zc.message,null),bc.id=Zc.nqb,bc.closeable=!0,bc.image=3,bc.addButton(Zc.buttonText,Zc.j3,Zc.buttonText,!0),this.G1.zC(bc,!1))}UVc(bc,Zc){this.G1&&(bc=new f.a(Zc.title,Zc.message,null),bc.id=Zc.nqb,bc.closeable=!1,bc.image=3,bc.addButton(Zc.buttonText,Zc.j3,Zc.buttonText,!1),this.G1.zC(bc,!1))}XKd(){}S4e(bc,Zc,gd,Sc=null,Gd=null,Vd=null,Ed=null){bc=new f.a(bc,Zc,null);bc.id=gd;bc.closeable=!0;Sc&&bc.TGg(Gd,Sc);Vd&&bc.addButton(Ed,Vd,Ed)}static main(){Ca.a.instance.Fi(new Ra)}}
Object(c.a)(Ra,"PackageManager",null,[4,5]);var la=a(9),ua=a(552),xa=a(222),fb=a(50),Jb=a(37),Ob=a(83),eb=a(38),Ma=a(174),va=a(371),Pa=a(188),Ha=a(91),tb=a(29),Ya=a(282),V=a(1),za=a(22),yb=a(281);class jc{constructor(){this.Drc=this.g1f=null;this.BM=0}}Object(c.a)(jc,"ApplyPolicyContextParameters",null,[]);var Cc=a(7),Sa=a(691),na=a(562),jb=a(47),Ib=a(46);class dc{constructor(){this.$Ga=this.annotationType=null;this.JMa=this.sy=!1}}Object(c.a)(dc,"AnnotationActivationOptions",null,[]);var ob=a(60);
const Fa=(bc,Zc,gd,Sc,Gd,Vd,Ed=null)=>{Ed=bc.Na(1,Ed);Ed.tenantId=Zc;return ob.g(bc,"GetPolicyLabelId",Ed,gd,Sc,Gd,Vd,4)},Ab=(bc,Zc,gd,Sc,Gd,Vd,Ed,Od,se,Le,Id=null)=>{Id=bc.Na(41,Id);Id.labelsInfoJson=Zc;Id.appliedLabelId=gd;Id.tenantId=Sc;Id.applyLabelFlag=Gd;Id.skipApplyOutcomes=Vd;return ob.g(bc,"ApplyPolicyLabel",Id,Ed,Od,se,Le,0)},$b=(bc,Zc,gd,Sc,Gd,Vd,Ed=null)=>{Ed=bc.Na(1,Ed);Ed.tenantId=Zc;return ob.g(bc,"GetPolicyApplicationMethod",Ed,gd,Sc,Gd,Vd,4)};var Cb=a(722),Rb=a(697);class uc extends Cb.a{constructor(){super();
this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Rb.a,{T_:uc.getTypeName(),B_:uc.Pd()})}static getTypeName(){return"AugLoop_SecurityClp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(uc,"LabellingAnnotation",Cb.a,[]);var nb=a(713);class Fb extends nb.a{constructor(){super();this.fullDocSITs=this.partialDocSITs=null;this.H_=Object.assign(new Rb.a,{T_:Fb.getTypeName(),B_:Fb.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_SecurityShared"}static Pd(){return[]}}
Object(c.a)(Fb,"SecurityShared",nb.a,[]);class Jc extends Fb{constructor(){super();this.existingLabelPriority=null;this.H_=Object.assign(new Rb.a,{T_:Jc.getTypeName(),B_:Jc.Pd()})}static getTypeName(){return"AugLoop_SecurityShared_CLP"}static Pd(){return["AugLoop_SecurityShared_SecurityShared"]}}Object(c.a)(Jc,"CLP",Fb,[]);class Fc extends Cb.a{constructor(){super();this.source=this.automatic=this.recommended=null;this.H_=Object.assign(new Rb.a,{T_:Fc.getTypeName(),B_:Fc.Pd()})}static getTypeName(){return"AugLoop_Automatic_Clp_LabellingAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}
Object(c.a)(Fc,"LabellingAnnotation",Cb.a,[]);var zb=a(969),hb=a(865),Pb=a(971);class ud extends Cb.a{constructor(){super();this.classificationId=null;this.H_=Object.assign(new Rb.a,{T_:ud.getTypeName(),B_:ud.Pd()})}static getTypeName(){return"AugLoop_LinkedDataType_LinkedDataTypeAnnotation"}static Pd(){return["AugLoop_Core_Annotation"]}}Object(c.a)(ud,"LinkedDataTypeAnnotation",Cb.a,[]);class Ub extends eb.a{constructor(bc,Zc,gd,Sc,Gd){super();this.vtf=3;this.SA=this.augmentationLoopManager=null;
this.B_a=!1;this.uab=[];this.$nf=new Sa.a(na.a.vK());this.gHd=0;this.lHd=null;this.msb=(Vd,Ed)=>{Vd=Object(Cc.a)(new zb.a,{parentPath:["session","doc","security"],items:[Object(Cc.a)(new hb.a,{id:"clp",body:Object(Cc.a)(new Jc,{existingLabelPriority:Ed.existingLabelPriority,partialDocSITs:Ed.hDe,fullDocSITs:Ed.gDe})})]});this.uab.push(Vd);this.qzb()};this.xgg=(Vd,Ed)=>{Vd=Object(Cc.a)(new Pb.a,{parentPath:["session","doc","security"],items:[Object(Cc.a)(new hb.a,{id:"clp",body:Object(Cc.a)(new Jc,
{existingLabelPriority:Ed.existingLabelPriority})})]});this.uab.push(Vd);this.qzb()};this.ygg=(Vd,Ed)=>{Vd=Object(Cc.a)(new Pb.a,{parentPath:["session","doc","security"],items:[Object(Cc.a)(new hb.a,{id:"clp",body:Object(Cc.a)(new Jc,{partialDocSITs:Ed.hDe,fullDocSITs:Ed.gDe})})]});this.uab.push(Vd);this.qzb()};this.yR=()=>{b.ULS.sendTraceTag(537154588,306,50,`AutoPolicyManager::OnApplicationModeChanged - isEditMode:${this.$.isEditMode}.`);this.$.isEditMode?V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",
!1)?this.qzb():this.bdf():(this.businessBar.removeEntry(41),this.businessBar.removeEntry(40),this.dhh())};this.pPa=()=>{b.ULS.sendTraceTag(537154587,306,50,"AutoPolicyManager::OnAugmentationLoopSessionClose called.");this.JKe();this.augmentationLoopManager=null};this.Gui=(Vd,Ed)=>{var Od,se,Le,Id,fe;b.ULS.sendTraceTag(537154586,306,50,"AutoPolicyManager::LabellingAnnotationHandler called.");if(3===Ed.operationType)b.ULS.sendTraceTag(537154585,306,50,"AutoPolicyManager::LabellingAnnotationHandler Ignoring delete operation.");
else{var Yd=Vd=null,Ce=null;if(this.Ngc()){var ye=Ed.AM;if(!ye){b.ULS.sendTraceTag(537154584,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");return}if(null===(Od=ye.automatic)||void 0===Od?0:Od.id)Vd=ye.automatic.id;if(null===(se=ye.recommended)||void 0===se?0:se.id)Yd=ye.recommended.id,ye.recommended.policyTip&&(Ce=ye.recommended.policyTip)}else{Od=Ed.AM;if(!Od){b.ULS.sendTraceTag(537154583,306,50,"AutoPolicyManager::LabellingAnnotationHandler LabellingAnnotation is null.");
return}if(null===(Le=null===(ye=Od.automatic)||void 0===ye?void 0:ye.sensitivityLabel)||void 0===Le?0:Le.id)Vd=Od.automatic.sensitivityLabel.id;if(null===(fe=null===(Id=Od.recommended)||void 0===Id?void 0:Id.sensitivityLabel)||void 0===fe?0:fe.id)Yd=Od.recommended.sensitivityLabel.id,Od.recommended.sensitivityLabel.policyTip&&(Ce=Od.recommended.sensitivityLabel.policyTip)}this.applyPolicyLabel(Vd,Yd,Ce,1)}};this.Bwi=(Vd,Ed)=>{b.ULS.sendTraceTag(537154582,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Handler called.");
3===Ed.operationType?b.ULS.sendTraceTag(537154581,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received delete operation."):(Vd=Ed.AM)?(Vd=Vd.classificationId,this.applyPolicyLabel(Vd,Vd,null,2)):b.ULS.sendTraceTag(537154580,306,50,"AutoPolicyManager::LinkedDataTypeLabellingAnnnotationHandler - Received an empty annotation.")};this.VSf=(Vd,Ed)=>{Ed?Ed.lBb&&this.businessBar.$E(41)?(this.businessBar.removeEntry(41),b.ULS.sendTraceTag(537154562,306,50,"Remove entry to RecommendedSensitivityLabelBusinessBarEntry succeeded.")):
!Ed.lBb&&this.businessBar.$E(40)&&(this.businessBar.removeEntry(40),b.ULS.sendTraceTag(537154561,306,50,"Remove entry to AutomaticSensitivityLabelBusinessBarEntry succeeded.")):b.ULS.sendTraceTag(537154563,306,15,"RemoveAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.h7f=(Vd,Ed)=>{Ed?Ed.lBb?(this.businessBar.FFj(Ed.title,Ed.message,Ed.buttonText,Od=>{Ed.j3(Od);this.businessBar.$E(41)&&this.businessBar.removeEntry(41)}),b.ULS.sendTraceTag(537154531,306,50,
"Add entry to RecommendedSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):(this.businessBar.xDj(Ed.title,Ed.message,Ed.buttonText,Od=>{Ed.j3(Od);this.businessBar.$E(40)&&this.businessBar.removeEntry(40)}),b.ULS.sendTraceTag(537154530,306,50,"Add entry to AutomaticSensitivityLabelBusinessBarEntry succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154560,306,15,"ShowAutoPolicyBusinessBar is called but AddAutoPolicyBusinessBarEntryEventArgs is null.")};this.VFd=bc;
this.policyManager=Zc;this.$=gd;this.fa=Sc;this.businessBar=Gd;this.bci();this.Taj();this.disposed=!1}get Zb(){return!this.disposed&&this.$.ea.Zb}dispose(){this.disposed||(this.disposed=!0,this.Vih(),this.JKe(),this.VFd=this.policyManager=this.augmentationLoopManager=null,super.dispose())}h_a(bc,Zc,gd,Sc,Gd=!1){b.ULS.sendTraceTag(537154642,306,50,`AutoPolicyManager: ApplyAutoPolicyLabel called for LabellingSource ${Sc} with AutoLabelPresent: ${!!bc}, RecommendedLabelPresent: ${!!Zc}, isStandard: ${Gd}.`);
this.Zb?this.VFd&&(this.RZg(Zc,Sc)?(this.lHd=Zc,this.gHd=Sc,this.$nf.ia(Sc,Zc)):Zc=this.lHd,bc=this.VFd.h_a(bc,Zc,gd,Gd),b.ULS.sendTraceTag(537154640,306,50,`AutoPolicyManager::ApplyAutoPolicyLabel - policyActor.ApplyAutoPolicyLabel returned ${bc}.`)):b.ULS.sendTraceTag(537154641,306,15,`AutoPolicyManager: ApplyAutoPolicyLabel failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}RZg(bc,Zc){if(!this.policyManager.qha())return b.ULS.sendTraceTag(537154639,306,15,"CanShowRecommendedSensitivityLabel - Labels are not available."),
!1;const gd=this.policyManager.pn;let Sc;({value:Sc}=this.$nf.Dc(this.gHd));let Gd=null,Vd=null,Ed=null;for(const Od of gd.SensitivityLabels)Od.Id===bc&&(Gd=Od),Od.Id===Sc&&(Vd=Od),Od.Id===this.lHd&&(Ed=Od);return Vd&&Vd.Id===bc?(b.ULS.sendTraceTag(537154638,306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since it is same as last recommendation from current source."),!1):this.businessBar.$E(41)&&this.gHd!==Zc&&Ed&&(!Gd||Ed.Order>=Gd.Order)?(b.ULS.sendTraceTag(537154637,
306,50,"AutoPolicyManager: CanShowRecommendedSensitivityLabel - Suppressing the recommendation since current label priority is lower than last label priority."),!1):!0}Ngc(){return V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)}Gff(){return V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPSecurityNodeCreation",!1)}Taj(){this.policyManager.Tpe(this.h7f);this.policyManager.lre(this.VSf);this.$.ea.DY(this.yR);this.Ngc()&&this.Gff()&&
(this.policyManager.RJg(this.msb),this.policyManager.JMg(this.xgg),this.policyManager.KMg(this.ygg))}Vih(){this.businessBar.removeEntry(41);this.businessBar.removeEntry(40);this.policyManager.Bej(this.h7f);this.policyManager.Ugj(this.VSf);this.$.ea.w0(this.yR);this.Ngc()&&this.Gff()&&(this.policyManager.jfj(this.msb),this.policyManager.Ahj(this.xgg),this.policyManager.Bhj(this.ygg))}bci(){this.SA=new Sa.a(na.a.vK());const bc=this.Ngc()?uc.getTypeName():Fc.getTypeName();this.SA.add(1,Object(Cc.a)(new dc,
{annotationType:bc,$Ga:this.Gui,sy:!1,JMa:!1}));this.SA.add(2,Object(Cc.a)(new dc,{annotationType:ud.getTypeName(),$Ga:this.Bwi,sy:!1,JMa:!1}))}wag(){for(let bc of this.uab)this.augmentationLoopManager.submitOperation(bc);this.uab=[]}Oaj(bc){if(!this.SA.mb(bc))return b.ULS.sendTraceTag(537154636,306,15,`AutoPolicyManager::RegisterAnnotation - AnnotationActivationOptions not available for LabellingSource ${bc}.`),!1;if(this.SA.na(bc).sy)return b.ULS.sendTraceTag(537154635,306,15,`AutoPolicyManager::RegisterAnnotation - Annotations already registered for LabellingSource ${bc}.`),
!0;this.SA.na(bc).sy=!0;b.ULS.sendTraceTag(537154634,306,50,`AutoPolicyManager::RegisterAnnotation - Annotations registered for LabellingSource ${bc}.`);if(!this.$.isEditMode)return b.ULS.sendTraceTag(537154633,306,50,"AutoPolicyManager::RegisterAnnotation - Skipping AugmentationLoop initialization in view mode."),!0;V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.AutoCLPV2Transition",!1)?this.qzb():this.bdf();return!0}bdf(){var bc=!1;for(let Zc of this.SA)if(bc=Zc.value.sy||bc)break;
bc?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154631,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop already initialized."),this.vZb()):this.B_a?b.ULS.sendTraceTag(537154630,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - AugmentationLoop initialization in-progress."):(this.B_a=!0,bc=this.$.va.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154629,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - Initializing AugmentationLoop in ${bc} milliseconds.`),
jb.a.instance.create(()=>{this.dci()},bc,Ib.a.rwe,!0,!0)):b.ULS.sendTraceTag(537154632,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessaryAndActivateAnnotations - no registered annotations.")}qzb(){var bc=0<this.uab.length;if(!bc)for(let Zc of this.SA)if(bc=Zc.value.sy||bc)break;bc?this.augmentationLoopManager?(b.ULS.sendTraceTag(537154627,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop already initialized."),this.vZb(),this.wag()):this.B_a?b.ULS.sendTraceTag(537154626,
306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - AugmentationLoop initialization in-progress."):(this.B_a=!0,bc=this.$.va.FlightingSettings.AutoCLPStartUpDelay,b.ULS.sendTraceTag(537154625,306,50,`AutoPolicyManager::InitAugmentationLoopIfNecessary - Initializing AugmentationLoop in ${bc} milliseconds.`),jb.a.instance.create(()=>{this.eci()},bc,Ib.a.rwe,!0,!0)):b.ULS.sendTraceTag(537154628,306,50,"AutoPolicyManager::InitAugmentationLoopIfNecessary - no registered annotations and operations.")}eci(){Jb.TaskExtensions.Aa(fb.GetServiceTaskFactory.Oa(this.$.da,
328,327,1),bc=>{this.augmentationLoopManager=bc.result;this.B_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(537154595,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.YZb(this.pPa),this.$.isEditMode?(this.vZb(),this.wag()):b.ULS.sendTraceTag(537154594,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154624,306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},
this.la,3)}dci(){Jb.TaskExtensions.Aa(fb.GetServiceTaskFactory.Oa(this.$.da,328,327,1),bc=>{this.augmentationLoopManager=bc.result;this.B_a=!1;this.augmentationLoopManager?(b.ULS.sendTraceTag(571479120,306,50,"AutoPolicyManager::InitAugmentationLoop - AugmentationLoopManager instantiated."),this.augmentationLoopManager.YZb(this.pPa),this.$.isEditMode?this.vZb():b.ULS.sendTraceTag(537154592,306,50,"AutoPolicyManager::InitAugmentationLoop - Skipping annotation activation in view mode.")):b.ULS.sendTraceTag(537154593,
306,10,"AutoPolicyManager::InitAugmentationLoop - Failed to instantiate AugmentationLoopManager.")},this.la,3)}JKe(){for(let bc of this.SA)bc.value.sy&&this.Uih(bc.key)}Uih(bc){this.SA.na(bc).JMa&&this.IJe(bc);this.SA.na(bc).sy=!1;b.ULS.sendTraceTag(537154591,306,50,`AutoPolicyManager::DeregisterAnnotation completed for LabellingSource ${bc}.`)}vZb(){for(let bc of this.SA)bc.value.sy&&!bc.value.JMa&&this.activateAnnotation(bc.key)}activateAnnotation(bc){this.augmentationLoopManager.activateAnnotation(this.SA.na(bc).annotationType);
this.augmentationLoopManager.yY(this.SA.na(bc).annotationType,this.SA.na(bc).$Ga);this.SA.na(bc).JMa=!0;b.ULS.sendTraceTag(537154590,306,50,`AutoPolicyManager::ActivateAnnotation completed for LabellingSource ${bc}.`)}dhh(){for(let bc of this.SA)bc.value.JMa&&this.IJe(bc.key)}IJe(bc){this.augmentationLoopManager.fRa(this.SA.na(bc).annotationType,this.SA.na(bc).$Ga);this.SA.na(bc).JMa=!1;b.ULS.sendTraceTag(537154589,306,50,`AutoPolicyManager::DeactivateAnnotation completed for LabellingSource ${bc}.`)}applyPolicyLabel(bc,
Zc,gd,Sc){if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154579,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is enabled."),this.h_a(bc,Zc,gd,Sc);else{b.ULS.sendTraceTag(537154578,306,50,"AutoPolicyManager::ApplyPolicyLabel - SupportsOfficeClientCoauthoring is disabled.");const Gd=Vd=>{this.h_a(bc,Zc,gd,Sc,0===Vd||1===Vd||4===Vd)};this.xhd(Gd,()=>{Gd(2)},this.vtf)}}$Yc(bc,Zc){let gd=null,Sc=null;if(!({sensitivityLabel:gd,bHa:Sc}=this.Jeg(bc)).returnValue)return b.ULS.sendTraceTag(537154577,
306,15,"AutoApplyOrRecommendPolicyLabel - Failed to set the sensitivity labels."),!1;if(Sc&&Sc.Order>=gd.Order)return b.ULS.sendTraceTag(537154576,306,50,"AutoApplyOrRecommendPolicyLabel - The applied label has a higher sensitivty."),!1;this.applyPolicyLabel(gd.Id,gd.Id,null,Zc);return!0}aZc(bc,Zc){Zc=!1;let gd=null,Sc=null;if(!({sensitivityLabel:gd,bHa:Sc}=this.Jeg(bc)).returnValue)return b.ULS.sendTraceTag(537154575,306,15,"AutoApplyOrRecommendPowerBILabel - Failed to set the sensitivity labels."),
{returnValue:!1,h7a:Zc};if(Sc&&Sc.ParentId&&gd.ParentId&&Sc.ParentId===gd.ParentId)return b.ULS.sendTraceTag(537154574,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label has a common parent with AppliedLabel."),{returnValue:!1,h7a:Zc};if(Sc&&Sc.Order>=gd.Order)return b.ULS.sendTraceTag(537154573,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - Label does not have a higher priority than AppliedLabel."),{returnValue:!1,h7a:Zc};if(this.fa.qa("SupportsOfficeClientCoauthoring"))b.ULS.sendTraceTag(537154572,
306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is enabled."),bc=this.policyManager.pn,bc=!bc.AppliedPolicyId||!bc.PolicyLabelAssignmentMethod||X.e(bc.PolicyLabelAssignmentMethod)===X.e("standard"),this.Oue(gd.Id,bc);else{b.ULS.sendTraceTag(537154571,306,50,"AutoPolicyManager::AutoApplyOrRecommendPowerBILabel - SupportsOfficeClientCoauthoring is disabled.");const Gd=Vd=>{this.Oue(gd.Id,0===Vd||1===Vd||4===Vd)};this.xhd(Gd,()=>{Gd(2)},this.vtf)}return{returnValue:!0,
h7a:Zc}}xhd(bc,Zc,gd,Sc=0){if(this.Zb){var Gd=this.$.pa.ya.Wb();$b(this.$.pa.ya,this.$.va.DocumentHostInfo.TenantId,Vd=>{this.uYh(Vd,bc)},()=>{this.tYh(bc,Zc,gd,Sc)},null,null,Gd)}else b.ULS.sendTraceTag(537154570,306,15,`AutoPolicyManager: GetPolicyApplicationMethod failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}uYh(bc,Zc){b.ULS.sendTraceTag(537154569,306,50,"AutoPolicyManager: GetPolicyApplicationMethod web service call was successful.");this.Zb?!bc||Ya.a(bc)?
b.ULS.sendTraceTag(537154567,306,15,bc?"AutoPolicyManager: GetPolicyApplicationMethod result has non-status message.":"AutoPolicyManager: GetPolicyApplicationMethod result is null"):Zc(bc.Result):b.ULS.sendTraceTag(537154568,306,50,`AutoPolicyManager: GetPolicyApplicationMethodSuccessCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}tYh(bc,Zc,gd,Sc){b.ULS.sendTraceTag(537154566,306,15,"AutoPolicyManager: GetPolicyApplicationMethod web service call failed. Trying again");
this.Zb?Sc>=gd?(b.ULS.sendTraceTag(537154564,306,15,"AutoPolicyManager: GetPolicyApplicationMethod max retries exhausted."),Zc()):this.xhd(bc,Zc,gd,Sc+1):b.ULS.sendTraceTag(537154565,306,50,`AutoPolicyManager: GetPolicyApplicationMethodFailureCallback failing because IsDisposed: ${this.disposed}, IsSessionActive: ${this.$.ea.Zb}.`)}Oue(bc,Zc){Zc?this.h_a(bc,null,null,3,!0):this.h_a(null,bc,null,3,!1)}Jeg(bc){let Zc,gd;gd=Zc=null;if(!this.$.isEditMode)return{returnValue:!1,sensitivityLabel:Zc,bHa:gd};
if(!this.policyManager.qha())return b.ULS.sendTraceTag(537154529,306,15,"TryGettingSensitivityLabels - Labels are not available."),{returnValue:!1,sensitivityLabel:Zc,bHa:gd};const Sc=this.policyManager.pn;if(!Sc)return b.ULS.sendTraceTag(537154528,306,15,"TryGettingSensitivityLabels - GetPolicyLabelsData returned an invalid result."),{returnValue:!1,sensitivityLabel:Zc,bHa:gd};if(wb.a.Dh(Sc.SensitivityLabels))return b.ULS.sendTraceTag(537154527,306,15,"TryGettingSensitivityLabels - Attempting to apply labels when there are no sensitivity labels available."),
{returnValue:!1,sensitivityLabel:Zc,bHa:gd};const Gd=Sc.AppliedPolicyId;for(const Vd of bc)for(const Ed of Sc.SensitivityLabels)Ed.Id===Vd&&(!Zc||Zc.Order<Ed.Order)&&(Zc=Ed),Ed.Id===Gd&&(gd=Ed);return Zc?{returnValue:!0,sensitivityLabel:Zc,bHa:gd}:(b.ULS.sendTraceTag(537154526,306,10,"TryGettingSensitivityLabels - None of the sensitivity labels matched."),{returnValue:!1,sensitivityLabel:Zc,bHa:gd})}}Object(c.a)(Ub,"AutoPolicyManager",eb.a,[2]);var Ac=a(154),Ic=a(12),dd=a(13);class Ud extends Ac.ErrorDialog{constructor(bc){super(bc,
Ud.MQ(bc))}uq(){super.uq();if(this.error.Appearance&1&&this.$.qd&2){const bc=this.getButton(0);Ic.DOMElementExtensions.RQd(bc.get_element(),dd.a.instance.ga(1311));this.KP(()=>{0===this.returnValue&&this.$.qd&2&&(b.ULS.sendTraceTag(50373725,306,50,"BlockSenitivityLabelActionDialog : Opening the book in excel desktop."),Jb.TaskExtensions.Aa(fb.GetServiceTaskFactory.Oa(this.$.da,55,56,0),Zc=>{Zc.result.Z3c()},this.$.la,3))})}}static MQ(bc){return bc.qd&2?tb.a.Zc(3,1,0,1969,0,-1237306487,"SensitivityLabelBlockApplyLabelOpenInDesktop"):
tb.a.Zc(1,1,0,1970,0,-313914360,"SensitivityLabelBlockApplyLabel")}}Object(c.a)(Ud,"BlockSenitivityLabelActionDialog",Ac.ErrorDialog,[]);class Hd extends eb.a{constructor(bc,Zc,gd,Sc,Gd){super();this.statusBarManager=null;this.b_c=!1;this.v$=null;this.NDc=!1;this.Eya=this.hQd=null;this.Go=this.WFd=!1;this.LEa=this.Hfe=this.Xfa=this.Sge=this.Wp=null;this.tOe=()=>{b.ULS.sendTraceTag(537154520,306,50,"PolicyManagerWrapper::EnableAutoLabellingInDocument - Triggered EnableAutoLabellingInDocument");const Vd=
this.VRf(1);b.ULS.sendTraceTag(537154519,306,50,`PolicyManagerWrapper::EnableAutoLabellingInDocument - Annotation registration result: ${Vd}.`)};this.MUd=(Vd,Ed)=>{Ed?(this.Wp=Ed.title,this.Sge=Ed.Erc,this.Xfa=Ed.buttonText,this.Hfe=Ed.Pyf,this.RE.ng(27,null),b.ULS.sendTraceTag(537154509,306,50,"Add entry to BusinessBar succeeded. Message is shown to user.")):b.ULS.sendTraceTag(537154510,306,15,"ShowPolicyBusinessBar is called but PolicyTipventArgs is null.")};this.v8f=(Vd,Ed)=>{const Od=Object(Ob.a)(rb,
Ed);Od?Od.V7f?this.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CommonBusinessBarEntryForSensitivityLabelError",!1)?(b.ULS.sendTraceTag(537154508,306,15,`ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of ${Od.errorType}`),this.RE.NFj(Od.title,Od.message,Od.buttonText,se=>{Od.j3&&(this.RE.$E(54)&&this.RE.removeEntry(54),Od.j3(se))})):7===Od.errorType?(b.ULS.sendTraceTag(537154507,306,15,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure because of File too large"),
this.RE.ng(49,null)):13===Od.errorType?this.RE.ng(50,null):9===Od.errorType?this.RE.ng(51,null):14===Od.errorType?this.RE.ng(52,null):15===Od.errorType?this.RE.OFj(Od.title,Od.message,Od.buttonText,se=>{this.RE.$E(53)&&this.RE.removeEntry(53);Od.j3(se)}):this.RE.ng(48,null):b.ULS.sendTraceTag(537154506,306,50,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure ShowMessage is false"):(b.ULS.sendTraceTag(537154505,306,10,"ShowSetPolicyLabelFailureInBusinessBar :: SetPolicyLabelFailure args is null"),
this.RE.ng(48,null))};this.r0d=(Vd,Ed)=>{this.d7&&(b.ULS.sendTraceTag(537154504,306,50,"PolicyManagerWrapper: UpdateLabelInfo called"),this.d7.O3f(),this.d7.h3f(),this.d7.vOf(),this.$.qd&64&&(Ed.onSuccess&&this.Eya?this.WPg():this.d7.Udg()));this.fa.qa("SupportsOfficeClientCoauthoring")&&(Vd=this.Is.pn,this.LEa=Vd.AppliedPolicyId,"null"===this.labelId&&(this.LEa=""),this.NDc&&(Vd=Vd.PolicyLabelAssignmentMethod&&X.e(Vd.PolicyLabelAssignmentMethod)===X.e("standard")?4:2,this.applyPolicyLabel(this.labelId,
Vd,!0,this.hQd)));this.YUe();this.Oz()};this.fCf=()=>{this.WFd=!0;this.YUe()};this.$Gf=(Vd,Ed)=>{b.ULS.sendTraceTag(42322116,306,50,`PolicyManagerWrapper.OnSetLabelSucceeded: Applying outcomes for change in policy label. ProtectedFile = ${n.AFrameworkApplication.protectedFile}, ApplyLabelFlag = ${Ed.BM}`);this.applyPolicyLabel(Ed.Drc,Ed.BM,!1,null)};this.cKi=(Vd,Ed)=>{this.LEa=Ed.Drc;if(tb.a.Nq(Vd.Errors)){var Od=tb.a.q4(Vd.Errors,[2045508683]);0<Od.length&&(Vd.Errors=tb.a.PB(Vd.Errors,[2045508683],
"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Qo(Vd.Errors));Od=tb.a.q4(Vd.Errors,[2046680228]);0<Od.length&&(4===Ed.BM||1===Ed.BM)&&(Vd.Errors=tb.a.PB(Vd.Errors,[2046680228],"PolicyManagerWrapper: OnApplyManualPolicyLabelSuccessCallback"),this.$.ea.Qo(Vd.Errors));Od=Vd=null;for(var se of this.Is.pn.SensitivityLabels)za.a.equals(this.labelId,se.Id,!1)&&(Vd=se),za.a.equals(Ed.g1f,se.Id,!1)&&(Od=se);se={};se.ApplyLabelFlag=Ed.BM;Vd?(se.currentLabel="Set",se.currentLabelEnabled=
Vd.Enabled,se.currentLabelName=Vd.Name?"Set":"NotSet",se.currentLabelParentId=Vd.ParentId?"Set":"NotSet"):se.currentLabel="NotSet";Od?(se.serverLabel="Set",se.serverLabelEnabled=Od.Enabled,se.serverLabelName=Od.Name?"Set":"NotSet",se.serverLabelParentId=Od.ParentId?"Set":"NotSet"):se.serverLabel="NotSet";b.ULS.sendTraceTag(541638850,306,15,`PolicyManagerWrapper.OnApplyManualPolicyLabelSuccessCallback Failed. DiagnosticInfo : ${JSON.stringify(se)}`)}};this.PTg=(Vd,Ed)=>{if(!this.$.workbookContext.HasRoundTrippedHFPart)return!1;
const Od=this.Is.pn;if(!Od)return b.ULS.sendTraceTag(537154502,306,15,"PolicyManagerWrapper.BlockSetSensitivityCall: policyLabelsData is null."),!1;let se=null;for(const Le of Od.SensitivityLabels)za.a.equals(Le.Id,Vd,!1)&&(se=Le);return se&&this.I9h(se)?(b.ULS.sendTraceTag(50341186,306,50,"PolicyManagerWrapper.BlockSetSensitivityCall: selectedSensitivityLabel has watermark label action."),this.ADj(Ed),!0):!1};this.Uhi=()=>{let Vd=!1;!this.$.va.IsNewWorkbook||this.labelId&&this.labelId.length||(Vd=
!0);b.ULS.sendTraceTag(537154501,306,50,`PolicyManagerWrapper.IsANewFile: is this a new file : ${Vd}`);return Vd};this.ltf=(Vd,Ed)=>{1===Ed.xte?this.$.isEditMode?(b.ULS.sendTraceTag(537154500,306,50,"MandatoryLabellingHandler : Swtiching to view-mode."),this.$.Ja.Kb(new Ha.a(-723527778,0,this.$.Hc,10,null))):b.ULS.sendTraceTag(537154499,306,50,"MandatoryLabellingHandler : App is already in view-mode."):(this.Eya=Ed.Eya,this.$.ea.DY(this.Jue),this.$.mgb(),b.ULS.sendTraceTag(537154498,306,50,"MandatoryLabellingHandler : Swtiching to edit-mode."),
this.$.Ja.Kb(new Ha.a(-8805455,0,this.$.Hc,10,null)))};this.Toe=(Vd,Ed)=>{Ed?(Vd=!!(this.$.qd&64),b.ULS.sendTraceTag(537154496,306,50,`AddMandatoryLabellingBusinessBar User has edit permission : ${Vd}`),Vd&&(this.$.mgb(),this.RE.WEj(Ed.title,Ed.message,Ed.buttonText,Od=>{Ed.j3(Od)}))):b.ULS.sendTraceTag(537154497,306,15,"AddMandatoryLabellingBusinessBar is called but MandatoryLabellingAppHandlerEventArgs is null.")};this.rTf=()=>{this.RE.$E(42)&&this.RE.removeEntry(42)};this.jfg=(Vd,Ed)=>{Ed.CBj&&
(b.ULS.sendTraceTag(527716803,306,50,"PolicyManagerWrapper.udpLabelingAppHandler: Open the document in the client when the applied label is a UDP label."),Jb.TaskExtensions.Aa(fb.GetServiceTaskFactory.Oa(this.$.da,55,56,0),Od=>{Od.result.Z3c()},this.$.la,3))};this.Jue=()=>{this.Eya&&this.$.isEditMode?(this.$.ea.w0(this.Jue),this.Dwb()):b.ULS.sendTraceTag(537154467,306,15,`ApplyMandatoryLabelOnEditMode : mandatoryPolicyId empty ${!this.Eya} , edit mode : ${this.$.isEditMode}.`)};this.ska=()=>{const Vd=
this.$.ea.Io;Vd&&!za.a.equals(Vd.AppliedPolicyLabelId,this.labelId,!1)&&(b.ULS.sendTraceTag(537154464,306,50,"PolicyManagerWrapper.HandleWorkbookMetadataChanged: Calling GetPolicyLabels to update statusbar and ribbon control."),b.ULS.shipAssertTag(537154463,306,this.$.isEditMode,"PolicyManagerWrapper.HandleWorkbookMetadataChanged policyId cannot change in read-only mode, this can happen if right policy id is not read from server."),this.fa.qa("SupportsOfficeClientCoauthoring")&&this.$.isEditMode&&
(this.NDc=!0,this.hQd=Vd.AppliedPolicyLabelId),this.LEa=Vd.AppliedPolicyLabelId,this.Dwb())};this.Opd=()=>{let Vd=!0;if(!this.$.ea.amIAlone)for(const Ed of this.$.ea.Xm)if(!Ed.SupportsClientIsMipTrusted){Vd=!1;break}b.ULS.sendTraceTag(537154462,306,50,`PolicyManagerWrapper.IsEveryCoauthorInSessionClientMipTrusted : ${Vd}`);return Vd};this.lDf=()=>{b.ULS.sendTraceTag(537154461,306,50,"PolicyManagerWrapper.OnLabelUpdate: RTC notification received");this.NDc=!0;this.Dwb()};this.$=Sc;this.Is=bc;this.RE=
gd;this.fa=Gd;this.Is.ire(this.MUd);this.d7=Zc}initialize(){this.fa.qa("SupportsPolicies")?(this.LEa=this.fa.Xa("AppliedPolicyId"),this.d7.Hg(),this.$.da.$a(29,bc=>{this.statusBarManager=bc;bc.GJ(this)}),this.Oz(),za.a.Dh(this.fa.Xa("HostUserId"))||this.T1i(),this.d7.Vaj(this.PTg),this.d7.Jbj(this.Uhi),this.Is.Raj(this.Opd),this.Go=V.EwaSettings.getBooleanFeatureGate(Ma.a.xQa,!1)):V.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CacheSensitivityVisibility",!1)&&Q.c()&&appChrome.api.dispatch(appChrome.actions.updateControlHiddenState("Sensitivity",
!0));!za.a.Dh(this.fa.Xa("HostUserId"))&&V.EwaSettings.ma(167)&&this.$.ea.Wg.get(45)&&(b.ULS.sendTraceTag(537154524,306,50,"DataLossPrevention feature is Enabled and launched on Excel."),this.sRh())}Lq(bc){this.addHandler("LabelInfoChangedKey",bc)}fr(bc){this.removeHandler("LabelInfoChangedKey",bc)}Gn(){return!0}ns(bc,Zc){if("QueryPolicyLabel"!==bc)return!1;if(this.joa())return Zc.Visible=!1,!0;Zc.Visible=!0;return 32===n.AFrameworkApplication.ub.ae(oa.a.Fbb,2,Zc)}dispose(){this.statusBarManager&&
(this.statusBarManager.iG(this),this.statusBarManager=null);this.d7.LPb();this.b_c=!1;this.Is.khj(this.v8f);this.Is.lhj(this.$Gf);this.$.ea.Mv(this.ska);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const bc=this.$.da.za(292);bc&&bc.agj(this.lDf)}this.Is.Dej(this.Toe);this.Is.Vgj(this.rTf);this.Is.kgj(this.ltf);this.Is.xhj(this.jfg);V.EwaSettings.ma(287)&&this.Is.Ffj(this.tOe);this.v$&&(this.v$.dispose(),this.v$=null);super.dispose()}get title(){return this.Wp}get Erc(){return this.Sge}get linkText(){return this.Xfa}get lSi(){return this.Hfe}get labelId(){return this.LEa}$Yc(bc,
Zc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154523,306,15,"AutoApplyOrRecommendPolicyLabel - Called when SupportPolicies is disabled."),!1;if(!this.WFd)return b.ULS.sendTraceTag(537154522,306,15,"AutoApplyOrRecommendPolicyLabel - PolicyData hasn't been received yet."),!1;if(wb.a.Dh(bc))return!1;this.v$||this.Wmd();return this.v$.$Yc(bc,Zc)}Oz(){this.raiseEvent("LabelInfoChangedKey")}sRh(){Wa.a.get_instance().Xj(10,()=>{this.Is.xfd()})}T1i(){Wa.a.get_instance().Xj(10,()=>{this.Is.J_b(this.r0d);
this.Is.uKg(this.fCf);this.Is.tKg(this.fCf);this.Is.YWc(this.v8f);this.Is.xre(this.$Gf);this.$.ea.ku(this.ska);this.Is.Upe(this.Toe);this.Is.mre(this.rTf);this.Is.cLg(this.ltf);this.Is.FMg(this.jfg);if(this.fa.qa("SupportsOfficeClientCoauthoring")){const bc=this.$.da.za(292);bc&&bc.UKg(this.lDf)}V.EwaSettings.ma(287)&&(b.ULS.sendTraceTag(537154521,306,50,"PolicyManagerWrapper: ApplyAutomaticPolicyLabel enabled and registered GetAutoPolicyLabelHandler"),this.Is.rKg(this.tOe));this.rDh()});this.$.Udb("sensitivity",
!0)}rDh(){this.fa.qa("SupportsOfficeClientCoauthoring")||this.labelId&&this.labelId.length?this.Dwb():this.zMh(this.$.va.DocumentHostInfo.TenantId)}Wmd(){this.v$=new Ub(this.d7,this.Is,this.$,this.fa,this.RE)}VRf(bc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154518,306,10,"PolicyManagerWrapper::RegisterAugmentationLoopAnnotations called when CLP is disabled."),!1;this.v$||this.Wmd();return this.v$.Oaj(bc)}aZc(bc,Zc){if(!this.fa.qa("SupportsPolicies"))return b.ULS.sendTraceTag(537154517,
306,10,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called when CLP is disabled."),{returnValue:!1,h7a:!1};if(!this.WFd)return b.ULS.sendTraceTag(537154516,306,15,"PolicyManagerWrapper::AutoApplyOrRecommendPowerBILabel called before PolicyData fetch is complete."),{returnValue:!1,h7a:!0};this.v$||this.Wmd();return this.v$.aZc(bc,Zc)}zMh(bc){b.ULS.sendTraceTag(537154514,306,50,`PolicyManagerWrapper: Doing GetPolicyLabelId web service call with tenantId length ${bc.length}`);const Zc=this.$.pa.ya.Wb();
Fa(this.$.pa.ya,bc,gd=>{this.$Kj(gd)},null,null,null,Zc)}$Kj(bc){b.ULS.sendTraceTag(537154513,306,50,"PolicyManagerWrapper: GetPolicyLabelId web service call was successful");bc&&!Ya.a(bc)&&(this.LEa=bc.Result);this.Dwb();this.labelId?b.ULS.sendTraceTag(537154512,306,50,`PolicyManagerWrapper: Fetched LabelId length from custom.xml is ${this.labelId.length}`):b.ULS.sendTraceTag(537154511,306,50,"PolicyManagerWrapper: LabelId is invalid")}Dwb(){this.Is.wfd(this.labelId,void 0,void 0,!1)}YUe(){if(!this.b_c){this.$.af();
this.b_c=!0;this.RE.J9e();const bc={};bc.hasLabel=!!this.labelId&&0<this.labelId.length;bc.isProtectedFile=this.fa.qa("ProtectedFile");bc.SupportsPolicies=this.fa.qa("SupportsPolicies");bc.AreLabelsAvailableForDisplay=this.Is.qha();bc.SupportsOfficeClientCoauthoring=this.fa.qa("SupportsOfficeClientCoauthoring");bc.IsAnonymousUser=this.fa.qa("IsAnonymousUser");b.ULS.sendTraceTag(51238051,306,50,`CLPUsage : ${JSON.stringify(bc)}`)}}WPg(){this.d7.XPg(this.Eya);this.Eya=null}I9h(bc){for(const Zc of bc.LabelActions)if(za.a.equals(Zc.Name,
"ApplyWatermark",!1))return!0;return!1}ADj(bc){bc?(new Ud(this.$)).vg():b.ULS.sendTraceTag(537154465,306,50,"PolicyManagerWrapper.showBlockApplyLabelDialogDialog: Watermark Dialog box called with showDialog set to false from autoapply.")}applyPolicyLabel(bc,Zc,gd,Sc){const Gd=ib.c(this.Is.pn);if(void 0===bc||null===bc)bc="";const Vd=new jc;Vd.Drc=bc;Vd.g1f=Sc;Vd.BM=Zc;const Ed=this.$.pa.ya;va.a(this.$.userOperationManager,(Od,se,Le)=>Ab(Ed,Gd,bc,this.$.va.DocumentHostInfo.TenantId,Zc,gd,yb.b.call(null,
this.cKi,Od),null,Le,Vd),Od=>new Pa.a(222,0,Od),null);this.NDc=!1;this.hQd=null}joa(){const bc=this.$.da.za(478);return this.Go&&bc?bc.Go():!1}}Object(c.a)(Hd,"PolicyManagerWrapper",eb.a,[211,212,746]);class me extends xa.a{constructor(bc){super();this.$=bc;this.Fb()}create(){const bc=fb.GetServiceTaskFactory.Oa(this.$.da,5,4,this.Ya),Zc=n.AFrameworkApplication.Dd,gd=n.AFrameworkApplication.fa;Jb.TaskExtensions.Aa(bc,()=>{try{const Sc=new ua.a(()=>new Oa(gd,Zc,n.AFrameworkApplication.sa.iE,this.$.va.MaxGetPolicyRetries,
da.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"))),Gd=new ua.a(()=>new ya(n.AFrameworkApplication.ub,n.AFrameworkApplication.sa,n.AFrameworkApplication.fa,Sc));let Vd=this.$.da.za(274);Vd||(Vd=new Hd(Sc.value,Gd.value,bc.result,this.$,n.AFrameworkApplication.fa),this.$.da.Ga(274,Vd),Vd.initialize());this.ob(Vd)}catch(Sc){throw b.ULS.sendTraceTag(537154525,306,10,`PolicyManager was not created successfully [Exception: ${Sc.toString()}]`),Sc;}},this.la,3)}static ka(bc){bc.da.Ga(275,
new me(bc))}}Object(c.a)(me,"PolicyManagerFactory",xa.a,[]);var xe=a(692),Ke=a(183);class vd{constructor(bc){this.$=bc}nc(){return!1}executeCommand(bc,Zc,gd){switch(Zc.command){case oa.a.setSensitivity:return this.$.workbookContext.FileCoauthorable||(gd[D.TXc]=this.$.workbookContext.ExclusiveLockId),bc=n.AFrameworkApplication.ub.ae(oa.a.setSensitivity,2,gd),ea.Task.Ta(32===bc);case oa.a.h7:return bc=n.AFrameworkApplication.ub.ae(oa.a.h7,2,gd),ea.Task.Ta(32===bc);case oa.a.i7:return bc=n.AFrameworkApplication.ub.ae(oa.a.i7,
2,gd),ea.Task.Ta(32===bc);default:return Ke.a(Zc.command)}}wc(bc,Zc){switch(Zc.command){case oa.a.setSensitivity:case oa.a.h7:case oa.a.i7:return!0;default:return!1}}Kc(bc,Zc,gd){switch(Zc){case "PopulateSensitivityFlyout":return 32===n.AFrameworkApplication.ub.ae(oa.a.Tza,2,gd);default:return!1}}}Object(c.a)(vd,"SensitivityCommandHandler",null,[223]);class Qe extends xe.a{constructor(bc){super(bc)}ld(){this.Yc([new vd(this.$)])}static ka(bc){xe.a.Nd(316,new Qe(bc))}}Object(c.a)(Qe,"SensitivityCommandHandlerFactory",
xe.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.Policy.Contracts");Type.registerNamespace("Common.App.Policy");Ra.main();(()=>{la.a.Fa(bc=>{me.ka(bc);Qe.ka(bc)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.policy.js.map/c46a741f7816862d938c0d3119182262/EwaDSEsNext.policy.js.map