'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[23],{1262:function(u,E,a){u=a(0);var c=a(15),b=a(80),e=a(821),f=a(83),d=a(187),h=a(8),m=a(209),l=a(64),w=a(42),n=a(188),y=a(109),t=a(282),r=a(1),v=a(11),B=a(99),A=a(13),z=a(281),x=a(21),D=a(343);class J{constructor(I,M,Q){this.qGa=I;this.Pk=M;this.cEc=Q}}Object(u.a)(J,"UserActivityLocation",null,[]);var L=a(983),T=a(60);const O=(I,M,Q,U,N,W=null)=>{W=I.Na(1,W);return T.g(I,"GetVersionHistoryHighlightActivitiesData",
W,M,Q,U,N,4)};var G=a(760),C=a(55);a.d(E,"a",function(){return H});class H{constructor(I,M,Q,U){this.authorColor=this.z2=this.Wea=null;this.k8a=!1;this.W1a=-1;this.u6c=0;this.fJa=100;this.W5=-1;this.J1d=null;this.Qpb=h.a.q0j;this.TJe=h.a.r0j;this.NEb=!1;this.gh=N=>{(N=t.a(N)?null:N.Result)?N.OperationWaitingForFileDownload?20>this.u6c?(this.fJa*=2,C.Task.delay(this.fJa).continueWith(()=>{this.ZZd()})):(this.rDc(),c.ULS.sendTraceTag(537150406,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):
N.ActivityList?(this.initialize(N.ActivityList,N.VersionAuthors),r.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.QPa():this.vNb(!0),this.J1d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.J1d.zc.toString()}`)):(this.rDc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):(this.fJa*=2,C.Task.delay(this.fJa).continueWith(()=>
{this.ZZd()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.Cza=()=>{this.rDc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.Ktd=N=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${N.MessageId}`);switch(N.MessageId){case L.a.iterateNext:this.iterateNext();this.W5=(this.W5+1)%this.MO.length;
this.MLb(L.a.setCurrentChangeCount,this.W5+1);break;case L.a.Wxa:this.Wxa();this.W5=0>this.W5?0:this.W5;this.W5=(this.W5+this.MO.length-1)%this.MO.length;this.MLb(L.a.setCurrentChangeCount,this.W5+1);break;case L.a.gPb:this.vNb(N.Values.ToggleValue)}};this.z5g=(N,W)=>this.u4b(N.Pk,W.Pk);this.x5g=(N,W)=>this.u4b(N.Pk,W);this.Pc=()=>{r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHRemovingDeselectOnSelectionChanged",!1)||this.q7b()};this.Ln=()=>{this.q7b()};this.rh=()=>{this.q7b()};
c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=I;this.ariaLiveNotifier=U;this.gridView=x.h(this.$);this.gridView.ha.iH(this.Pc);this.gridView.AC(this.Ln);this.gridView.Vb.Yk(this.rh);this.CWj();this.NEb=r.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.XlOnlineVHNewIterationAlgorithm",!1);M&&(this.J1d=I.Jb.Ac("UserAction","VersionHistoryDiffManagerStopWatch"),this.ZZd());if(this.As=Q)I=b.a.eba(this.$.va.VersionHistoryActionUrl)||G.a.m$,I!==G.a.m$&&
this.As.tGa(I),this.As.so(L.a.iterateNext),this.As.so(L.a.Wxa),this.As.so(L.a.gPb),this.As.dm(L.a.iterateNext,this.Ktd),this.As.dm(L.a.Wxa,this.Ktd),this.As.dm(L.a.gPb,this.Ktd)}get Tgb(){return this.z2}get GLb(){return-1===this.W1a?null:this.MO[this.W1a]}get MO(){this.k8a||(this.Wea.sort(this.z5g),this.k8a=!0);return this.Wea}dispose(){this.eRa();this.Wea=this.z2=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.jG(this.Pc),this.gridView.ZD(this.Ln),this.gridView.Vb&&this.gridView.Vb.Hk(this.rh),
this.As&&(this.As.bpa(L.a.Wxa),this.As.bpa(L.a.iterateNext),this.As.bpa(L.a.gPb)))}initialize(I,M){I?(this.eRa(),this.W1a=-1,this.Wea=[],this.k8a=!1,this.z2={},this.authorColor={},this.HCi(M),this.c6c(I)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}ZZd(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.u6c.toString()} --${this.fJa.toString()}`);this.u6c++;this.$.userOperationManager.Ic(new n.a(537,
0,(I,M,Q)=>O(this.$.pa.ya,z.b(I,this.gh),z.a(M,this.Cza),Q,null),80),null)}vNb(I){const M=this.z2;for(let U in M){var Q=U;const N=M[U];N?N.xNb(I):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+Q+"view was Null")}}eRa(){const I=this.z2;for(let Q in I){var M=Q;const U=I[Q];U?U.QKd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+M+"view was Null")}this.Wea=this.z2=null}h0f(I){let M;if(this.NEb)M=I?this.Z3e(this.W5):
this.a5e(this.W5),I=this.MO[M];else if(!({Xcf:M,cjg:I}=this.cXh(I,this.W1a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!I,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.q7b();if(I.qGa.toString()in this.z2){this.z2[I.qGa.toString()].mqj(I.Pk);var Q=w.D(I.Pk);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(A.a.instance.nb(158),M+1,this.MO.length,Q.Ew(!1),I.cEc.DisplayName));
this.W1a=M}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${I.qGa.toString()} view not present in views dictionary`)}MLb(I,M){if(r.EwaSettings.ma(315))if(this.As){var Q={};Q.count=M;I=new e.a(I);I.Values=Q;this.As.send(I)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}cXh(I,
M){let Q,U=!1;Q=null;let N=0;for(;!U&&N<this.MO.length;){M=I?this.Z3e(M):this.a5e(M);Q=this.MO[M];const W=Object(f.a)(B.a,this.$.xa.getItemByName(Q.Pk.SheetName));if(!W)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,Xcf:M,cjg:Q};W.visible&&(U=!0);N++}return{returnValue:U,Xcf:M,cjg:Q}}Z3e(I){return this.NEb||-1!==I?(I+1)%this.MO.length:this.U3e()}a5e(I){this.NEb&&
-1===I?I=0:-1===I&&(I=this.U3e());return I=(I+this.MO.length-1)%this.MO.length}c6c(I){this.lfh(I);this.I5c()}m3h(I,M){const Q=[];if(!I.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),Q;for(const U of I.RangeList)if(!U||!this.$.xa.Rk(U.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+U.SheetName);else if(!this.NEb||this.$.xa.getItemByName(U.SheetName).visible)I=
new J(0,U,M),Q.push(I);return Q}lfh(I){for(const M of I)if(!M||y.e(M.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const Q of M.LocationList)if(Q)switch(Q.Type){case 0:this.Wea.push(...this.m3h(Q,M.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}I5c(){var I=
{};const M=new d.a,Q=[];for(const U of this.Wea){M.contains(U.cEc)||M.add(U.cEc);if(0!==U.qGa)continue;const N=new D.a(w.D(U.Pk),l.d(this.$.xa.getItemByName(U.Pk.SheetName))),W=H.Ayc(N);W in I||Q.push(N);I[W]=this.XOh(U.cEc)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.Wea.length}, Highlightable activities: ${Q.length},Total userlist in activities : ${this.Wea.length}, Total userlist from pane: ${Q.length} `);this.rDc();0<Q.length&&
(I=new (a(1366).RangeVersionHistoryHighlightView)(this.$,Q,I,this.Qpb),this.z2["0"]=I)}rDc(){const I=this.Wea?this.MO.length:0;this.MLb(L.a.setCurrentChangeCount,0);this.MLb(L.a.setTotalChangesCount,I)}QPa(){this.MLb(L.a.QPa,0)}HCi(I){if(I)for(let N=0;N<I.length;++N)if(r.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&!I[N].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");
else{var M=I[N].EmailAddress;var Q=I[N].UserName;var U=null;if(I[N].LoginName){const W=I[N].LoginName.split("|");3===W.length&&(U=W[2])}U?this.authorColor[U]=I[N].InitialsColor:M?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[M]=I[N].InitialsColor):Q?(c.ULS.sendTraceTag(537150360,0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[Q]=I[N].InitialsColor):c.ULS.sendTraceTag(537150359,
0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}CWj(){if(this.$.va.VersionHistoryHighlightsSettings){var I=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.va.VersionHistoryHighlightsSettings))?Sys.Serialization.JavaScriptSerializer.deserialize(this.$.va.VersionHistoryHighlightsSettings):null;for(let Q=0;Q<I.length;Q++){var M=I[Q];const U=
M.key?M.key:M.Key?M.Key:"";M=M.value?M.value:M.Value?M.Value:"";"DefaultColor"===U?this.TJe=M:"InitialTint"===U?this.Qpb=M:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}XOh(I){if(I.Email in this.authorColor)return this.authorColor[I.Email];if(I.DisplayName in this.authorColor)return this.authorColor[I.DisplayName];
c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.TJe}u4b(I,M){var Q=Object(f.a)(B.a,this.$.xa.getItemByName(I.SheetName));const U=Object(f.a)(B.a,this.$.xa.getItemByName(M.SheetName));return Q&&U?(Q=(Q=v.HelperMethods.FB(Q.index,U.index))||v.HelperMethods.FB(I.FirstRow,M.FirstRow))||v.HelperMethods.FB(I.FirstColumn,M.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),
0)}U3e(){var I=w.m(this.gridView.ha.ra.activeRange,this.$.xa.oa);if(!I)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;I=v.HelperMethods.jw(new m.a(this.MO),0,this.MO.length,I,this.x5g);0>I&&(I=~I);return I%this.MO.length}q7b(){if(this.GLb){if(!(this.GLb.qGa.toString()in this.z2)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.GLb.qGa.toString()} view not present in views dictionary`);
return}this.z2[this.GLb.qGa.toString()].cjh(this.GLb.Pk)}this.W1a=-1}iterateNext(){this.h0f(!0)}Wxa(){this.h0f(!1)}static Ayc(I){return`${I.range}${I.sheetId}`}}Object(u.a)(H,"VersionHistoryHighlightManager",null,[665,2])},1366:function(u,E,a){a.r(E);u=a(0);var c=a(15),b=a(8);class e{}e.jxh="ewa-vhr-rectinnerborder";Object(u.a)(e,"CssClassNames",null,[]);var f=a(64),d=a(42),h=a(198),m=a(21),l=a(343),w=a(1262);a.d(E,"RangeVersionHistoryHighlightView",function(){return n});class n{constructor(y,t,r,
v){this.Ejb=null;this.$=y;this.hBg=t;this.WSa=r;this.XSa={};this.Qpb=v;this.cfi()}get EF(){return[n.a5]}get qb(){return this.Ejb||(this.Ejb=m.h(this.$).qb)}xNb(y){y?this.qb.Sn(this.EF):this.qb.Xg(this.EF)}QKd(){this.xNb(!1);this.qb.HSa(new l.a(null,f.d(this.$.oa)),this.EF)}mqj(y){if(this.WSa){var t=new l.a(d.D(y),f.d(this.$.xa.getItemByName(y.SheetName))),r=w.a.Ayc(t);if(r in this.WSa)if(r in this.XSa){t=h.a.rp(this.WSa[r]);r=this.XSa[r];for(let v in r)r[v].style.backgroundColor=`rgba(${t.r},${t.g},${t.b},${b.a.s0j})`;
m.h(this.$).ha.Sa.xH(null);m.h(this.$).w8e(y,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+r);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+r)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}cjh(y){y=
new l.a(d.D(y),f.d(this.$.xa.getItemByName(y.SheetName)));var t=w.a.Ayc(y);if(t in this.XSa)if(t in this.WSa){y=h.a.rp(this.WSa[t]);t=this.XSa[t];for(let r in t)t[r].style.backgroundColor=`rgba(${y.r},${y.g},${y.b},${this.Qpb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+t);else c.ULS.sendTraceTag(537150425,0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+t)}cfi(){this.qb.lx(this.hBg,
[n.a5],!1,(y,t)=>{if(y&&y.range&&y.sheetId&&t){var r=new l.a(y.range,y.sheetId);r=w.a.Ayc(r);r in this.XSa||(this.XSa[r]={});this.XSa[r][y.paneType.toString()]=t;r in this.WSa?(y=this.WSa[r],r=h.a.rp(y),t.style.borderColor=y,t.style.backgroundColor=`rgba(${r.r},${r.g},${r.b},${this.Qpb})`,y=document.createElement("div"),y.className=e.jxh,t.appendChild(y)):c.ULS.sendTraceTag(537150419,0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+r)}else c.ULS.shipAssertTag(537150423,
0,!!y,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!y||!!y.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!y||!!y.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,0,!!t,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}n.a5=23;Object(u.a)(n,"RangeVersionHistoryHighlightView",null,[697])},1430:function(u,
E,a){a.r(E);var c=a(9),b=a(0),e=a(4),f=a(222),d=a(15),h=a(114),m=a(145),l=a(41);class w extends h.a{constructor(Z,db,Lb,hc,Pc){super(Z,db);this.executionContext=null;this.retryCount=0;this.LUi=Rc=>{({MNd:Rc}=this.NRj(Rc)).returnValue?Rc.Success?(m.c(2138207060,!0),d.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):(m.c(2138207060,!1),d.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${Rc.Output}`),
this.ih(this.hK)):(m.c(2138207060,!1),this.ih(this.hK));(Rc=this.executionContext.activityState[w.Gwd])&&Rc();this.Jp();this.executionContext.MM()};this.KUi=()=>{if(0<this.retryCount)d.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.$Xf();else{d.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");m.c(2138207060,!1);this.ih(this.hK);
var Rc=this.executionContext.activityState[w.Gwd];Rc&&Rc();this.Jp();this.executionContext.MM()}};this.hK=Lb;this.v3=hc;this.baseUrl=Pc}execute(Z){this.executionContext=Z;this.retryCount=3;this.$Xf();return 1}$Xf(){var Z=this.executionContext.activityState[w.Fsc];const db=`${this.baseUrl}${"restoreversion.ashx"}`,Lb={};Lb.VersionId=this.executionContext.activityState[w.jkg];Lb.QuerySignature=Z;Z=l.c(Lb);this.v3.Pm(db,2,Z,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.LUi,this.KUi,null)}NRj(Z){let db;
db=null;Z=Z?Z.data?Z.data.ue:null:null;return Z&&Z.length?({At:db}=l.d(Z)).returnValue?{returnValue:!0,MNd:db}:(d.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,MNd:db}):(d.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),{returnValue:!1,MNd:db})}}w.jkg="RVAvi";w.Fsc="RVAqs";w.Gwd="RVlvrt";Object(b.a)(w,
"RestoreVersionActivity",h.a,[]);var n=a(6);class y extends f.a{constructor(Z,db,Lb){super();this.activityName=Z;this.$J=db;this.hK=Lb;this.Fb()}create(){this.ob(new w(this.activityName,this.$J,this.hK,e.AFrameworkApplication.Dd,e.AFrameworkApplication.sa.Pa.Z_))}static ka(Z){Z.da.Ga(320,new y(n.a.PNd,n.a.ij,n.a.QNd))}}Object(b.a)(y,"RestoreVersionActivityFactory",f.a,[]);class t extends h.a{constructor(Z,db){super(Z,db)}execute(Z){(0,Z.activityState[t.u8f])(()=>{this.Jp();Z.MM()});return 1}}t.u8f=
"RVEAssea";Object(b.a)(t,"RestoreVersionErrorActivity",h.a,[]);class r extends f.a{constructor(Z,db){super();this.activityName=Z;this.$J=db;this.Fb()}create(){this.ob(new t(this.activityName,this.$J))}static ka(Z){Z.da.Ga(321,new r(n.a.QNd,n.a.ij))}}Object(b.a)(r,"RestoreVersionErrorActivityFactory",f.a,[]);var v=a(80),B=a(692),A=a(50),z=a(37),x=a(183),D=a(372),J=a(55);class L{constructor(Z,db){this.$=Z;this.v0j=db}nc(){return e.AFrameworkApplication.fa.qa("IsAnonymousUser")?(d.ULS.sendTraceTag(537150415,
0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(Z,db){d.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Z=!1;switch(db.command){case -1112508866:D.a(this.$)&&this.$.da.za(423).vzc(!1),Z=this.v0j.lGj()}d.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Z}.`);return Z?J.Task.Ta(Z):x.a(db.command)}wc(Z,db){return-1112508866===db.command&&this.$.isVersionHistoryEnabled()}Kc(){return!1}}Object(b.a)(L,
"VersionHistoryCommandHandler",null,[223]);var T=a(7),O=a(252),G=a(164),C=a(383);class H{static addAppPLTEventToLog(Z){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Z)}catch(db){}}static setIsPageLoadForFirstTime(Z){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Z)}catch(db){}}}Object(b.a)(H,"VersionHistoryLogConnector",null,[]);var I=a(27),M=a(821),Q=a(1240),U=a(154),N=a(91),W=a(29),X=a(1),sa=a(44),da=a(250),S=a(983),oa=a(259),K=a(247),ea=
a(12);class ya{constructor(Z){this.Xw=Z}ai(){oa.a(this.Xw.$).pB(this.de)||oa.a(this.Xw.$).ai(this)}q8(){oa.a(this.Xw.$).pB(this.de)&&oa.a(this.Xw.$).Xz(this)}get de(){return K.a.gkg}get mc(){return document.querySelector('[id="vhHeader"]')}get Gf(){return!0}mh(Z){return ea.DOMElementExtensions.yf(this.mc,Z)}sj(){this.Xw.$.frame.Me.wk(this.Xw.$.frame.Me.mF)}Zj(){}kg(Z,db){db||this.Xw.EPb.then(Lb=>{Lb.enterHeaderFocusTrapZone();return null});return!db}}Object(b.a)(ya,"VersionHistoryHeader",null,[36]);
class ha{constructor(Z){this.Xw=Z}ai(){oa.a(this.Xw.$).pB(this.de)||oa.a(this.Xw.$).ai(this)}q8(){oa.a(this.Xw.$).pB(this.de)&&oa.a(this.Xw.$).Xz(this)}get de(){return K.a.hkg}get mc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get Gf(){return!0}mh(Z){return ea.DOMElementExtensions.yf(this.mc,Z)}sj(){this.Xw.$.frame.Me.wk(this.Xw.$.frame.Me.mF)}Zj(){}kg(Z,db){db||this.Xw.EPb.then(Lb=>{Lb.enterFocusTrapZone();return null});return!db}}Object(b.a)(ha,"VersionHistoryPane",
null,[36]);class La{constructor(Z){this.Xw=Z}ai(){oa.a(this.Xw.$).pB(this.de)||oa.a(this.Xw.$).ai(this)}q8(){oa.a(this.Xw.$).pB(this.de)&&oa.a(this.Xw.$).Xz(this)}get de(){return K.a.ikg}get mc(){return document.querySelector('[id="vhViewer"]')}get Gf(){return!0}mh(Z){return ea.DOMElementExtensions.yf(this.mc,Z)}sj(){this.Xw.$.frame.Me.wk(this.Xw.$.frame.Me.mF)}Zj(){}kg(Z,db){db||this.Xw.EPb.then(Lb=>{Lb.enterViewerFocusTrapZone();return null});return!db}}Object(b.a)(La,"VersionHistoryViewer",null,
[36]);var Ia=a(143),ra=a(253),pa=a(69),ba=a(422),fa=a(760);class Ka{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(Ka,"AppBootSettings",null,[]);class aa{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(aa,"AppVersionControllerFactoryParameters",null,[]);class ja{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=null}}Object(b.a)(ja,"OnVersionSelectedParams",null,[]);class Va{constructor(){this.appName=
0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=!1;this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}
Object(b.a)(Va,"AppSettings",null,[]);class bb{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(bb,"ControllerFactoryParameters",null,[]);var wa;(function(Z){Z[Z.none=0]="none";Z[Z.vhUnknown=1]="vhUnknown";Z[Z.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";Z[Z.vhFailedToGetDownloadToken=101]="vhFailedToGetDownloadToken";Z[Z.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";Z[Z.vhFetchFailed=
103]="vhFetchFailed";Z[Z.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";Z[Z.vhFileNotFound=105]="vhFileNotFound";Z[Z.vhVersionTooOld=106]="vhVersionTooOld";Z[Z.vhFetchException=107]="vhFetchException";Z[Z.vhServiceUnavailable=108]="vhServiceUnavailable";Z[Z.vhBadGateway=109]="vhBadGateway";Z[Z.vhUnauthorized=110]="vhUnauthorized";Z[Z.vhInternalServerError=111]="vhInternalServerError";Z[Z.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Z[Z.vhFailedHostDownload=113]="vhFailedHostDownload";
Z[Z.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";Z[Z.vhFailedToCacheParts=115]="vhFailedToCacheParts";Z[Z.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Z[Z.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Z[Z.vhInvalidDocID=118]="vhInvalidDocID";Z[Z.vhMissingDocID=119]="vhMissingDocID";Z[Z.vhNullDocID=120]="vhNullDocID";Z[Z.vhNullHashedDocID=121]="vhNullHashedDocID";Z[Z.vhNullGetDownloadAccessTokenRequest=122]="vhNullGetDownloadAccessTokenRequest";
Z[Z.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";Z[Z.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Z[Z.vhGetTipVersionException=125]="vhGetTipVersionException";Z[Z.vhGetVersionsException=126]="vhGetVersionsException";Z[Z.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";Z[Z.vhFetchRetryException=128]="vhFetchRetryException";Z[Z.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";Z[Z.vhNullResponseFromRequestDownloadToken=
130]="vhNullResponseFromRequestDownloadToken";Z[Z.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";Z[Z.vhXhrException=132]="vhXhrException";Z[Z.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Z[Z.vhFileGone=134]="vhFileGone";Z[Z.vhNullRevisionIDs=135]="vhNullRevisionIDs";Z[Z.vhRequestDeleteVersionsException=136]="vhRequestDeleteVersionsException";Z[Z.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";Z[Z.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(wa||
(wa={}));Object(b.b)("VersionHistoryFullAppErrorCode",wa);var ka=a(302);class ta{constructor(Z){this.baseVersionInfo=this.S3=this.mpa=this.vl=this.ewaAccessibilityManager=this.EPb=null;this.xKd=this.mwf=!1;this.jJe=!0;this.dialog=this.accessTokenExpirationManager=this.dC=this.yXe=this.bE=this.M1d=this.K1d=this.L1d=null;this.TFf=db=>{d.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.WCj()){var Lb=Pc=>{m.c(2138207060,!1);this.vl.setRestoreFailedAtServer(Pc)};
this.bE&&this.bE.startTimer(ta.Gcg);var hc=()=>{this.bE.endTimer(ta.Gcg);this.rAe(this.bE)};this.vl.setRestoreInProgress();sa.a(this.$).Js(new da.a(n.a.ey,5,()=>{const Pc=pa.a(this.$).hd.activityState;Pc[ra.a.Jq]=n.a.eDe;Pc[Ia.a.xY]=!0;Pc[Ia.a.DT]=0;Pc[w.jkg]=db;Pc[w.Fsc]=e.AFrameworkApplication.Ii;Pc[w.Gwd]=hc;Pc[t.u8f]=Lb;X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",!1)&&(Pc[ka.a.vEd]=!0)}))}else m.c(2138207060,!1)};this.zIf=db=>{this.EPb.then(Lb=>
{Lb.enterFocusTrapZone();return null});d.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.bE.endTimer(ta.sYd);this.bE.incrementCounter(ta.f9g);d.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.bE.getTimerDuration(ta.sYd)}`);this.akj(db.containerDiv);db.versions&&0<db.versions.length&&(this.yXe=ta.zF(db.versions[db.versions.length-1]));this.S3&&this.mpa&&this.CPd(this.S3);d.ULS.sendTraceTag(537150346,
0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=db=>{d.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${ta.zF(db.currentVersion)}, LastSelected:${ta.zF(this.S3)}`);this.bE.incrementCounter(ta.e9g);this.S3=db.currentVersion;this.baseVersionInfo=db.baseVersion;this.mwf=db.noBaseToCompareTo;this.mpa&&this.O_j()&&(this.CPd(db.currentVersion),d.ULS.sendTraceTag(537150344,0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};
this.AAf=db=>{d.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===db||void 0===db?0:db.versionSelected)?ta.zF(db.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===db||void 0===db?0:db.updatedVersions)?db.updatedVersions.length:0}, LastSelected:${ta.zF(this.S3)}`);this.bE.incrementCounter(ta.d9g);if(this.baseVersionInfo){if((null===db||void 0===db?0:db.updatedVersions)&&2<=db.updatedVersions.length){let Lb=null,hc=null;const Pc=
ta.zF(this.S3),Rc=ta.zF(this.baseVersionInfo);for(const xd of db.updatedVersions)if(db=ta.zF(xd),Pc===db?Lb=xd:Rc===db&&(hc=xd),Lb&&hc)break;Lb&&hc?(this.S3=Lb,this.baseVersionInfo=hc,d.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${ta.zF(this.S3)}, RevisionID[N-1]: ${ta.zF(this.baseVersionInfo)}.`),this.CPd(this.S3)):d.ULS.sendTraceTag(537150306,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${Pc}, RevisionID[N-1]: ${Rc}.`)}else d.ULS.sendTraceTag(537150305,
0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");d.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else d.ULS.sendTraceTag(537150336,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};this.yzf=()=>{d.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");
this.J3g();const db=new N.a(1470556788,0,this.$.Hc,0,null);this.$.Ja.Kb(db)};this.jGf=db=>{d.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let Lb=new N.a(-1244760097,0,this.$.Hc,0,null);this.$.ie.get(51)&&(d.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),Lb=new N.a(-309686558,0,this.$.Hc,0,null));m.c(1604651619,!0);this.$.Ja.Kb(Lb,{["FileDownloadUrl"]:db})};this.BAf=db=>{d.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");
if(!X.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.VCj())db=new O.QueryStringBuilder(db),db.Yi("fn",e.AFrameworkApplication.fileName),d.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+db.toString().length),8===this.$.frame.d$a(db.toString(),!0)?(d.ULS.sendTraceTag(587830283,0,10,"VersionHistoryPaneActor:OnDownloadVersion failed"),m.c(1316171850,!1)):m.c(1316171850,!0)};this.eyf=db=>{this.vl.setFullAppErrorCode(db);X.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&
this.vl.setViewerError(!0)};this.Tve=db=>{const Lb=document.getElementById(ta.JUe);!Lb||this.dC&&!db||(d.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.dC=new S.a(Lb.contentWindow,v.a.eba(this.$.va.VersionHistoryActionUrl)||fa.a.m$),this.dC.dm(G.a.gVa,this.KIb),this.dC.dm(G.a.hVa,this.KIb),this.dC.so(S.a.setCurrentChangeCount),this.dC.so(S.a.setTotalChangesCount),X.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.dC.so(S.a.QPa),this.dC.dm(S.a.setCurrentChangeCount,this.KIb),this.dC.dm(S.a.setTotalChangesCount,this.KIb),X.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.dC.dm(S.a.QPa,this.KIb))};this.LBf=db=>{if(X.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))db=wa[db]?wa[db]:"None";else switch(db){case 101:db="VHFailedToGetDownloadToken";break;case 100:db="VHFailedToLoadVersionList";break;case 104:db="VHVersioningNotEnabled";
break;case 105:db="VHFileNotFound";break;case 106:db="VHVersionTooOld";break;default:db="None"}this.bE.addEvent("OnFullAppError",db);d.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${db}`)};this.WDd=db=>{this.jJe=db;d.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${db.toString()}`);this.$Pd(S.a.gPb,{["ToggleValue"]:db})};this.dDf=db=>{d.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${db}`);m.c(1488635506,!0);const Lb={};
db?this.$Pd(S.a.iterateNext,Lb):this.$Pd(S.a.Wxa,Lb)};this.KIb=db=>{switch(db.MessageId){case G.a.gVa:d.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");X.EwaSettings.ma(416)&&this.vl.setVersionLoadComplete();break;case G.a.hVa:d.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case S.a.setCurrentChangeCount:db=db.Values.count;d.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${db}`);
this.vl.setCurrentChangeCount(db);break;case S.a.setTotalChangesCount:db=db.Values.count;d.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${db}`);this.vl.setTotalChangesCount(db);break;case S.a.QPa:this.WDd(this.jJe);break;default:d.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${db.MessageId}`)}};this.$=Z;this.d$b=this.$.Eb+ta.BBh;this.wKd=!1;X.EwaSettings.ma(382)&&this.qfh();X.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&
this.$.da.$a(38,db=>{this.accessTokenExpirationManager=db;this.OPa=this.OPa.bind(this);this.accessTokenExpirationManager.rob(this.OPa)});this.KCb="";this.Aud=0;this.perfTelemetryInfos=[]}OPa(){null!=this.vl&&(this.vl.updateDocId(e.AFrameworkApplication.Ii),d.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){X.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.accessTokenExpirationManager.yuc(this.OPa);
this.RBe()}L2i(){this.$.da.$a(15,Z=>{this.ewaAccessibilityManager=Z;this.ewaAccessibilityManager.mode=2})}qfh(){this.L1d=new ha(this);this.K1d=new ya(this);this.M1d=new La(this)}lGj(){d.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");e.AFrameworkApplication.MN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");e.AFrameworkApplication.MN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");
e.AFrameworkApplication.MN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");e.AFrameworkApplication.Ip("8492a557;72ff4572");this.bE=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.bE.startTimer(ta.Fcg);if(!this.vl&&(ba.a(()=>{this.vl=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(T.a)(new bb,{ulsLogger:new C.a,docId:e.AFrameworkApplication.Ii,appSettings:Object(T.a)(new Va,{appName:120,
userSessionId:e.AFrameworkApplication.userSessionId,wdEnableSaveACopy:X.EwaSettings.ma(351),wdEnableDownloadTokens:X.EwaSettings.ma(346),wacCluster:e.AFrameworkApplication.Dd.kP,uiLocale:e.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:X.EwaSettings.ma(317)&&this.$.isEditMode,wdEnableIterator:X.EwaSettings.ma(314)&&X.EwaSettings.ma(315),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:X.EwaSettings.ma(416),disableSaveACopy:this.jTd(),wdEnableShowVersionChanges:X.EwaSettings.ma(314)&&
X.EwaSettings.ma(316),disabledChangeGates:this.$.va.VHSDisabledChangeGates,wdEnableSaveACopyOverFlowMenu:X.EwaSettings.ma(532),isRtl:e.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.vl))return d.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),m.c(429638140,
!1),!1;this.mGj();this.bE.endTimer(ta.Fcg);this.bE.startTimer(ta.Icg);d.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");m.c(429638140,!0);return!0}mGj(){var Z;this.Kcj();if(!document.getElementById(this.d$b)){const db=document.createElement("div");db.id=this.d$b;db.style.width="100%";db.style.zIndex="998";db.style.display="block";db.style.position="absolute";if(e.AFrameworkApplication.sa.Pa.Ye){const Lb=(null===(Z=document.getElementById("HeaderRegion"))||
void 0===Z?void 0:Z.offsetHeight)||0;db.style.top=Lb+"px";db.style.bottom="0px";db.style.height=`calc(100vh - ${Lb}px)`}else db.style.height="100%";this.$.vr.insertBefore(db,this.$.vr.firstChild);this.EPb=this.vl.createVersionHistoryDialog(db)}document.getElementById(this.d$b).style.display="block";this.lKd();this.bE.startTimer(ta.sYd);this.vl.getVersions("")}lKd(){X.EwaSettings.ma(382)&&(this.L1d.ai(),this.K1d.ai(),this.M1d.ai(),this.L2i())}J_d(){X.EwaSettings.ma(382)&&(this.L1d.q8(),this.K1d.q8(),
this.M1d.q8(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=0))}Kcj(){this.vl.getVersionsReadyEvent().addListener(this.zIf);this.vl.getVersionSelectedEvent().addListener(this.onVersionSelected);this.vl.getCloseSelectedEvent().addListener(this.yzf);this.vl.getFullAppErrorEvent().addListener(this.LBf);this.vl.getIteratorSelectedEvent().addListener(this.dDf);this.vl.getShowVersionChangesToggledEvent().addListener(this.WDd);X.EwaSettings.ma(346)&&(this.vl.getDownloadTokenReadyEvent().addListener(this.AAf),
this.wKd=!0);X.EwaSettings.ma(351)&&(this.vl.getSaveACopySelectedEvent().addListener(this.jGf),this.vl.getDownloadVersionSelectedEvent().addListener(this.BAf));X.EwaSettings.ma(317)&&this.$.isEditMode&&(this.vl.getRestoreVersionSelectedEvent().addListener(this.TFf),this.xKd=!0)}Lcj(){this.mpa.getAppErrorEvent().addListener(this.eyf)}gk(){this.vl.getVersionsReadyEvent().removeListener(this.zIf);this.vl.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.vl.getCloseSelectedEvent().removeListener(this.yzf);
this.vl.getFullAppErrorEvent().removeListener(this.LBf);this.vl.getIteratorSelectedEvent().removeListener(this.dDf);this.vl.getShowVersionChangesToggledEvent().removeListener(this.WDd);X.EwaSettings.ma(351)&&(this.vl.getSaveACopySelectedEvent().removeListener(this.jGf),this.vl.getDownloadVersionSelectedEvent().removeListener(this.BAf));this.wKd&&(this.vl.getDownloadTokenReadyEvent().removeListener(this.AAf),this.wKd=!1);this.xKd&&(this.vl.getRestoreVersionSelectedEvent().removeListener(this.TFf),
this.xKd=!1);this.mpa&&this.mpa.getAppErrorEvent().removeListener(this.eyf)}JAj(){return this.jTd()||!e.AFrameworkApplication.vZ}VCj(){return this.JAj()?(d.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),m.c(1316171850,!1),!1):!0}WCj(){let Z=!0;if(X.EwaSettings.ma(594)&&!this.$.wN)return d.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&
!X.EwaSettings.ma(313)){this.iyi();this.vl.setCoauthRestoreError();Z=!1;const db=new N.a(-729359593,0,this.$.Hc,0,null);this.$.Ja.Kb(db)}this.$.wN&&(d.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Z&&(Z=!1,this.kGj()));return Z}kGj(){var Z=W.a.Zc(1,0,1894,1893,0,-1603358883,"RestoreVersionUnsavedChangesError");Z=this.dialog||new U.ErrorDialog(this.$,Z);Z.initialize();Z.vg()}O_j(){d.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?
ta.zF(this.baseVersionInfo):""}`);if(ta.zF(this.S3)===this.yXe)return d.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(X.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.mwf)return d.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),!0;if(!this.baseVersionInfo)return d.ULS.sendTraceTag(537150340,0,10,
"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),!1;const Z=ta.tRh(this.baseVersionInfo);d.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Z?Z.length:0}`);return Z?!0:(d.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}jTd(){return!this.$.$ka}J3g(){document.getElementById(this.d$b).style.display="none";const Z=new N.a(-1423792966,0,this.$.Hc,0,null);this.$.Ja.Kb(Z);this.RBe()}RBe(){this.bE&&(this.bE.endTimer(ta.Icg),
this.rAe(this.bE),this.bE=null);this.gk();this.J_d();this.perfTelemetryInfos&&(d.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Z=>JSON.stringify(Z)).toString()),this.perfTelemetryInfos=null);this.dC&&(this.dC.bpa(G.a.gVa),this.dC.bpa(G.a.hVa),this.dC.bpa(S.a.setCurrentChangeCount),this.dC.bpa(S.a.setTotalChangesCount),X.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.dC.bpa(S.a.QPa),this.dC.dispose(),this.dC=null)}akj(Z){try{this.mpa?
(H.setIsPageLoadForFirstTime(!1),X.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&!document.getElementById(ta.JUe)&&(this.mpa.resetContainer(Z),this.Tve(!0))):(H.setIsPageLoadForFirstTime(!0),ba.a(()=>{const db=new Ka;db.ulsLogger=new C.a;db.actionUrl=this.$.va.VersionHistoryActionUrl;db.hideEmbedFooter=!0;db.useFetch=X.EwaSettings.ma(411)&&!I.a.Jw;this.mpa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(T.a)(new aa,{appBootSettings:db,
rootDiv:Z}))})),this.Lcj()}catch(db){d.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${db}`)}}CPd(Z){d.ULS.sendTraceTag(537150298,0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${ta.zF(Z)}, LastSelected:${this.KCb}`);if(Z)if(ta.zF(Z).length){var db=(new Date).getTime();if(ta.zF(Z)===this.KCb&&1E3>db-this.Aud)d.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");else{ta.zF(Z)!==
this.KCb&&(d.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.vl.setTotalChangesCount(-1),this.vl.setCurrentChangeCount(-1));var Lb=excelVersionHistory.FactoryGlobal.getTelemetryCollector();Lb.addEvent("SelectVersion",ta.zF(Z));try{this.o2j(Lb);this.Aud=db;this.KCb=ta.zF(Z);const hc=new ja;hc.selectedVersionInfo=this.S3;hc.baseVersionInfo=this.baseVersionInfo;hc.telemetryCollector=Lb;this.mpa.onVersionSelectedWithParams(hc);
this.vl&&X.EwaSettings.ma(351)&&this.vl.setDisableSaveACopy(this.jTd());this.Tve(!1)}catch(hc){this.Aud=0,this.KCb="",Lb.addEvent("Exception",hc.toString()),d.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${hc}`)}finally{d.ULS.sendTraceTag(537150292,0,50,Lb?Lb.getJsonForLogging():"")}}}else d.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else d.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}o2j(Z){for(const db of this.perfTelemetryInfos){const Lb=
db.TelemetryEventKey?db.TelemetryEventKey:db.telemetryEventKey?db.telemetryEventKey:"",hc=db.TelemetryEventData?db.TelemetryEventData:db.telemetryEventData?db.telemetryEventData:"";Lb&&hc&&Z.addEvent(Lb,hc)}this.perfTelemetryInfos.length=0}rAe(Z){d.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Z?Z.getJsonForLogging():""} `)}iyi(){const Z=this.$.ea.Xm,db={};let Lb=null;for(const hc of Z)hc.UserEmail&&(db[hc.UserEmail]=hc.UserEmail in db?db[hc.UserEmail]+1:1),hc.User.UserID===
this.$.ea.clientId&&(Lb=hc.UserEmail);d.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Z.length}, TotalAuthorsAsYourself ${Lb?db[Lb]:-1}`)}$Pd(Z,db){d.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Z}`);if(this.dC){Z=new M.a(Z);Z.Values[Q.a.q6c]=this.$.va.UserSessionId;if(db)for(let Lb in db)Z.Values[Lb]=db[Lb];this.dC.send(Z)}else d.ULS.sendTraceTag(537150284,0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static zF(Z){return Z?
Z.RevisionID?Z.RevisionID:Z.revisionID?Z.revisionID:"":""}static tRh(Z){return Z?Z.DownloadUrl?Z.DownloadUrl:Z.downloadUrl?Z.downloadUrl:"":""}}ta.BBh="_excelVersionHistoryOverlay";ta.JUe="vhs_frame";ta.Fcg="TimeTakenShowVersionHistoryDialogAction";ta.Icg="TimeTillVersionHistoryDialogWasOpenMs";ta.sYd="TimeTakenGetVersionsToOnVersionsReady";ta.e9g="CountOnVersionSelectedCalledinOneVHSession";ta.f9g="CountOnVersionsReadyCalledinOneVHSession";ta.d9g="CountOnDownloadTokenReadyCalledinOneVHSession";ta.Gcg=
"TimeTakenVersionRestore";Object(b.a)(ta,"VersionHistoryPaneActor",null,[2]);var qa=a(184);class rb extends B.a{constructor(Z){super(Z)}ld(){const Z=this.sxi(),db=A.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Ya);z.TaskExtensions.Aa(z.TaskExtensions.Ed([Z,db],this.la,3),()=>{var Lb=db.result;const hc=v.a.eba(this.$.va.VersionHistoryActionUrl);hc!==fa.a.m$&&Lb.tGa(hc);Lb=new ta(this.$);this.Yc([new L(this.$,Lb)])},this.la,3)}sxi(){const Z=A.GetServiceTaskFactory.Zja(this.$.da,283,284,this.Ya).then(db=>
db.ln.loadScript("excelVersionHistory"),db=>{d.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${db}`);return Promise.reject(db)});return qa.c(Z)}static ka(Z){B.a.Nd(304,new rb(Z))}}Object(b.a)(rb,"VersionHistoryCommandHandlerFactory",B.a,[]);var Za=a(1262),gb=a(695);class mb extends f.a{constructor(Z){super();this.$=Z;this.Fb()}create(){const Z=A.GetServiceTaskFactory.Oa(this.$.da,211,212,this.Ya),db=A.GetServiceTaskFactory.Oa(this.$.da,
21,137,this.Ya);z.TaskExtensions.Aa(z.TaskExtensions.Ed([Z,db],this.$.la),()=>{const Lb=Object(gb.a)(this.$.da,305,()=>new Za.a(this.$,!0,db.result,Z.result));this.ob(Lb)},this.$.la,3)}static ka(Z){Z.da.Ga(306,new mb(Z))}}Object(b.a)(mb,"VersionHistoryHighlightManagerFactory",f.a,[]);var Ga=a(511),ib=a(5),cc=a(161),ic=a(13);class xb extends h.a{constructor(Z,db,Lb){super(Z,db);this.lineageManager=Lb}execute(Z){this.lineageManager.lineageHidePreviousHistory();return super.execute(Z)}}Object(b.a)(xb,
"LineageClearHistoryConfirmedActivity",h.a,[]);var Vb=a(17),wb=a(140);class cb{constructor(Z,db){this.$=Z;this.lineageManager=db;Z=[new Vb.a(n.a.nvd,1038647878,0,0,2238),new Vb.a(n.a.idle,1038647878,0,1)];pa.a(this.$).$Jd(new wb.a(n.a.mvd,n.a.idle,Z),new xb(n.a.nvd,n.a.idle,db))}nc(){return!1}executeCommand(Z,db,Lb){Z=!1;switch(db.command){case 1834994092:9===db.$e&&this.ILj();this.KDj(db,Lb);Z=!0;break;case -409942531:this.MDj(),Z=!0}return Z?J.Task.Ta(!0):x.a(db.command)}wc(Z,db){return 1834994092===
db.command||-409942531===db.command}Kc(){return!1}KDj(Z,db){d.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${db.MenuItemId||Z.$e}`);this.lineageManager.S7f(19===Z.$e&&!!db.MenuItemId,db.MenuItemId,Z.$e,db)}ILj(){const Z=ib.a.Xsc;Z!==cc.a(this.$).Em.cA&&cc.a(this.$).Em.activateRibbonTab(Z)}MDj(){sa.a(this.$).Js(new da.a(n.a.mvd,5,()=>{const Z=pa.a(this.$).hd,db=W.a.Zc(3,1,2235,2236,2237,1038647878,"LineageConfirmClearHistory");db.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";
db.HelpDescription=ic.a.instance.ga(1315);Z.rr([db])}))}}Object(b.a)(cb,"LineageActivityCommandHandler",null,[223]);class lb extends B.a{constructor(Z){super(Z)}ld(){z.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,366,367,this.Ya),Z=>{this.Yc([new cb(this.$,Z.result)])},this.la,3)}static ka(Z){B.a.Nd(363,new lb(Z))}}Object(b.a)(lb,"LineageActivityCommandHandlerFactory",B.a,[]);class Y{constructor(Z){this.rTa=!0;Y.Uff()?Y.Yii()?this.rTa=!1:Y.dgf()?(d.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!Z}`),
this.rTa=Z):this.rTa=!1:this.rTa=!0}x7a(){return!this.rTa}static dgf(){return Y.Uff()&&X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static Uff(){return X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",!1)}static Yii(){return X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)}}Object(b.a)(Y,"LineageCatchUpExperimentManager",null,[816]);class Oa extends f.a{constructor(Z){super();
this.$=Z;this.Fb()}create(){Y.dgf()?z.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,456,457,this.Ya),Z=>{z.TaskExtensions.Aa(Z.result.gCj(),db=>{this.ZGe(db.result)},this.$.la,3)},this.$.la,3):this.ZGe(!0)}ZGe(Z){this.ob(this.$.da.za(458)||this.$.da.Ga(458,new Y(Z)))}static ka(Z){Z.da.Ga(459,new Oa(Z))}}Object(b.a)(Oa,"LineageCatchUpExperimentManagerFactory",f.a,[]);var Wa=a(417),Ca=a(33),Ra=a(82),la=a(147),ua=a(120);class xa{}Object(b.a)(xa,"LineageClientParams",null,[]);class fb{}Object(b.a)(fb,
"LineageFilter",null,[]);var Jb=a(64),Ob=a(76),eb=a(132),Ma=a(42),va=a(188),Pa=a(116),Ha=a(109),tb=a(282),Ya=a(281),V=a(21),za=a(133),yb=a(60);const jc=(Z,db,Lb,hc,Pc,Rc,xd,Wd=null)=>{Wd=Z.Na(1,Wd);Wd.clientParams=db;Wd.lineageFilter=Lb;return yb.g(Z,"LineageOpenPaneOrChangeFilter",Wd,hc,Pc,Rc,xd,0)},Cc=(Z,db,Lb,hc,Pc,Rc,xd=null)=>{xd=Z.Na(1,xd);xd.fetchFromBelow=db;return yb.g(Z,"LineageLoadMore",xd,Lb,hc,Pc,Rc,0)},Sa=(Z,db,Lb,hc,Pc,Rc=null)=>{Rc=Z.Na(1,Rc);return yb.g(Z,"LineageRefreshView",Rc,
db,Lb,hc,Pc,0)},na=(Z,db,Lb,hc,Pc,Rc=null)=>{Rc=Z.Na(1,Rc);return yb.g(Z,"LineageUpdateView",Rc,db,Lb,hc,Pc,0)},jb=(Z,db,Lb,hc,Pc,Rc=null)=>{Rc=Z.Na(1,Rc);return yb.g(Z,"LineageClosePane",Rc,db,Lb,hc,Pc,0)},Ib=(Z,db,Lb,hc,Pc,Rc=null)=>{Rc=Z.Na(1,Rc);return yb.g(Z,"LineageHidePreviousHistory",Rc,db,Lb,hc,Pc,0)},dc=(Z,db,Lb,hc,Pc,Rc=null)=>{Rc=Z.Na(1,Rc);return yb.g(Z,"LineageLoadInGridBlueDots",Rc,db,Lb,hc,Pc,0)};var ob=a(51),Fa=a(344);class Ab{constructor(){this.activityList=null;this.oldestActivityId=
this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(Ab,"LineageActivitiesResponseDTO",null,[]);class $b extends Ab{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)($b,"LineageActivitiesUpdateResponseDTO",Ab,[]);class Cb{constructor(){this.onDisplayInGridHighlightsChanged=
this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onDegradedCardGiveFeedbackButtonClicked=this.onLearnMoreLinkClicked=this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(Cb,"LineageAppCallbacks",null,[]);class Rb{constructor(){this.imageUrl=this.email=
this.displayName=this.provider=this.id=null}}Object(b.a)(Rb,"LineageAuthorDTO",null,[]);class uc{constructor(){this.logger=this.uiCulture=this.dataCulture=null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(uc,"LineageControllerFactoryParams",null,[]);class nb{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(nb,"LineageSharedRangeDTO",null,[]);class Fb{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Fb,"LineageSheetMultiRangeDTO",
null,[]);class Jc{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(Jc,"LineageUserActivityDTO",null,[]);class Fc{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Fc,"LineageValueChangeDTO",null,[]);var zb;
(function(Z){Z[Z.default=0]="default";Z[Z.D48X48=1]="D48X48";Z[Z.D64X64=2]="D64X64";Z[Z.D96X96=3]="D96X96";Z[Z.D120X120=4]="D120X120";Z[Z.D240X240=5]="D240X240";Z[Z.D360X360=6]="D360X360";Z[Z.D432X432=7]="D432X432";Z[Z.D504X504=8]="D504X504";Z[Z.D648X648=9]="D648X648"})(zb||(zb={}));Object(b.b)("ProfilePhotoDimension",zb);const hb=(Z,db)=>{let Lb=[];for(const Nd of Z){Z=Nd;var hc=db,Pc=Object(T.a),Rc=new Jc,xd=Number.parseLocale(Z.UserActivity.Id),Wd=Z.Uid,ue=Z.UserActivity.Type;var ve=Z.UserActivity.Person;
var qe=hc;if(ve){var we=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(we=qe.Ota(ve.Email,ve.Provider,e.AFrameworkApplication.Ii,zb.default));ve=Object(T.a)(new Rb,{id:ve.Id,provider:ve.Provider,displayName:ve.DisplayName,email:ve.Email,imageUrl:we})}else ve=null;qe=Z.SheetName;we=new Date(Z.UserActivity.DisplayTimestamp);var Ze=Z.DisplayLocation,zf=Z.LineageValueChangeList;var Ja=[];for(const je of zf)zf=Object(T.a)(new Fc,{hasNewValue:je.HasNewValue,hasOldValue:je.HasOldValue,
newValue:je.HasNewValue?je.NewValue:null,oldValue:je.HasOldValue?je.OldValue:null,cellLocation:je.CellLocation}),Ja.push(zf);zf=Z.IsBulkEditOverFlow;a:{var Eb=Z.UserActivity.LocationList;var zc=Z.UserActivity.Type;if(!Eb){d.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");zc=null;break a}if(!Eb.length){d.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");zc=null;break a}var bd=[],yd=
[];let je="";21===zc?yd.push(Eb[0]):yd=Eb;for(const le of yd)switch(le.Type){case 1:break;case 2:je=le.SheetName;break;case 0:Eb=le;if(!Eb.RangeList){d.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}je=Eb.RangeList[0].SheetName;yd=[];21===zc?yd.push(Eb.RangeList[0]):yd=Eb.RangeList;for(const bf of yd)Eb=Object(T.a)(new nb,{firstCol:bf.FirstColumn,firstRow:bf.FirstRow,lastRow:bf.LastRow,lastCol:bf.LastColumn}),bd.push(Eb);break;default:d.ULS.sendTraceTag(512259098,
0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",le.Type)}zc=Object(T.a)(new Fb,{sheetName:je,rangeList:bd})}hc=(bd=Z.NestedActivityList)?hb(bd,hc):null;Z=Pc(Rc,{activityId:xd,activityGuid:Wd,activityType:ue,author:ve,sheetName:qe,displayTimestamp:we,gridLocation:Ze,valueChanges:Ja,isBulkEditOverflow:zf,rangeHighlightLocation:zc,nestedActivityList:hc,degradedCardTypeBits:Z.DegradedCardTypeBits});25===Z.activityType?(Pc=[],Pb(Z,Pc),Lb=[...Lb,...Pc]):Lb.push(Z)}return Lb},
Pb=(Z,db)=>{25===Z.activityType?Z.nestedActivityList.forEach(Lb=>{Lb&&Pb(Lb,db)}):db.push(Z)};class ud{constructor(Z,db,Lb,hc,Pc){this.E3a=this.UF=null;this.EE=this.qvd=0;this.$Fb=()=>{this.S7&&(this.S7.stop(),this.S7=null);this.oNb.start();this.UF.createLineageTaskPane(this.lvd,this.E3a,this.activityGuid)};this.lineageOpenPaneOrChangeFilterRequest=(Rc,xd)=>{this.oNb.stop();za.b(this.$).ud(eb.a.iSi,{});this.aGj();const Wd=Object(T.a)(new xa,{ClientViewCapacity:Rc.clientViewCapacity});let ue=null;
xd&&(ue=Object(T.a)(new fb,{FilterSheetMultiRange:this.uQj(xd.filterSheetMultiRange)}));const ve=qe=>{qe=Pa.a.Pe(qe.data);d.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${W.a.sc(qe)}]`)};this.$.userOperationManager.Ic(new va.a(1010,0,(qe,we,Ze)=>jc(this.$.pa.ya,Wd,ue,Ya.b(qe,this.Lgd("LineageOpenPaneOrChangeFilter")),Ya.a(we,ve),Ze,null),80),null)};this.lineageLoadMoreRequest=Rc=>{za.b(this.$).ud(eb.a.hSi,{});const xd=Wd=>{Wd=Pa.a.Pe(Wd.data);
d.ULS.sendTraceTag(537155480,0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${W.a.sc(Wd)}]`)};this.$.userOperationManager.Ic(new va.a(1011,0,(Wd,ue,ve)=>Cc(this.$.pa.ya,Rc,Ya.b(Wd,this.Lgd("LineageLoadMore")),Ya.a(ue,xd),ve,null),80),null)};this.lineageRefreshViewRequest=()=>{za.b(this.$).ud(eb.a.jSi,{});const Rc=xd=>{xd=Pa.a.Pe(xd.data);d.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${W.a.sc(xd)}]`)};this.$.userOperationManager.Ic(new va.a(1012,
0,(xd,Wd,ue)=>Sa(this.$.pa.ya,Ya.b(xd,this.Lgd("LineageRefreshView")),Ya.a(Wd,Rc),ue,null),80),null)};this.lineageUpdateViewRequest=()=>{na(this.$.pa.ya,Rc=>{if(Rc=tb.a(Rc)?null:Rc.Result){var xd={["CountOfUpdatedActivities"]:Rc.LineageActivitiesResponse.ActivityList.length};za.b(this.$).ud(eb.a.kSi,xd);Rc=Object(T.a)(new $b,{activityList:X.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?hb(Rc.LineageActivitiesResponse.ActivityList,this.cAa):this.IHd(Rc.LineageActivitiesResponse.ActivityList),
latestActivityId:Rc.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Rc.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:Rc.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Rc.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Rc.HasNewActivities,filterSheetMultiRange:this.kQj(Rc.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Rc.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Rc.LineageActivitiesResponse.ServerLastActivityId,
showLoadPrevious:Rc.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Rc.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(Rc.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.mxb(Rc.LineageActivitiesResponse.EolPersonHideHistory)});this.UF.onLineageActivitiesUpdateResponse(Rc)}else d.ULS.shipAssertTag(537155475,0,!!Rc,"LineageManager.LineageUpdateView returned null response.")},Rc=>{Rc=Pa.a.Pe(Rc.data);d.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${W.a.sc(Rc)}]`)},
null,null)};this.areInGridHighlightsAvailable=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.onDisplayInGridHighlightsChanged=Rc=>{this.blueDotManager&&this.blueDotManager.hvj(Rc)};this.onCardSelected=(Rc,xd)=>{if(Rc=Rc.rangeHighlightLocation){if(xd){let Wd;if(({range:Wd}=Ma.Z(xd,X.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?
this.$.xa:null)).returnValue){this.nbf(Rc.sheetName,this.j5a([Ma.j(Wd)]));return}d.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+xd+" is not valid.")}Rc.rangeList.length?this.nbf(Rc.sheetName,Rc.rangeList):this.X$h(Rc.sheetName)}};this.onLearnMoreLinkClicked=()=>{const Rc=new N.a(-859308420,Ob.a.Db,this.$.Hc,12,null);this.$.Ja.Kb(Rc,{[Ob.a.og]:"HelpID=XLO_LineageTS",["InputMethod"]:Ob.a.Db,[Ob.a.Jc]:ib.a.qV,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=
Rc=>{this.$.Ja.Kb(new N.a(-1112508866,Rc,this.$.Hc,12,null))};this.onDegradedCardGiveFeedbackButtonClicked=()=>{const Rc={};Rc[ib.a.CQ]="LineageDegradedCard";this.$.Xc(802602464,0,12,Rc)};this.isFeatureEnabled=Rc=>{switch(Rc){case "FlattenListInLineageManager":return X.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");default:return!1}};this.zf=()=>{const Rc=this.$.ea.Io.LineageVersion;Rc!==this.qvd&&(d.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Rc}, this.lineageVersion: ${this.qvd}`),
this.qvd=Rc,this.Daj())};this.Tc=(Rc,xd)=>{this.UF&&!this.lineageTaskPane.kic&&xd.WH&&(d.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.Oo=()=>{this.UF&&!this.lineageTaskPane.kic&&(d.ULS.sendTraceTag(587220562,0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.KD=()=>{const Rc=this.o5a();this.UF.onFilterableSheetListChange(Rc)};this.zza=()=>{const Rc=this.o5a();this.UF.onFilterableSheetListChange(Rc)};
this.Zpc=()=>{const Rc=this.o5a();this.UF.onFilterableSheetListChange(Rc)};this.onPaneClosed=()=>{this.UF.onPaneClosed();jb(this.$.pa.ya,null,Rc=>{Rc=Pa.a.Pe(Rc.data);d.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${W.a.sc(Rc)}]`)},null,null)};this.onRangeFilterInputEnabled=Rc=>{Rc?this.gridView.ha.NT(this.Pc):this.gridView.ha.XR(this.Pc)};this.Pc=()=>{var Rc=Ma.q(this.gridView.ha.ra.activeRange,this.$);Rc=Object(T.a)(new Fb,{rangeList:this.j5a(Rc.Ranges),
sheetName:Rc.SheetName});this.UF.onSelectedRangeUpdated(Rc)};this.tryParseRangeInfo=Rc=>{let xd;if(({sheetName:xd,range:Rc}=Ma.Z(Rc,this.$.xa)).returnValue){xd||(xd=this.$.xa.oa.sheetName);const Wd=[];Wd.push(Rc);Rc=Ma.u(xd,null,Wd);return Object(T.a)(new Fb,{rangeList:this.j5a(Rc.Ranges),sheetName:Rc.SheetName})}return null};this.Rz=()=>{const Rc=this.EE!==this.$.ea.ze;this.UF&&this.lineageTaskPane.isVisible&&Rc&&(this.EE=this.$.ea.ze,this.UF.onRefreshRequired())};this.$=Z;db.Ga(366,this);this.blueDotManager=
hc;this.gridView=V.h(this.$);this.lineageTaskPane=Lb;this.lvd=this.lineageTaskPane.SM();this.batchSize=50;this.S7=Pc;this.oNb=this.$.Jb.Pg("UserAction","LineagePaneLoadingShimmerStopWatch");this.cAa=Ra.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.yei();this.qGg()}dispose(){this.Fdj();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.vO(this.onPaneClosed),this.lineageTaskPane.kG(this.Rz),this.lineageTaskPane=null);this.oNb=this.cAa=this.E3a=this.lvd=this.UF=null}S7f(Z,
db,Lb,hc){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===Lb){d.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!Z&&16!==Lb&&18!==Lb&&30!==Lb){this.lineageTaskPane.y2c();return}}Ca.a.fd(this.$)||(this.oNb.start(),this.S7&&(ob.b().OA(this.oNb.id,this.S7.id,"actions","actions"),this.S7.stop(),this.S7=null));this.lineageTaskPane.kic||d.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Z?
db:Lb}`);this.EE=this.$.ea.ze;this.E3a=null;Z?(Z=Ma.r(this.gridView.ha.ra.selectedRanges,this.$),this.E3a=Object(T.a)(new Fb,{rangeList:db.toString()===ib.a.k7f?this.j5a(Z.Ranges):null,sheetName:Z.SheetName})):X.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&30===Lb&&this.O3i(hc);Ca.a.fd(this.$)&&this.lineageTaskPane.kic?this.lineageTaskPane.Bvj(this.$Fb):this.UF.createLineageTaskPane(this.lvd,this.E3a,this.activityGuid);this.lineageTaskPane.wg(!0);
this.$.Xc(-71295319,-1,0,null)}O3i(Z){if(Z){var db=Z.sheetName,Lb=Z.gridLocation;Z=Z.activityGuid;if(db&&Lb&&Z){this.activityGuid=Z;var hc;({range:hc}=Ma.Z(Lb,this.$.xa)).returnValue?this.E3a=Object(T.a)(new Fb,{rangeList:this.j5a([Ma.j(hc)]),sheetName:db}):d.ULS.shipAssertTag(512266262,0,!1,"Blue dot sheetName/gridLocation is not valid.")}else d.ULS.shipAssertTag(509752709,0,!1,"Blue dot sheetName/gridLocation/activityGuid is not set.")}else d.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Z=
{["paneVisible"]:this.lineageTaskPane.isVisible};la.a.sendTelemetryEvent(Object(T.a)(new Fa.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:ua.a.Wj(Z)}));this.$.userOperationManager.Ic(new va.a(1018,0,(db,Lb,hc)=>Ib(this.$.pa.ya,db,Lb,hc,null),64),null);this.lineageTaskPane.isVisible||this.S7f(!1,null,4,void 0)}yei(){const Z=Object(T.a)(new Cb,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,
onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,onDegradedCardGiveFeedbackButtonClicked:this.onDegradedCardGiveFeedbackButtonClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,
onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged});ba.a(()=>{this.UF=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(T.a)(new uc,{clientBatchSize:this.batchSize,filterableSheetList:this.o5a(),uiCulture:this.$.va.UICultureTag,dataCulture:this.$.va.DataCultureTag,logger:new C.a,lineageAppCallbacks:Z}))})}Lgd(Z){return db=>{if(db=tb.a(db)?null:db.Result){var Lb={["CountOfActivities"]:db.ActivityList.length};Lb.WebRequestName=Z;za.b(this.$).ud(eb.a.FPi,
Lb);db=Object(T.a)(new Ab,{activityList:X.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?hb(db.ActivityList,this.cAa):this.IHd(db.ActivityList),latestActivityId:db.LastSearchedActivityId,oldestActivityId:db.FirstSearchedActivityId,serverMessageCode:db.LineageResponseCode,lastSearchedActivityTimestamp:new Date(db.EcmaLastSearchedDate),serverFirstActivityId:db.ServerFirstActivityId,serverLastActivityId:db.ServerLastActivityId,showLoadPrevious:db.ShowLoadPrevious,
eolCorrelationId:db.EolCorrelationId,eolDateHideHistory:new Date(db.EolDateHideHistory),eolPersonHideHistory:this.mxb(db.EolPersonHideHistory)});this.UF.onLineageActivitiesResponse(db)}else d.ULS.shipAssertTag(537155477,0,!!db,"LineageManager."+Z+" returned null response.")}}kQj(Z){return Ha.e(Z.Ranges)&&!Z.SheetName?null:Object(T.a)(new Fb,{rangeList:this.j5a(Z.Ranges),sheetName:Z.SheetName})}j5a(Z){const db=[];for(const Lb of Z)Z=Object(T.a)(new nb,{firstCol:Lb.FirstColumn,firstRow:Lb.FirstRow,
lastRow:Lb.LastRow,lastCol:Lb.LastColumn}),db.push(Z);return db}uQj(Z){if(!Z)return null;const db={};db.Ranges=this.Jhd(Z.rangeList);db.SheetName=Z.sheetName;return db}Jhd(Z){const db=[];if(Ha.e(Z))return db;for(const Lb of Z)Z={},Z.FirstColumn=Lb.firstCol,Z.FirstRow=Lb.firstRow,Z.LastRow=Lb.lastRow,Z.LastColumn=Lb.lastCol,db.push(Z);return db}X$h(Z){(Z=this.$.xa.getItemByName(Z))&&Z.visible&&Z.activate(!0)}nbf(Z,db){const Lb=[];for(var hc of db)db={},db.FirstColumn=hc.firstCol,db.FirstRow=hc.firstRow,
db.LastRow=hc.lastRow,db.LastColumn=hc.lastCol,Lb.push(Ma.D(db));hc=Lb.length-1;db=Lb[hc].topLeft;V.h(this.$).P4(Lb,hc,Z,null,db,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}Daj(){this.UF&&this.lineageTaskPane.isVisible&&(this.EE=this.$.ea.ze,this.UF.onRefreshRequired())}qGg(){this.lineageTaskPane.vM(this.onPaneClosed);this.lineageTaskPane.ME(this.Rz);this.$.ea.ku(this.zf);this.$.ea.Uj(this.Tc);this.$.ea.uM(this.Oo);const Z=this.$.xa;Z.EY(this.KD);Z.eha(this.Zpc);Z.EGa(this.zza);
Z.CZa(this.Zpc)}Fdj(){this.$.ea.Mv(this.zf);this.gridView.ha.XR(this.Pc);this.$.ea.uk(this.Tc);this.$.ea.VR(this.Oo);const Z=this.$.xa;Z.s7(this.KD);Z.rna(this.Zpc);Z.nRa(this.zza);Z.OJb(this.Zpc)}onStaleActivitiesDetected(){this.UF.onStaleActivitiesDetected()}o5a(){const Z=this.$.xa.items,db=[];for(const Lb of Z)Lb.visible&&!Jb.e(Lb)&&db.push(Lb.sheetName);return db}aGj(){if(X.EwaSettings.ma(600)){var Z=this.$.da.za(403);Z&&Z.disable();Z=new N.a(-847286761,Ob.a.Db,this.$.Hc,0,ib.a.p0);this.$.Ja.Kb(Z,
{["InputMethod"]:Ob.a.Db,CalloutName:5})}}IHd(Z){const db=[];for(const Lb of Z)Z=Object(T.a)(new Jc,{activityId:Number.parseLocale(Lb.UserActivity.Id),activityGuid:Lb.Uid,activityType:Lb.UserActivity.Type,author:this.mxb(Lb.UserActivity.Person),sheetName:Lb.SheetName,displayTimestamp:new Date(Lb.UserActivity.DisplayTimestamp),gridLocation:Lb.DisplayLocation,valueChanges:this.Q5i(Lb.LineageValueChangeList),isBulkEditOverflow:Lb.IsBulkEditOverFlow,rangeHighlightLocation:this.E5i(Lb.UserActivity.LocationList,
Lb.UserActivity.Type),nestedActivityList:this.x5i(Lb.NestedActivityList),degradedCardTypeBits:Lb.DegradedCardTypeBits}),db.push(Z);return db}E5i(Z,db){if(!Z)return d.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Z.length)return d.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const Lb=[];var hc=[];let Pc="";21===db?hc.push(Z[0]):hc=Z;for(const Rc of hc)switch(Rc.Type){case 1:break;
case 2:Pc=Rc.SheetName;break;case 0:Z=Rc;if(!Z.RangeList){d.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}Pc=Z.RangeList[0].SheetName;hc=[];21===db?hc.push(Z.RangeList[0]):hc=Z.RangeList;for(const xd of hc)Z=Object(T.a)(new nb,{firstCol:xd.FirstColumn,firstRow:xd.FirstRow,lastRow:xd.LastRow,lastCol:xd.LastColumn}),Lb.push(Z);break;default:d.ULS.sendTraceTag(537155464,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(T.a)(new Fb,
{sheetName:Pc,rangeList:Lb})}Q5i(Z){const db=[];for(const Lb of Z)Z=Object(T.a)(new Fc,{hasNewValue:Lb.HasNewValue,hasOldValue:Lb.HasOldValue,newValue:Lb.HasNewValue?Lb.NewValue:null,oldValue:Lb.HasOldValue?Lb.OldValue:null,cellLocation:Lb.CellLocation}),db.push(Z);return db}x5i(Z){return Z?this.IHd(Z):null}mxb(Z){if(!Z)return null;let db=null;e.AFrameworkApplication.fa.qa("IsUserProfilePictureResolutionEnabled")&&(db=this.cAa.Ota(Z.Email,Z.Provider,e.AFrameworkApplication.Ii,0));return Object(T.a)(new Rb,
{id:Z.Id,provider:Z.Provider,displayName:Z.DisplayName,email:Z.Email,imageUrl:db})}}Object(b.a)(ud,"LineageManager",null,[815,2]);class Ub extends f.a{constructor(Z){super();this.S7=this.lineageTaskPane=null;this.$=Z;this.Fb()}lpf(Z,db){z.TaskExtensions.Aa(Z,()=>{this.ob(this.$.da.za(366)||new ud(this.$,this.$.da,this.lineageTaskPane,db,this.S7))},this.$.la,3)}create(){this.S7=this.$.Jb.Ac("UserAction","LineagePaneSeenStopwatch");this.S7.start();const Z=A.GetServiceTaskFactory.Oa(this.$.da,365,364,
this.Ya),db=Wa.a(this.$),Lb=A.GetServiceTaskFactory.Oa(this.$.da,283,284,this.Ya);if(X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const hc=A.GetServiceTaskFactory.Oa(this.$.da,501,500,0);z.TaskExtensions.Aa(z.TaskExtensions.Ed([Z,db,Lb,hc],this.$.la),()=>{this.lineageTaskPane=Z.result;Ca.a.fd(this.$)||db.result.vN(this.lineageTaskPane);this.lpf(qa.c(Lb.result.ln.loadScript("cellLineage")),hc.result)},this.$.la,3)}else z.TaskExtensions.Aa(z.TaskExtensions.Ed([Z,db,Lb],
this.$.la),()=>{this.lineageTaskPane=Z.result;Ca.a.fd(this.$)||db.result.vN(this.lineageTaskPane);this.lpf(qa.c(Lb.result.ln.loadScript("cellLineage")),null)},this.$.la,3)}static ka(Z){Z.da.Ga(367,new Ub(Z))}}Object(b.a)(Ub,"LineageManagerFactory",f.a,[]);var Ac=a(788),Ic=a(224),dd=a(14),Ud=a(107),Hd=a(260),me=a(85),xe=a(238),Ke=a(19),vd=a(701);const Qe=ib.a.hBc+"LineageActivityPaneTitle",bc=ib.a.nfb+"LineageActivityCloseButton";class Zc extends xe.a{constructor(Z,db,Lb){super(Z);this.$Fb=this.VCe=
this.Qd=null;this.krd=!0;this.vq=0;this.Sp=!1;this.Bc=(hc,Pc)=>{Pc.Nf||this.y2c()};this.rk=()=>{this.y2c();return!0};this.$=db;this.taskPaneManager=Lb;this.$.ik(this.Bc);oa.a(this.$).ai(this);Ca.a.fd(this.$)&&(this.isVisible=!1)}LP(Z){this.get_events().addHandler("LineageTaskPaneRemove",Z)}WR(Z){this.get_events().removeHandler("LineageTaskPaneRemove",Z)}ME(Z){this.addHandler("LineageTaskPaneVisibilityChanged",Z)}kG(Z){this.removeHandler("LineageTaskPaneVisibilityChanged",Z)}vM(Z){this.get_events().addHandler("LineageTaskPaneClose",
Z)}vO(Z){this.get_events().removeHandler("LineageTaskPaneClose",Z)}get isVisible(){return super.isVisible}set isVisible(Z){super.isVisible!==Z&&(super.isVisible=Z,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get kic(){return this.krd}get Gf(){return this.isVisible}get jh(){return 15}get de(){return K.a.ywi}get Fk(){return Ke.a.Jyh}get sN(){return ic.a.instance.ga(1073)}get Kp(){return 300}get isResizable(){return!1}get mc(){return this.domElement}get height(){return this.taskPaneManager.XO.offsetHeight}get titleText(){return ic.a.instance.ga(1290)}get ZB(){return this.taskPaneManager.zva(this.mc,
this.titleText,this.Kp,this.isResizable,()=>{this.isVisible=!0;this.$Fb?this.$Fb():d.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Kp)}lq(){return this.Sp}Ds(){return this.Sp}FR(){}TQ(){return!1}sj(){}Zj(){}dispose(){this.$&&(this.$.Il(this.Bc),oa.a(this.$).Xz(this));this.Qd&&(Ic.a.instance.Ba(dd.a.click,this.Qd,this.rk),Ud.KeyInputManager.instance.Tv(this.Qd,this.VCe));this.Qd=this.taskPaneManager=
this.$=null;super.dispose()}kg(Z,db){if(!db){Z=ea.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Z)return!1;ea.DOMElementExtensions.setFocus(Z)}return!db}mh(Z){return ea.DOMElementExtensions.yf(this.mc,Z)}wg(Z){this.Sp=Z;const db=this.taskPaneManager;if(this.isVisible=Z)this.$.frame.Me.ak("LineagePane"),this.krd=!1;if(Ca.a.fd(this.$))Z?db.X6("LineageTaskPane",this.ZB):db.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.kA();const Lb=!!this.taskPaneManager.oh&&
15===this.taskPaneManager.oh.taskPane.jh;Z&&0<db.YB.length&&(!Lb||db.isCollapsed)&&db.nG(this,!0)}this.$.af()}SM(){var Z=this.$.Eb;Z=Ca.a.fd(this.$)?this.domElement:document.getElementById(Z+ib.a.pvd);var db=this.sH();Z.appendChild(db);db=vd.b("div","LineagePaneBodyId","LineageActivityBody");Z.appendChild(db);this.Cvj();return db}y2c(){this.$.frame.Me.ak(this.$.frame.Me.mF||Hd.AFrame.TT);this.krd=!0;this.wg(!1);this.raiseEvent("LineageTaskPaneClose")}Bvj(Z){this.$Fb=Z}Cvj(){this.$.frame.Me.wk("LineagePane");
const Z=this.$.frame.Me.Ci("LineagePane");Z.parent=Hd.AFrame.TT;Z.IN=!0}sH(){const Z=vd.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),db=vd.b("h1","LineagePaneTitleId",Qe);db.innerText=this.titleText;this.Qd=Ac.a.pb("LineagePaneCloseButtonId",bc,ic.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.Qd.classList.add(e.AFrameworkApplication.isRtl?ib.a.Maa:ib.a.Naa);Ic.a.instance.ta(dd.a.click,this.Qd,this.rk);this.VCe=Ud.KeyInputManager.instance.Ls(this.Qd,this.rk,me.a.Lh);Z.appendChild(db);
Z.appendChild(this.Qd);return Z}static ka(Z,db){const Lb=Z.Eb;let hc=document.getElementById(Lb+ib.a.pvd);hc||(hc=document.createElement("div"),hc.id=Z.Eb+ib.a.pvd,hc.classList.add("LineageActivityPane"),Ca.a.fd(Z)||document.getElementById(Lb+ib.a.xR).appendChild(hc));return Z.da.za(365)||Z.da.Ga(365,new Zc(hc,Z,db))}}Object(b.a)(Zc,"LineageTaskPane",xe.a,[814,2,368,36]);class gd extends f.a{constructor(Z){super();this.hh=this.yi=null;this.$=Z;this.Fb()}get ND(){this.yi||(this.yi=z.TaskExtensions.Aa(Wa.a(this.$),
Z=>{this.hh=Zc.ka(this.$,Z.result)},this.la,3));return this.yi}create(){const Z=A.GetServiceTaskFactory.create(this.$.da,203,this.la,this.Ya),db=A.GetServiceTaskFactory.create(this.$.da,155,this.la,this.Ya);z.TaskExtensions.Aa(z.TaskExtensions.ts(z.TaskExtensions.Ed([Z,db],this.la),()=>this.ND,this.la),()=>{this.ob(this.hh)},this.la,3)}dispose(){this.hh=this.yi=this.$=null;super.dispose()}static ka(Z){Z.da.Ga(364,new gd(Z))}}Object(b.a)(gd,"LineageTaskPaneFactory",f.a,[]);class Sc{constructor(Z,db){this.Prd=
!1;this.zf=()=>{this.ceg()};this.$=Z;X.EwaSettings.ma(600)&&this.$.ea.h9a&&!Sc.ryb&&(db&&!db.rTa||this.g0j(),Sc.t$e?d.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):db&&!db.rTa||this.n0j());d.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.WKd();this.$=null;d.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){Sc.ryb||
(Sc.ryb=!0,d.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.WKd()}n0j(){X.EwaSettings.ma(596)&&!this.$.isAnonymousUser()&&yb.i(this.$.pa.ya,Z=>{this.$?(Z=Z.Result,d.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${Z}.`),Sc.t$e=!0,Z&&this.vPb(0)):d.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{d.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}g0j(){X.EwaSettings.ma(595)&&!this.ceg()&&(this.$.ea.ku(this.zf),this.Prd=!0)}ceg(){return this.$.ea&&this.$.ea.Io&&this.$.ea.Io.ShouldTriggerLineageCalloutOnMerge?(d.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.vPb(1),!0):!1}vPb(Z){Sc.ryb?d.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
(Sc.ryb=!0,d.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${Z}.`),this.WKd(),X.EwaSettings.ma(476)&&(Z=new N.a(-847286761,Ob.a.Db,this.$.Hc,0,ib.a.p0),this.$.Ja.Kb(Z,{["CalloutName"]:4})))}WKd(){this.Prd&&(this.Prd=!1,this.$.ea.Mv(this.zf))}}Sc.ryb=!1;Sc.t$e=!1;Object(b.a)(Sc,"LineageTeachingCalloutTriggerManager",null,[817,2]);class Gd extends f.a{constructor(Z){super();this.$=Z;this.Fb()}create(){z.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,
458,459,this.Ya),Z=>{const db=Z.result;Z=Object(gb.a)(this.$.da,403,()=>new Sc(this.$,db));this.ob(Z)},this.$.la,3)}static ka(Z){Z.da.Ga(402,new Gd(Z))}}Object(b.a)(Gd,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);var Vd=a(872),Ed=a(79);class Od{constructor(Z,db){this.yh=Z;this.dv=db}bX(Z,db,Lb,hc=null){return this.zmh(Z,hc,Pc=>this.yh.dob(Pc,2,Lb,db,void 0,void 0,void 0,void 0,void 0,"2"))}zmh(Z,db,Lb){const hc=!!db&&""!==db;let Pc=Z;hc&&(Pc=v.a.IT(Z,"perfTag",db));const Rc=new Date;return Vd.a.then(Lb(Pc),
xd=>{const Wd=+new Date-+Rc;if(!xd||!xd.Jg||!xd.Jg.data)return xd;hc&&xd.Jg.data.request&&this.qrj(xd.Jg.data.request.getResolvedUrl(),db,Wd);return xd})}qrj(Z,db,Lb){Z=this.dv.l_h(Z);if(Z.count&&(Z=Ed.last(Z))){const hc={Message:"Request durations for activities calls."};hc.PerfTag=db;hc.CustomDuration=Lb;hc.PerformanceDuration=Z.duration;d.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(hc))}}}Object(b.a)(Od,"CatchUpNetworkingWrapper",null,[281]);var se=a(243);class Le extends se.a{constructor(Z,
db){super(Z,db)}Vaa(){return 6}}Object(b.a)(Le,"GetActivityFeedRequest",se.a,[]);class Id extends se.a{constructor(Z,db,Lb,hc,Pc,Rc){super(Z,db);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=Lb;this.ActivityStatesToSet=hc;this.ActivityStatesToReset=Pc;this.ResetUnseenCount=Rc}Vaa(){return 7}}Object(b.a)(Id,"UpdateActivityFeedStateRequest",se.a,[]);var fe=a(385);class Yd{constructor(Z,db,Lb){this.Ree=Z;this.pDa=db;this.GDa=Lb}getActivityFeed(Z){return Vd.a.then(this.GDa.execute(new Le(this.pDa(),
null),(db,Lb,hc)=>this.Ree.bX(db,Lb,hc,"ActivityFeed"),Z),db=>{if(!db)return d.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!db.Jg)return d.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!db.Jg.data)return d.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!db.Jg.data.ue)return d.ULS.sendTraceTag(572846940,3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;db=fe.a.gJa(db.Jg.data.ue);
return db?db:(d.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}GUj(Z,db,Lb,hc){return Vd.a.then(this.GDa.execute(new Id(this.pDa(),null,Z,db,Lb,hc),(Pc,Rc,xd)=>this.Ree.bX(Pc,Rc,xd,"UpdateActivityFeedState"),null),Pc=>{try{return Pc.succeeded}catch(Rc){return d.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+Rc.message),!1}})}}Object(b.a)(Yd,"CatchUpRequestHandler",null,[282]);var Ce=a(467);class ye{constructor(Z){this.zga=Z;this.Dde=
new Ce.a}gyi(){this.Vyi()}Vyi(){if(this.zga){var Z=db=>{this.Dde.contains("CatchUpChangesFeedback")||(this.Dde.add("CatchUpChangesFeedback"),db.logActivity("CatchUpChangesFeedback",null))};this.zga.execute(db=>{window.setTimeout(()=>{Z(db)},2E4)})}else d.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(ye,"FloodgateEventLogger",null,[]);var Ae=a(187);class He{constructor(Z){this.hzg=Z}get duration(){return this.hzg.duration}}Object(b.a)(He,
"PerformanceResourceTimingWrapper",null,[]);class gf{constructor(Z){this.dv=Z}l_h(Z){const db=new Ae.a;if(!this.dv)return db;Z=this.dv.getEntriesByName(Z,"resource");if(!Z)return db;for(const Lb of Z)db.add(new He(Lb));return db}}Object(b.a)(gf,"PerformanceWrapper",null,[]);var Xe=a(248);class $a{constructor(){this.gb=null}get name(){return"Common.App.CatchUpActivity"}Wh(Z){this.gb=Z;this.gb.register(Od,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").xc().Fc(()=>
new Od(e.AFrameworkApplication.Dd,new gf(window.performance)));this.gb.register(Yd,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").xc().Fc(()=>new Yd(this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>e.AFrameworkApplication.Ii,new fe.a));this.gb.register(ye,"Common.App.CatchUpActivity.FloodgateEventLogger").xc().Fc(()=>new ye(this.gb.Ub("Common.ISystemInitiatedFeedback")))}init(){this.gb.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");
this.gb.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){Xe.a.instance.Fi(new $a)}}Object(b.a)($a,"CatchUpActivityPackage",null,[4,5]);class ac{constructor(Z,db){this.$=Z;this.catchUpActivityManager=db}nc(Z,db){return this.catchUpActivityManager?-876699925===db?!this.catchUpActivityManager.Tff:!1:!0}executeCommand(Z,db){Z=!1;switch(db.command){case -876699925:Z=this.catchUpActivityManager.sXi();break;case 950288339:return this.catchUpActivityManager.showHideInGridHighlights(),
J.Task.Ta(!0)}return Z?J.Task.Ta(!0):x.a(db.command)}wc(Z,db){return X.EwaSettings.ma(431)?-876699925===db.command||950288339===db.command:!1}Kc(){return!1}}Object(b.a)(ac,"CatchUpActivityCommandHandler",null,[223]);class Da extends B.a{constructor(Z){super(Z)}ld(){this.$.da.$a(286,Z=>{this.Yc([new ac(this.$,Z)])})}static ka(Z){B.a.Nd(285,new Da(Z))}}Object(b.a)(Da,"CatchUpActivityCommandHandlerFactory",B.a,[]);var Na=a(263),sb=a(518),Kb=a(87),Yb=a(83),vc=a(25);class ad{constructor(Z){this.Uh=Z}doesContentExist(Z){if(!Z)return d.ULS.sendTraceTag(537168066,
3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Z.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Z.navigationId)return d.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),!1;const db={};db.NavigationId=atob(Z.navigationId);return 32===this.Uh.ae(vc.a.uJa,2,db);default:return!1}}}Object(b.a)(ad,"CatchUpActivityContentManager",null,[806]);var ld=a(822),md=a(1237);class Qd{constructor(Z){this.WFb=()=>{switch(this.zu.model.state){case 1:this.c8f(!0);
break;case 0:this.xNb(!1);break;case 2:case 3:this.xNb(!0);break;default:d.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.zu.model.state)}};this.yvg=Z;this.zu.$pe(this.WFb);this.Az=[]}get zu(){return this.yvg}dispose(){this.zu.bUf(this.WFb);this.Az=null}Zuj(Z){this.Az.push(Z)}M2g(){this.Az.length=0}c8f(Z){for(const db of this.Az){db.className=ld.a.C_g;const Lb=document.getElementById(`${db.id}-${ib.a.wAe}`);ea.DOMElementExtensions.setVisible(Lb,
Z)}}xNb(Z){for(const db of this.Az)db&&(Z?db.className=2===this.zu.model.state?ld.a.L8i:ld.a.M8i:this.c8f(!1))}}Object(b.a)(Qd,"RangeCatchUpActivityView",null,[910,2]);var ce=a(22);class ec extends md.a{constructor(Z,db,Lb){super(Z,db,Lb);this.gridView=V.h(Z);this.ena=db}dispose(){this.gridView=null;super.dispose()}TIg(Z){const db=this.Tgb[0];db?db.Zuj(Z):d.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.ena.activityId)}Nkj(){const Z=
this.Tgb[0];Z&&Z.M2g()}cHg(Z){this.ena.addRange(Z)}nPh(){if(3!==this.ena.activityType)return null;d.ULS.shipAssertTag(537168003,0,1===this.ena.VNb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");return Ma.D(this.ena.VNb[0])}BLb(Z){if(Z){if(!this.ena)return;this.Gzd(this.Wlj())}super.BLb(Z)}c6c(){const Z=this.I5c();this.Tgb.push(Z)}I5c(){return new Qd(this)}Gzd(Z){Z?Z.SheetName?(this.gridView.ha.Sa.xH(null),this.gridView.focus(),this.gridView.w8e(Z,
3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):d.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):d.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}Wlj(){if(Ha.e(this.ena.VNb))return d.ULS.shipAssertTag(537167971,0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),
null;var Z=this.$.xa.oa;d.ULS.shipAssertTag(537167970,0,!!Z,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Z=this.vRj(Z.sheetName,this.ena.VNb);if(!Z&&(Z=this.R3h(this.ena.VNb),!Z))return null;const db={};db.SheetName=Z.SheetName;db.FirstColumn=Z.FirstColumn;db.FirstRow=Z.FirstRow;db.LastColumn=Z.FirstColumn;db.LastRow=Z.FirstRow;return db}R3h(Z){if(Ha.e(Z))return null;let db=null;for(let hc=0;hc<Z.length;hc++){var Lb=Z[hc].SheetName;if(!ce.a.equals(Lb,
db,!1)&&(db=Lb,Lb=this.$.xa.getItemByName(Lb),null===Lb||void 0===Lb?0:Lb.visible))return Z[hc]}return null}vRj(Z,db){if(db)for(const Lb of db)if(ce.a.equals(Lb.SheetName,Z,!1))return Lb;return null}}Object(b.a)(ec,"RangeCatchUpActivityHighlightController",md.a,[]);var Vc=a(78);class td extends Vc.a{constructor(Z,db,Lb,hc,Pc){super();this.$=Z;this.p4d=db;this.Rpg=Lb;this.vC=hc;this.state=Pc?1:0}get type(){return this.vC}get activityId(){return this.p4d}get activityType(){return this.Rpg}dispose(){this.p4d=
null;super.dispose()}}Object(b.a)(td,"CatchUpActivityHighlightModelBase",Vc.a,[]);class he extends td{constructor(Z,db,Lb,hc,Pc,Rc){super(Z,db,Lb,hc,Rc);this.ranges=Pc;this.k8a=!1}get VNb(){this.k8a||(this.ranges.sort(he.u4b),this.k8a=!0);return this.ranges}addRange(Z){for(const db of Z)this.ranges.push(db)}dispose(){this.ranges=null;super.dispose()}static u4b(Z,db){if(!Z.SheetName||!db.SheetName)return d.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),
0;const Lb=Z.SheetName.localeCompare(db.SheetName);return Lb?Lb:Z.FirstColumn<db.FirstColumn||Z.FirstColumn===db.FirstColumn&&Z.FirstRow<db.FirstRow?-1:Z.FirstColumn===db.FirstColumn&&Z.FirstRow===db.FirstRow?0:1}}Object(b.a)(he,"RangeCatchUpActivityHighlightModel",td,[]);var ne=a(343);class Te{constructor(){this.v3c=[];this.PMb={};this.Gne={}}dispose(){this.Gne=this.PMb=this.v3c=null}oVf(Z,db){db?V.h(Z).qb.Sn([24]):V.h(Z).qb.Xg([24])}R$g(Z,db,Lb,hc){const Pc={};for(const xd of db){if(!xd||Ha.e(xd.LocationList))continue;
db=[];const Wd={},ue=[];for(const ve of xd.LocationList){if(!ve){d.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+xd.Id);break}switch(ve.Type){case 0:var Rc=ve;let qe;"0"in Wd?(qe=Wd["0"],qe.cHg(Rc.RangeList)):(qe=new ec(Z,new he(Z,xd.Id,xd.Type,0,Rc.RangeList,hc),Lb),db.push(qe),Wd["0"]=qe);for(const we of Rc.RangeList){Rc=new ne.a(Ma.D(we),Jb.d(Z.xa.getItemByName(we.SheetName)));if(this.zyc(Rc)in this.PMb)this.PMb[this.zyc(Rc)].push(qe);
else{let Ze=[];Ze.push(qe);this.PMb[this.zyc(Rc)]=Ze}ue.push(Rc);this.v3c.push(Rc)}break;default:d.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}d.ULS.shipAssertTag(537168011,0,!(xd.Id in Pc),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+xd.Id);this.Gne[xd.Id]=ue;Pc[xd.Id]=db}this.jbh(Z,this.v3c,this.PMb,hc);return Pc}E2g(Z){for(let db in Z){const Lb=
Z[db];for(const hc of Lb)hc.Nkj()}}zyc(Z){return`${Z.range}-${Z.sheetId}`}jbh(Z,db,Lb,hc){this.E2g(Lb);V.h(Z).qb.lx(db,[24],hc,(Pc,Rc)=>{var xd=new ne.a(Pc.range,Pc.sheetId);xd=this.zyc(xd);const Wd=Lb[xd];if(Wd)for(const ue of Wd)ue.TIg(Rc),Pc.metadata=ue;else d.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+xd)})}}Object(b.a)(Te,"CatchUpHighlightControllersCreator",null,[]);class Me{constructor(){this.activityIds=
this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(b.a)(Me,"CreateIndicatorTooltipParameters",null,[]);class Ye{constructor(){this.clearSticky=!1}}Object(b.a)(Ye,"DismissIndicatorTooltipParameters",null,[]);class pf{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(pf,"UpdateIndicatorTooltipParameters",null,[]);class Be{constructor(Z,db){this.$=Z;this.Uh=db}navigateToActivity(Z){if(Z.fromSummaryString)return Z=
new N.a(1834994092,Ob.a.Db,this.$.Hc,18,null),this.$.Ja.Kb(Z),this.bDa(1);Z=Z.activity;if(X.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&Z&&1===Z.type){var db=new N.a(1834994092,Ob.a.Db,this.$.Hc,30,null);this.$.Ja.Kb(db,{["activityGuid"]:Z.activityId,["sheetName"]:Z.location.region,["gridLocation"]:Z.location.subregion[0]});return this.bDa(1)}if(!this.fii(Z))return this.bDa(4);if(!this.xri(Z))return this.bDa(7);const Lb={};try{db=window.self.atob(Z.navigationId);
if(!db)return this.bDa(5);Lb.NavigationId=db}catch(hc){return d.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${hc}`),this.bDa(5)}if(8===this.Uh.ae(vc.a.uJa,2,Lb))return this.Uh.processAction(vc.a.p$a,2),this.bDa(2);Z=32===this.Uh.ae(vc.a.h1a,2,Lb)?1:6;return this.bDa(Z)}fii(Z){return Z&&Z.navigationId?!0:!1}xri(Z){switch(Z.type){case 3:case 4:case 6:case 7:case 9:case 8:return!0;case 10:return X.EwaSettings.isChangeGateEnabled("OfficeVSO:7212124_EnableTaskReplyNavigation")?
!0:!1;default:return!1}}bDa(Z){return Promise.resolve(Z)}}Object(b.a)(Be,"CatchUpActivityNavigationManager",null,[807]);class Ie{constructor(Z,db){this.e5b=this.ifa=null;this.Xcd=!1;this.jSa=null;this.yka={};this.dEa=null;this.Fld=!1;this.WFb=(Lb,hc)=>{switch(hc.state){case 0:case 1:3===hc.pHd&&(this.k$h(),this.jSa=null);break;case 2:break;case 3:this.E7c();this.jSa=hc.activityId;this.NDj();break;default:d.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+
hc.state)}};this.$l=()=>{this.utb()};this.Pc=()=>{this.utb()};this.Ln=()=>{this.utb()};this.rh=()=>{this.utb()};this.c7f=(Lb,hc)=>{this.ifa&&hc.TH!==this.zka&&(hc.isSticky&&this.P7b(!0),(Lb=this.KRj(hc.TH))?(this.ifa.createActivityIndicatorTooltip(Object(T.a)(new Me,{target:hc.TH,container:Lb,activityIds:[hc.activityId],isSticky:hc.isSticky,dirHint:this.gridView.rtl?12:9,activityNavigationManager:X.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?
this.W2b:void 0})),hc.isSticky?(this.zka=hc.TH,d.ULS.sendTraceTag(51172352,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Selected/Unselected Event.")):(this.jfc=hc.TH,d.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event.")),this.Lhc||(this.gridView.view.nt(this.QCc),this.gridView.jv(this.QCc),this.Lhc=!0)):d.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null."))};
this.LLe=(Lb,hc)=>{this.P7b(hc.hlh)};this.QCc=()=>{this.ifa?(this.zka&&this.ifa.updateActivityIndicatorTooltip(Object(T.a)(new pf,{target:this.zka,isSticky:!0})),this.jfc&&this.ifa.updateActivityIndicatorTooltip(Object(T.a)(new pf,{target:this.zka,isSticky:!1}))):d.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Z;this.gridView=V.h(this.$);this.ha=this.gridView.ha;this.Za=this.gridView.Vb;this.ha.x_b(this.$l);
this.ha.iH(this.Pc);this.gridView.AC(this.Ln);this.Za.Yk(this.rh);this.zka=this.jfc=null;this.Lhc=!1;this.Ecd={};this.W2b=new Be(this.$,e.AFrameworkApplication.ub);this.blueDotManager=db}get Hne(){return this.ifa}set Hne(Z){this.ifa=Z}get excelCommentManager(){this.dEa||(this.dEa=this.$.da.za(65));return this.dEa}get w1a(){this.e5b||(this.e5b=new Te);return this.e5b}set w1a(Z){this.e5b=Z}dispose(){this.ha.huc(this.$l);this.ha.jG(this.Pc);this.gridView.ZD(this.Ln);this.Za.Hk(this.rh);this.TKe();this.Ecd=
this.zka=this.jfc=this.jSa=this.Za=this.ha=this.gridView=null}u1f(Z){const db=this.apb();this.TKe();if(!Ha.e(Z)){d.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");if(this.yka=this.w1a.R$g(this.$,Z,this,db)){Z=this.yka;for(let Lb in Z){const hc=Z[Lb];for(const Pc of hc)this.nRg(Pc)}}this.w1a.oVf(this.$,db)}}vNb(){const Z=this.apb();Z&&this.Fld?d.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):
(Z||this.utb(),this.w1a.oVf(this.$,Z))}W$h(Z){if(this.apb())if(this.zka&&this.P7b(!0),this.E7c(),Z=this.yka[Z.activityId])for(const db of Z)db.BLb(!0);else d.ULS.sendTraceTag(537168032,0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}V2f(Z){if(this.Xcd!==Z){var db=this.apb();this.Xcd=Z;db!==this.apb()&&this.vNb()}}TKe(){if(this.yka){const Z=this.yka;for(let db in Z){const Lb=Z[db];for(const hc of Lb)this.Gdj(hc),hc.dispose()}}this.yka={};this.w1a.dispose();
this.w1a=null}NDj(){if(this.excelCommentManager){var Z=this.yka[this.jSa];Z&&0<Z.length&&3===Z[0].model.activityType&&((Z=Z[0])?this.excelCommentManager.rEj(Z.nPh()):d.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}k$h(){this.excelCommentManager&&this.excelCommentManager.tub()}E7c(){if(this.jSa){const Z=this.yka[this.jSa];if(Z){for(const db of Z)db.BLb(!1);this.jSa=null}else d.ULS.sendTraceTag(537168028,0,
50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}utb(){this.E7c();this.P7b(!0)}KRj(Z){if(!Z)return d.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Z=`${Z.id}-${ib.a.A_g}`;let db=this.Ecd[Z];if(!db){if(!this.gridView.domElement)return d.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),null;db=document.createElement("Div");
db.className=ld.a.B_g;db.id=Z;this.gridView.domElement.appendChild(db);this.Ecd[Z]=db}return db}P7b(Z){this.ifa&&(this.ifa.dismissActivityIndicatorTooltips(Object(T.a)(new Ye,{clearSticky:Z})),this.jfc=null,Z&&(this.zka=null),this.Lhc&&!this.zka&&(this.gridView.view.gr(this.QCc),this.gridView.Ky(this.QCc),this.Lhc=!1))}nRg(Z){Z.$pe(this.WFb);Z.wJg(this.c7f);Z.vJg(this.LLe)}Gdj(Z){Z.bUf(this.WFb);Z.Pej(this.c7f);Z.Oej(this.LLe)}apb(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&
!this.Xcd}}Object(b.a)(Ie,"CatchUpActivityHighlightManager",null,[875,2]);var Hf=a(444);class Ne{}Object(b.a)(Ne,"GetRelevantActivitiesDataRequest",null,[]);class Je{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(Je,"Activity",null,[]);class Jf{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=
null}}Object(b.a)(Jf,"ActivityFeedItem",null,[]);class Ue{constructor(){this.activityFeedItems=null}}Object(b.a)(Ue,"ActivityFeedPayload",null,[]);class ab{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(ab,"ActivityRequestPayload",null,[]);class Nb{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Nb,"Person",null,
[]);class tc extends Je{constructor(){super();this.relationship=0}}Object(b.a)(tc,"TaskActivity",Je,[]);const Nc=(Z,db,Lb,hc,Pc,Rc=null)=>{Rc=Z.Na(1,Rc);return yb.g(Z,"GetLineageWywaAuthors",Rc,db,Lb,hc,Pc,4)},pd=(Z,db,Lb,hc,Pc,Rc,xd=null)=>{xd=Z.Na(1,xd);xd.getRelevantActivitiesDataRequest=db;return yb.g(Z,"GetRelevantActivitiesData",xd,Lb,hc,Pc,Rc,0)};class zd{constructor(Z,db,Lb=!1,hc=null){this.i1d=null;this.$=Z;this.X2b=db;this.zHb=Ra.a.instance.resolve("Common.App.People.IPeopleColorUtils");
this.cAa=Ra.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.x7a=Lb;this.blueDotManager=hc}requestWYWAActivities(){return this.x7a?new Promise((Z,db)=>{Nc(this.$.pa.ya,Lb=>{var hc;const Pc=tb.a(Lb)?null:Lb.Result;X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?(Lb=null===(hc=null===Pc||void 0===Pc?void 0:Pc.WywaAuthors)||void 0===hc?void 0:hc.length,null!=Lb&&0<Lb?this.xhg(Rc=>{Rc={activities:Rc,actors:Pc?this.Vcc(Pc.WywaAuthors):null,hasMore:!1,highWaterline:zd.Bia,
lowWaterline:zd.Bia,wywaWaterline:zd.Bia};Z(Rc)}):Z(zd.ntb)):(hc=Object(T.a)(new ab,{activities:[],actors:Pc?this.Vcc(Pc.WywaAuthors):null,hasMore:!1,highWaterline:zd.Bia,lowWaterline:zd.Bia,wywaWaterline:zd.Bia}),Z(hc))},()=>{d.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");db(null)},null,null)}):Promise.resolve(zd.ntb)}requestActivities(){return Promise.resolve(zd.ntb)}requestRelevantActivities(){if(!this.$.ea.Zb||this.$.ea.T5a)return d.ULS.sendTraceTag(537168021,
3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Zb}, HasRaisedSessionEnded: ${this.$.ea.T5a}]`),Promise.resolve(zd.ntb);const Z=Object(T.a)(new Ne,{SetDaysBack:e.AFrameworkApplication.fa.rd("AppWaterlineOverrideDaysValue",0),SetTimestamp:e.AFrameworkApplication.fa.rd("AppWaterlineOverrideTimestampValue",0)});return new Promise((db,Lb)=>{pd(this.$.pa.ya,Z,hc=>{let Pc=zd.ntb;hc?tb.a(hc)?(hc=W.a.sc(hc.Errors),d.ULS.sendTraceTag(578353159,
3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${hc}`)):Pc=this.QZh(hc.Result):d.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");db(Pc)},hc=>{hc=Pa.a.Pe(hc.data);hc=W.a.sc(hc);d.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${hc}]`);Lb(null)},null,null)})}requestActivityFeed(){return qa.b(this.getActivityFeed()).then(Z=>
Object(T.a)(new Ue,{activityFeedItems:this.iQj(Z)}))}updateActivityState(Z){return X.EwaSettings.ma(447)?Promise.resolve(!0):this.X2b?qa.b(this.X2b).then(db=>{var Lb,hc;return qa.b(db.GUj(Z.itemIds,null!==(Lb=Z.activityStatesToSet)&&void 0!==Lb?Lb:0,null!==(hc=Z.activityStatesToReset)&&void 0!==hc?hc:0,Z.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.X2b?Vd.a.mYd(this.X2b,Z=>Z.getActivityFeed(null)):J.Task.Ta([])}QZh(Z){if(!Z)return d.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),
Object(T.a)(new ab,{activities:[]});const db=this.Mdg(Z.NewActivities,2);Z=this.Mdg(Z.OutstandingActivities,3);for(const Lb of Z)db.push(Lb);return Object(T.a)(new ab,{activities:db})}Mdg(Z,db=1){const Lb=[];if(!Z||!Z.length)return Lb;for(const hc of Z)hc?(Z=zd.pQj(hc.Type),6===Z||7===Z||9===Z||8===Z?Lb.push(Object(T.a)(new tc,{activityId:hc.Id,type:Z,displayTimestamp:new Date(hc.DisplayTimestamp),navigationId:hc.NavigationId,actors:this.Vcc(hc.People),relevancy:db,relationship:this.oQj(hc.Relationship)})):
Lb.push(Object(T.a)(new Je,{activityId:hc.Id,type:Z,displayTimestamp:new Date(hc.DisplayTimestamp),navigationId:hc.NavigationId,actors:this.Vcc(hc.People),relevancy:db}))):d.ULS.shipAssertTag(537168017,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return Lb}oQj(Z){switch(Z){case 1:return 1;case 2:return 2;case 3:return 3}d.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}iQj(Z){const db=[];for(const Lb of Z)Z=Object(T.a)(new Jf,
{id:Lb.id,type:Lb.type,collectionId:Lb.collectionId,activityState:Lb.activityState,activityFeedItemPayload:Lb.activityFeedItemPayload,timestamp:Lb.timestamp}),db.push(Z);return db}Vcc(Z){const db=[];if(!Z||!Z.length)return db;for(const Lb of Z)Lb&&db.push(this.mxb(Lb));return db}mxb(Z){return Object(T.a)(new Nb,{id:Z.Id,provider:Z.Provider,displayName:Z.DisplayName,email:Z.Email,imageUrl:this.cAa.Ota(Z.Email,Z.Provider,e.AFrameworkApplication.Ii,0),color:this.zHb.fjd(new Hf.a(null,void 0,Z.DisplayName),
6)})}static pQj(Z){switch(Z){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return d.ULS.shipAssertTag(537168015,3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}j5i(Z,db){const Lb=Z.map(hc=>({activityId:hc.activityGuid,activityFeedItemId:null,type:1,actors:[{id:hc.author.id,provider:hc.author.provider,displayName:hc.author.displayName,givenName:null,email:hc.author.email,
imageUrl:hc.author.imageUrl,color:null}],location:{type:105,region:hc.sheetName,subregion:[hc.gridLocation]},displayTimestamp:hc.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.i1d=Z.map(hc=>{var Pc,Rc;const xd=null!==(Rc=null===(Pc=hc.rangeHighlightLocation)||void 0===Pc?void 0:Pc.rangeList.map(Wd=>({Type:0,RangeList:[{SheetName:hc.sheetName,FirstRow:Wd.firstRow,LastRow:Wd.lastRow,FirstColumn:Wd.firstCol,LastColumn:Wd.lastCol}]})))&&void 0!==Rc?Rc:[];return{Id:hc.activityGuid,
Type:null,Person:null,DisplayTimestamp:null,LocationList:xd}});db(Lb)}xhg(Z){this.blueDotManager?this.blueDotManager.KEj().then(db=>{this.j5i(db,Z)},()=>{}):d.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}zd.Bia="<WywaWaterline>DefaultWaterline</WywaWaterline>";zd.ntb=Object(T.a)(new ab,{activities:[],actors:[],hasMore:!1,highWaterline:zd.Bia,lowWaterline:zd.Bia,wywaWaterline:zd.Bia});Object(b.a)(zd,"CatchUpActivityRequestManager",
null,[808]);class Sd{constructor(Z){this.$=Z}shouldShowEmptyExperienceButton(){return this.$.ea.h9a?!0:!1}onButtonClick(){const Z={["InputMethod"]:Ob.a.Db};this.$.Ja.Kb(new N.a(1834994092,Ob.a.Db,this.$.Hc,16,null),Z)}onInviteOthersButtonClick(){const Z={["InputMethod"]:Ob.a.Db};this.$.Ja.Kb(new N.a(869186573,Ob.a.Db,this.$.Hc,16,null),Z)}getExplanationText(){const Z=this.$.da.za(365);return ic.a.instance.Ua(Z&&Z.isVisible?656:655)}getCommandName(){return ic.a.instance.ga(443)}}Object(b.a)(Sd,"CatchUpEmptyExperienceBehaviorManager",
null,[809]);const ke=Z=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Z)};class ie{constructor(Z,db=null){this.$=Z;this.flyoutRibbonButton=db;oa.a(this.$).ai(this);this.hasFocus=!1}dispose(){oa.a(this.$).Xz(this)}get mc(){return document.getElementById("catchUpFlyoutContainer")}get Gf(){return this.flyoutRibbonButton.Ehf&&!this.hasFocus}get de(){return K.a.U0c}kg(Z,db){if(db)return!1;Z=document.getElementById("flyoutItem0");if(!Z)return d.ULS.sendTraceTag(537168009,
3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Z.focus();this.mlh(Z);return!0}mh(Z){return this.mc?ea.DOMElementExtensions.yf(this.mc,Z):!1}sj(){this.hasFocus=!0}Zj(){this.hasFocus=!1}mlh(Z){if(Sys.Browser.agent===Sys.Browser.Firefox){var db=document.createEvent("KeyboardEvent");db.initKeyEvent(dd.a.Pb,!0,!0,window.self,!1,!1,!1,!1,me.a.BQb,0);Z.dispatchEvent(db)}else db=document.createEvent("Events"),db.initEvent(dd.a.Pb,!0,!0),db.keyCode=me.a.BQb,db.which=me.a.BQb,Z.dispatchEvent(db)}}
Object(b.a)(ie,"FlyoutFocus",null,[36,2]);var Fe=a(420);class qc{constructor(Z){this.buttonClickedCallback=null;this.akb=this.yAb=!1;this.UGh=new Date;this.IXe=Z}dispose(){this.akb=this.yAb=!1}registerButtonClickedEvent(Z){this.buttonClickedCallback&&d.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Z.buttonClickedCallback}onFlyoutInitialized(){this.yAb&&d.ULS.sendTraceTag(537168007,3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");
const Z=(new Date).getTime()-this.UGh.getTime();d.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Z}`);m.c(vc.a.E_g,!0,m.e,0,0,Z);this.yAb=!0;Fe.a.yC&&Fe.a.yC.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.yAb?this.buttonClickedCallback?this.buttonClickedCallback():d.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):d.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Ehf(){return this.akb}onFlyoutVisibilityChanged(Z){this.akb!==
Z.flyoutIsVisible&&(this.akb=Z.flyoutIsVisible,Fe.a.yC&&Fe.a.yC.updateCommandUI(!0),this.akb||this.IXe&&this.IXe.gyi())}}Object(b.a)(qc,"FlyoutRibbonButton",null,[874]);var Uc=a(522);class ub{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=
null}}Object(b.a)(ub,"CatchUpConfiguration",null,[]);class Xb{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=null}}Object(b.a)(Xb,"SharedControllerFactoryParameters",null,[]);class wc{constructor(Z,db,Lb=null,hc=null,Pc=null){this.QHa=null;this.r$e=!1;this.zf=()=>
{this.Rha.V2f(!0);this.Rqb.xhg(()=>{this.Rha.u1f(this.Rqb.i1d);this.Rha.V2f(!1)})};this.SIf=Rc=>{X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)&&!Na.a.Dh(Rc.wywaActivities)&&2!==Rc.wywaActivities[0].type&&(this.Rha.u1f(this.Rqb.i1d),this.showHideInGridHighlights(),this.Rha.W$h(Rc.wywaActivities[0]),this.$.ea.ku(this.zf))};this.$=Z;this.blueDotManager=Pc;this.Rha=new Ie(this.$,this.blueDotManager);this.Z5d=new ad(e.AFrameworkApplication.ub,X.EwaSettings.ma(447));Z=sb.a.OOj(Ra.a.instance.Ub("Common.App.CatchUpActivity.ICatchUpRequestHandler"));
this.Rof=hc;this.Rqb=new zd(this.$,Z,this.x7a(),this.blueDotManager);this.W2b=new Be(this.$,e.AFrameworkApplication.ub);this.emptyCatchUpBehaviorManager=new Sd(this.$);this.Pwi(Rc=>{this.XKi(Rc)},db);this.Oyi();db=null;Lb||(db=Ra.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=Lb||new qc(db);this.flyoutFocus=new ie(this.$,this.flyoutRibbonButton)}get Tff(){const Z=this.flyoutRibbonButton.yAb;Z&&!this.r$e&&(d.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),
this.r$e=!0);return Z}get pji(){return this.flyoutRibbonButton.Ehf}dispose(){this.QHa&&this.QHa.getWywaEvent().removeListener(this.SIf);this.QHa=this.$=null;Kb.a.Ia(this.Rha);this.flyoutRibbonButton=this.flyoutFocus=this.Z5d=this.W2b=this.Rqb=this.Rha=null;this.$.ea.Mv(this.zf)}sXi(){this.flyoutRibbonButton.toggleCatchUpFlyout();return!0}showHideInGridHighlights(){this.Rha.vNb()}Oyi(){d.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.nff()&&d.ULS.sendTraceTag(526718752,
3012,50,"ActivityFeedData is enabled")}Pwi(Z,db){ke("ScriptDownload");z.TaskExtensions.Aa(A.GetServiceTaskFactory.Oa(this.$.da,283,284,db),Lb=>{Z(qa.c(Lb.result.ln.loadScript("catchUpActivity")))},this.$.da.la,3)}x7a(){return!!this.Rof&&this.Rof.x7a()&&this.$.ea.h9a}nff(){return X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}XKi(Z){z.TaskExtensions.Aa(Z,()=>{ba.a(()=>{this.QHa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(T.a)(new Xb,
{activityContentManager:Object(Yb.a)(806,this.Z5d),activityNavigationManager:Object(Yb.a)(807,this.W2b),activityRequestManager:Object(Yb.a)(808,this.Rqb),dataCulture:this.$.va.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Yb.a)(qc,this.flyoutRibbonButton),uiCulture:this.$.va.UICultureTag,ulsLogger:new C.a,emptyCatchUpBehaviorManager:Object(Yb.a)(809,this.emptyCatchUpBehaviorManager)}))});this.Rha.Hne=this.QHa.getActivityIndicatorTooltipManager();Uc.a(this.$);this.QHa.getWywaEvent().addListener(this.SIf);
ke("InitializeCatchUpApp");this.QHa.initialize(Object(T.a)(new ub,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.x7a(),includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.nff()}))},this.$.la,3)}}Object(b.a)(wc,"CatchUpActivityManager",null,[810,2]);class Tc extends f.a{constructor(Z){super();this.$=Z;this.Fb()}create(){let Z=X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?A.GetServiceTaskFactory.Oa(this.$.da,501,500,
1):J.Task.Ta(null),db=A.GetServiceTaskFactory.Oa(this.$.da,458,459,this.Ya);z.TaskExtensions.Aa(z.TaskExtensions.Ed([Z,db],this.$.la),()=>{const Lb=db.result,hc=Z.result,Pc=Object(gb.a)(this.$.da,286,()=>new wc(this.$,this.Ya,null,Lb,hc));this.ob(Pc)},this.$.la,3)}static ka(Z){Z.da.Ga(287,new Tc(Z))}}Object(b.a)(Tc,"CatchUpActivityManagerFactory",f.a,[]);var sd=a(235),qb=a(157),Sb=a(163),mc=a(283);class Lc{constructor(Z,db){this.blueDotSettings=0;this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=
()=>0===(this.blueDotSettings&1);this.hvj=Lb=>{d.ULS.sendTraceTag(509732679,0,50,"User toggled in grid highlights, new value {0}.",Lb);this.blueDotSettings=Lb?0:1;Lb=new N.a(950288339,0,2,12,null);this.$.Ja.Kb(Lb,{});this.i2j()};this.$=Z;this.blueDotSettings=db;this.cAa=Ra.a.instance.resolve("Common.App.People.IUserProfilePictureUtils")}dispose(){this.$=null}KEj(){return Object(Sb.a)(this,void 0,void 0,function*(){return new Promise(Z=>{d.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::showInGridBlueDots");
za.b(this.$).ud(eb.a.lineageLoadInGridBlueDots,{});const db=hc=>{hc=Pa.a.Pe(hc.data);d.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${W.a.sc(hc)}]`)},Lb=hc=>{if(hc=tb.a(hc)?null:hc.Result){var Pc={["CountOfActivities"]:hc.ActivityList.length};za.b(this.$).ud(eb.a.xwi,Pc);hc=hb(hc.ActivityList,this.cAa);Z(hc)}else d.ULS.shipAssertTag(512234914,0,!!hc,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};this.$.userOperationManager.Ic(new va.a(1024,
0,(hc,Pc,Rc)=>dc(this.$.pa.ya,Ya.b(hc,Lb),Ya.a(Pc,db),Rc,null),80),null)})})}i2j(){X.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)&&mc.C(this.$.pa.ya,4,this.blueDotSettings.toString(),Z=>{W.a.ag(Z.Errors)?d.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${W.a.sc(Z.Errors)}`):Z.Result||d.ULS.sendTraceTag(509732677,
0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Z,db,Lb)=>{Z=Pa.a.Pe(Z.data);d.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${Lb}. Errors: ${W.a.sc(Z)}.`)},null,null)}}Object(b.a)(Lc,"BlueDotManager",null,[813,2]);class rd extends f.a{constructor(Z){super();this.pbc=null;this.SOi=db=>{db=Pa.a.Pe(db.data);d.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${W.a.sc(db)}.`)};
this.$=Z;this.Fb()}create(){this.pbc||(this.pbc=this.mNh());this.pbc.continueWith(()=>{this.ob(Object(gb.a)(this.$.da,501,()=>new Lc(this.$,this.pbc.result)))})}static ka(Z){Z.da.Ga(500,new rd(Z))}mNh(){if(X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return sd.a.Ta(0);let Z=new qb.a;Object(mc.w)(this.$.pa.ya,4,db=>{this.TOi(db,Z)},db=>{this.SOi(db);Z.setResult(1)},null,null);return Z.task}TOi(Z,db){W.a.ag(Z.Errors)?(d.ULS.sendTraceTag(509732675,0,10,
`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${W.a.sc(Z.Errors)}`),db.setResult(1)):null==Z.Result?db.setResult(0):(Z=parseInt(Z.Result,10),d.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Z}`),db.setResult(Z))}}Object(b.a)(rd,"BlueDotManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");
Type.registerNamespace("_Ewa");c.a.Fa(rb.ka);c.a.Fa(mb.ka);c.a.Fa(r.ka);c.a.Fa(y.ka);Ga.a.Oi('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(Z=>{gd.ka(Z);Ub.ka(Z);Oa.ka(Z);Gd.ka(Z);lb.ka(Z)})})();Type.registerNamespace("Common.App.CatchUpActivity");$a.main();(()=>{c.a.Fa(Z=>{ke("Begin");Tc.ka(Z);Da.ka(Z)})})();(()=>{c.a.Fa(Z=>{rd.ka(Z)})})()},983:function(u,E,a){a.d(E,"a",function(){return e});u=a(0);var c=a(164);E=a(1240);var b=a(760);class e extends E.a{constructor(f,d){super(f,d);d!==b.a.m$&&this.tGa(d);this.Wga(e.iterateNext);this.Wga(e.Wxa);this.BVc(c.a.gVa);this.BVc(c.a.hVa)}}e.iterateNext="IterateNext";e.Wxa="IteratePrevious";
e.gPb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount="SetTotalChangesCount";e.QPa="OnVHDiffReady";Object(u.a)(e,"VersionHistoryMessenger",E.a,[])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/600558ffdd4bf8f654a580d933333978/EwaDSEsNext.catchup.js.map