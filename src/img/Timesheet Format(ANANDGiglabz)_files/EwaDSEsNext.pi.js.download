'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[18],{1111:function(u,E,a){a.d(E,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1112:function(u,E,a){a.d(E,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1114:function(u,E,a){a.d(E,"a",function(){return b});var c=a(511);const b=()=>{c.a.Oi(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1115:function(u,E,a){a.d(E,"a",function(){return c});u=a(0);class c{}c.kFc="b-ring_Apc_Trans";c.mmg="cdn_static_resource_ewa_image";Object(u.a)(c,"ResourceHosts",null,[])},1139:function(u,E,a){var c=a(0),b=a(7),e=a(15),f=a(222),d=a(30),h=a(27),m=a(351),l=a(170),w=a(263),n=a(354),y=a(4),t=a(1),r=a(38),v=a(8),B=a(284),A=a(13);class z extends B.a{constructor($a){super($a);this.l3g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,
0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");this.Rb=0;this.oc(1,A.a.instance.ga(2254));$a=A.a.instance.ga(2252);const ac=this.kN();this.initializeAndShow($a,this.l3g,ac)}get pc(){return"ClipboardReadPermissionAskDialog"}kN(){const $a={};$a.id=this.pc;const ac=A.a.instance.ga(2253);$a.DialogMessage=ac;return $a}}Object(c.a)(z,"ClipboardReadPermissionAskDialog",B.a,[]);var x=a(51);const D=($a,ac,Da,Na,sb)=>{const Kb=$a.Stopwatch,Yb={};Yb.a=sb;Yb.e=Kb.id;Yb.c="RearrangeRowColumn";
Yb.b="mouse";Yb.d=$a.OperationId.toString();Yb.f=Da.toString();Yb.g=Na.toString();Yb.h=ac.toString();Yb.i=$a.DragDropIsShiftKeyDown;Yb.j=!0;Yb.o=Kb.zc;Yb.q=!1;Yb.r=$a.CopyPasteTargetType.toString();Yb.s=$a.EncounteredDeploymentErrors;return Yb};class J{constructor($a,ac){this.uJh=()=>{const Da={};Da.SourceItem=this.toString();return Da};this.sessionStateId=$a;this.sessionId=ac;this.toJSON=this.uJh}chf($a){return $a?this.sessionStateId===$a.sessionStateId&&this.sessionId===$a.sessionId:!1}isFromCurrentSession($a){return this.sessionId===
$a.va.UserSessionId}}Object(c.a)(J,"SourceItem",null,[]);class L extends J{constructor($a,ac,Da,Na,sb){super(Da,Na);this.activeFloatingObjectControlId=$a;this.sheetName=ac;this.type=sb}isEqual($a){return $a&&Object.getType($a)===L?this.chf($a)&&this.activeFloatingObjectControlId===$a.activeFloatingObjectControlId&&this.sheetName===$a.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(L,"ArtSourceItem",J,[]);var T;(function($a){$a[$a.valid=0]="valid";$a[$a.notPairwiseDisjoint=1]="notPairwiseDisjoint";
$a[$a.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";$a[$a.notValidForm=3]="notValidForm";$a[$a.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(T||(T={}));Object(c.b)("CopySourceValidationOptions",T);var O=a(42);class G extends J{constructor($a,ac,Da,Na,sb){super(Na,sb);e.ULS.shipAssertTag(537167645,0,!!ac&&0<ac.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=$a;this.ranges=ac;this.sheetName=Da}isEqual($a){return $a&&Object.getType($a)===
G?this.chf($a)&&O.Q(this.ranges,$a.ranges)&&this.sheetName===$a.sheetName:!1}toString(){return O.i(this.ranges,",",this.$,!1)}}Object(c.a)(G,"RangeSourceItem",J,[]);const C=$a=>!!$a&&Object.getType($a)===G;class H{}H.xZj="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(H,"ExpectedErrorNames",null,[]);class I{}I.plainText="text/plain";I.html="text/html";I.png="image/png";I.shadowWorkbook="data/shadow-workbook";I.mni="metadata/is-last-copy-was-external";I.Gji="metadata/is-last-copy-was-external-XLO-source";
I.I1g="metadata/chrome-extension-id";I.esb="copyId";I.qNg="metadata/additional-signature-data-attributes";Object(c.a)(I,"ClipboardDataFormat",null,[]);const M=$a=>$a.clipboardItems&&($a=$a.clipboardItems.getItem(I.mni))&&"1"===$a?!0:!1,Q=$a=>M($a)&&!(void 0===$a.clipboardItems||null===$a.clipboardItems)&&!!$a.clipboardItems.getItem(I.png)&&!$a.clipboardItems.getItem(I.plainText),U=$a=>$a.clipboardItems&&($a=$a.clipboardItems.getItem(I.Gji))&&"1"===$a?!0:!1,N=$a=>$a&&($a=$a.getCachedMetadata(),null===
$a||void 0===$a?0:$a.lastCopy)?$a.lastCopy:null;var W=a(49),X=a(21),sa=a(34);class da{constructor($a,ac,Da,Na){this.$=$a;this.originalDestinations=ac;this.l$b=Da;this.cqg=Na;this.Yzg=this.originalDestinations;this.Stg=this.l$b;this.sxg="PasteRecoveryUI"}get pNg(){return this.cqg}get Ovi(){return this.sxg}get iaj(){return this.Yzg}get rVe(){return this.Stg}UKa(){return da.D0i}iRh(){return this.l$b&&1===this.l$b.length?this.jRh(this.l$b[0]):null}jRh($a){var ac=X.h(this.$);const Da=ac.ib.Ni($a);var Na=
ac.fg($a,Da);ac=ac.rtl;if(!Na)return null;$a=X.h(this.$).Bf(Da);const sb=$a.Am;if(!sb.Bd(Na))return null;Na=sb.Ke(Na);const Kb=Na.topLeft.y;var Yb=Na.bottomRight.y;const vc=ac?Na.bottomRight.x:Na.topLeft.x;Na=ac?Na.topLeft.x:Na.bottomRight.x;var ad=new W.a(Na+(ac?-81:81),Yb+38+6);if(sb.kia(ad))return this.e5a($a,sb,Da,Na,Yb,ac?12:-3,66);ad=new W.a(Na+(ac?-81:81),Yb);if(sb.kia(ad))return this.e5a($a,sb,Da,Na,Yb,ac?20:3,22);ad=new W.a(Na,Yb+38+6);if(sb.kia(ad))return this.e5a($a,sb,Da,Na,Yb,-81+(ac?
18:0),66);Na=new W.a(vc+(ac?81:-81),Yb);if(sb.kia(Na))return this.e5a($a,sb,Da,vc,Yb,-81+(ac?12:-6),22);Yb=new W.a(vc,Kb-38-6);return sb.kia(Yb)?this.e5a($a,sb,Da,vc,Kb,ac?15:0,16):this.e5a($a,sb,Da,ac?sb.topLeft.x:sb.bottomRight.x,sb.bottomRight.y,-81+(ac?15:-6),22)}e5a($a,ac,Da,Na,sb,Kb,Yb){var vc=X.h(this.$);const ad=vc.rtl;$a=Sys.UI.DomElement.getLocation($a.domElement);Na=new Sys.UI.Point(Na+(ad?0:$a.x)-ac.topLeft.x,sb+$a.y-ac.topLeft.y);ad&&(vc=vc.view.visibleArea,Na.x=vc.bottomRight.x-vc.topLeft.x-
Na.x,2===Da||4===Da)&&(Na.x+=ac.bottomRight.x);Na=sa.a(this.$).cka(Na);return new Sys.UI.Point(Na.x+Kb,Na.y+Yb)}}da.D0i=["PasteRecoveryUI"];Object(c.a)(da,"PasteRecoveryUI",null,[781]);var S=a(76),oa=a(174);class K{}K.aFg="ActiveSelection";K.shadowWorkbook="ShadowWorkbook";K.wng="GVML";K.plainText="PlainText";K.html="Html";K.wTg="Bitmap";Object(c.a)(K,"PayloadType",null,[]);class ea{}ea.XGj="Slice6";Object(c.a)(ea,"SliceName",null,[]);class ya{}ya.MHi="NotCalled";ya.success="Success";ya.failed="Failed";
Object(c.a)(ya,"SucceededPopulatingSystemClipboardOptions",null,[]);var ha=a(358);const La=($a,ac)=>$a?ac&&ac.va?$a.sessionId!==ac.va.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Ia=$a=>{switch($a){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},ra=$a=>{if(!$a)return"null";const ac=[];for(const Da of $a.get())ac.push(`${Da.clipboardDataFormat}(${Da.data.length})`);
ac.sort();return ac.join(",")};var pa;(function($a){$a[$a.valid=0]="valid";$a[$a.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";$a[$a.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";$a[$a.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";$a[$a.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";$a[$a.multipleDestinationsAreNotMultiplyOfSourceRange=
5]="multipleDestinationsAreNotMultiplyOfSourceRange";$a[$a.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";$a[$a.copySourceNotValid=7]="copySourceNotValid";$a[$a.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";$a[$a.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";$a[$a.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";$a[$a.unknown=100]="unknown"})(pa||(pa={}));Object(c.b)("PasteValidationOptions",
pa);var ba=a(50),fa=a(142),Ka=a(37),aa=a(154),ja=a(345),Va=a(29),bb=a(318),wa=a(11),ka=a(22),ta=a(124),qa=a(112),rb=a(563),Za=a(98),gb=a(55),mb=a(184),Ga=a(64),ib=a(343);class cc extends r.a{constructor($a,ac,Da,Na,sb,Kb,Yb,vc,ad=null){super();this.pasteShortcutManager=null;this.ggf=t.EwaSettings.xb();this.zxa=t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.qcg=null;this.e8a=!1;this.Tsd=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");
this.cDd=ld=>{this.uAj(ld)&&(this.$p.Xec(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};this.xAi=(ld,md)=>{e.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${ld}]. userPressedExtensionLink=${md}`);this.gridView.focus()};this.dd=(ld,md)=>{md.FN||md.Nf||this.Ar("OnWorkbookOpened",
!1).catch(()=>{})};this.Fh=(ld,md)=>{ld=N(this.TK);const Qd=this.$p.wxb(ld);Qd&&(md.oa&&md.oa.sheetName===Qd.sheetName&&Qd.isFromCurrentSession(this.$)?this.$p.mbf(Qd.ranges,ld.commandParameters.commandType):this.$p.Xec())};this.bpc=(ld,md)=>{ld=N(this.TK);(ld=this.$p.wxb(ld))&&md.item&&md.item.sheetName===ld.sheetName&&ld.isFromCurrentSession(this.$)&&this.Ar("OnItemDeleting",!1).catch(()=>{})};this.AGb=(ld,md)=>{this.ggf?this.qcg(ld,md):this.IHf()};this.DR=(ld,md)=>{1===md.Kr&&md.Rf.operation.flags&
2&&this.Ar("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=$a;this.Ag=Da;this.gridView=X.h($a);this.$p=sb;this.Pfi=Kb;this.TK=ac;this.h5b=Na;this.getStringifiedError=ad||copyPasteInfra.getStringifiedError;this.O6f=1===vc;this.ucd=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Lj();this.copyPasteShortcutDialogFactory=this.$.da.za(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");
Yb||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),Yb=cc.dih);this.userHash=d.a.mw(Yb);this.yEi="CultureTag: "+A.a.instance.ptb+" HASH: ";this.TK.addMetadataChangeListener(cc.xuf,this.cDd);this.lDi=oa.a.bEb;this.Jya=this.zxa?t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.va.CopyPasteMaxPayloadLength):v.a.Jya;(this.Go=t.EwaSettings.getBooleanFeatureGate(oa.a.xQa,!1))&&$a.da.$a(478,ld=>{this.pasteShortcutManager=
ld});this.ggf&&(this.qcg=bb.a(()=>{this.IHf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}get pasteIndicationManager(){return this.$.da.za(373)}DLg($a){this.addHandler(cc.$Dd,$a)}Bgj($a){this.removeHandler(cc.$Dd,$a)}copy($a){$a.stopwatch=this.$.Jb.Ac("UserAction",x.b().uj($a.ribbonCommandInfo.command)+"ClientSide");if(this.Go){const Kb=ba.GetServiceTaskFactory.Oa(this.$.da,478,479,0);Ka.TaskExtensions.Aa(Kb,()=>{this.pasteShortcutManager=Kb.result},this.la,3)}const ac=!!N(this.TK);
t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Ez&&(this.e8a=!1);this.Ar("Copy/before/"+m.a[$a.ribbonCommandInfo.method],!1,void 0,!0,$a.copyPasteTargetType).catch(()=>{});var Da=-1985798686===$a.ribbonCommandInfo.command;if(1===this.gridView.Oe&&(Da=this.$p.tgf(this.gridView.ha.ra.selectedRanges,Da),0!==Da)){const Kb=cc.R7g(Da);this.Uza(Kb,T[Da],!1);return Promise.reject(!1)}$a.userHash=this.userHash;$a.id=l.a.create().toString();let Na=this,sb=
this;return this.h5b.onCopy($a).then(Kb=>{Kb.isAsyncCopy||$a.stopwatch.stop();Na.pasteIndicationManager.UMe();const Yb=ha.d($a);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${Yb}`);Na.tyi(Kb,ac);Kb=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===$a.copyPasteTargetType:!0;!$a.isFormatPainter&&Na.Go&&Kb&&(Na.pasteShortcutManager?Na.pasteShortcutManager.Fph():e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));
return Promise.resolve(!0)},Kb=>{let Yb=!1,vc="none",ad=cc.mtb,ld=!0,md=-1,Qd=cc.copyErrorName+cc.MJa,ce=!1,ec=null;if(Kb){ec=Kb.copyContext;md=Kb.reason;Qd+=cc.aLa(Kb);Kb.message&&(ad=Kb.message);var Vc=cc.Q7g(Kb);if(Vc)if(3===Vc.copyErrorName)Yb=!0,ad=vc="Async Copy canceled by the user.",ld=!1;else if(Va.a.Nq(Vc.ewaErrors))if(ad=sb.ccc(Vc.ewaErrors),Va.a.dh(Vc.ewaErrors,cc.operationSucceededWithAlert))ce=Yb=!0;else if(Va.a.dh(Vc.ewaErrors,cc.pasteDataLimitHit)||Va.a.dh(Vc.ewaErrors,cc.copyThrottlingError))Yb=
!0;13===Kb.reason?(Yb=!0,ld=!1):11===Kb.reason&&(ld=!1)}Vc=Kb?sb.getStringifiedError(Kb):"null";Yb?(Vc=ha.d($a),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${ld}, Friendly message: ${vc}, Error Message: ${ad}, CommandParameters: ${Vc}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${ld}, Error Message: ${Vc}, CommandParameters: ${ha.d($a)}`);
ld&&sb.Ar("Copy/fail/"+m.a[$a.ribbonCommandInfo.method],!0,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});sb.syi($a,Yb,ad,Qd,md,ce,ec);return Promise.reject(Kb)})}paste($a){$a.stopwatch=this.$.Jb.Ac("UserAction",x.b().uj($a.ribbonCommandInfo.command)+"ClientSide");t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Ez&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.e8a=!1,$a.clipboardPicklingApiDataFormatsToRead=
[I.shadowWorkbook]);X.h(this.$).ji&&X.h(this.$).ji.X7(this.ihd($a.ribbonCommandInfo.command),$a.stopwatch.id);if($a.isPasteCommandFromRecoveryUI){var ac=this.$.da.za(406);var Da=this.ucd?O.d(ac.Fkc):w.a.clone(ac.Fkc);ac=ac.jud;$a.pasteRecoveryCachedClipboardItems=ac?ac[cc.GKf]:null}else Da=this.ucd?O.d(this.gridView.ha.ra.selectedRanges):w.a.clone(this.gridView.ha.ra.selectedRanges);$a.originalDestinations=Da;$a.expandDestinations=this.Z_c($a.originalDestinations,$a.commandType);if(this.k0c($a.commandType,
$a.expandDestinations)||this.JZg())return $a.userHash=this.userHash,$a.id=l.a.create().toString(),t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.Ez&&($a.clipboardReadPermissionPromptShown=!1,$a.clipboardAsyncApiDataFormatsToRead=[I.plainText+"Async"],this.h5b.shouldShowClipboardReadPermissionDialog().then(Na=>{Na&&($a.clipboardReadPermissionPromptShown=!0,new z(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.h5b.onPaste($a).then(Na=>
this.Apc(Na,$a),Na=>this.nGb($a,Na));this.$.Xc(927125067,S.a.Db,30,null);Da=O.i($a.expandDestinations,",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${Da}, CommandType: ${$a.commandType}, copyPasteTargetType="${$a.copyPasteTargetType}"`);return Promise.resolve(!0)}ihd($a){switch($a){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}JZg(){return!!X.h(this.$).ha.Sa.activeFloatingObjectControlId&&
this.$.Yp(null,!1,470)}FCb(){const $a=N(this.TK);return $a&&$a.commandParameters?$a.commandParameters.copyPasteTargetType:0}lni(){return!!N(this.TK)&&La(N(this.TK),this.$)}Ar($a,ac,Da=!1,Na=!1,sb=0){try{this.Go&&this.pasteShortcutManager&&this.pasteShortcutManager.M7b();let Kb=sb;const Yb=this.Jui();if(!Na&&2===Yb)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${ac}', isExplicit = '${Da}', isForce = '${Na}', Current CCP operation copyPasteTargetType = '${sb}', LastCopyPasteTargetType = '${Yb}'`),
Promise.reject(null);0===Kb&&(Kb=Yb);const vc=this.$.Jb.Ac("UserAction","ClearCopyState"),ad=vc.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${ac}', isExplicit = '${Da}', isForce = '${Na}', Current CCP operation copyPasteTargetType = '${sb}', LastCopyPasteTargetType = '${Yb}'`);this.$p.Xec();this.w8i();return this.h5b.onCancelCopy(ac).then(()=>{ac&&t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Ez&&(this.e8a=!1);vc.stop();this.dqf($a,ad,!0,Da,ac,"","",vc.zc,Kb);return Promise.resolve(!0)},ld=>{var md=ld?this.getStringifiedError(ld):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${md}`);vc.stop();md=cc.ZZg+cc.MJa;let Qd=cc.mtb;ld&&(md+=cc.aLa(ld),ld.message&&(Qd=ld.message));this.dqf($a,ad,!1,Da,ac,Qd,md,vc.zc,Kb);return Promise.reject(ld)})}catch(Kb){return Promise.reject(null)}}d2c($a,ac,
Da=!1,Na=!1,sb=0){return Na||!t.EwaSettings.ma(647)||this.Lmh()?this.Ar($a,ac,Da,Na,sb):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}Uza($a,ac,Da){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${ac}`);const Na=new Za.a;
Na.ia("reason",ac);rb.a(ta.a.discontinuousSelectionBlocking,[Da?qa.a.w0i:qa.a.N8g],!0,!0,!1,!1,Na);$a=Va.a.Zc(1,1,751,$a,0,371863010,"DiscontinuousSelectionBlocking");t.EwaSettings.Iz()?new ja.a(this.$,$a):($a=new aa.ErrorDialog(this.$,$a),$a.initialize(),$a.vg())}Jui(){const $a=N(this.TK);return $a&&$a.sourceItem?Object.getType($a.sourceItem)===L?2:1:0}dragDropCells($a,ac,Da,Na,sb=!1){$a.stopwatch=this.$.Jb.Ac("UserAction","DragDropClientSide");$a.isDragDrop=!0;this.Ar("DragDrop/before/"+m.a[$a.ribbonCommandInfo.method],
!1,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});const Kb=sb?2:1;let Yb=0;Yb=sb?4:Na?256:128;const vc={encounteredDeploymentErrors:!1};vc.commandParameters=$a;$a.userHash=this.userHash;$a.id=l.a.create().toString();return this.Tsd?this.$p.pasteRange($a.ribbonCommandInfo,O.q(ac,this.$),O.q(Da,this.$),Kb,Yb,[$a.stopwatch],vc,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.l9a($a,Kb,ac,Da,vc)},ad=>
{const ld=ad?this.getStringifiedError(ad):"null";e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${ld}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.K$a(ad,$a,Kb,ac,Da,vc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},ad=>Promise.reject(ad)):this.$p.pasteRange($a.ribbonCommandInfo,O.q(ac,this.$),O.q(Da,this.$),Kb,Yb,[$a.stopwatch],vc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.l9a($a,Kb,ac,Da,vc);return Promise.resolve(!0)},ad=>{const ld=ad?this.getStringifiedError(ad):"null";e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${ld}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.K$a(ad,$a,Kb,ac,Da,vc);return Promise.reject(ad)})}inh($a,ac,Da,Na,sb=!1){$a.stopwatch=this.$.Jb.Ac("UserAction","DragDropReplaceClientSide");$a.isDragDrop=!0;this.d2c("DragDropReplace/before/"+m.a[$a.ribbonCommandInfo.method],
!1,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});const Kb=sb?2:1;let Yb=0;Yb=sb?4:Na?256:128;const vc={encounteredDeploymentErrors:!1};vc.commandParameters=$a;t.EwaSettings.getBooleanFeatureGate(oa.a.u8b,!1)&&($a.isDragInsert=!1);$a.userHash=this.userHash;$a.id=l.a.create().toString();return this.Tsd?this.$p.pasteRange($a.ribbonCommandInfo,O.q(ac,this.$),O.q(Da,this.$),Kb,Yb,[$a.stopwatch],vc,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);
this.l9a($a,Kb,ac,Da,vc)},ad=>{const ld=ad?this.getStringifiedError(ad):"null";e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${ld}, copyPasteTargetType="${$a.copyPasteTargetType}"`);return this.K$a(ad,$a,Kb,ac,Da,vc)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},ad=>Promise.reject(ad)):this.$p.pasteRange($a.ribbonCommandInfo,O.q(ac,this.$),O.q(Da,this.$),Kb,Yb,[$a.stopwatch],vc,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,0,50,
`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.l9a($a,Kb,ac,Da,vc);return Promise.resolve(!0)},ad=>{const ld=ad?this.getStringifiedError(ad):"null";e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${ld}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.K$a(ad,$a,Kb,ac,Da,vc);return Promise.reject(ad)})}hnh($a,ac,Da,Na,sb=!1){$a.stopwatch=this.$.Jb.Ac("UserAction",
"DragDropInsertClientSide");this.d2c("DragDropInsert/before/"+m.a[$a.ribbonCommandInfo.method],!1,void 0,void 0,$a.copyPasteTargetType).catch(()=>{});const Kb=sb?2:1,Yb=O.K(this.Z_c([Da],Kb));var vc=this.$.ea.oa.sheetName;const ad=this.$.ea.oa.sheetName,ld=O.v(ac,this.$);ld.SheetName=vc;vc=O.v(Yb,this.$);vc.SheetName=ad;Na=Yb.isRow||ac.isRow||Na?1:0;const md={encounteredDeploymentErrors:!1};$a.isDragInsert=!0;md.commandParameters=$a;$a.userHash=this.userHash;$a.id=l.a.create().toString();if(this.Tsd)return sb=
this.$p.$Me(md,ld,vc,sb,Na,$a.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.l9a($a,Kb,ac,Da,md)},ce=>{const ec=ce?this.getStringifiedError(ce):"null";e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${ec}, copyPasteTargetType="${$a.copyPasteTargetType}"`);this.K$a(ce,$a,Kb,ac,Da,md)}),mb.c(sb.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
ce=>Promise.reject(ce))).jp(()=>!0);sb=this.$p.$Me(md,ld,vc,sb,Na,$a.ribbonCommandInfo,null,null);let Qd=this;return mb.c(sb.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${$a.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.l9a($a,Kb,ac,Da,md);return Promise.resolve(!0)},ce=>{const ec=ce?Qd.getStringifiedError(ce):"null";e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${ec}, copyPasteTargetType="${$a.copyPasteTargetType}"`);
Qd.K$a(ce,$a,Kb,ac,Da,md);return Promise.reject(ce)})).jp(()=>!0)}Ofi($a,ac){var Da=N(this.TK);if(!Da)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),gb.Task.Ta(!1);if(!C(Da.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),gb.Task.Ta(!1);var Na=Da.sourceItem;if(!Na)return e.ULS.shipAssertTag(537167810,0,!!Na,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),gb.Task.Ta(!1);
if(!Na.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),gb.Task.Ta(!1);if(1<Na.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.Uza(2186,"InsertCopiedCutCells",!0),gb.Task.Ta(!1);Da=O.K(Na.ranges);var sb=this.gridView.ha.ra.$c.clone();$a=O.K(this.Z_c([sb],$a));const Kb=this.Vnf();Na=Na.sheetName;sb=this.$.ea.oa.sheetName;const Yb=O.v(Da,
this.$);Yb.SheetName=Na;const vc=O.v($a,this.$);vc.SheetName=sb;return($a.hf||Da.hf?gb.Task.Ta(0):$a.isRow||Da.isRow?gb.Task.Ta(1):this.Pfi.x5b(this.$,X.h(this.$).rtl)).jp(ad=>this.$p.executeInsertCopiedCutCellsOperation(Yb,vc,Kb,ad.result,ac,null,null)).continueWith(()=>{Kb?this.$p.Xec():this.Ar("InsertCopiedCutCells/success/"+m.a[ac.method],!0)})}Bqd(){const $a=N(this.TK),ac=this.gridView.ha.ra.Og;return!!$a&&C($a.sourceItem)&&ac&&1===$a.sourceItem.ranges.length}Vnf(){return this.Wnf(-911352779)}Ekc(){return this.Wnf(-1985798686)}k0c($a,
ac){var Da=new fa.a(this.$.xa),Na=36===$a;const sb=Da.Td(4);$a=2===this.FCb()&&Da.Td(1);Na=Na&&sb;Da=!Da.ki||!this.Ekc()||!fa.a.h8b(ac,X.h(this.$));return Na||$a||this.$.Yp(ac,!0)&&Da}Rhc($a,ac){return this.$p.Rhc($a,ac)}dispose(){super.dispose();this.gk();this.TK.removeMetadataChangeListener(cc.xuf)}s8c($a,ac,Da,Na,sb,Kb){if(!this.V2g($a.commandParameters.ribbonCommandInfo.command))return $a.cseStatus=2,!1;if(Kb&&ac.Bd(Na))return $a.cseStatus=4,!1;if(Da!==sb)return $a.cseStatus=6,!1;if(t.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&
(Na.width%ac.width||Na.height%ac.height))return $a.cseStatus=16,!1;if(t.EwaSettings.getBooleanFeatureGate(oa.a.RIe,!1)){if(Da=ac,Na=Na.Ke(this.gridView.vi),ac=null===ac.Ke(this.gridView.vi),sb=$a.commandParameters.ribbonCommandInfo.command,ac&&1804571062!==sb&&-185374993!==sb||!Na)return $a.cseStatus=7,!1}else if(Da=ac.Ke(this.gridView.vi),Na=Na.Ke(this.gridView.vi),!Da||!Na)return $a.cseStatus=7,!1;ac=O.v(Da,this.$);ac=this.Ag.B0i(this.gridView,ac,O.v(Na,this.$),$a.commandParameters.ribbonCommandInfo.command,
$a.commandParameters.stopwatch);1===ac&&(Kb&&(this.Ag.W1c(Da,!1),this.Ag.W1c(Da,!0)),-185374993===$a.commandParameters.ribbonCommandInfo.command&&X.h(this.$).h8i(),this.pasteIndicationManager.pld($a.commandParameters.id),this.Jwc($a.commandParameters.expandDestinations,$a.commandParameters.isPasteCommandFromRecoveryUI),this.rCe("DoPasteClientEstimation/"+m.a[$a.commandParameters.ribbonCommandInfo.method],$a));$a.cseStatus=ac;return 1===ac}QLf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,
!1,!1,this.xAi)}Mqf($a,ac,Da,Na){$a=D($a,ac,Da,Na,this.$.va.UserSessionId);$a.k=!0;x.b().Qe(45,$a,!0)}CFf($a,ac,Da,Na,sb){var Kb=!1,Yb=!1,vc=cc.mtb,ad=cc.WMe+cc.MJa;$a&&(ad+=cc.aLa($a),Va.a.Nq($a.ewaErrors)?(vc=this.ccc($a.ewaErrors),Va.a.dh($a.ewaErrors,[-103190598])&&(Kb=!0)):$a.message&&(vc=$a.message));Yb||(Yb=this.Tpd($a));ac=D(ac,Da,Na,sb,this.$.va.UserSessionId);ac.k=!1;ac.l=Yb;ac.n=vc;ac.p=ad;ac.q=Kb;x.b().Qe(45,ac,!0);return Promise.reject($a)}V2g($a){switch($a){case 237279923:case 808159687:return t.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");
case -185374993:return!0;case 1804571062:return!0;default:return!1}}Wnf($a){const ac=N(this.TK);if(!ac)return!1;const Da=ac.sourceItem;return Da&&!Da.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):ac.commandParameters.ribbonCommandInfo.command===$a}Lmh(){var $a=N(this.TK);return $a?($a=$a.sourceItem)&&!$a.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),
!1):!0:!1}uAj($a){return $a&&$a.lastCopy?La($a.lastCopy,this.$):!0}l1e($a,ac,Da,Na,sb){const Kb={};Kb.a=this.$.va.UserSessionId;Kb.e=$a.stopwatch.id;Kb.c=x.b().uj($a.ribbonCommandInfo.command);Kb.b=m.a[$a.ribbonCommandInfo.method];Kb.d=$a.id;Kb.f=Da.toString();Kb.g=Na.toString();Kb.h=ac.toString();Kb.o=$a.stopwatch.zc;Kb.q=!1;Kb.r=$a.copyPasteTargetType.toString();Kb.s=sb.encounteredDeploymentErrors;t.EwaSettings.getBooleanFeatureGate(oa.a.u8b,!1)&&(Kb.i=sb.commandParameters.dragDropIsShiftKeyDown,
Kb.j=sb.commandParameters.isDragInsert);return Kb}l9a($a,ac,Da,Na,sb){$a=this.l1e($a,ac,Da,Na,sb);$a.k=!0;x.b().Qe(45,$a,!0)}Byi($a,ac,Da,Na,sb,Kb,Yb,vc,ad){$a=this.l1e($a,ac,Da,Na,ad);$a.k=!1;$a.l=sb;$a.n=Kb;$a.p=Yb;$a.q=vc;x.b().Qe(45,$a,!0)}dqf($a,ac,Da,Na,sb,Kb,Yb,vc,ad){const ld={};ld.a=this.$.va.UserSessionId;ld.b=ac;ld.c=$a;ld.f=Da;ld.e=Na;ld.d=sb;ld.g=Kb;ld.h=Yb;ld.i=vc;ld.j=ad.toString();x.b().Qe(46,ld,!0)}tyi($a,ac){$a=this.I0e($a.commandParameters,$a);$a.l=!0;$a.j=ac;x.b().Qe(43,$a,!0)}syi($a,
ac,Da,Na,sb,Kb,Yb){$a=this.I0e($a,Yb);$a.l=!1;$a.m=ac;$a.o=Da;$a.y=Na;$a.x=sb;$a.z=Kb;x.b().Qe(43,$a,!0);e.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${$a.y},ErrorReason=${$a.x},IsExpectedError=${$a.m},IsSucceededWithAlert=${$a.z},ErrorMessage=${$a.o}`)}I0e($a,ac){const Da={};Da.a=this.$.va.UserSessionId;Da.f=$a.stopwatch.id;Da.g=$a.id;Da.c=x.b().uj($a.ribbonCommandInfo.command);Da.b=m.a[$a.ribbonCommandInfo.method];Da.q=$a.stopwatch.zc;Da.bd=cc.rbc();
Da.bg=$a.copyPasteHandlerName;Da.bj=void 0===$a.ribbonCommandInfo.$e||null===$a.ribbonCommandInfo.$e?null:n.a[$a.ribbonCommandInfo.$e];Da.bq=$a.uploadToClipService;Da.br=$a.floatingObjectType;Da.s=$a.copyPasteTargetType.toString();Da.bc=Ia($a.copyPasteTargetType);Da.z=!1;if(ac){Da.bk=ac.id;Da.bl=ac.serverRequestTimeInMs;ac.requestTelemetryData&&(Da.bm=ac.requestTelemetryData.EcsOperationDuration,Da.bn=ac.requestTelemetryData.EcsRequestDuration,Da.bo=ac.requestTelemetryData.WfeRequestDuration);Da.d=
ac.sourceItem?ac.sourceItem.toString():null;Da.e=-1;if(C(ac.sourceItem)){Da.e=0;$a=ac.sourceItem.ranges;for(const Na of $a)Da.e+=Na.qH}Da.h=ac.isAsyncCopy;Da.i=ac.isFromCache;Da.k=ac.isSelectionAllowed;Da.r=ac.plainTextPayloadSize;Da.u=ac.htmlPayloadSize;Da.v=ac.htmlSizeExceedsLimit;Da.w=ac.copyTotalSizeExceedsLimit;Da.t=ac.shadowWorkbookPayloadSize;Da.p=ac.clientSideCopyTime;Da.ba=ac.encounteredDeploymentErrors;Da.bb=ac.shadowWorkbookSizeExceedsLimit;Da.be=ac.syncClipboardItemsKeys;Da.bf=ac.asyncClipboardItemsKeys;
Da.bh=this.MFe(ac.succeededPopulatingSystemClipboardSync);Da.bi=this.MFe(ac.succeededPopulatingSystemClipboardAsync)}return Da}Jwc($a,ac=!1){if(!this.gridView.eb&&!this.gridView.si){var Da=this.gridView.ha.ra,Na=!ac&&1===$a.length&&O.Q($a,Da.selectedRanges),sb=Na?Da.activeCell:$a[0].topLeft;$a[0].contains(sb)||(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${Da.selectedRanges}, IndexOfActiveRange ${Da.Bs}, ActiveCell ${Da.activeCell}, calculatedDestinationRanges ${$a}, keepThePreviousActiveCell ${Na}, newActiveCell ${sb}, isPasteCommandFromRecoveryUI ${ac}`),
sb=$a[0].topLeft);this.gridView.ha.mx($a,0,sb,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}I4e($a,ac){const Da={};Da.a=this.$.va.UserSessionId;Da.g=$a.stopwatch.id;Da.t=$a.stopwatch.zc;Da.bz=!1;ac&&(Da.bv=ac.id,Da.bw=ac.serverRequestTimeInMs,Da.n=ac.commandParameters.clipboardFormatReadTimes,Da.o=ac.commandParameters.clipboardFormatReadStatus,Da.p=ac.commandParameters.clipboardReadPermissionPromptShown,Da.q=ac.commandParameters.asyncApiReadTimedOut,ac.requestTelemetryData&&(Da.cb=ac.requestTelemetryData.EcsOperationDuration,
Da.cc=ac.requestTelemetryData.EcsRequestDuration,Da.cd=ac.requestTelemetryData.WfeRequestDuration));Da.x=$a.copyPasteTargetType.toString();Da.bl=Ia($a.copyPasteTargetType);Da.br=$a.copyPasteHandlerName;Da.i=O.i($a.expandDestinations,",",this.$,!1);Da.h=O.i($a.originalDestinations,",",this.$,!1);Da.e=$a.id;Da.d=$a.commandType;Da.c=x.b().uj($a.ribbonCommandInfo.command);Da.b=m.a[$a.ribbonCommandInfo.method];Da.bf=!1;Da.bg=!1;Da.bp=cc.rbc();Da.bt=void 0===$a.ribbonCommandInfo.$e||null===$a.ribbonCommandInfo.$e?
null:n.a[$a.ribbonCommandInfo.$e];Da.cj=$a.isPasteCommandFromEnterShortcut;if(Da.ca=$a.isPasteCommandFromRecoveryUI)Da.cf=$a.pasteRecoveryUndoStopwatch.id,Da.cg=$a.pasteRecoveryUndoStopwatch.zc;if(ac){if(($a=ac.copyContextSnapshot)&&!ac.wasLastCopyExternal){Da.f=$a.commandParameters.id;Da.j=$a.sourceItem.toString();Da.k=-1;if(C($a.sourceItem)){Da.k=0;const Na=$a.sourceItem.ranges;for(const sb of Na)Da.k+=sb.qH}Da.bg=1===$a.commandParameters.commandType}else ac.clipboardItems?Da.f=ac.clipboardItems.getItem(I.esb):
e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");Da.bz=ac.pasteRecoveryUIDisplayed;Da.ci=ac.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return Da}Mzi($a,ac,Da,Na,sb,Kb,Yb,vc,ad){$a=this.I4e($a,vc);$a.l=!1;$a.m=ac;$a.s=Da;$a.bc=Na;$a.be=sb;$a.bd=Kb;$a.bf=Yb;vc?($a.y=M(vc)||!vc.copyContextSnapshot,$a.bi=!$a.y&&La(vc.copyContextSnapshot,this.$),$a.bj=vc.shadowWorkbookSizeExceedsLimit,
$a.v=vc.shadowWorkbookPayloadSize,$a.w=vc.htmlPayloadSize,$a.bq=ra(vc.clipboardItems),$a.bb=vc.activeSelectionType,$a.bs=vc.isSameSession,$a.bn=vc.payloadOrigin,$a.bo=vc.payloadType,$a.bu=vc.externalAppSource,$a.bx=vc.indicationDisplayScheduled,$a.by=vc.pasteIndicationDisplayStatus,$a.ck=vc.pasteDestinationHasMergedCells):$a.bi=La(ad,this.$);x.b().Qe(44,$a,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${$a.be},ErrorReason=${$a.bd},IsExpectedError=${$a.m},IsSucceededWithAlert=${$a.bf},ErrorMessage=${$a.s}`)}Nzi($a){const ac=
this.I4e($a.commandParameters,$a);ac.y=$a.wasLastCopyExternal;ac.l=!0;ac.u=$a.plainTextPayloadSize;ac.v=$a.shadowWorkbookPayloadSize;ac.w=$a.htmlPayloadSize;ac.z=$a.isClipboardDataContainShadowWorkbook;ac.ba=$a.isShadowWorkbookParsedSuccessfully;ac.bb=$a.activeSelectionType;ac.bc=$a.pasteResult;ac.bh=$a.encounteredDeploymentErrors;ac.bj=$a.shadowWorkbookSizeExceedsLimit;ac.bk=U($a);ac.bq=ra($a.clipboardItems);ac.bs=$a.isSameSession;ac.bn=$a.payloadOrigin;ac.bo=$a.payloadType;ac.bu=$a.externalAppSource;
ac.bx=$a.indicationDisplayScheduled;ac.by=$a.pasteIndicationDisplayStatus;ac.ck=$a.pasteDestinationHasMergedCells;ac.bm=$a.clipboardItems?$a.clipboardItems.getItem(I.I1g):null;ac.bi=!$a.isSameSession&&!$a.wasLastCopyExternal;x.b().Qe(44,ac,!0)}Lj(){this.$.xa.Vf(this.Fh);this.$.xa.NKg(this.bpc);this.$.userOperationManager.ur(this.DR);this.$.ml(this.dd);X.h(this.$).Vb.Yk(this.AGb)}gk(){this.$&&this.$.xa&&(this.$.xa.Dg(this.Fh),this.$.xa.Tfj(this.bpc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.ko(this.DR);
this.gridView&&this.gridView.Vb&&this.gridView.Vb.Hk(this.AGb)}nGb($a,ac){var Da=null;let Na=!1;var sb=null;let Kb="UnknownFailure",Yb=-1,vc=cc.mtb,ad=cc.pasteErrorName+cc.MJa,ld=!1;this.pasteIndicationManager.pld($a.id);this.pasteDestinationHasMergedCells($a.expandDestinations)&&(ac.pasteContext.pasteDestinationHasMergedCells=!0);const md=N(this.TK);($a.clearStateOnFinish||$a.clearSystemClipboard)&&this.Ar("Paste/fail/"+m.a[$a.ribbonCommandInfo.method],!0,void 0,void 0,$a.copyPasteTargetType).catch(()=>
{});if(ac){Yb=ac.reason;ad+=cc.aLa(ac);ac.message&&(vc=ac.message);if(Da=cc.e8g(ac))if(1===Da.pasteErrorName)Na=!0,Kb="CopyPasteLengthTooLongPopup",vc=sb="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${sb}, copyPasteTargetType="${$a.copyPasteTargetType}"`),Da=Va.a.Zc(1,0,26,690,0,1306609195,"CopyPasteOversizeError"),t.EwaSettings.Iz()?new ja.a(this.$,Da):(Da=new aa.ErrorDialog(this.$,Da),Da.initialize(),Da.vg());
else if(7===Da.pasteErrorName)Na=!0,Kb="No-Op",vc=sb="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${sb}, copyPasteTargetType="${$a.copyPasteTargetType}"`);else if(8===Da.pasteErrorName)Na=!0,Kb="UseShortcutsPopup",vc=sb="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${sb}, copyPasteTargetType="${$a.copyPasteTargetType}"`),
this.QLf();else if(18===Da.pasteErrorName){Na=!0;Kb="PasteExternalNotSupportMultipleSelectionPopup";vc="Paste external not support multiple selection.";sb="Unknown";var Qd=2186;100!==Da.validationFailureReason&&(sb=pa[Da.validationFailureReason],Qd=cc.EFe(Da.validationFailureReason));this.Uza(Qd,sb,!0)}else 20===Da.pasteErrorName||19===Da.pasteErrorName?(Na=!0,20===Da.pasteErrorName?(Kb="PasteAcrossSessionNotSupportMultipleSelectionPopup",vc="Paste across session does not support multiple selection."):
(Kb="PasteInSameSessionNotSupportMultipleSelectionPopup",vc="This kind of multiple selection is not supported for same session paste."),sb="Unknown",Qd=2186,100!==Da.validationFailureReason&&(sb=pa[Da.validationFailureReason],Qd=cc.EFe(Da.validationFailureReason)),Da=6===Da.validationFailureReason,this.k0c($a.commandType,$a.expandDestinations)&&Da&&this.Jwc($a.expandDestinations),this.Uza(Qd,sb,!0)):6===Da.pasteErrorName?(Na=!0,Kb="No-Op",vc=sb="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",
e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${sb}, copyPasteTargetType="${$a.copyPasteTargetType}"`)):17===Da.pasteErrorName?(Na=!0,Kb="No-Op",vc=sb="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${sb}, copyPasteTargetType="${$a.copyPasteTargetType}"`)):16===Da.pasteErrorName?(Na=!0,Kb="No-Op",vc=sb="Paste has failed because the previous copy has failed",Da=this.getStringifiedError(Da),e.ULS.sendTraceTag(537167771,
0,15,`CopyPasteInfrastructure.OnPasteFailed: ${sb}, copyPasteTargetType="${$a.copyPasteTargetType}", error=${Da}`)):Va.a.Nq(Da.ewaErrors)?(Va.a.p$(Da.ewaErrors)||Va.a.dh(Da.ewaErrors,Va.a.Odc())?(Na=!0,Kb="CommunicationError",sb=Va.a.sc(Da.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${vc} copyPasteTargetType="${$a.copyPasteTargetType}"`)):Va.a.dh(Da.ewaErrors,cc.zoj)?(Na=!0,Kb="SavingWorkbookError",sb=Va.a.sc(Da.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${vc} copyPasteTargetType="${$a.copyPasteTargetType}"`)):
Va.a.dh(Da.ewaErrors,cc.operationSucceededWithAlert)&&(ld=Na=!0,Kb="OperationSucceededWithAlert",sb=Va.a.sc(Da.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${vc} copyPasteTargetType="${$a.copyPasteTargetType}"`)),Na||(vc=this.ccc(Da.ewaErrors),Na=this.Tpd(ac))):11===Da.pasteErrorName&&(Na=!0,Kb="No-Op",vc="Paste has failed because user try copy cross-session oart object");15===ac.reason&&(Na=!0,Kb="No-Op",vc="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
ka.a.equals(ad,H.xZj,!1)&&(Na=!0,Kb="No-Op",vc="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Na||(Da=ac?this.getStringifiedError(ac):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${Da}, copyPasteTargetType="${$a.copyPasteTargetType}"`));this.Mzi($a,Na,vc,Kb,ad,Yb,ld,ac.pasteContext,md);return Promise.reject(ac)}Apc($a,ac){var Da;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${ac.copyPasteTargetType}"`);
this.pasteIndicationManager.pld(ac.id);if(this.G0i(ac.copyPasteTargetType,$a)){t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Ez&&$a.wasLastCopyExternal&&$a.payloadType===K.shadowWorkbook&&(this.e8a=!0);var Na=null;(null===(Da=$a.pastedRange)||void 0===Da?0:Da.Ranges)&&0<$a.pastedRange.Ranges.length?Na=O.g($a.pastedRange.Ranges):$a.wasLastCopyExternal||(Na=ac.expandDestinations);this.iqj($a,Na);if(this.uCj($a,Na)){let sb;this.ucd?(Da=O.d(ac.originalDestinations),
sb=1028===ac.commandType?O.d(ac.expandDestinations):O.d(Na)):(Da=w.a.clone(ac.originalDestinations),sb=1028===ac.commandType?w.a.clone(ac.expandDestinations):w.a.clone(Na));let Kb=null;$a.wasLastCopyExternal&&(ac.isKeyboardEvent||ac.isPasteCommandFromRecoveryUI)&&(Kb={[cc.GKf]:$a.clipboardItems});this.pasteDestinationHasMergedCells(ac.expandDestinations)&&($a.pasteDestinationHasMergedCells=!0);$a.pasteRecoveryUIDisplayed=!0;const Yb=new da(this.$,Da,sb,Kb),vc=ba.GetServiceTaskFactory.Oa(this.$.da,
406,405,0);Ka.TaskExtensions.Aa(vc,()=>{const ad=vc.result;ad.vTg(Yb);ad.GFj(ac.ribbonCommandInfo.method)},this.la,8)}$a.pasteRecoveryUIDisplayed||1!==Na.length||(Na=O.K(Na),y.AFrameworkApplication.Ip("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Na&&(Da=Ga.d(this.$.xa.oa),Na=new ib.a(Na,Da),this.QZd(Na,"CutAndPaste")))}this.rCe("Paste/success/"+m.a[ac.ribbonCommandInfo.method],
$a);this.Nzi($a);this.O6f&&(!ac.isKeyboardEvent||U($a))&&this.$.ea.Wg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.O6f=!1,this.K9g());return Promise.resolve(!0)}uCj($a,ac){return!ac||1!==ac.length||$a.commandParameters.clearSystemClipboard||$a.commandParameters.clearStateOnFinish||$a.commandParameters.skipClipboardAccess?!1:M($a)&&(ac=$a.clipboardItems.getItem(I.plainText),$a=$a.clipboardItems.getItem(I.html),void 0===
ac||null===ac||ac.length>this.lDi||void 0===$a||null===$a||$a.length>this.Jya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}G0i($a,ac){return 1===$a||ac.payloadType===K.plainText||t.EwaSettings.ma(160)&&ac.payloadType===K.html||t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.Ez&&ac.payloadType===K.shadowWorkbook}pasteDestinationHasMergedCells($a){const ac=
X.h(this.$).Ea.nD();if(!ac||!ac.length)return!1;for(const Da of ac)if(Da.Dw($a[0]))return!0;return!1}rCe($a,ac){let Da;({WHa:Da}=this.Eji(ac)).returnValue&&this.Ar($a,Da,void 0,void 0,ac.commandParameters.copyPasteTargetType).catch(()=>{})}K$a($a,ac,Da,Na,sb,Kb){var Yb=$a?this.getStringifiedError($a):"null";e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${Yb}`);let vc=Yb=!1,ad=!1,ld=cc.mtb,md=cc.WMe+cc.MJa;$a&&(md+=cc.aLa($a),Va.a.Nq($a.ewaErrors)?(ld=this.ccc($a.ewaErrors),
Va.a.dh($a.ewaErrors,cc.operationSucceededWithAlert)&&(Yb=!0),Va.a.dh($a.ewaErrors,cc.dragDropNonEmptyRange)&&(vc=ad=!0)):$a.message&&(ld=$a.message));ad||(ad=this.Tpd($a));vc?this.gridView.ha.selectionType=-1:this.$p.laj(sb);this.Byi(ac,Da,Na,sb,ad,ld,md,Yb,Kb)}Z_c($a,ac){let Da=$a;const Na=this.tVh();if(null===Na||void 0===Na?0:Na.ranges)Da=this.$p.UYg(ac,Na.ranges,$a);return Da}tVh(){const $a=N(this.TK);return $a&&C($a.sourceItem)?$a.sourceItem:null}w8i(){this.raiseEvent(cc.$Dd,null)}iqj($a,ac){const Da=
$a.commandParameters.originalDestinations;ac&&(O.Q(this.gridView.ha.ra.selectedRanges,Da)?(this.Jwc(ac),$a=wa.HelperMethods.opb(ac),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${$a}`)):$a.commandParameters.isPasteCommandFromRecoveryUI?(this.Jwc(ac,!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${ac}, active cell: ${ac[0].topLeft}`)):
($a=wa.HelperMethods.opb(Da),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${$a}`)))}Eji($a){if($a.isPlainTextPaste||$a.isHtmlPaste||Q($a)||$a.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,WHa:!1};var ac=$a.copyContextSnapshot;if($a.commandParameters.clearStateOnFinish)return{returnValue:!0,WHa:!0};if(ac&&C(ac.sourceItem)){var Da=ac.sourceItem;
if(!Da.isFromCurrentSession(this.$))return{returnValue:!1,WHa:!0};ac=-1985798686===ac.commandParameters.ribbonCommandInfo.command;if(!(1<Da.ranges.length||1<$a.commandParameters.expandDestinations.length)){const Na=O.K(Da.ranges);$a=O.K($a.commandParameters.expandDestinations);const sb=this.$.ea.oa.sheetName;Da=Da.sheetName;if(Da===sb&&$a.equals(Na))return{returnValue:!1,WHa:!0};if(Da===sb&&$a.Ke(Na))return{returnValue:!0,WHa:!1}}return{returnValue:ac,WHa:!0}}return{returnValue:!1,WHa:!0}}IHf(){var $a=
N(this.TK);($a=this.$p.wxb($a))&&$a.isFromCurrentSession(this.$)&&this.Ar("OnStartEdit",!1).catch(()=>{})}ccc($a){$a=Va.a.XRh($a,cc.MJa);return this.yEi+d.a.mw($a).toString()}Tpd($a){$a=cc.aLa($a);return!!$a&&ka.a.Q2a($a,cc.xEi)}K9g(){const $a=Va.a.Zc(1,2,327,328,h.a.Bp?329:h.a.$H?330:331,530046625,"ActivateLocalStorage"),ac=ba.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Ka.TaskExtensions.Aa(ac,()=>{ac.result.ng(43,$a)},this.la,3)}MFe($a){return void 0===$a||null===$a?ya.MHi:$a?ya.success:ya.failed}static e8g($a){const ac=
$a.innerError;return ac&&0!==ac.pasteErrorName?$a.innerError:null}static Q7g($a){const ac=$a.innerError;return ac&&0!==ac.copyErrorName?$a.innerError:null}static aLa($a){let ac="";if(!$a)return cc.ZJe;$a.errorName&&(ac=$a.errorName,$a.innerError&&(ac+=cc.MJa+cc.aLa($a.innerError)));ac||(ac=$a&&$a.name?$a.name:cc.ZJe);return ac}static rbc(){cc.sS||(cc.sS=ea.XGj);return cc.sS}static EFe($a){switch($a){case 7:case 1:return 2193;case 5:return 2190;case 6:return 2189;case 8:case 3:case 2:case 4:case 9:case 10:return 2186;
default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${$a}`),2193}}static R7g($a){switch($a){case 3:return 2187;case 1:return 2188;case 2:case 4:return 2186;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${$a}`),2193}}QZd($a,ac){Ka.TaskExtensions.Aa(ba.GetServiceTaskFactory.Oa(this.$.da,426,427,1),
Da=>{void Da.result.Lea($a,ac);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}cc.xuf="EwaJsMetadataChangeListenerId";cc.$Dd="cpiOSC";cc.dih="cpiDID";cc.mtb="Unknown";cc.ZJe="UnknownError";cc.MJa="_";cc.WMe="DragAndDropError";cc.pasteErrorName="PasteError";cc.ZZg="CancelError";cc.copyErrorName="CopyError";cc.xEi="MergedCellOverlap";cc.GKf="PasteRecoveryCachedClipboardItems";cc.zoj=[1352631530,
1679665408];cc.operationSucceededWithAlert=[-103190598];cc.pasteDataLimitHit=[1306609195];cc.copyThrottlingError=[-386183710];cc.dragDropNonEmptyRange=[563945982];cc.sS=null;Object(c.a)(cc,"CopyPasteInfrastructure",r.a,[775,776,2]);class ic{constructor(){this.R0a=this.ECe=null}}Object(c.a)(ic,"ClipboardPlatformInitializationResult",null,[]);var xb=a(187),Vb=a(639),wb=a(553),cb=a(121),lb=a(5),Y=a(60);const Oa=($a,ac,Da,Na,sb,Kb,Yb,vc,ad,ld=null)=>{ad=$a.Na(9,ad);ad.sourceRanges=ac;ad.destinationRanges=
Da;ad.flags=Na;return Y.g($a,"PasteRange",ad,sb,Kb,Yb,vc,64,ld)},Wa=($a,ac,Da,Na,sb,Kb,Yb,vc=null)=>{Yb=$a.Na(1,Yb);Yb.pasteHtmlParameters=ac;return Y.g($a,"PasteHtmlContent",Yb,Da,Na,sb,Kb,64,vc)},Ca=($a,ac,Da,Na,sb,Kb,Yb,vc,ad=null)=>{vc=$a.Na(9,vc);vc.destinationRange=ac;vc.source=Da;return Y.g($a,"PasteString",vc,Na,sb,Kb,Yb,64,ad)},Ra=($a,ac,Da,Na,sb,Kb,Yb=null,vc=null)=>{Yb=$a.Na(1,Yb);Yb.copyParameters=ac;return Y.g($a,"Copy",Yb,Da,Na,sb,Kb,0,vc)},la=($a,ac,Da,Na,sb,Kb,Yb=null,vc=null)=>{Yb=
$a.Na(1,Yb);Yb.copyParameters=ac;return Y.g($a,"Cut",Yb,Da,Na,sb,Kb,0,vc)},ua=($a,ac,Da,Na,sb,Kb,Yb=null,vc=null)=>{Yb=$a.Na(1,Yb);Yb.pasteParameters=ac;return Y.g($a,"Paste",Yb,Da,Na,sb,Kb,64,vc)};class xa{constructor($a,ac,Da){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=$a;this.destinationRange=ac;this.pasteFlags=Da}}Object(c.a)(xa,"MacroRecorderPasteRangePayload",null,[137]);class fb{constructor($a,ac){this.content=this.destinationRange=null;this.destinationRange=
$a;this.content=ac}getContent(){return this.content}}Object(c.a)(fb,"MacroRecorderPasteStringPayload",null,[137]);class Jb{constructor($a){this.pasteParameters=null;this.pasteParameters=$a}}Object(c.a)(Jb,"MacroRecorderPastePayload",null,[137]);var Ob=a(584),eb=a(761),Ma=a(188),va=a(33),Pa=a(207),Ha=a(116),tb=a(281);const Ya=($a,ac,Da,Na,sb,Kb,Yb=null)=>{Yb=$a.Na(41,Yb);Yb.insertCopiedCutCellsParameters=ac;return Y.g($a,"InsertCopiedCutCells",Yb,Da,Na,sb,Kb,4)},V=($a,ac,Da,Na,sb,Kb,Yb=null)=>{Yb=
$a.Na(41,Yb);Yb.insertCopiedCutCellsParameters=ac;return Y.g($a,"InsertCopiedCutCellsV2",Yb,Da,Na,sb,Kb,0)};class za{constructor($a){this.parameters=null;this.parameters=$a}getParameters(){return this.parameters}}Object(c.a)(za,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[137]);var yb=a(371);class jc{constructor($a,ac,Da,Na,sb,Kb,Yb,vc,ad){this.destinationRange=$a;this.esb=Da;this.z0i=Na;this.Wd=sb;this.wQb=Kb;this.pasteContext=Yb;this.B3b=vc;this.xdg=ad}}Object(c.a)(jc,"PasteHtmlRequestParams",
null,[]);class Cc{constructor($a,ac){this.qkc=this.bOa=null;this.gQa=oa.a.gQa;this.rFd=oa.a.rFd;this.bEb=oa.a.bEb;this.khc=t.EwaSettings.getBooleanFeatureGate(oa.a.e6b,!1);this.Smi=t.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.pod=!1;this.zxa=t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Sz=(Da,Na)=>{if(2===Na.Kr)this.Jv.clear(),this.bOa=null;else if(1===Na.Kr&&this.Jv&&this.Jv.contains(Na.Rf)){Da=cb.a(Na.Rf.operation.operationName);
const sb=Na.Rf.dequeueUtcTime.getTime()-Na.Rf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${Da} returned, it took ${sb} milliseconds to complete.`);this.Jv.remove(Na.Rf);this.bOa=null}};this.$=$a;this.gridView=ac;this.pod&&(this.$.userOperationManager.ur(this.Sz),this.Jv=new xb.a)}get Jya(){return this.zxa?t.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.va.CopyPasteMaxPayloadLength):v.a.Jya}copy($a,
ac,Da,Na=null,sb=null){const Kb=this.$.pa.ya.Wb();this.pod&&this.sY();this.qkc=Kb.ClientRequestId;var Yb=new Ma.a(505,0,(vc,ad,ld)=>{const md={CopyPasteTargetType:1};md.SourceRanges=$a;md.CopyOperationId=ac.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.zxa}, CopyOperationId : ${md.CopyOperationId}`);return this.bOa=this.zxa?Ra(this.$.pa.sw,md,tb.b(vc,Da),Na?tb.a(ad,Na):ad,ld,ac.ribbonCommandInfo,Kb,sb):Ra(this.$.pa.ya,md,tb.b(vc,Da),Na?tb.a(ad,
Na):ad,ld,ac.ribbonCommandInfo,Kb,sb)},80);Yb=this.$.userOperationManager.Ic(Yb,ac.ribbonCommandInfo);this.pod&&this.Jv.add(Yb)}FKf($a,ac,Da,Na,sb,Kb){return new Promise((Yb,vc)=>{var ad;const ld=Kb.commandParameters.stopwatch.zc;let md=2;20===Kb.commandParameters.commandType&&(md=16);36===Kb.commandParameters.commandType&&(md=32);68===Kb.commandParameters.commandType&&(md=64);va.a.ztd(this.$)&&1028===Kb.commandParameters.commandType&&(md=1024);let Qd=null;if(null===(ad=Kb.copyContextSnapshot)||void 0===
ad?0:ad.commandParameters)Qd=Kb.copyContextSnapshot.commandParameters.id;Cc.YPd(this.$,$a,Na,ac,Da,null,ce=>{Cc.nec(ce,Kb,Yb,vc,ld,this.$,null,!0,null,null)},ce=>{Kb.serverRequestTimeInMs=Kb.commandParameters.stopwatch.zc-ld;ce=Ha.a.Pe(ce.data);vc(new eb.a(5,ce))},sb,md,Qd,Kb.commandParameters.id)})}pasteRange($a,ac,Da,Na,sb,Kb,Yb,vc,ad,ld){return new Promise((md,Qd)=>{const ce=Yb.commandParameters.stopwatch.zc;Cc.orj(this.$,$a,ac,Da,Na|-5&sb,ec=>{Cc.nec(ec,Yb,md,Qd,ce,this.$,null,!0,ad,ld)},ec=>
{Yb.serverRequestTimeInMs=Yb.commandParameters.stopwatch.zc-ce;ec=Ha.a.Pe(ec.data);ec=new eb.a(5,ec);null===ld||void 0===ld?void 0:ld(ec);Qd(ec)},Kb,vc)})}C5i($a,ac,Da,Na,sb,Kb,Yb){return(new Promise((vc,ad)=>{if(ac)if(ac.length>this.Jya){var ld=Yb.clipboardItems.getItem(I.plainText);let md=-1;void 0!==ld&&null!==ld&&(md=ld.length);oa.a.ohf&&ac.length<this.rFd&&ac.length>this.gQa&&(this.JLf(ac),this.jW=new jc($a,ac,Da,Na,sb,Kb,Yb,0,this.crc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>
this.HFd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${ac.length}, MaxHtmlImportLength: ${this.Jya}, PlainTextLength: ${md}`);ad(new eb.a(1))}else ld=new Ma.a(204,0,(md,Qd,ce)=>{this.$.My();const ec=Yb.commandParameters.stopwatch.zc;md=tb.b(md,ne=>{Cc.nec(ne,Yb,vc,ad,ec,this.$,ac,!1,null,null)});Qd=tb.a(Qd,ne=>{Yb.serverRequestTimeInMs=Yb.commandParameters.stopwatch.zc-ec;ne=Ha.a.Pe(ne.data);ad(new eb.a(3,ne))});
const Vc=this.$.pa.ya.Wb(),td=O.v($a,this.$),he={};he.SourceHtml=ac;he.DestinationRanges=td?O.s(td):null;he.CopyOperationId=Da;he.PasteId=Na;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.zxa}. PasteId : ${he.PasteId}`);return this.zxa?Wa(this.$.pa.sw,he,md,Qd,ce,null,Vc,Kb):Wa(this.$.pa.ya,he,md,Qd,ce,null,Vc,Kb)},65),this.$.userOperationManager.Ic(ld,sb);else vc("")})).then(()=>{oa.a.ohf&&ac.length>this.gQa&&(this.JLf(ac),this.jW=
new jc($a,ac,Da,Na,sb,Kb,Yb,0,this.crc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.HFd()))})}JLf($a){const ac=this.$.Jb.Ac("Task","pasteHtmlChunkOperation"),Da=Math.floor($a.length/this.gQa)+1;this.crc=Array(Da);let Na=0;for(;Na<Da;)this.crc[Na]=$a.substring(Na*this.gQa,(Na+1)*this.gQa),Na++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${ac.zc}`)}HFd(){this.y0i(this.jW.destinationRange,this.crc[this.jW.B3b],this.jW.esb,
this.jW.z0i,this.jW.Wd,this.jW.wQb,this.jW.pasteContext,this.jW.B3b,this.jW.xdg);this.jW.B3b++;this.jW.B3b<this.jW.xdg&&window.requestIdleCallback(()=>this.HFd())}y0i($a,ac,Da,Na,sb,Kb,Yb,vc,ad){const ld=new Ma.a(204,0,(md,Qd,ce)=>{const ec=Yb.commandParameters.stopwatch.zc;md=tb.b(md,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${Yb.commandParameters.stopwatch.zc-ec},
             pasteid:${Na},
             chunkIndex:${vc},
             totalChunks:${ad}`)});Qd=tb.a(Qd,()=>{Yb.serverRequestTimeInMs=Yb.commandParameters.stopwatch.zc-ec;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${Yb.serverRequestTimeInMs},
               pasteid:${Na},
               chunkIndex:${vc},
               totalChunks:${ad}`)});const Vc=this.$.pa.ya.Wb();var td=O.v($a,this.$);td={SourceHtml:ac,DestinationRanges:td?O.s(td):null,CopyOperationId:Da,PasteId:`${Na}_chunk_${vc}`,ChunkIndex:vc,TotalChunks:ad};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.zxa}. PasteId : ${td.PasteId}`);return Wa(this.$.pa.sw,td,md,Qd,ce,null,Vc,Kb)},65);this.$.userOperationManager.Ic(ld,sb)}D5i($a,ac,Da,Na,sb){return new Promise((Kb,Yb)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${sb.id}`);ac&&(ac=ka.a.trimEnd(ac,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${sb.id}`);if(ac)if(ac.length>this.bEb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",ac.length,this.bEb),Yb(new eb.a(1));
else{let ad,ld;const md=O.v($a,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${sb.id}`);var vc=!this.$.ea.isNamedObjectViewMode&&!ac.includes("\n")&&!ac.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${sb.id}. treatAsLink=${vc}`);vc=vc&&ka.a.Mif(ac);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${sb.id}. treatAsLink=${vc}`);
const Qd=this.$.pa.ya.Wb();if(vc){ld=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${sb.id}`);const ce=Pa.a.wcd(ac);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${sb.id}`);const ec=O.s(md);vc=(Vc,td,he)=>{const ne=sb.commandParameters.stopwatch.zc;Vc=tb.b(Vc,Te=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${sb.id}`);
sb.requestTelemetryData=Te.RequestTelemetryData;sb.serverRequestTimeInMs=sb.commandParameters.stopwatch.zc-ne;Te.Errors&&0<Te.Errors.length?Yb(new eb.a(2,Te.Errors)):Kb(ac)});td=tb.a(td,Te=>{sb.serverRequestTimeInMs=sb.commandParameters.stopwatch.zc-ne;Te=Ha.a.Pe(Te.data);Yb(new eb.a(2,Te))});this.$.My();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${sb.id}`);return Y.b(this.$.pa.ya,ec,ac,ce,!1,!1,63,Vc,td,he,$a,
Qd,Na)};ad=()=>new Ob.a(ec,ac,ce)}else ld=180,vc=(ce,ec,Vc)=>{this.$.My();const td=sb.commandParameters.stopwatch.zc;ce=tb.b(ce,he=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${sb.id}`);Cc.nec(he,sb,Kb,Yb,td,this.$,ac,!1,null,null)});ec=tb.a(ec,he=>{sb.serverRequestTimeInMs=sb.commandParameters.stopwatch.zc-td;he=Ha.a.Pe(he.data);Yb(new eb.a(4,he))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${sb.id}`);
return Ca(this.$.pa.ya,md,ac,ce,ec,Vc,null,Qd,Na)},ad=()=>new fb(md,ac);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${sb.id}`);vc=new Ma.a(ld,0,vc,65,ad);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${sb.id}`);this.$.userOperationManager.Ic(vc,Da)}else Kb("")})}mbf($a,ac){ac=[1===ac?4:5];this.gridView.qb.lx(ib.a.Eea(Ga.d(this.$.oa),
$a),ac,!0);this.gridView.qb.Sn(ac);this.gridView.qb.update(!0)}Xec(){const $a=[4,5];this.gridView.qb.Xg($a,!1,!1);this.gridView.qb.Ti(null,$a,!1);1===this.gridView.ha.Oe&&this.gridView.Sn(!1,!1);this.gridView.qb.update(!1,!1)}UYg($a,ac,Da){const Na=[];for(const sb of Da)Na.push(this.YYg($a,ac,sb));return Na}sY(){if(this.Jv)for(let $a of this.Jv)if(this.$&&this.$.userOperationManager){if($a.operation){const ac=cb.a($a.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${ac}.`)}this.XZg();
this.$.userOperationManager.iua($a)}}XZg(){if(this.bOa){const $a=this.bOa.lu;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${$a}`);Ha.a.Ru($a);!t.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.qkc&&Y.h(this.$.pa.ya,this.qkc,null,null,null);this.qkc=this.bOa=null}}YYg($a,ac,Da){e.ULS.shipAssertTag(537167713,0,!!ac,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<ac.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Na=0,sb=0;var Kb=new Set;const Yb=new Set;for(const vc of ac){ac=`${vc.left}_${vc.right}`;const ad=`${vc.top}_${vc.bottom}`;Yb.has(ac)||(Yb.add(ac),sb+=vc.width);Kb.has(ad)||(Kb.add(ad),Na+=vc.height)}if(36===$a)return Da.isSingle?Cc.oVe(sb,Na,Da):Da.clone();516===$a&&($a=Na,Na=sb,sb=$a);$a=!(Da.width%sb)&&!(Da.height%Na);Kb=Da.y_&&!(Da.height%Na);Da.R5&&!(Da.width%sb)||Kb?Da=Cc.oVe(sb,Na,Da):$a?Da=Da.clone():
(Da=Da.clone(),Da.bottom=Math.min(v.a.fh,Da.top+Na-1),Da.right=Math.min(v.a.qh,Da.left+sb-1));return Da}AQg($a,ac,Da,Na,sb,Kb,Yb,vc,ad,ld,md){if(!Na||!Na.length)return 1;if(1<Na.length){if(!this.khc&&Kb)return 3;if(ld)return 0;if(vc)return 9;if(ad)return 8;if(md)return 2;if(1<ac.length)return 4;const Qd=ac[0];if(!Yb&&!w.a.all(Na,ce=>ce.isSingle||!(ce.width%Qd.width)&&!(ce.height%Qd.height)))return 5;if((!this.khc||!Kb)&&ka.a.equals($a,Da,!0))for(const ce of sb)if(ce.Bd(Qd)&&!ce.equals(Qd))return 6}else if(ac&&
0<ac.length){if(0!==this.tgf(ac,ad))return 7;if(1<ac.length){if(!this.khc&&Kb)return 3;if((!this.khc||!Kb)&&ka.a.equals($a,Da,!0))for(const Qd of ac)if($a=sb[0],Qd.Bd($a)&&!Qd.equals($a))return 6}}return 0}tgf($a,ac){if(!$a||1>=$a.length)return 0;if(ac)return 2;if(!O.S($a))return 1;ac=new Vb.a(wb.a.Yj());for(const Da of $a)for(const Na of $a){const sb=Da.top===Na.top&&Da.bottom===Na.bottom,Kb=Da.left===Na.left&&Da.right===Na.right,Yb=Math.max(Da.left,Na.left)<Math.min(Da.right,Na.right);if(Math.max(Da.top,
Na.top)<Math.min(Da.bottom,Na.bottom)&&!sb||Yb&&!Kb)return 3;ac.add(`${Da.top}-${Da.bottom}-${Na.left}-${Na.right}`);ac.add(`${Na.top}-${Na.bottom}-${Da.left}-${Da.right}`)}for(const Da of $a)ac.remove(`${Da.top}-${Da.bottom}-${Da.left}-${Da.right}`);return 0<ac.count?3:0}laj($a){const ac=this.gridView.ha;ac.updateSelection($a,$a.topLeft,0);ac.selectionType=-1}wxb($a){if(null===$a||void 0===$a?0:$a.sourceItem){if(!C($a.sourceItem))return null;if(($a=$a.sourceItem)&&O.cb($a.ranges,!0))return $a}return null}Rhc($a,
ac){e.ULS.shipAssertTag(537167711,0,!!$a,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return ac&&lb.a.uG in ac||$a.tabName?!1:1===$a.method}static orj($a,ac,Da,Na,sb,Kb,Yb,vc,ad){const ld=$a.pa.ya.Wb(ad?{uca:!0,Dba:1}:{uca:!1,Dba:0});ad=new Ma.a(506,0,(md,Qd,ce)=>{$a.My();return Oa($a.pa.ya,Da,Na,sb,tb.b(md,Kb),tb.a(Qd,Yb),ce,null,ld,vc)},65,()=>new xa(Da,Na,sb));$a.userOperationManager.Ic(ad,ac)}static nec($a,ac,Da,Na,sb,Kb,Yb=null,vc,ad,ld){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${ac.id}`);ac.requestTelemetryData=$a.RequestTelemetryData;ac.serverRequestTimeInMs=ac.commandParameters.stopwatch.zc-sb;Va.a.ag($a.Errors)?Va.a.oha($a.Errors)?(ac&&(ac.encounteredDeploymentErrors=!0),$a=Va.a.sc($a.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${$a}`)):
($a=new eb.a(5,$a.Errors),null===ld||void 0===ld?void 0:ld($a),Na($a)):$a.Result?(Na=!!$a&&!!$a.RequestTelemetryData,X.h(Kb).ji.Vla(ac.commandParameters.stopwatch.id,$a.StateId,Na?$a.RequestTelemetryData.EcsOperationDuration:0,Na?$a.RequestTelemetryData.EcsRequestDuration:0,Na?$a.RequestTelemetryData.WfeRequestDuration:0),ac.pastedRange=$a.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${ac.id}`),
null===ad||void 0===ad?void 0:ad(),Da(!0),t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&vc&&(ac=ac.commandParameters.isDragDrop?9:6,(Kb=Kb.da.za(465))&&Kb.m1(ac,$a))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${ac.id}`),Da(Yb||!0))}static YPd($a,ac,Da,Na,sb,Kb,Yb,vc,ad,ld,md,Qd){const ce=$a.pa.ya.Wb(),ec=Cc.Och(Da,
Na,sb,ld,md,Qd);Da=new Ma.a(503,0,(Vc,td,he)=>{$a.My();return ua($a.pa.ya,ec,tb.b(Vc,Yb),tb.a(td,vc),he,Kb,ce,ad)},65,()=>new Jb(ec));$a.userOperationManager.Ic(Da,ac)}static Och($a,ac,Da,Na,sb,Kb){const Yb={};Yb.ShadowWorkbookBase64=$a.shadowWorkbookBase64;Yb.SourceRanges={};Yb.SourceRanges.Ranges=Array(1);Yb.SourceRanges.Ranges[0]={};Yb.SourceRanges.Ranges[0].FirstRow=$a.rangeRowStart;Yb.SourceRanges.Ranges[0].LastRow=$a.rangeRowEnd;Yb.SourceRanges.Ranges[0].FirstColumn=$a.rangeColumnStart;Yb.SourceRanges.Ranges[0].LastColumn=
$a.rangeColumnEnd;t.EwaSettings.getBooleanFeatureGate(oa.a.e6b,!1)?Da?Yb.DestinationRanges=O.u(Da.SheetName,Da.NamedObjectName,O.g(Da.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),Yb.DestinationRanges=null):Yb.DestinationRanges=ac?O.s(ac):null;Yb.CopyPasteTargetType=1;Yb.PasteType=Na;Yb.CopyOperationId=sb;Yb.PasteId=Kb;Yb.SourceClientPath=$a.sourceClientPath;Yb.SourceSheetName=$a.sourceSheetName;Yb.SourceWorkbookName=$a.sourceWorkbookName;
if(!$a.originalSourceRangesCountExceedsLimit&&$a.originalSourceRanges&&0<$a.originalSourceRanges.length&&1024===Na){Yb.OriginalSourceMultiRange={};ac=Array($a.originalSourceRanges.length);for(Da=0;Da<ac.length;++Da)ac[Da]={},ac[Da].FirstRow=$a.originalSourceRanges[Da][0],ac[Da].FirstColumn=$a.originalSourceRanges[Da][1],ac[Da].LastRow=$a.originalSourceRanges[Da][2],ac[Da].LastColumn=$a.originalSourceRanges[Da][3];Yb.OriginalSourceMultiRange.Ranges=ac}return Yb}static oVe($a,ac,Da){Da=Da.clone();Da.height<
ac&&(Da.bottom=Math.min(v.a.fh,Da.top+ac-1));Da.width<$a&&(Da.right=Math.min(v.a.qh,Da.left+$a-1));return Da}executeInsertCopiedCutCellsOperation($a,ac,Da,Na,sb,Kb=null,Yb=null){const vc={};vc.InsertDirection=Na;vc.SourceRange=$a;vc.DestRange=ac;vc.CopyCutOperation=Da?0:1;const ad=this.$.pa.ya,ld=this.$.pa.ya.Wb(),md=()=>new za(vc);return yb.a(this.$.userOperationManager,(Qd,ce,ec)=>this.Smi?V(ad,vc,Kb?tb.b(Qd,Kb):Qd,Yb?tb.a(ce,Yb):ce,ec,ld):Ya(ad,vc,Kb?tb.b(Qd,Kb):Qd,Yb?tb.a(ce,Yb):ce,ec,null),Qd=>
new Ma.a(104,0,Qd,void 0,md),sb)}$Me($a,ac,Da,Na,sb,Kb,Yb,vc){return new Promise((ad,ld)=>{this.executeInsertCopiedCutCellsOperation(ac,Da,Na,sb,Kb,md=>{$a.requestTelemetryData=md.RequestTelemetryData;if(md.Errors&&0<md.Errors.length){const Qd=new eb.a(21,md.Errors);null===vc||void 0===vc?void 0:vc(Qd);ld(new eb.a(21,md.Errors))}else null===Yb||void 0===Yb?void 0:Yb(),ad(!0)},md=>{md=Ha.a.Pe(md.data);md=new eb.a(21,md);null===vc||void 0===vc?void 0:vc(md);ld(md)})})}}Object(c.a)(Cc,"CopyPasteUtils",
null,[774]);var Sa=a(494),na;(function($a){$a[$a.range=0]="range";$a[$a.art=1]="art"})(na||(na={}));Object(c.b)("SourceItemType",na);var jb=a(24),Ib=a(91);class dc{constructor($a){this.iag={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.WNb={};this.eag={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,
["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.GYc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};
this.hag={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.cOd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.gag={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};this.Kka={};this.fag={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.Z3a=
{};this.jag={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,
["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Vr={};this.$=$a;this.Kka.notDefined="InputManager.InputMethod.NotDefined";this.Kka.unknown="InputManager.InputMethod.Unknown";this.Kka.keyboard="InputManager.InputMethod.Keyboard";this.Kka.mouse="InputManager.InputMethod.Mouse";this.Kka.touch="InputManager.InputMethod.Touch";this.Kka.crossSlide=
"InputManager.InputMethod.CrossSlide";this.Z3a.none="FrameMode.None";this.Z3a.reading="FrameMode.Reading";this.Z3a.edit="FrameMode.Edit";this.Vr.unknown="UILocation.Unknown";this.Vr.upperRibbon="UILocation.UpperRibbon";this.Vr.ribbon="UILocation.Ribbon";this.Vr.QAT="UILocation.QAT";this.Vr.jewel="UILocation.Jewel";this.Vr.navigationPane="UILocation.NavigationPane";this.Vr.keyboardShortcut="UILocation.KeyboardShortcut";this.Vr.statusBar="UILocation.StatusBar";this.Vr.dialog="UILocation.Dialog";this.Vr.floatie=
"UILocation.Floatie";this.Vr.notificationBar="UILocation.NotificationBar";this.Vr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Vr.taskPane="UILocation.TaskPane";this.Vr.heroDock="UILocation.HeroDock";this.Vr.singleLineRibbon="UILocation.SingleLineRibbon";this.Vr.multilineRibbon="UILocation.MultilineRibbon";this.Vr.overflow="UILocation.Overflow";this.Vr.tellMe="UILocation.TellMe";this.Vr.farPeripheralControls="UILocation.FarPeripheralControls";this.Vr.header="UILocation.Header";this.Vr.fileMenu=
"UILocation.FileMenu";this.Vr.contextMenu="UILocation.ContextMenu";this.Vr.dialogMenu="UILocation.DialogMenu";this.Vr.toolbar="UILocation.Toolbar";this.Vr.canvas="UILocation.Canvas";this.WNb.range="SourceItemType.Range";this.WNb.art="SourceItemType.Art"}serializeSourceItem($a){const ac={};if($a&&Object.getType($a)===G)ac.sheetName=$a.sheetName,ac.topArray=w.a.map($a.ranges,Da=>Da.top),ac.leftArray=w.a.map($a.ranges,Da=>Da.left),ac.bottomArray=w.a.map($a.ranges,Da=>Da.bottom),ac.rightArray=w.a.map($a.ranges,
Da=>Da.right),ac.sessionStateId=$a.sessionStateId,ac.sessionId=$a.sessionId,ac.sourceItemType=this.b1f(0);else if($a&&Object.getType($a)===L)ac.activeFloatingObjectControlId=$a.activeFloatingObjectControlId,ac.sheetName=$a.sheetName,ac.sessionStateId=$a.sessionStateId,ac.sessionId=$a.sessionId,ac.floatingObjectType=this.Qrj($a.type),ac.sourceItemType=this.b1f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;
return JSON.stringify(ac)}serializeCommandParameters($a){if(!$a)return e.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const ac={};ac.id=$a.id;ac.commandType=$a.commandType;ac.copyPasteTargetType=$a.copyPasteTargetType;$a.ribbonCommandInfo&&(ac.ribbonCommandName=this.Zrj($a.ribbonCommandInfo.command),ac.inputMethodName=this.Trj($a.ribbonCommandInfo.method),ac.frameModeName=this.Rrj($a.ribbonCommandInfo.mode),ac.uiLocationName=
this.csj($a.ribbonCommandInfo.$e),ac.tabName=$a.ribbonCommandInfo.tabName);return JSON.stringify(ac)}deserializeSourceItem($a){if(!$a)return null;try{const ac=JSON.parse($a);if(!ac)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let Da=null;switch(this.jjh(ac.sourceItemType)){case 0:Da=new G(this.$,this.gjh(ac),ac.sheetName,ac.sessionStateId,ac.sessionId);break;case 1:Da=new L(ac.activeFloatingObjectControlId,ac.sheetName,
ac.sessionStateId,ac.sessionId,this.djh(ac.floatingObjectType))}return Da}catch(ac){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${$a?$a.length:0}, errror: ${ac}`),null}}deserializeCommandParameters($a){if(!$a)return null;try{const ac=JSON.parse($a);if(!ac)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;
const Da=ha.a();Da.id=ac.id;Da.ribbonCommandInfo=this.ijh(ac);Da.commandType=ac.commandType;Da.copyPasteTargetType=ac.copyPasteTargetType;return Da}catch(ac){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${$a?$a.length:0}, errror: ${ac}`),null}}gjh($a){const ac=[];e.ULS.shipAssertTag(537167699,0,!!$a.topArray&&0<$a.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${$a.topArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!$a.leftArray&&0<$a.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${$a.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!$a.bottomArray&&0<$a.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${$a.bottomArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!$a.rightArray&&0<$a.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${$a.rightArray?
"empty":"null"}.`);if(!($a.topArray&&$a.leftArray&&$a.bottomArray&&$a.rightArray))return ac;e.ULS.shipAssertTag(537167695,0,$a.topArray.length===$a.bottomArray.length&&$a.topArray.length===$a.leftArray.length&&$a.topArray.length===$a.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${$a.topArray.length}), BottomArray(${$a.bottomArray.length}), LeftArray(${$a.leftArray.length}), RightArray(${$a.rightArray.length}) should be the same.`);const Da=Math.min($a.topArray.length,
$a.bottomArray.length,$a.leftArray.length,$a.rightArray.length);for(let Na=0;Na<Da;Na++)ac.push(new jb.Range($a.topArray[Na],$a.leftArray[Na],$a.bottomArray[Na],$a.rightArray[Na],!1,!1));return ac}ijh($a){return new Ib.a(this.hjh($a.ribbonCommandName),this.fjh($a.inputMethodName),this.ejh($a.frameModeName),this.ljh($a.uiLocationName),$a.tabName)}Zrj($a){return void 0!==$a&&null!==$a&&$a.toString()in this.cOd?this.cOd[$a.toString()]:(e.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${$a}`),
this.cOd["-911352779"])}hjh($a){return $a&&$a in this.hag?this.hag[$a]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${$a}`),-911352779)}Trj($a){return void 0!==$a&&null!==$a&&m.a[$a]in this.Kka?this.Kka[m.a[$a]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${$a}`),this.Kka.unknown)}fjh($a){return $a&&
$a in this.gag?this.gag[$a]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${$a}`),0)}Rrj($a){return void 0!==$a&&null!==$a&&Sa.a[$a]in this.Z3a?this.Z3a[Sa.a[$a]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${$a}`),this.Z3a.edit)}ejh($a){return $a&&$a in this.fag?this.fag[$a]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${$a}`),
2)}b1f($a){return void 0!==$a&&null!==$a&&na[$a]in this.WNb?this.WNb[na[$a]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${$a}`),this.WNb.range)}jjh($a){return $a&&$a in this.iag?this.iag[$a]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${$a}`),0)}Qrj($a){return void 0!==$a&&null!==$a&&$a.toString()in this.GYc?this.GYc[$a.toString()]:(e.ULS.shipAssertTag(537167686,
0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${$a}`),this.GYc["99"])}djh($a){return $a&&$a in this.eag?this.eag[$a]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${$a}`),99)}csj($a){return void 0!==$a&&null!==$a&&n.a[$a]in this.Vr?this.Vr[n.a[$a]]:(e.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${$a}`),this.Vr.ribbon)}ljh($a){return $a&&
$a in this.jag?this.jag[$a]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${$a}`),2)}}Object(c.a)(dc,"EnvironmentSerializationHelper",null,[]);class ob{}ob.uZf="SameSession";ob.SIe="CrossSession";ob.Fof="LegacyCrossSession";ob.external="External";Object(c.a)(ob,"PayloadOrigin",null,[]);const Fa=$a=>$a?$a.shadowWorkbookSizeExceedsLimit&&void 0!==$a.shadowWorkbookBlockedSize&&null!==$a.shadowWorkbookBlockedSize?$a.shadowWorkbookBlockedSize:
$a.shadowWorkbookBase64?$a.shadowWorkbookBase64.length:0:0,Ab=$a=>$a.shadowWorkbookSizeExceedsLimit?!0:Fa($a)>v.a.qmc;class $b{constructor($a,ac){this._name=ac;this.$=$a;this.hm=A.a.instance;this.$p=new Cc($a,X.h($a))}get name(){return this._name}get JYc(){return this.hm.Ua(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}hSj($a){let ac;ac=null;try{const Da=$a.getItem(I.shadowWorkbook);if(!Da)return{returnValue:!1,V0:ac};ac=JSON.parse(Da);
return{returnValue:this.Nsi(ac),V0:ac}}catch(Da){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+Da),{returnValue:!1,V0:ac}}}Nsi($a){return!!$a&&(!!$a.shadowWorkbookBase64||$a.shadowWorkbookSizeExceedsLimit)&&void 0!==$a.rangeRowStart&&void 0!==$a.rangeRowEnd&&void 0!==$a.rangeColumnStart&&void 0!==$a.rangeColumnEnd}$qc($a){$a.wasLastCopyExternal=!0;if(t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.Ez&&516!==$a.commandParameters.commandType&&1028!==$a.commandParameters.commandType){var ac=null;if(({V0:ac}=this.hSj($a.clipboardItems)).returnValue)return $a.isShadowWorkbookParsedSuccessfully=!0,this.x0i($a,ac)}if(516!==$a.commandParameters.commandType&&36!==$a.commandParameters.commandType){if(t.EwaSettings.ma(160)&&20!==$a.commandParameters.commandType&&(null===this.$.shortcutKeyManager||this.$.shortcutKeyManager.ohc)&&(ac=$a.clipboardItems.getItem(I.html),void 0!==ac&&null!==ac&&ac&&
ac.trim()!==this.JYc&&(ac.startsWith("<")||h.a.If&&ac.startsWith("\n<")))){const Da=$a.clipboardItems.getItem(I.esb);return this.v0i($a,ac,void 0===Da?null:Da)}return this.BKf($a)}return Promise.reject(new eb.a(6))}x0i($a,ac){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");$a.pasteResult="SystemClipboardShadowWorkbookPaste";$a.payloadType=K.shadowWorkbook;$a.payloadOrigin=ob.external;$a.shadowWorkbookPayloadSize=
Fa(ac);$a.shadowWorkbookSizeExceedsLimit=Ab(ac);let Da=null,Na=null;const sb=$a.commandParameters.originalDestinations;t.EwaSettings.getBooleanFeatureGate(oa.a.e6b,!1)?Da=O.r(sb,this.$):Na=O.v(O.K(sb),this.$);ac.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&($a.originalSourceRangesCountExceedsLimit=ac.originalSourceRangesCountExceedsLimit);if($a.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${$a.shadowWorkbookPayloadSize}) is over the limit(${v.a.qmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${ac.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new eb.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${$a.commandParameters.id}`);return this.$p.FKf($a.commandParameters.ribbonCommandInfo,Na,Da,ac,[$a.commandParameters.stopwatch],$a)}BKf($a){var ac=$a.clipboardItems.getItem(I.plainText);if(void 0!==ac&&null!==ac&&ac.trim()===this.JYc)return Promise.reject(new eb.a(7));void 0!==ac&&null!==ac&&($a.plainTextPayloadSize=ac.length);$a.isPlainTextPaste=
!0;$a.pasteResult="SystemClipboardPaste";$a.payloadOrigin=U($a)?ob.Fof:ob.external;$a.payloadType=K.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${$a.id}, PasteOperationId=${$a.commandParameters.id}`);ac=this.$p.D5i(O.K($a.commandParameters.originalDestinations),ac,$a.commandParameters.ribbonCommandInfo,[$a.commandParameters.stopwatch],$a);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${$a.id}`);
return ac}v0i($a,ac,Da){$a.htmlPayloadSize=ac.length;$a.isHtmlPaste=!0;$a.pasteResult="SystemClipboardHtmlPaste";$a.payloadType=K.html;$a.payloadOrigin=U($a)?ob.Fof:ob.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${$a.commandParameters.id}`);return this.$p.C5i(O.K($a.commandParameters.originalDestinations),ac,Da,$a.commandParameters.id,$a.commandParameters.ribbonCommandInfo,[$a.commandParameters.stopwatch],$a)}qIe($a){const ac=
{};$a&&(ac.shadowWorkbookBase64=$a.ShadowWorkbookBase64,ac.shadowWorkbookSizeExceedsLimit=$a.ShadowWorkbookSizeExceedsLimit,ac.originalSourceRangesCountExceedsLimit=$a.OriginalSourceRangesCountExceedsLimit,ac.originalSourceRangesCount=$a.OriginalSourceRangesCount,ac.shadowWorkbookBlockedSize=$a.ShadowWorkbookBlockedSize);return ac}Mjg($a,ac){const Da=M($a),Na=32===($a.commandParameters.commandType&32),sb=1024===($a.commandParameters.commandType&1024);let Kb=!1,Yb=null,vc=null,ad=!1;if(!Da){Kb=-1985798686===
$a.commandParameters.ribbonCommandInfo.command;var ld=$a.copyContextSnapshot;if(ac)ad=!ld.sourceItem.isFromCurrentSession(this.$);else if(ld=this.$p.wxb(ld))Yb=ld.ranges,vc=ld.sheetName,ad=!$a.isSameSession}return this.$p.AQg(vc,Yb,this.$.oa.sheetName,$a.commandParameters.originalDestinations,$a.commandParameters.expandDestinations,ad,Na,sb,Kb,ac,Da)}}Object(c.a)($b,"BaseCopyPasteHandler",null,[832,833,834]);class Cb{constructor($a){this.clipboardItems=this.key=null;this.M$=$a}qwa($a){return this.key&&
this.key.isEqual($a)?this.createClipboardItems(this.clipboardItems):null}setValue($a,ac){this.key=$a;this.clipboardItems=this.createClipboardItems(ac)}createClipboardItems($a){const ac=this.M$.create();var Da=$a.getItem(I.plainText);Da&&ac.setItem(I.plainText,Da);(Da=$a.getItem(I.shadowWorkbook))&&ac.setItem(I.shadowWorkbook,Da);($a=$a.getItem(I.html))&&ac.setItem(I.html,$a);return ac}}Object(c.a)(Cb,"CopyCache",null,[]);var Rb=a(67);class uc extends $b{constructor($a,ac,Da,Na,sb=null){super($a,Na);
this.R8g=ac;this.M$=Da;this.u4c=sb||new Cb(this.M$);this.gridView=X.h($a);this.ha=this.gridView.ha;this.clipboardRangeFactory=$a.da.za(169)}getSourceItem(){const $a=t.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?O.d(this.gridView.ha.ra.selectedRanges):w.a.clone(this.gridView.ha.ra.selectedRanges);return new G(this.$,$a,this.$.ea.oa.sheetName,this.$.ea.ze,this.$.va.UserSessionId)}beforeSerialize($a){$a.isSelectionAllowed=!1;$a.isAsyncCopy=!1;$a.isFromCache=!1;$a.encounteredDeploymentErrors=
!1;$a.plainTextPayloadSize=0;$a.shadowWorkbookPayloadSize=0;$a.htmlPayloadSize=0;$a.clientSideCopyTime=0;const ac=new fa.a(this.$.xa),Da=$a.sourceItem;$a.isSelectionAllowed=w.a.all(Da.ranges,Na=>this.isSelectionAllowed(ac,Na));$a.isSelectionAllowed&&this.$p.mbf(Da.ranges,$a.commandParameters.commandType)}wNa($a){return this.gridView.Ea.h5()&&X.j(this.gridView,$a)}V0i($a,ac,Da,Na){let sb=!1,Kb=1===ac.commandParameters.commandType,Yb=Na[0].qH;1===Da.ranges.length&&1===Na.length?t.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&
Kb&&1!==Yb&&Yb!==Da.ranges[0].qH?$a.cseStatus=17:sb=this.R8g.s8c($a,O.K(Da.ranges),Da.sheetName,O.K($a.commandParameters.expandDestinations),this.$.ea.oa.sheetName,Kb):$a.cseStatus=5;sb&&X.h(this.$).ji.uS($a.commandParameters.stopwatch.id,Rb.BasicTelemetryCalculator.$Q);return this.E0i($a,Da,O.u(this.$.oa.sheetName,null,Na),ac.commandParameters.commandType,sb)}isSelectionAllowed($a,ac){return $a.CBb(ac,this.gridView)}E0i($a,ac,Da,Na,sb){ac=O.u(ac.sheetName,null,ac.ranges);$a.pasteResult="SameSessionPaste";
$a.payloadOrigin=ob.uZf;$a.payloadType=K.aFg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${$a.commandParameters.id}`);return this.$p.pasteRange($a.commandParameters.ribbonCommandInfo,ac,Da,Na,$a.commandParameters.commandType,[$a.commandParameters.stopwatch],$a,sb,null,null)}}Object(c.a)(uc,"BaseRangeCopyPasteHandler",$b,[]);var nb=a(35);class Fb{constructor($a){this.zU=new nb.a(!0);this.$=$a}onDeferredPasteStarted($a){this.zU.mb($a.id)||
this.zU.add($a.id,!0);if(0<this.zU.count){const ac=ba.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Ka.TaskExtensions.Aa(ac,()=>{ac.result.ng(28,null)},this.$.la,3)}}onDeferredPasteCompleted($a){const ac=0<this.zU.count;this.zU.mb($a.id)&&this.zU.remove($a.id);if(ac&&!this.zU.count){const Da=ba.GetServiceTaskFactory.Oa(this.$.da,5,4,0);Ka.TaskExtensions.Aa(Da,()=>{Da.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Fb,"DeferredPasteTracker",null,[]);var Jc;(function($a){$a[$a.none=0]="none";$a[$a.loadClipboardFromServerFailed=
1]="loadClipboardFromServerFailed";$a[$a.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";$a[$a.asyncCopyCanceled=3]="asyncCopyCanceled";$a[$a.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Jc||(Jc={}));Object(c.b)("CopyErrorType",Jc);var Fc=a(922),zb=a(1113);class hb extends Fc.a{constructor($a,ac=null){super(Jc[$a]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=$a;this.ewaErrors=ac;if(null===ac||void 0===ac?0:ac.length)this.innerError=
new zb.a(ac,null)}}Object(c.a)(hb,"CopyInnerError",Fc.a,[]);class Pb extends uc{constructor($a,ac,Da,Na=null){super($a,ac,Da,"AcrossSessionRangeCopyPasteHandler",Na);this.zU=new Fb($a)}serialize($a){const ac=$a.sourceItem,Da={};let Na=this.u4c.qwa(ac);if(Na)Da.synchronousResult=Na,$a.isFromCache=!0,$a.clientSideCopyTime=$a.commandParameters.stopwatch.zc;else{let Kb=null;var sb=O.F(ac.ranges);if(!va.a.hif()&&this.wNa(sb)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");
sb=this.clipboardRangeFactory.create(sb);try{Kb=sb.toString(),Na=this.M$.create(),Na.setItem(I.plainText,Kb),this.u4c.setValue(ac,Na),Da.synchronousResult=Na,$a.clientSideCopyTime=$a.commandParameters.stopwatch.zc}finally{sb&&sb.dispose()}}else $a.isAsyncCopy=!0,Da.synchronousResult=this.M$.create(),Da.synchronousResult.setItem(I.plainText,this.JYc);Da.asynchronousResult=this.hfd($a,ac,Kb)}$a.syncClipboardItemsKeys=ra(Da.synchronousResult);return Da}shouldWaitForCopyToComplete($a){if(!$a||!$a.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,
0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;e.ULS.shipAssertTag(537167906,0,!!this.$.va,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if($a.copyContextSnapshot.sessionId===this.$.va.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),
!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted($a){this.zU.onDeferredPasteStarted($a)}onDeferredPasteCompleted($a){this.zU.onDeferredPasteCompleted($a)}deserialize($a){$a.isClipboardDataContainShadowWorkbook=!(void 0===$a.clipboardItems.getItem(I.shadowWorkbook)||null===$a.clipboardItems.getItem(I.shadowWorkbook));if(X.h(this.$).ha.Oe&326)return M($a)&&($a.wasLastCopyExternal=!0),Promise.reject(new eb.a(17));
var ac=this.Mjg($a,!1);if(0!==ac)return Promise.reject(new eb.a(M($a)?18:$a.isSameSession?19:20,void 0,void 0,void 0,ac));var Da=$a.copyContextSnapshot,Na=this.$p.wxb(Da);if(M($a))return this.$qc($a);ac=$a.commandParameters.originalDestinations;if(Na&&$a.isSameSession)return this.V0i($a,Da,Na,ac);if(516!==$a.commandParameters.commandType){if(({V0:Da}=this.gSj($a.clipboardItems)).returnValue){$a.isShadowWorkbookParsedSuccessfully=!0;let sb=Na=null;t.EwaSettings.getBooleanFeatureGate(oa.a.e6b,!1)?Na=
O.r(ac,this.$):sb=O.v(O.K(ac),this.$);return this.t0i($a,sb,Na,Da)}if($a.isClipboardInaccessible)return Promise.reject(new eb.a(8));if(36!==$a.commandParameters.commandType)return this.BKf($a)}return Promise.reject(new eb.a(6))}beforePaste($a){this.$.da.za(373).Uoj($a);$a.indicationDisplayScheduled=!0}zRj($a){let ac;if(!($a&&$a.SourceRanges&&$a.SourceRanges.Ranges&&$a.SourceRanges.Ranges.length&&($a.OriginalSourceRangesCountExceedsLimit||$a.OriginalSourceMultiRange&&$a.OriginalSourceMultiRange.Ranges&&
$a.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,V0:null};var Da=$a.SourceRanges.Ranges[0];if(!$a.ShadowWorkbookBase64&&!$a.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,V0:null};ac=this.qIe($a);ac.rangeRowStart=Da.FirstRow;ac.rangeRowEnd=Da.LastRow;ac.rangeColumnStart=Da.FirstColumn;ac.rangeColumnEnd=Da.LastColumn;ac.sourceClientPath=$a.SourceClientPath;ac.sourceSheetName=$a.SourceSheetName;ac.sourceWorkbookName=$a.SourceWorkbookName;if(!$a.OriginalSourceRangesCountExceedsLimit)for($a=
$a.OriginalSourceMultiRange.Ranges,ac.originalSourceRanges=Array($a.length),Da=0;Da<$a.length;++Da)ac.originalSourceRanges[Da]=[$a[Da].FirstRow,$a[Da].FirstColumn,$a[Da].LastRow,$a[Da].LastColumn];return{returnValue:!0,V0:ac}}gSj($a){let ac;ac=null;$a=$a.getItem(I.shadowWorkbook);if(!$a)return{returnValue:!1,V0:ac};ac=JSON.parse($a);return{returnValue:this.Msi(ac),V0:ac}}Msi($a){return!!$a&&(!!$a.shadowWorkbookBase64||$a.shadowWorkbookSizeExceedsLimit)&&void 0!==$a.rangeRowStart&&void 0!==$a.rangeRowEnd&&
void 0!==$a.rangeColumnStart&&void 0!==$a.rangeColumnEnd}t0i($a,ac,Da,Na){e.ULS.shipAssertTag(537167903,0,!!Na,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");y.AFrameworkApplication.MN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");$a.pasteResult="CrossSessionPaste";$a.payloadOrigin=ob.SIe;$a.payloadType=K.shadowWorkbook;$a.shadowWorkbookPayloadSize=Fa(Na);$a.shadowWorkbookSizeExceedsLimit=Ab(Na);Na.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&
($a.originalSourceRangesCountExceedsLimit=Na.originalSourceRangesCountExceedsLimit);if($a.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${$a.shadowWorkbookPayloadSize}) is over the limit(${v.a.qmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Na.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new eb.a(1));if(1028===$a.commandParameters.commandType&&$a.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,
0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Na.originalSourceRangesCount}) is over the limit(${v.a.mDi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Na.originalSourceRangesCountExceedsLimit}`),Promise.reject(new eb.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${$a.commandParameters.id}`);return this.$p.FKf($a.commandParameters.ribbonCommandInfo,
ac,Da,Na,[$a.commandParameters.stopwatch],$a)}hfd($a,ac,Da){e.ULS.shipAssertTag(537167901,0,!!$a,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Na=$a.commandParameters.stopwatch.zc;return new Promise((sb,Kb)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${$a.id}`);const Yb=O.u(ac.sheetName,null,ac.ranges);this.$p.copy(Yb,$a.commandParameters,
vc=>{$a.requestTelemetryData=vc.RequestTelemetryData;$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Na;if(Va.a.ag(vc.Errors))if(Va.a.oha(vc.Errors))$a.encounteredDeploymentErrors=!0,vc=Va.a.sc(vc.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${vc}. copy Id: ${$a.id}`);else{var ad=Va.a.sc(vc.Errors);e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${ad}. copy Id: ${$a.id}`);
Kb(new hb(2,vc.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${$a.id}`),$a.markForCancellation)Kb(new hb(3,vc.Errors));else{ad=vc.Result;var ld=ad.PlainTextResult;void 0!==Da&&null!==Da&&(ld=Da);void 0!==ld&&null!==ld&&($a.plainTextPayloadSize=ld.length);var md=this.M$.create();if(({V0:Qd}=this.zRj(ad)).returnValue){$a.shadowWorkbookPayloadSize=Fa(Qd);$a.shadowWorkbookSizeExceedsLimit=Ab(Qd);
$a.originalSourceRangesCountExceedsLimit=ad.OriginalSourceRangesCountExceedsLimit;var Qd=JSON.stringify(Qd);md.setItem(I.shadowWorkbook,Qd)}md.setItem(I.plainText,ld);va.a.hif()&&(ld=ad.HtmlResult,$a.htmlSizeExceedsLimit=ad.HtmlSizeExceedsLimit,void 0!==ld&&null!==ld&&($a.htmlPayloadSize=ld.length),md.setItem(I.html,ld));$a.copyTotalSizeExceedsLimit=ad.CopyTotalSizeExceedsLimit;md.setItem(I.esb,$a.commandParameters.id);this.u4c.setValue(ac,md);$a.asyncClipboardItemsKeys=ra(md);sb(md);t.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",
!1)&&(ad=1===$a.commandParameters.commandType?8:7,(md=this.$.da.za(465))&&md.m1(ad,vc))}},vc=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Na;vc=Ha.a.Pe(vc.data);const ad=Va.a.sc(vc);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${ad}. copy Id: ${$a.id}`);Kb(new hb(2,vc))},[$a.commandParameters.stopwatch])})}}Object(c.a)(Pb,"AcrossSessionRangeCopyPasteHandler",uc,[]);class ud{constructor($a,ac,
Da,Na,sb,Kb=null,Yb=null){this.floatingObjectId=$a;this.commandParameters=ac;this.Wt=Da;this.lgh=Na;this.Eaa=Kb;this.wQb=Yb;this.H8g=sb}}Object(c.a)(ud,"CopyArtRequest",null,[]);class Ub{constructor($a,ac,Da,Na,sb,Kb,Yb,vc,ad){this.promise=null;this.ribbonCommandInfo=$a;this.destination=ac;this.PKe=Da;this.wQb=sb;this.V0=Kb;this.item=Yb;this.pasteContext=vc;this.FOa=Da||ac.FirstRow+"_"+ac.FirstColumn;this.Cif=!0;this.ACe=ad}}Object(c.a)(Ub,"PasteArtRequest",null,[]);class Ac{constructor($a,ac){this.tKb=
new Za.a;this.r_a=$a;this.$=ac;this.d6i=Da=>Promise.resolve(Da);this.nGb=Da=>Promise.reject(Da)}Q7h($a){if(this.yoi($a.FOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${$a.FOa}`);const ac=this.tKb.na($a.FOa);this.tKb.ia($a.FOa,$a);const Da=ac.promise;ac.Cif=!1;return this.bqh($a,Da)}this.tKb.ia($a.FOa,$a);return this.Hvi($a)}yoi($a){return this.tKb.mb($a)}Hvi($a){return new Promise((ac,Da)=>{$a.promise=
this.r_a.AKf($a).then(Na=>{ac(null);return this.Apc($a,Na)},Na=>{Da(null);return this.nGb(Na)})})}bqh($a,ac){return new Promise((Da,Na)=>{$a.promise=ac.then(sb=>{this.vXj($a,sb);return this.r_a.AKf($a).then(Kb=>{Da(null);return this.Apc($a,Kb)},Kb=>{Na(null);return this.nGb(Kb)})},sb=>this.nGb(sb))})}Apc($a,ac){$a.Cif&&(this.r2g($a.FOa),this.APd($a,ac));return this.d6i(ac)}r2g($a){this.tKb.remove($a)}APd($a,ac){const Da=this.a0h();$a.FOa===Da&&this.r_a.APd($a.destination,ac,$a.item.type)}a0h(){var $a=
X.h(this.$).ha.Sa.activeFloatingObjectControlId;$a||($a=O.v(X.h(this.$).ha.ra.activeCell,this.$),$a=$a.FirstRow+"_"+$a.FirstColumn);return $a}vXj($a,ac){$a.destination=null;$a.PKe=ac}}Object(c.a)(Ac,"PasteArtRequestManager",null,[]);var Ic=a(199),dd=a(122),Ud=a(103);class Hd extends $b{constructor($a,ac,Da,Na,sb=null){super($a,"ArtCopyPasteHandler");this.m3g="XLO";this.n3g="3";this.zU=new Fb($a);this.M$=ac;this.r_a=Da;this.ha=X.h($a).ha;this.t4c=sb||new Cb(this.M$);this.u0i=new Ac(Da,$a);this.qpb=
Na}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Sa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Sa.activeFloatingObjectControlId}]`);return new L(this.ha.Sa.activeFloatingObjectControlId,this.$.ea.oa.sheetName,this.$.ea.ze,this.$.va.UserSessionId,this.ha.Sa.$b.floatingObject.type)}beforeSerialize($a){$a&&$a.commandParameters?
($a?($a.isAsyncCopy=!1,$a.isSelectionAllowed=!1,$a.isFromCache=!1,$a.plainTextPayloadSize=0,$a.shadowWorkbookPayloadSize=0,$a.htmlPayloadSize=0,$a.htmlSizeExceedsLimit=!1,$a.clientSideCopyTime=0,$a.encounteredDeploymentErrors=!1,$a.shadowWorkbookSizeExceedsLimit=!1,$a.originalSourceRangesCountExceedsLimit=!1,$a.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),$a.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,
0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize($a){const ac=$a.sourceItem,Da={};if(!ac)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),Da;if(!this.yri())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),Da;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${ac.activeFloatingObjectControlId}]`);
this.BGd();let Na=this.t4c.qwa(ac);if(Na)Da.synchronousResult=Na,$a.isFromCache=!0,$a.isAsyncCopy=!1,$a.clientSideCopyTime=$a.commandParameters.stopwatch.zc,1===$a.commandParameters.commandType&&this.$.Xc(2045211913,$a.commandParameters.ribbonCommandInfo.method,$a.commandParameters.ribbonCommandInfo.$e,null);else{$a.isFromCache=!1;$a.isAsyncCopy=!0;Na=this.M$.create();if($a.commandParameters.uploadToClipService){const sb={};sb["data-clipservice-ccpid"]=$a.commandParameters.id;sb["data-pkey"]=$a.commandParameters.pKey;
sb["data-clipservice-type"]=$a.commandParameters.clipServiceDataType;sb["data-clipservice-count"]=$a.commandParameters.objectCount.toString();sb["data-clipservice-dc"]=$a.commandParameters.clipServiceDataCenter;sb["data-clipservice-client"]=this.m3g;sb["data-TimeStamp"]=(new Date).toUTCString();sb["data-clipservice-version"]=this.n3g;Na.setItem(I.qNg,JSON.stringify(sb))}Da.synchronousResult=this.LGg(Na);Da.asynchronousResult=this.hfd($a,ac,Na)}$a.syncClipboardItemsKeys=ra(Da.synchronousResult);return Da}LGg($a){e.ULS.shipAssertTag(537167891,
0,!!this.ha.Sa.$b,"Expecting a floating object to be currently selected for copy");$a||($a=this.M$.create());const ac=this.ha.Sa.$b.Yvb();ac&&$a.setItem(I.html,`<img src='${ac}'>`);return $a}BGd(){const $a=this.ha.Sa.$b;this.qpb.BGd(dd.a.srb($a.floatingObject),dd.a.p3g($a.xu))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted($a){this.zU.onDeferredPasteStarted($a)}onDeferredPasteCompleted($a){this.zU.onDeferredPasteCompleted($a)}deserialize($a){var ac=
M($a),Da=null;let Na=null;var sb=!1;if(!ac){Da=$a.copyContextSnapshot;Na=Da.sourceItem;if(!Na)return Promise.reject(new eb.a(10));sb=Na.isFromCurrentSession(this.$)}var Kb=this.Mjg($a,!0);if(0!==Kb)return Promise.reject(new eb.a(ac?18:sb?19:20,void 0,void 0,void 0,Kb));if(ac)return this.$qc($a);if(!sb&&!Hd.iki(Na))return $a=`User attempted to paste art of type [${Na.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,$a),Promise.reject(new eb.a(11,void 0,void 0,$a));if(Da.isAsyncSerializeFailed)return Promise.reject(new eb.a(16,
void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let Yb;try{const vc=$a.clipboardItems.getItem(I.shadowWorkbook);Yb=JSON.parse(vc)}catch(vc){return $a=copyPasteInfra.getStringifiedError(vc),e.ULS.sendTraceTag(537167888,0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${$a}`),Promise.reject(new eb.a(12,void 0,vc))}Yb.floatingObjectId!==Na.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Na.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Yb.floatingObjectId}]`):
e.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Na.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Yb.floatingObjectId}]`);if(!Yb||!Yb.shadowWorkbookBase64)return Promise.reject(new eb.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!Yb}`));$a.isShadowWorkbookParsedSuccessfully=!0;$a.shadowWorkbookPayloadSize=Fa(Yb);$a.shadowWorkbookSizeExceedsLimit=Ab(Yb);$a.payloadOrigin=sb?ob.uZf:
ob.SIe;$a.payloadType=K.wng;if(Ab(Yb))return $a=`Shadow workbook size [${$a.shadowWorkbookPayloadSize}] is over the limit [${v.a.qmc}]. ShadowWorkbookSizeExceedsLimit: ${Yb.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,0,15,`ArtCopyPasteHandler.Deserialize: ${$a}`),Promise.reject(new eb.a(1,void 0,void 0,$a));Da=ac=null;X.h(this.$).ha.Oe&326?Da=X.h(this.$).ha.Sa.activeFloatingObjectControlId:ac=this.$.oa&&this.$.oa.activeCell?O.v(this.$.oa.activeCell,this.$):O.v(O.K($a.commandParameters.originalDestinations),
this.$);sb=null;if(this.qpb.q6f(Na))try{sb=this.qpb.s8c()}catch(vc){Kb=copyPasteInfra.getStringifiedError(vc),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${Kb}`)}return this.u0i.Q7h(new Ub($a.commandParameters.ribbonCommandInfo,ac,Da,$a.commandParameters.commandType,[$a.commandParameters.stopwatch],Yb,Na,$a,sb))}$qc($a){$a.wasLastCopyExternal=!0;if($a.clipboardItems.getItem("image/png")){const ac=$a.commandParameters.stopwatch.zc;
$a.payloadType=K.wTg;return mb.b(this.$.Xc(1403967063,$a.commandParameters.ribbonCommandInfo.method,$a.commandParameters.ribbonCommandInfo.$e,{["dataUrl"]:$a.clipboardItems.getItem("image/png")})).then(Da=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-ac;return Da?Promise.resolve(null):Promise.reject(new eb.a(15))},()=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-ac;return Promise.reject(new eb.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");
return super.$qc($a)}yri(){const $a=X.h(this.$).ha;return $a.Sa.activeFloatingObjectControlId&&$a.Sa.$b&&$a.Sa.$b.floatingObject?$a.Sa.$b.floatingObject.kXd():!1}hfd($a,ac,Da){return new Promise((Na,sb)=>{const Kb=$a.commandParameters.stopwatch.zc;e.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.r_a.J8g(new ud(ac.activeFloatingObjectControlId,$a.commandParameters,Yb=>{$a.requestTelemetryData=Yb.RequestTelemetryData;
$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Kb;if(Va.a.ag(Yb.Errors))if(Va.a.oha(Yb.Errors))$a.encounteredDeploymentErrors=!0,Yb=Va.a.sc(Yb.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Yb}`);else{var vc=Va.a.sc(Yb.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${vc}`);sb(new hb(4,
Yb.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${ac.activeFloatingObjectControlId}].`),$a.markForCancellation)sb(new hb(3,Yb.Errors));else{if(Va.a.Nq(Yb.Errors)){var ad=Va.a.sc(Yb.Errors);e.ULS.sendTraceTag(537167882,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${ad}`)}if(ad=Yb.Result){ad=this.qIe(ad);ad.floatingObjectId=ac.activeFloatingObjectControlId;
$a.shadowWorkbookPayloadSize=Fa(ad);$a.shadowWorkbookSizeExceedsLimit=Ab(ad);try{vc=JSON.stringify(ad)}catch(ld){sb(new eb.a(14,void 0,ld,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${$a.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${ad.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,0,!!Da,"Expecting syncClipboardItems to be defined");Da.setItem(I.shadowWorkbook,vc);1===$a.commandParameters.commandType&&(this.S3i(ac.type,ac.activeFloatingObjectControlId,
Yb.StateId),this.deleteFloatingObject(ac.activeFloatingObjectControlId,ac.type));this.t4c.setValue(ac,Da);$a.asyncClipboardItemsKeys=ra(Da);Na(Da)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${ac.activeFloatingObjectControlId}`),Na(this.t4c.qwa(ac))}},$a.commandParameters.commandType,ac.type,Yb=>{$a.serverRequestTimeInMs=$a.commandParameters.stopwatch.zc-Kb;Yb=Ha.a.Pe(Yb.data);1===$a.commandParameters.commandType&&
this.r_a.hTj(ac.type,ac.activeFloatingObjectControlId);const vc=Va.a.sc(Yb);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${vc}`);sb(new hb(4,Yb))},[$a.commandParameters.stopwatch]))})}deleteFloatingObject($a,ac){$a=Ic.a.xz(ac,$a);if($a=Ud.a(this.$).Sq($a))Ud.a(this.$).deleteFloatingObject($a,14,!0),X.h(this.$).ha.Sa.bB=null}S3i($a,ac,Da){const Na=this.$.da.za(277);if(Na){let Kb=null;$a=Ic.a.xz($a,ac);$a=Ud.a(this.$).Sq($a);
if(null===$a||void 0===$a?0:$a.Zi)Kb=$a.Zi.block;if(Kb){var sb=$a.floatingObject.Mg();Na.b_b(()=>!Kb.Mi.mb(sb),Da,"CutArt")}}}static iki($a){return 1===$a.type||5===$a.type}}Object(c.a)(Hd,"ArtCopyPasteHandler",$b,[]);var me=a(58);class xe extends Jb{constructor($a,ac,Da,Na){super($a);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=ac;this.top=Da;this.left=Na}}Object(c.a)(xe,"MacroRecorderPasteArtPayload",Jb,[]);class Ke{constructor($a,ac){this.$=$a;this.qpb=ac}jci($a,
ac,Da,Na,sb,Kb=null,Yb=null){const vc=this.$.pa.ya.Wb();let ad=null;const ld={CopyPasteTargetType:2};ld.FloatingObjectId=$a;ld.CopyOperationId=Da.id;Da.floatingObjectType=ac;ld.UploadToClipService=Da.uploadToClipService;ld.PKey=Da.pKey;ld.ClipServiceDataCenter=Da.clipServiceDataCenter;let md=0;2===sb?(sb=505,md=16,ad=(Qd,ce,ec)=>Ra(this.$.pa.ya,ld,tb.b(Qd,Na),Kb?tb.a(ce,Kb):ce,ec,Da.ribbonCommandInfo,vc,Yb)):(sb=179,ad=(Qd,ce,ec)=>{this.kmh(ac,$a);this.$.My();return la(this.$.pa.ya,ld,tb.b(Qd,Na),
Kb?tb.a(ce,Kb):ce,ec,Da.ribbonCommandInfo,vc,Yb)});this.$.userOperationManager.Ic(new Ma.a(sb,0,ad,md|64),Da.ribbonCommandInfo)}kmh($a,ac){var Da=Ic.a.xz($a,ac);(Da=Ud.a(this.$).Sq(Da))?(X.h(this.$).ha.Sa.xH(Da),Da.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${$a}, FloatingObjectId: ${ac}`)}hTj($a,ac){$a=Ic.a.xz($a,ac);if($a=Ud.a(this.$).Sq($a))$a.isVisible=!0}J8g($a){this.jci($a.floatingObjectId,$a.H8g,
$a.commandParameters,$a.Wt,$a.lgh,$a.Eaa,$a.wQb)}Lci($a,ac,Da,Na,sb,Kb,Yb,vc=null,ad=!0){return new Promise((ld,md)=>{const Qd=Kb.commandParameters.stopwatch.zc;this.YPd($a,sb,ac,Da,ce=>{Kb.requestTelemetryData=ce.RequestTelemetryData;Kb.serverRequestTimeInMs=Kb.commandParameters.stopwatch.zc-Qd;if(Va.a.oha(ce.Errors))Kb&&(Kb.encounteredDeploymentErrors=!0),ce=Va.a.sc(ce.Errors),e.ULS.sendTraceTag(537167875,0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${ce}`);
else if(Va.a.ag(ce.Errors)){var ec=Va.a.sc(ce.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${ec}`);md(new eb.a(9,ce.Errors))}else ce.Result?(ec=ce.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.e4i(Yb,ec.FloatingObjectId,ce.StateId),ld(Ke.xmd(ec.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),md(new eb.a(9,ce.Errors)))},
ce=>{Kb.serverRequestTimeInMs=Kb.commandParameters.stopwatch.zc-Qd;ce=Ha.a.Pe(ce.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Va.a.sc(ce)}`);md(new eb.a(9,ce))},Na,vc,ad)})}e4i($a,ac,Da){const Na=this.$.da.za(277);if(Na){const sb=Ic.a.xz($a,Ke.xmd(ac));Na.b_b(()=>!!Ud.a(this.$).Sq(sb),Da,"PasteArt")}}x_d($a,ac){ac&&this.qpb.x_d($a,Ic.a.xz($a.type,ac))}AKf($a){return this.Lci($a.ribbonCommandInfo,$a.destination,$a.PKe,$a.wQb,$a.V0,$a.pasteContext,
$a.item.type,$a.ACe,$a.item.isFromCurrentSession(this.$)).then(ac=>ac,ac=>{this.x_d($a.item,$a.ACe);return Promise.reject(ac)})}APd($a,ac,Da){$a||($a=O.v(X.h(this.$).ha.ra.activeCell,this.$));X.h(this.$).$ic(O.D($a),1)?Ud.a(this.$).Lna(Da,ac,!0):X.h(this.$).ha.Sa.SHa($a,ac,Da).continueWith(Na=>{Na.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${ac}]`):e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${ac}]`)})}YPd($a,
ac,Da,Na,sb,Kb,Yb,vc,ad=!0){const ld=this.$.pa.ya.Wb(),md={};md.ShadowWorkbookBase64=ac.shadowWorkbookBase64;md.FloatingObjectId=Na;md.DestinationRanges=Da?O.s(Da):null;md.CopyPasteTargetType=2;md.ClientEstimationFloatingObjectId=vc;Da=new Ma.a(503,0,(Qd,ce,ec)=>{vc||this.$.My();return ua(this.$.pa.ya,md,tb.b(Qd,sb),tb.a(ce,Kb),ec,null,ld,Yb)},void 0,()=>{if(ad){let Qd;Qd=me.a.li(me.a.hc(md));Qd.FloatingObjectId=ac.floatingObjectId;md.DestinationRanges||(Qd.DestinationRanges=O.p(this.$.xa.oa.sheetName,
"",0,0,0,0));return new xe(Qd,ad,0,0)}return new xe(md,ad,0,0)});Da.flags=65;this.$.userOperationManager.Ic(Da,$a)}static xmd($a){return`${$a.length+2}.{${$a.toUpperCase()}}`}}Object(c.a)(Ke,"ArtCopyPasteUtils",null,[799]);var vd=a(213);class Qe{constructor($a){this.r4c=this.Fta=null;this.Oab=15;this.$=$a}BGd($a,ac){this.Fta=$a;this.r4c=ac}s8c(){if(!this.Fta||!this.r4c)return e.ULS.sendTraceTag(537167841,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),
"";const $a=dd.a.srb(new Ic.a(this.Fta));$a.Id=Ke.xmd(l.a.create().toString());$a.Version=-1;$a.Name="";$a.IsClientEstimation=!0;var ac=this.Zdi($a);if(!ac)return null;const Da=new Ic.a($a);ac.block.Mi.add(Da);Da.yKb();const Na=Ud.a(this.$);Na.v5b(Da,ac);ac=Na.Sq(Ic.a.WTh($a));!ac||ac.floatingObject.iNa||ac.floatingObject.CNa||ac.BSa(this.r4c);Na.Lna($a.Type,$a.Id,!0);return $a.Id}q6f($a){return t.EwaSettings.ma(220)&&$a.isFromCurrentSession(this.$)&&!X.h(this.$).rtl&&!X.h(this.$).ib.tj}x_d($a,ac){this.q6f($a)&&
($a=Ud.a(this.$).Sq(ac))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${ac}] of type [${$a.floatingObject.type}]`),Ud.a(this.$).deleteFloatingObject($a,15,!0),$a.Zi&&$a.kcb($a.Zi,!1))}Zdi($a){if(!$a)return e.ULS.sendTraceTag(537167839,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(X.h(this.$).ha.Sa.activeFloatingObjectControlId){var ac=
X.h(this.$).ha.Sa.bB.floatingObject;$a.OriginDeltaX=ac.offsetX+this.Oab;$a.OriginDeltaY=ac.offsetY+this.Oab;$a.AbsoluteLeft+=this.Oab;$a.AbsoluteTop+=this.Oab;$a.AbsoluteRight+=this.Oab;$a.AbsoluteBottom+=this.Oab;$a.ZOrder=ac.eC+1;return X.h(this.$).ha.Sa.bB.Zi}if(!this.$.oa||!this.$.oa.activeCell)return e.ULS.sendTraceTag(537167838,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var Da=this.$.oa.activeCell;
ac=X.h(this.$).x1(Da);if(!ac)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${Da.toString()} is null.`),null;const Na=wa.HelperMethods.ixb(ac.domElement,ac.$i.domElement);Da=ac.gridView.fg(Da,2);if(!Na||!Da)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Na}. cellPositionRelativeToGridOrigin is null: ${!Da} .`),null;$a.OriginDeltaX=
Da.topLeft.x-Na.x;$a.OriginDeltaY=Da.topLeft.y-Na.y;$a.AbsoluteLeft=Da.topLeft.x;$a.AbsoluteTop=Da.topLeft.y;$a.AbsoluteRight=$a.AbsoluteLeft+Math.abs(this.Fta.AbsoluteRight-this.Fta.AbsoluteLeft);$a.AbsoluteBottom=$a.AbsoluteTop+Math.abs(this.Fta.AbsoluteBottom-this.Fta.AbsoluteTop);$a.ZOrder=this.Fta.ZOrder+100;return new vd.a(ac.gridView.Ea.Dl(ac.hashCode),ac.hashCode)}}Object(c.a)(Qe,"ArtPasteClientEstimation",null,[798]);class bc{create(){const $a=window.clipboardPlatform;return $a?$a.createClipboardItems():
null}}Object(c.a)(bc,"ClipboardItemsFactory",null,[797]);class Zc{}Zc.undefined="Undefined";Object(c.a)(Zc,"CCPTelemetryConsts",null,[]);class gd{}gd.cells="Cells";gd.floatingObject="FloatingObject";gd.unknown="Unknown";Object(c.a)(gd,"ActiveSelection",null,[]);class Sc{}Sc.wlh="DisplayNotInvoked";Sc.k8c="Displayed";Sc.o4i="PrerequisitesNotReady";Object(c.a)(Sc,"PasteIndicationDisplayStatus",null,[]);var Gd=a(109);class Vd{constructor($a){this.GGc=this.OQc=null;this.$=$a}get GId(){if(!this.OQc){const $a=
this.$.da.za(254,!0);$a&&(this.OQc=new Pb(this.$,$a,new bc))}return this.OQc}get FYc(){if(!this.GGc&&this.$.da.za(254,!0)){const $a=new Qe(this.$);this.GGc=new Hd(this.$,new bc,new Ke(this.$,$a),$a)}return this.GGc}getCopyFlowHandler($a){const ac=this.RPh(X.h(this.$).Oe);$a.commandParameters.copyPasteHandlerName=ac.name;return ac}getPasteFlowHandler($a){var ac=$a.copyContextSnapshot;ac=Q($a)?this.FYc:M($a)?this.GId:(null===ac||void 0===ac?0:ac.sourceItem)&&Object.getType(ac.sourceItem)===L?this.FYc:
this.GId;$a.commandParameters.copyPasteHandlerName=ac.name;return ac}initializePasteContext($a){if($a&&($a.isSameSession=!1,$a.isShadowWorkbookParsedSuccessfully=!1,$a.pasteResult=Zc.undefined,$a.payloadOrigin=Zc.undefined,$a.payloadType=Zc.undefined,$a.encounteredDeploymentErrors=!1,$a.shadowWorkbookSizeExceedsLimit=!1,$a.originalSourceRangesCountExceedsLimit=!1,$a.activeSelectionType=this.GLh(),$a.indicationDisplayScheduled=!1,$a.pasteDestinationHasMergedCells=!1,$a.pasteIndicationDisplayStatus=
Sc.wlh,$a.copyContextSnapshot)){var ac=$a.copyContextSnapshot;const Yb=C(ac.sourceItem);var Da=ac.sourceItem;var Na=!!Da&&Object.getType(Da)===L;Da=0;var sb=!1;Yb?(sb=ac.sourceItem,$a.isSameSession=sb.isFromCurrentSession(this.$),Da=1,sb=this.zoi(sb,$a)):Na&&($a.isSameSession=ac.sourceItem.isFromCurrentSession(this.$),Da=2);if($a.copyContextSnapshot.commandParameters){const vc=-1985798686===ac.commandParameters.ribbonCommandInfo.command;Na=$a.commandParameters;var Kb=this.$;ac?Kb&&Kb.va?ac=ac.sessionId===
Kb.va.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),ac=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),ac=!1);Na.clearSystemClipboard=ac&&vc&&Yb&&!sb;$a.commandParameters.copyPasteTargetType=Da}}}getSessionId(){return this.$.va.UserSessionId}zoi($a,ac){const Da=Gd.b($a.ranges,Na=>Na.hf)&&Gd.b(ac.commandParameters.originalDestinations,Na=>1!==Na.top);return Gd.b($a.ranges,Na=>Na.isRow)&&Gd.b(ac.commandParameters.originalDestinations,Na=>
1!==Na.left)||Da}RPh($a){switch($a){case 1:return this.GId;case 64:case 4:case 2:case 256:return this.FYc;default:throw Error.invalidOperation("Unsupported selection");}}GLh(){return X.h(this.$).ha.Oe&470?gd.floatingObject:1===X.h(this.$).ha.Oe?gd.cells:gd.unknown}getDialogResponse(){}}Object(c.a)(Vd,"ExcelCopyPasteApplicationHost",null,[773]);var Ed=a(157);class Od extends B.a{constructor($a,ac){super($a);this.pp=null;this.Qfi=(Da,Na)=>{1===Da?(Da=Od.Gkh[Na[Od.Fkh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===Da?"Horizontal":"Vertical"}`),this.pp.setResult(Da)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.pp.Qs())};this.gg(ac)}get pc(){return"InsertCopiedCutCellsDialog"}gg($a){this.pp=new Ed.a;const ac=A.a.instance.ga(16);$a=this.kN($a);this.initializeAndShow(ac,this.Qfi,$a)}kN($a){return{[Od.uu]:this.pc,
[Od.fqi]:$a}}}Od.Fkh="direction";Od.fqi="isRtl";Od.Gkh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(Od,"InsertCopiedCutCellsDialog",B.a,[]);class se{x5b($a,ac){return(new Od($a,ac)).pp.task}}Object(c.a)(se,"InsertCopiedCutCellsDialogFactory",null,[636]);var Le=a(87),Id=a(47),fe=a(46);class Yd{constructor($a){this.w6b="";this.D2=this.rt=null;this.Zrc=!1;this.Naf=(ac=null,Da=null)=>{this.hide(ac,Da)};this.gridView=X.h($a);this.gridView.ha.iH(this.Naf)}UMe(){this.Zrc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.ky($a=>{$a.Taa(0).then(()=>{this.Zrc=!0})}))}Uoj($a){var ac=$a.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${ac}, cancelCtx is null = ${!this.rt}, PrerequisitesDownloaded = ${this.Zrc}`);this.UMe();this.w6b=ac;ac=!this.bwf();if(!this.rt||ac)this.Pze(),this.rt=Id.a.instance.create(()=>{this.vlh($a)},void 0===$a.timeoutToShowSpinnerInMs||
null===$a.timeoutToShowSpinnerInMs?100:$a.timeoutToShowSpinnerInMs,fe.a.A0i);this.D2=$a.commandParameters.originalDestinations}vlh($a){this.Zrc?(this.display($a.commandParameters.originalDestinations),$a.pasteIndicationDisplayStatus=Sc.k8c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),$a.pasteIndicationDisplayStatus=Sc.o4i)}display($a){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.qb.lx(ib.a.Eea(Ga.d(this.gridView.$.oa),$a),Yd.brc,!0);this.gridView.qb.Sn(Yd.brc)}pld($a){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${$a}, currentPasteCommandId = ${this.w6b}`);$a&&ka.a.equals($a,this.w6b,!1)&&this.hide()}hide($a=null){this.D2&&$a&&this.bwf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");
this.w6b="";this.Pze();this.D2=null;this.gridView.qb.Xg(Yd.brc);this.gridView.qb.Ti(null,Yd.brc)}bwf(){return O.Q(this.gridView.ha.ra.selectedRanges,this.D2)}Pze(){this.rt&&(Le.a.Ia(this.rt),this.rt=null)}dispose(){this.hide();this.gridView.ha.jG(this.Naf)}}Yd.brc=[30];Object(c.a)(Yd,"PasteIndicationManager",null,[635,2]);var Ce=a(978),ye=a(53),Ae=a(695);class He extends f.a{constructor($a){super();this.$=$a;this.hm=A.a.instance;this.Fb()}create(){const $a=ye.a.KN([74,75],4,this.Ya,void 0,void 0,
void 0,He.Qna),ac=ba.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.Ya);Ka.TaskExtensions.Aa(Ka.TaskExtensions.Ed([ac,$a],this.la),()=>{const Da=new Ce.a;let Na=null;this.g6g(Da).then(sb=>{Na=sb.ECe;const Kb=copyPasteInfra.createCopyPasteInfra(Na,new Vd(this.$),Da,this.$);e.ULS.shipAssertTag(537167762,0,!!this.$.va,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.va&&!!this.$.va.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const Yb=Na.getMetadataManager();var vc=Object(Ae.a)(this.$.da,254,()=>new cc(this.$,Yb,ac.result,Kb,new Cc(this.$,X.h(this.$)),new se,this.$.va.DocumentHostInfo.UserId,Na.getInitializationError()));this.ob(vc);if(sb.R0a){vc=cc.rbc();const ad=JSON.stringify(sb.R0a.dataClipboardCapabilities),ld=sb.R0a.clipboardStrategiesToInitialize[0].clipboardStrategyType===sb.R0a.dataClipboardStrategyType,md=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${vc}, StrategyType=${sb.R0a.dataClipboardStrategyType}, StrategyCapabilities=${ad}, IsBestStrategyTypeInitialized=${ld}, InfraLoadTimeMS=${md}`)}else e.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},sb=>{const Kb=cc.rbc();sb=sb?copyPasteInfra.getStringifiedError(sb):"null";e.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${Kb} error: ${sb}`)})},this.la,3)}dispose(){super.dispose()}g6g($a){let ac=null;var Da=window.clipboardPlatform;Da&&(ac=Da.getClipboardPlatformEnvironment());if(!ac)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);Da=this.$.va;const Na=[Da.OfficeOnlineChromeExtensionId,Da.ChromeClipboardAccessExtensionId],sb=this.hm.Ua(5);var Kb=this.$.ie.get(57);let Yb=!Kb&&this.$.ie.get(5);const vc=this.$.ea.dc;vc&&(vc.inWebPart||vc.inViewerFromWebPart||vc.isDivSyndicated)&&(Yb=!1);Kb=this.OOh(Yb,!Kb);e.ULS.shipAssertTag(537167758,0,!!Da.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return ac.init(this.$,
$a,Na,Da.SharedClipboardHostingApp,Da.SharedClipboardHostingApps,Da.SharedClipboardHostingEnvironments,Da.SharedClipboardOverrideOrigin,Da.SharedClipboardSchemaVersion,Da.SharedClipboardExpirationInMinutes,Da.ClipboardPromiseTimeoutInMinutes,sb,Da.MachineCluster,new dc(this.$),Kb,Da.DocumentHostInfo.UserId,Da.ClipboardTtlInMS,t.EwaSettings.ma(306),Da.UserSessionId).then(ad=>Object(b.a)(new ic,{ECe:ac,R0a:ad}),ad=>Promise.reject(ad))}OOh($a,ac){const Da=[];$a&&ac&&Da.push(this.Meh());ac&&(Da.push(this.Z5c(7)),
Da.push(this.Z5c(0)));$a&&Da.push(this.wHe());Da.push({clipboardStrategyType:4});const Na=Da?Da.map(sb=>JSON.stringify(sb)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${$a}, isSystemClipboardAllowed=${ac}, result = ${Na}`);return Da}wHe(){const $a=this.$.va,ac={clipboardStrategyType:5};ac.sessionId=$a.UserSessionId;ac.useSharedClipboardIframe=!0;ac.sharedClipboardHostingApp=
$a.SharedClipboardHostingApp;ac.sharedClipboardHostingApps=$a.SharedClipboardHostingApps;ac.sharedClipboardHostingEnvironments=$a.SharedClipboardHostingEnvironments;ac.sharedClipboardOverrideOrigin=$a.SharedClipboardOverrideOrigin;ac.sharedClipboardSchemaVersion=$a.SharedClipboardSchemaVersion;ac.sharedClipboardExpirationInMinutes=$a.SharedClipboardExpirationInMinutes;ac.wacCluster=$a.MachineCluster;return ac}Meh(){const $a={clipboardStrategyType:6};$a.localStorageStrategyParameters=this.wHe();$a.systemClipboardStrategyParameters=
this.Z5c(0);return $a}Z5c($a){const ac={};ac.clipboardStrategyType=$a;ac.skipFilesIfPlainTextExists=!0;return ac}static ka($a){$a.da.Ga(373,new Yd($a));$a.da.Ga(He.Qna,new He($a))}}He.Qna=255;Object(c.a)(He,"CopyPasteInfrastructureFactory",f.a,[]);var gf=a(9);a.d(E,"a",function(){return Xe});const Xe=()=>{gf.a.Fa($a=>{He.ka($a)})}},1155:function(u,E,a){u=a(0);var c=a(15),b=a(682),e=a(553),f=a(84),d=a(83),h;(function(pa){pa[pa.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";pa[pa.cloudPolicySettings=
1]="cloudPolicySettings";pa[pa.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(u.b)("ApplicationFeatureHelperRequestType",h);class m{constructor(){this.message=null;this.yfc=0}}Object(u.a)(m,"HttpRequstToPromiseRejectData",null,[]);var l=a(97),w=a(80),n=a(240),y=a(30);class t{constructor(pa,ba){this.lb=pa;this.yh=ba}o5c(pa,ba,fa,Ka=null,aa=null,ja=null,Va=null,bb=null){const wa=h[fa],ka=wa+"RequestFailure";l.Health.instance.recordKpiUsage(ka,0,"jpittsdirects",null);return new Promise((ta,
qa)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",wa);const rb=null!=Va?Va:this.lb.rd("ApplicationFeatureHelperRequestQueueTimeout",15E3),Za=null!=bb?bb:this.lb.rd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.yh.Zga(pa,1,null,this.gUh(fa,Ka),ja,!1,1,gb=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",wa);try{if(void 0===gb||null===gb||void 0===
gb.data||null===gb.data||void 0===gb.data.ue||null===gb.data.ue){l.Health.instance.recordKpiFailure(ka,"Invalid RequestSucceededEventArgs",!1,!0,null);let Ga=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",wa);qa(this.xxb(Ga,gb))}else if(gb.data.httpStatus!==n.a.lP){l.Health.instance.recordKpiFailure(ka,"HttpStatusCode_"+gb.data.httpStatus.toString(),!1,!0,null);let Ga=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
gb.data.httpStatus,wa);qa(this.xxb(Ga,gb))}else{void 0!==aa&&null!==aa&&void 0!==gb.data.responseHeaders&&null!==gb.data.responseHeaders&&aa(gb.data.responseHeaders);var mb=ba(gb.data.ue);if(mb)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",wa),ta(mb);else{l.Health.instance.recordKpiFailure(ka,"Parse Failure",!1,!0,null);let Ga=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
wa);qa(this.xxb(Ga,gb))}}}catch(Ga){l.Health.instance.recordKpiFailure(ka,"Unexpected Failure",!1,!0,null),mb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",Ga,wa),qa(this.xxb(mb,gb))}},gb=>{if(gb.data){l.Health.instance.recordKpiFailure(ka,"HttpStatusCode_"+gb.data.httpStatus.toString(),!1,!0,null);var mb=y.a.Yhd(gb.data.ue||"No Data");mb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
gb.data.httpStatus,mb,wa)}else l.Health.instance.recordKpiFailure(ka,"Invalid RequestFailedEventArgs",!1,!0,null),mb=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",wa);qa(this.xxb(mb,gb))},null,void 0,void 0,rb,Za)})}xxb(pa,ba){const fa=new m;fa.message=pa;fa.yfc=ba&&ba.data?ba.data.httpStatus:-1;return fa}gUh(pa,ba){const fa={};fa["x-UserDataSignature"]=this.lb.Xa("UserDataSignature");fa["x-LicensingIsEnabled"]=this.lb.qa("LicensingIsEnabled").toString();
fa["x-CacheIsEnabled"]=this.lb.qa("LicensingRedisIsEnabled").toString();fa["x-OcpsIsEnabled"]=this.lb.qa("OcpsIsEnabled").toString();fa["x-LicensingAADIdIsEnabled"]=this.lb.qa("LicensingAadIdIsEnabled").toString();0===pa&&(fa["x-LicenseCheckOnTenantEnabled"]=this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SafeLinksLicenseCheck",!1).toString(),fa["x-SupportUserConsentDependentFeatures"]="true",fa["x-AFHUserConsentGroupValue"]="0",fa["x-UseShellServiceForUserConsentGroup"]="true",fa["x-SMBUserLicensingEnabled"]=
"true",fa["x-AFHPIPLComplianceEnabled"]=w.a.iy(window.location.href,"wd_afhpipl")||"false");if(ba)for(let Ka of ba.keys)fa[Ka]=ba.na(Ka);return fa}}Object(u.a)(t,"HttpRequestToPromiseUtility",null,[]);var r=a(4),v;(function(pa){pa[pa.loki=0]="loki";pa[pa.augloopACLP=1]="augloopACLP"})(v||(v={}));Object(u.b)("AlternateAuthSupportApp",v);var B=a(729),A=a(41);class z{constructor(){this.Token=null;this.ExpirationTime=0}}Object(u.a)(z,"WacAlternateAuthToken",null,[]);class x{constructor(pa,ba){this.hPj=
3E5;if(void 0===pa||null===pa||void 0===ba||null===ba)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.lb=pa;this.QRb=new b.a(e.a.Yj());this.Ojb=new t(pa,ba);void 0!==B.a.Nwd&&null!==B.a.Nwd&&void 0!==B.a.Llc&&null!==B.a.Llc&&0<B.a.Llc&&(pa=new z,pa.Token=B.a.Nwd,pa.ExpirationTime=B.a.Llc,this.QRb.ia("loki",pa))}nMh(){let pa=null;this.QRb.mb(v[0])&&(pa=this.QRb.na(v[0]));return void 0===pa||null===pa||this.Ysd(pa)?this.qDh():Promise.resolve(pa.Token)}Ysd(pa){return pa.ExpirationTime-
Date.now()<this.hPj}qDh(){const pa=new b.a(e.a.Yj());pa.ia("X-AlternateAuthApp",v[0]);return this.Ojb.o5c(this.Rva("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.K_i,"parseAlternateAuthTokenResponse"),2,pa).then(ba=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",v[0]);this.QRb.ia(v[0],ba);return ba.Token},ba=>{ba=Object(d.a)(m,ba);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",
ba.message,ba.yfc);return null})}K_i(pa){let ba=null;({At:ba}=A.d(pa));c.ULS.sendTraceTag(545821457,3004,ba?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",pa);return ba}Rva(pa){return String.format("{0}{1}?{2}",this.lb.Xa("WebServiceBase"),pa,r.AFrameworkApplication.Ii)}}Object(u.a)(x,"AlternateAuthHelper",null,[316]);var D=a(458);class J{constructor(pa,ba,fa){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=pa;this.isEnabled=ba;this.tierName=
fa}}Object(u.a)(J,"FeatureStateChangeArgs",null,[]);var L=a(136),T=a(252),O=a(27),G=a(111),C=a(170),H;(function(pa){pa[pa.Enabled=0]="Enabled";pa[pa.Disabled=1]="Disabled"})(H||(H={}));Object(u.b)("FeatureState",H);var I=a(82),M=a(25),Q=a(189);class U{constructor(pa,ba,fa=null,Ka=null,aa=null){this.dva=this.fXb=this.Zhe=this.Tqa=this.hYb=null;this.Ojb=new t(pa,ba);this.lb=pa;this.xxg=pa.rd("LicensingMaxRetryAttempts",0);this.PMc=pa.qa("IsO365ConsumerHost");this.OMc=pa.qa("IsO365CommercialHost");this.RUb=
pa.qa("PremiumUpsellIsEnabled");this.u6d=fa;this.ime=Ka;this.La=aa;this.Sqa=pa.qa("LicensingIsEnabled");this.gFa=pa.qa("OcpsIsEnabled")&&this.OMc;this.jUc=pa.qa("ShowPrivacyDialog")&&!!Ka;this.Dae=pa.qa("IsAnonymousUser");this.sbd=new Promise(ja=>{ja(!1)});this.pCa=new Promise(ja=>{ja(!0)});this.cva=new b.a(e.a.Yj());this.TYb=!0;this.lde=this.GVh();this.drd()&&!this.Dae?(void 0!==r.AFrameworkApplication.sa&&null!==r.AFrameworkApplication.sa&&(this.hYb=r.AFrameworkApplication.sa.iE,void 0!==this.hYb&&
null!==this.hYb&&(this.Tqa=this.hYb.Pg("WebServiceCall","ApplicationFeatureHelperService"))),this.dva=this.e_d()):this.dva=new Promise(ja=>{ja({})});this.dva.catch(ja=>{c.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(ja))});this.TYb&&(this.RUb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(ja=>{this.RUb=this.lb.qa("PremiumUpsellIsEnabled")&&ja;return null}))}GVh(){const pa=this.lb.Zp("AllLicensedFeatures")?this.lb.Cw("AllLicensedFeatures"):[],ba=new D.a;for(let fa=0;fa<pa.length;fa++)ba.add(pa[fa]);
return ba}drd(){return this.OMc||this.PMc}e_d(pa=0,ba=!1){c.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",ba);const fa=L.a.fs();fa&&(fa.set("retryAttempt",pa.toString()),fa.set("forceRefresh",ba.toString()),fa.set("isO365ConsumerHost",this.PMc.toString()),fa.set("isO365CommercialHost",this.OMc.toString()),fa.set("isFreemiumUpsellEnabled",this.RUb.toString()));l.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",
fa);l.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",fa);void 0!==this.Tqa&&null!==this.Tqa&&this.Tqa.start();let Ka=null;ba&&(Ka=new b.a(e.a.Yj()),Ka.ia("x-LicensingForceRefresh","true"));this.Zhe=new Date;return(this.Sqa?this.Ojb.o5c(this.Rva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.N_i,"parseApplicationFeatureHelperResponse"),0,Ka,Object(f.a)(this,this.f5i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(aa=>
{const ja=Object.assign(new Q.a,{durationMs:this.G$f()});ja.extendedProperties=fa;ja.extendedProperties&&aa&&(ja.extendedProperties.set("featureCount",G.a.count(aa).toString()),ja.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in aa).toString()),ja.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in aa).toString()),this.fXb&&ja.extendedProperties.set("fromCache",(this.fXb<this.Zhe).toString()));l.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
ja);return aa},aa=>{const ja=Object.assign(new Q.a,{durationMs:this.G$f()}),Va=Object(d.a)(m,aa);if(!Va)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,ja),new Promise((bb,wa)=>{wa(aa)});ja.extendedProperties=fa;ja.extendedProperties&&ja.extendedProperties.set("status",Va.yfc.toString());l.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,ja);return 408===Va.yfc&&++pa<=this.xxg?this.e_d(pa):new Promise((bb,wa)=>{wa(Va)})})}N_i(pa){(pa=A.b(pa))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",pa)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return pa.Features}Rva(pa){var ba=String.format("{0}{1}",this.lb.Xa("WebServiceBase"),
pa);this.lb.Zp("ApplicationFeatureHelperHttpCachingEnabled")&&this.lb.qa("ApplicationFeatureHelperHttpCachingEnabled")&&(pa=U.ycc(this.lb))&&0<pa.length&&(this.TYb&&(pa+="ucbf"),ba=new T.QueryStringBuilder(ba),ba.Yi("afhskey",pa),ba=ba.toString());return ba}isFeatureEnabled(pa,ba){if(!this.gFa&&!this.jUc&&!this.Sqa)return this.pCa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",pa);if("ConnectedServices"===pa){var fa=
this.gFa?this.u6d.wF("ControllerConnectedServicesEnabled"):this.pCa;const ja=this.jUc?this.ime.getSettings().then(Va=>2!==Va.ru,()=>ba):this.pCa;return fa.then(Va=>Va?ja:this.sbd)}fa=null;fa=this.gFa?this.u6d.isFeatureEnabled(pa):this.pCa;let Ka=null;Ka=this.Sqa?this.qli(pa,ba):this.pCa;let aa=null;aa=this.jUc?this.ime.isFeatureEnabled(pa):this.pCa;return fa.then(ja=>ja?aa.then(Va=>Va?Ka:this.sbd):this.sbd).then(ja=>{this.nqf(pa,ja,!0);return ja},()=>{this.nqf(pa,ba,!1);return ba})}nqf(pa,ba,fa){c.ULS.sendTraceTag(526713106,
3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",pa,ba,fa)}getFeatureTier(pa,ba){if(!this.Sqa)return new Promise(fa=>{fa(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",pa);return this.dva.then(fa=>this.zdc(pa,fa,ba),()=>ba)}isFreemiumUpsellEnabled(){return this.RUb&&this.PMc&&!this.Dae}launchUpsellExperience(pa,ba=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",
pa));var fa=L.a.fs();fa&&(fa.set("experienceId",pa),ba&&fa.set("campaignId",ba));l.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",fa);if(fa=I.a.instance.Kh("Common.IInProductMessagingUIManager")){const Ka=Object(f.a)(this,this.c6h,"handleDimeTaskComplete");fa.uof(pa,Ka,ba)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.La.ae(M.a.Kac,
2,{["experience"]:pa})}hna(pa,ba){if(!this.Sqa)return null;if(!pa||!ba)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const fa=C.a.create().toString();this.cva.mb(pa)||this.cva.ia(pa,new b.a(e.a.Yj()));this.cva.na(pa).add(fa,ba);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",fa,pa));return fa}NKd(pa,ba){this.Sqa&&
(pa&&this.cva.mb(pa)?ba&&C.a.isValid(ba)?this.cva.na(pa).mb(ba)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",ba,pa)),this.cva.na(pa).remove(ba)):c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",ba,pa)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",
ba,pa)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",pa)))}zdc(pa,ba,fa){return this.TYb?pa in ba?ba[pa].LicenseTier:fa:pa in ba?this.j0i(ba[pa],fa):fa}j0i(pa,ba){switch(pa.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return ba}}c6h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.dva.then(pa=>{this.KRf(pa)}).catch(()=>
{this.KRf({})})}KRf(pa){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const ba=this.e_d(0,!0);ba.then(fa=>{this.dva=ba;G.a.count(fa)>G.a.count(pa)?l.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let Ka of this.cva.keys)if(Ka in fa){const aa=this.zdc(Ka,fa,0);Ka in pa?this.zdc(Ka,pa,0)!==aa&&this.JAd(Ka,!0,aa):this.JAd(Ka,
!0,aa)}else Ka in pa&&this.JAd(Ka,!1,this.zdc(Ka,pa,0))}).catch(fa=>{l.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(fa))})}JAd(pa,ba,fa){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",pa,ba,fa);ba=new J(pa,ba,fa);fa=this.cva.na(pa);for(let Ka of fa)try{Ka.value(ba)}catch(aa){c.ULS.sendTraceTag(594051084,
3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",pa,Ka.key,aa.message))}}Td(pa,ba){if(this.Sqa){const fa=this.lde.contains(pa);let Ka=!0,aa="",ja=!1;return this.dva.then(Va=>{pa in Va?(Va=Va[pa],aa=H[Va.FeatureState],Ka=1!==Va.FeatureState):Ka=!fa;this.wqf(pa,fa,aa,ja,ba,Ka);return Ka},()=>{ja=!0;fa&&(Ka=ba);this.wqf(pa,fa,aa,ja,ba,Ka);return Ka})}return this.pCa}wqf(pa,ba,fa,Ka,aa,ja){c.ULS.sendTraceTag(557389507,
3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",pa,ba,Ka,fa,aa,ja)}qli(pa,ba){if(this.TYb)return this.Td(pa,ba);if(this.Sqa){if(this.lde.contains(pa))return this.dva.then(fa=>pa in fa,()=>ba);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",pa)}return this.pCa}f5i(pa){try{pa&&"Date"in pa&&(this.fXb=new Date(pa.Date),
c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.fXb.toString()))}catch(ba){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",ba)}}G$f(){if(void 0!==this.Tqa&&null!==this.Tqa){const pa=this.Tqa.zc;this.Tqa.stop();return pa}return null}static ycc(pa){try{if(O.a.wLj){const ba=pa.Xa("UserDataSignature").split(".");if(1<ba.length){const fa=window.self.atob(ba[1]),Ka=JSON.parse(fa).LocalStorageKey;if(void 0!==
Ka&&null!==Ka&&0<Ka.length)return Ka}}}catch(ba){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",ba.toString())}return null}}Object(u.a)(U,"ApplicationFeatureHelper",null,[317]);var N=a(187);class W{constructor(pa,ba){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=pa.PolicySettings;pa=new Date;pa.setMinutes(pa.getMinutes()+ba);this.ExpirationTime=pa.getTime()}}Object(u.a)(W,"CloudPolicySettingsCacheData",null,[]);var X=a(818),sa=a(374),da=a(228);class S{static O8f(){return r.AFrameworkApplication.fa.qa("SideCarIsEnabled")?
S.vwc&&S.zpd?new Promise(pa=>{pa(!0)}):new Promise((pa,ba)=>{S.vwc=da.a.create(r.AFrameworkApplication.fa.Xa("SideCarUrl"));sa.a.Sia(S.vwc);S.vwc.b$((fa,Ka)=>{(S.zpd=Ka.succeeded)?pa(Ka.succeeded):ba(Ka.succeeded)})}):new Promise(pa=>{pa(!1)})}}S.zpd=!1;S.vwc=null;Object(u.a)(S,"SideCarLoader",null,[]);class oa{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(u.a)(oa,"CloudPolicySettingsData",null,[]);class K{constructor(pa,ba){this.JHc=0;this.a4b=null;this.Ojb=
new t(pa,ba);this.lb=pa;ba=pa.Xa("HostAuthType");this.gFa=pa.qa("OcpsIsEnabled")&&pa.qa("IsO365CommercialHost")&&!(void 0===ba||null===ba)&&"aad"===ba.toLowerCase();this.sfe=A.b(pa.Xa("OcpsDefaultSettings")||"{}");this.Ckb=this.ycc();ba=this.lb.Zp("ServicesControlsMicrosoftControllerServicesList")?this.lb.Cw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.QSb=new D.a;for(let fa=0;fa<ba.length;fa++)this.QSb.add(ba[fa]);this.gFa&&!pa.qa("IsAnonymousUser")&&pa.qa("SideCarIsEnabled")?this.a4b=
this.YRj():this.a4b=this.Woa(this.gFa,this.Rva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.O_i,"parseCloudPolicySettingsResponse"));this.a4b.then(()=>null).catch(fa=>{c.ULS.sendTraceTag(50622685,3004,10,JSON.stringify(fa))})}wF(pa,ba=!0){if(!this.gFa){const ja=this;return new Promise(Va=>{Va(ja.hxb(pa))})}let fa=this,Ka=this;const aa=this.a4b.then(ja=>{try{let Va=null;ja.PolicySettings&&"unknown"in ja.PolicySettings&&(Va=ja.PolicySettings.unknown);if(Va){if(pa in Va&&void 0!==Va[pa]&&
null!==Va[pa])return new Promise(wa=>{wa("0"!==Va[pa])});const bb=pa.toLowerCase();if(bb in Va&&void 0!==Va[bb]&&null!==Va[bb])return new Promise(wa=>{wa("0"!==Va[bb])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+pa+" not found, using default");return new Promise(wa=>{wa(fa.hxb(pa))})}return new Promise(bb=>{bb(fa.hxb(pa))})}catch(Va){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+pa+" policy value. Error Message: {0}",Va.message),fa.handleError(Va.toString(),ba,fa.hxb(pa))}},ja=>Ka.handleError(ja,
ba,Ka.hxb(pa)));aa.then(ja=>{c.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",pa,ja);return null});return aa}isFeatureEnabled(pa,ba=!0){if(this.lb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.sli(pa,ba);let fa=new Promise(aa=>{aa(!0)}),Ka="";this.QSb.contains(pa)&&(Ka="ControllerConnectedServicesEnabled",fa=this.wF(Ka,ba));fa.then(aa=>{c.ULS.sendTraceTag(50651668,
3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",pa,aa,Ka);return null});return fa}sli(pa,ba=!0){let fa=new Promise(aa=>{aa(!0)}),Ka="";"mso_sendASmile"===pa?Ka="Enabled":"Survey"===pa||"FloodgateSurvey"===pa?Ka="SurveyEnabled":this.QSb.contains(pa)&&(Ka="ControllerConnectedServicesEnabled");""!==Ka&&(fa=this.wF(Ka,ba));fa.then(aa=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",
pa,aa,Ka);return null});return fa}handleError(pa,ba,fa){return ba?new Promise(Ka=>{Ka(fa)}):new Promise((Ka,aa)=>{aa(pa)})}Woa(pa,ba,fa){if(!pa)return Promise.resolve(new oa);let Ka=!1,aa=null;l.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let ja=this.M4c("GetCloudPolicySettings");return(new Promise((Va,bb)=>{if(void 0!==this.Ckb&&null!==this.Ckb&&0<this.Ckb.length){const wa=this.HRj();if(void 0!==wa&&null!==wa){Ka=!0;Va(wa);return}}this.Ojb.o5c(ba,fa,1,null,Object(f.a)(this,
this.k5i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],this.lb.rd("CloudPolicySettingsRequestQueueTimeout",15E3),this.lb.rd("CloudPolicySettingsRequestSentTimeout",3E4)).then(wa=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.xSj(wa);Va(wa);return wa},wa=>{bb(wa);return null})})).then(Va=>{({stopwatch:ja,returnValue:aa}=this.sAc(ja));var bb=L.a.fs();bb&&bb.set("FromCache",Ka.toString());bb=Object.assign(new Q.a,{durationMs:aa,extendedProperties:bb});
l.Health.instance.recordKpiSuccess("GetCloudPolicySettings",bb);return Va})}YRj(){return S.O8f().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}Rva(pa){return String.format("{0}{1}",this.lb.Xa("WebServiceBase"),pa)}O_i(pa){let ba=null;({At:ba}=A.d(pa));c.ULS.sendTraceTag(50622687,3004,ba?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",
pa);return ba}k5i(pa){try{if(void 0!==pa&&null!==pa&&"CheckIn-Interval"in pa){const ba=parseInt(pa["CheckIn-Interval"]);void 0!==ba&&null!==ba&&0<ba&&(this.JHc=ba)}}catch(ba){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",ba)}}hxb(pa){return pa in this.sfe?"0"!==this.sfe[pa]:!0}HRj(){try{const pa=X.a.instance.getItem(this.Ckb);if(void 0===pa||null===pa)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),
null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",pa);const ba=JSON.parse(pa);if(void 0===ba||null===ba)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===ba.ExpirationTime||null===ba.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),
null;if((new Date(ba.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),null;const fa=new oa;fa.PolicySettings=ba.PolicySettings;fa.ControllerConnectedServicesFeatureNames=new N.a;this.lb.Zp("ServicesControlsMicrosoftControllerServicesList")&&this.lb.Cw("ServicesControlsMicrosoftControllerServicesList");for(let Ka of this.QSb)fa.ControllerConnectedServicesFeatureNames.add(Ka);c.ULS.sendTraceTag(51662941,3004,
50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return fa}catch(pa){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",pa.toString()),null}}xSj(pa){try{if(void 0===pa||null===pa||void 0===pa.PolicySettings||null===pa.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.JHc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");
else{const ba=new W(pa,this.JHc),fa=JSON.stringify(ba);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",fa);X.a.instance.setItem(this.Ckb,fa);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(ba){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",ba.toString())}}ycc(){const pa=U.ycc(this.lb);return pa&&0<pa.length?"OCPS"+pa:null}M4c(pa){const ba=I.a.instance.Kh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");
return void 0!==ba&&null!==ba?ba.Ac("WebServiceCall",pa):null}sAc(pa){if(void 0!==pa&&null!==pa){const ba=pa.zc;pa.stop();return{returnValue:ba,stopwatch:null}}return{returnValue:null,stopwatch:pa}}}Object(u.a)(K,"CloudPolicySettingsHelper",null,[314]);class ea{constructor(){this.OMe=this.ejg=this.ru=0;this.PMe=this.fjg=this.wIa="";this.VSc=this.Xea=2}clone(){const pa=new ea;pa.ru=this.ru;pa.ejg=this.ejg;pa.OMe=this.OMe;pa.wIa=this.wIa;pa.fjg=this.fjg;pa.PMe=this.PMe;pa.Xea=this.Xea;pa.VSc=this.src;
return pa}get src(){return this.VSc}serialize(pa=null){const ba={};if(!pa||pa.contains(ea.jPa))ba[ea.jPa]=this.ru;if(!pa||pa.contains(ea.lFb))ba[ea.lFb]=this.wIa;if(!pa||pa.contains(ea.mFb))ba[ea.mFb]=this.Xea;return JSON.stringify(ba)}static create(pa,ba=null){const fa=new ea;fa.VSc=pa;void 0!==ba&&null!==ba&&(ea.jPa in ba&&(fa.ru=ba[ea.jPa]),ea.lFb in ba&&(fa.wIa=ba[ea.lFb]),ea.mFb in ba&&(fa.Xea=ba[ea.mFb]));return fa}static deserialize(pa,ba){try{const fa=JSON.parse(pa);if(void 0!==fa&&null!==
fa)return ea.create(ba,fa);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",pa);throw Error.argument("settingsData");}catch(fa){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",fa.toString()),fa;}}}ea.jPa="CCS";ea.lFb="CCSTime";ea.mFb="OfficePrivacyRoamedNoticeShown";Object(u.a)(ea,"UserPrivacySettings",null,[]);var ya=a(128);class ha{constructor(pa,ba){if(void 0===pa||null===pa||void 0===ba||null===ba)throw Error.argumentNull("appSettingsManager/clientRequestManager");
this.lb=pa;this.yh=ba;this.lSc=this.oe=null}Rva(pa){var ba=String.format("{0}RoamingServiceHandler.ashx?action=",this.lb.appSettings.RoamingServiceHandlerWebServiceBase||"");ba=new Sys.StringBuilder(ba);ba.append(pa);ba.append("&");ba.append(r.AFrameworkApplication.Ii);return ba.toString()}executeRequest(pa,ba,fa,Ka=null){return this.yh.dob(pa,ba,Ka,null,fa,"33",!1,null,6E4)}saveSettings(pa){return new Promise((ba,fa)=>{try{if(void 0===this.oe||null===this.oe||void 0===pa||null===pa)c.ULS.sendTraceTag(51258443,
3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),fa("Can't determine setting changes to save");else{var Ka=this.oe.ru!==pa.ru;if(2===this.oe.src&&Ka)this.noj(pa),ba(!0);else{var aa=this.$rj(pa);if(void 0===aa||null===aa||!aa.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),fa("No changes to save");else if(1===this.oe.src)ba(this.Xeg(aa));else if(0===this.oe.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",
aa);const ja=this.executeRequest(this.Rva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",aa);ja.continueWith(()=>{if(ja.Ch||ja.Xf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),ba(!1);else{var Va=ja.result;void 0!==Va.Jg&&null!==Va.Jg&&void 0!==Va.Jg.data&&null!==Va.Jg.data&&Va.Jg.data.httpStatus===n.a.lP?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),ba(!0)):(c.ULS.sendTraceTag(51258446,3004,
10,"SaveUserPrivacySettings: Roaming Request Failed"),ba(!1))}})}}}}catch(ja){c.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",ja.toString()),ba(!1)}})}$rj(pa){if(void 0===this.oe||null===this.oe||void 0===pa||null===pa)throw Error.invalidOperation("User Privacy settings have not been initialized");const ba=new N.a;0===pa.src?(this.oe.ru!==pa.ru&&(ba.add(ea.jPa),ba.add(ea.lFb)),this.oe.Xea!==pa.Xea&&ba.add(ea.mFb)):1===pa.src&&this.oe.ru!==pa.ru&&ba.add(ea.jPa);return ba.count?
pa.serialize(ba):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)}getSettings(){if(!this.lSc){const pa=this;this.lSc=new Promise(ba=>{try{pa.oe?ba(pa.oe.clone()):pa.QRj().then(fa=>{pa.oe=fa;ba(pa.oe.clone());return null},()=>{pa.ORj().then(fa=>{pa.oe=fa;ba(pa.oe.clone());return null},()=>{pa.PRj().then(fa=>{pa.oe=fa;ba(pa.oe.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");
pa.oe=new ea;ba(pa.oe.clone());return null});return null});return null})}catch(fa){c.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",fa.toString()),pa.oe=new ea,ba(pa.oe.clone())}})}return this.lSc}QRj(){return new Promise((pa,ba)=>{try{const Ka=-1!==window.location.href.indexOf("&wd_pn=2");if(this.lb.qa("PrivacyDialogShouldCheckRoaming")||Ka){var fa=this.executeRequest(this.Rva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");fa.continueWith(()=>{try{if(fa.Ch||
fa.Xf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{const aa=fa.result;if(aa&&aa.Jg&&aa.Jg.data)if(aa.Jg.data.httpStatus!==n.a.lP)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",aa.Jg.data.httpStatus);else{if(aa.Jg.data.ue){pa(ha.parse(aa.Jg.data.ue,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",aa.Jg.data.ue);
return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");ba("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(aa){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",aa.toString()),ba("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,
3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),ba("Roaming should not be used")}catch(Ka){c.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",Ka.toString()),ba("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}ORj(){return new Promise((pa,ba)=>{try{const fa=ya.a.get("WacUPToggleState");let Ka=null;void 0!==fa&&null!==fa&&0<fa.length&&(Ka=decodeURIComponent(fa));if(void 0!==Ka&&null!==Ka&&0<Ka.length){const aa=ha.parse(Ka,
1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",aa.toString());pa(aa)}else{const aa=ea.create(1),ja=new N.a;ja.add(ea.jPa);const Va=aa.serialize(ja);this.Xeg(Va)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",Va),pa(aa)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",Va),ba("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(fa){c.ULS.sendTraceTag(50860941,
3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",fa.toString()),ba("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}PRj(){return new Promise(pa=>{try{var ba=-1!==window.location.href.indexOf("&wdccsoff=1");let fa=ea.create(2);ba?(fa.ru=2,r.AFrameworkApplication.vLe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",fa.toString())):(fa.ru=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",
fa.toString()));pa(fa)}catch(fa){c.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",fa.toString()),ba=ea.create(2),ba.ru=1,pa(ba)}})}noj(pa){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===pa.ru?r.AFrameworkApplication.vLe():r.AFrameworkApplication.Aph();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",pa)}Xeg(pa){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",
pa);const ba=this.lb.Xa("PrivacyCookieDomain")||"";if(!ba||!ba.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",pa);return ya.a.aSd("WacUPToggleState",pa,ya.a.WV,"/",ba)}catch(ba){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",ba.toString()),!1}}isFeatureEnabled(pa){return this.getSettings().then(ba=>{const fa=this.lb.Zp("ServicesControlsMicrosoftControllerServicesList")?
this.lb.Cw("ServicesControlsMicrosoftControllerServicesList"):[],Ka=new D.a;for(let aa=0;aa<fa.length;aa++)Ka.add(fa[aa]);return Ka.contains(pa)?2!==ba.ru:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",pa);return!0})}static parse(pa,ba){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",pa,ba),ea.deserialize(pa,ba)}catch(fa){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",fa.toString()),
fa;}}}Object(u.a)(ha,"UserPrivacySettingsHelper",null,[315]);var La=a(248);class Ia{constructor(){this.gb=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Wh(pa){this.gb=pa;this.gb.register(314,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").xc().Fc(()=>new K(r.AFrameworkApplication.fa,r.AFrameworkApplication.Dd));this.gb.register(315,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").xc().Fc(()=>new ha(r.AFrameworkApplication.fa,
r.AFrameworkApplication.Dd));this.gb.register(316,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").xc().Fc(()=>new x(r.AFrameworkApplication.fa,r.AFrameworkApplication.Dd));this.gb.register(317,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").xc().Fc(()=>new U(r.AFrameworkApplication.fa,r.AFrameworkApplication.Dd,this.gb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.gb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
r.AFrameworkApplication.ub))}init(){r.AFrameworkApplication.fa.Dv(()=>{const pa=this.gb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");r.AFrameworkApplication.fa.qa("LicensingIsEnabled")&&(pa.isFeatureEnabled("LicensingTestFeature",!1).then(ba=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",ba,r.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}),pa.getFeatureTier("LicensingTestFeature",
0).then(ba=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",ba,r.AFrameworkApplication.fa.Xa("IsAnonymousUser"));return null}));this.gb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.QMj()})}dispose(){}QMj(){try{r.AFrameworkApplication.fa.qa("SideCarIsEnabled")&&S.O8f().then(pa=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
pa);return pa})}catch(pa){}}static main(){La.a.instance.Fi(new Ia)}}Object(u.a)(Ia,"ApplicationFeatureHelperPackage",null,[4,5]);a.d(E,"a",function(){return ra});const ra=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Ia.main()}},1158:function(u,E,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(1362),d=a(635),h=a(549),m=a(27),l=a(87),w=a(30),n=a(157),y=a(235),t=a(8),r=a(58),v=a(154),B=a(345),A=a(47),z=a(46),x=a(29),D=a(1),J=a(22),L=a(13),T=a(103),
O=a(83),G=a(84),C=a(146),H=a(4),I=a(14),M=a(95),Q=a(45),U=a(1075);class N extends C.a{constructor(xb,Vb=!0){super(!1,!1,N.Uu);this.YXa=null;this.o9d=!1;this.rn=[];this.Rj=null;this.NYb=xb;this.cBg=Vb;this.$v=this.Xke=!1;this.Kga=null;this.UJc=!1;this.qg=this.jkh;this.Fe="InsertFileDialog";this.oc(1,this.kZb);N.Uu?(this.YXa={["id"]:this.Fe,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(G.a)(this,this.RXi,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(G.a)(this,this.FOi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(G.a)(this,this.mgc,"insertDialogHandler"),this.YXa),this.qTb=!0):(this.showDialog(this.titleText,Object(G.a)(this,this.mgc,"insertDialogHandler")),Vb&&this.E4f(),(xb=this.nK(1))&&this.rn.push(xb),(xb=this.nK(0))&&this.rn.push(xb),this.Ghg(),this.qTb=!1)}get ZYj(){return this.NYb}validate(){this.Rj.qF||e.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Rj.qF.value?
!0:(N.fA(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}FOi(xb){this.cBg&&(this.Rj=this.D4f(xb,this.NYb))}RXi(){this.Rj&&this.Rj.qF&&(this.o9d||(this.Rj.Ubj(Object(G.a)(this,this.uCd,"onFileChosen")),this.o9d=!0),this.Rj.hWe())}uCd(xb){this.YXa.uploadStatusLabel=xb;this.MUa(this.titleText,Object(G.a)(this,this.mgc,"insertDialogHandler"),this.YXa)}mgc(xb){1===xb&&this.isEnabled()?N.Uu&&this.Rj.qF&&!this.Rj.qF.value?(this.YXa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.MUa(this.titleText,
Object(G.a)(this,this.mgc,"insertDialogHandler"),this.YXa)):(this.Pyb(),this.NYb.finalizeUpload(this.Rj,Object(G.a)(this,this.dispose,"dispose"))):0===xb&&this.hide()}E4f(){this.UJc=!1;this.Rj=this.D4f(document.getElementById("uploadFrameContainer"),this.NYb);H.AFrameworkApplication.fa.qa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.Kga=Object(G.a)(this,this.jEd,"onUploadFrameLoad"),Q.a.addHandler(this.Rj.iFrame,"load",this.Kga));this.Rj.qF||e.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.MNf()}jEd(){this.MNf()}MNf(){if(this.Rj&&!this.UJc){var xb=this.Rj.qF;xb&&(Q.a.addHandler(xb,I.a.Pb,Object(G.a)(this,this.onKeyDown,"onKeyDown")),xb=[xb],this.rn=xb.concat.apply(xb,this.rn),this.Ghg(),this.UJc=!0)}}dispose(){if(this.Rj&&!N.Uu){const xb=this.Rj.qF;xb&&Q.a.removeHandler(xb,I.a.Pb,Object(G.a)(this,this.onKeyDown,"onKeyDown"));this.Kga&&Q.a.removeHandler(this.Rj.iFrame,"load",this.Kga)}this.Rj=null;super.dispose()}Ghg(){if(0<this.rn.length){const xb=new U.a(this.rn),Vb=M.FocusManager.instance().LQ();
Vb&&(this.rn[0].focus(),Vb.jf=xb,Vb.N_=!0)}}onKeyDown(xb){4!==M.FocusManager.instance().ONf(xb)&&xb.preventDefault()}static get Uu(){return H.AFrameworkApplication.sa.Pa.Hv&&H.AFrameworkApplication.sa.Pa.ekf}static fA(xb){const Vb=document.getElementById("errorText");Vb.innerText=xb;Vb.style.display="inline-block"}}Object(u.a)(N,"InsertFileDialog",C.a,[]);class W{static get qg(){return C.a.gq(W.ol,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}W.ol="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(u.a)(W,"InsertImageDialogHtml",null,[]);class X extends N{constructor(xb,Vb=!0){super(xb,Vb)}get kZb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get jkh(){return W.qg}validate(){this.Rj.qF||e.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const xb=Object(O.a)(f.a,this.ZYj),Vb=xb.Kjg(this.Rj.qF.value);return 0!==Vb?(N.fA(xb.z1e(Vb)),!1):!0}}Object(u.a)(X,"InsertImageDialog",N,[]);var sa=a(554);const da=
(xb,Vb,wb)=>{if(xb){var cb=0;do{try{xb();break}catch(lb){if(e.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",cb,wb,lb.message,lb.stack),cb>=Vb)break}cb++}while(1)}};var S=a(106),oa=a(86),K=a(41),ea=a(252),ya=a(200),ha=a(80),La=a(464),Ia=a(170);class ra{constructor(xb,Vb,wb,cb,lb,Y,Oa,Wa,Ca=!0,Ra=null,la=!1){this.oWe="FileUpload.ashx";this.oo=null;this._initialized=!1;this.Ig=this.ijb=this.TJc=this.Kga=this.QTb=this.nr=this.dt=null;
this.Lm=!1;this.qE=this.RTb=this.fUc=null;this._parent=xb;this.Vvg=Vb;this.tAg=wb;this.U9d=lb;this.iSc=Oa;this.a4d=Wa;this.Y5d=Ra;this.eUc=!1;this.rwg=cb.qa("CanaryRenewalForFileUploadIsEnabled");this.Vig=!1;(this.ira=la)||this.E9g(Y);Ca&&this.Tdf()}get PXf(){return this.tAg}get sessionId(){return this.iSc}get iFrame(){return this.oo}get qF(){return this.nr}get a$a(){return H.AFrameworkApplication.fa?H.AFrameworkApplication.fa.qa("NativeFileOpenDialogIsEnabled"):!1}get iWe(){return H.AFrameworkApplication.fa?
H.AFrameworkApplication.fa.qa("FileInputDescriptionAccessibilityIsEnabled"):!1}get qni(){return this.ira?!1:ya.b(this.oo.contentWindow.location.pathname,this.oWe,0)}get vOg(){return!m.a.fla&&H.AFrameworkApplication.fa.qa("AllowMultipleImageInsertFromLocalDevice")}Tdf(){this.qE=Ia.a.create().toString();this.ira?this.T9c():this.xPg()}E9g(xb){this.oo=document.createElement("iframe");this.oo.className=xb;this.oo.id=xb;this.U9d&&(this.oo.style.visibility="visible",this.oo.style.height="30px",this.oo.setAttribute("frameborder",
"0"));this.Kga=Object(G.a)(this,this.jEd,"onUploadFrameLoad");Q.a.addHandler(this.oo,"load",this.Kga)}f8b(xb=null){H.AFrameworkApplication.sa.Wrc();if(!this.nr)return e.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";Q.a.addHandler(this.nr,"change",()=>{this.IDh(xb)});da(Object(G.a)(this,this.hWe,"fileInputClick"),1,"DoFileOpenDialog");return this.nr.value}IDh(xb){xb&&xb(this.nr.value)}JDh(){this.QTb&&(this.QTb.innerText=this.S2e())}Ubj(xb){Q.a.addHandler(this.nr,"change",()=>{xb(this.S2e())})}S2e(){let xb=
null;if(this.nr.value){const Vb=this.nr.value,wb=Vb.lastIndexOf("\\");0<wb&&(xb=Vb.substring(wb+1,Vb.length))}return xb?xb:""}hWe(){try{e.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.nr.click()}catch(xb){throw e.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",xb.message),xb;}}JKj(){this.Cqi()?this.vag():(this.T0d(),this.dt.submit())}Cqi(){return(this.rwg||this.ira)&&!(void 0===window.self.FormData||null===window.self.FormData)}U0f(xb){if(xb){const Vb=
this.iGe();this.Ig=new XMLHttpRequest;this.Ig.open("POST",Vb);this.Ig.setRequestHeader("X-CorrelationId",this.qE);this.Ryi(xb);this.Ig.onreadystatechange=Object(G.a)(this,this.jpa,"uploadResponseReceived");this.Ig.send(xb)}}Ryi(xb){if(!m.a.fla&&xb.get){var Vb=xb.get("ImageId");xb=window.self.navigator;Vb={["CorrelationId"]:this.qE,["Canary"]:H.AFrameworkApplication.canary,["ImageNodeId"]:Vb};xb&&(xb=xb.connection?xb.connection:xb.mozConnection?xb.mozConnection:xb.webkitConnection?xb.webkitConnection:
null)&&(Vb.effectiveType=xb.effectiveType,Vb.downlink=xb.downlink,Vb.type=xb.type,Vb.rtt=xb.rtt);e.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",Vb)}}vag(){try{this.T0d();e.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const xb=new (Type.parse("FormData"))(this.dt);this.U0f(xb)}catch(xb){e.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+xb.message),this.nab(null)}}uag(xb){try{if(this.T0d(),
e.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.Q_j(xb)){this.RTb=xb;this.dt.contains(this.nr)&&this.dt.removeChild(this.nr);var Vb=new (Type.parse("FormData"))(this.dt);Vb.append("applicationfileInput",xb.blob,xb.filename);this.U0f(Vb)}else this.nab(null)}catch(wb){e.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+wb.message),this.nab(null)}}Q_j(xb){return xb&&void 0!==xb.blob&&null!==xb.blob&&
void 0!==xb.filename&&null!==xb.filename&&""!==xb.filename?void 0===window.self.FormData||null===window.self.FormData?(e.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(xb=xb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===xb.blob||null===xb.blob,void 0===xb.filename||null===xb.filename||""===xb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",e.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
xb)),!1)}jpa(){if(4===this.Ig.readyState)if(200===this.Ig.status){e.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.qE);const xb=this.Ig.getResponseHeader("X-NewKey"),Vb=this.oji(this.Ig);let wb=!1;if(void 0!==xb&&null!==xb&&Vb&&(wb=this.F_j(xb),!this.eUc&&wb)){e.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.qE);this.eUc=!0;void 0!==this.RTb&&
null!==this.RTb?this.uag(this.RTb):this.vag();return}e.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.eUc,Vb,!(void 0===xb||null===xb),wb,this.qE);this.nab(this.Ig.responseText)}else e.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Ig.status,this.Ig.responseText?!1:!0,this.qE),this.nab(null)}oji(xb){try{const Vb=
K.a(xb.responseText).Responses;if(void 0!==Vb&&null!==Vb&&1===Vb.length){const wb=Vb[0];if(void 0!==wb&&null!==wb&&2===wb.length&&28===wb[1].StatusCode)return!0}}catch(Vb){}return!1}F_j(xb){La.a.Ggg(xb);return H.AFrameworkApplication.canary!==xb?!1:!0}T0d(){this.fUc||(this.fUc=new Date)}dispose(){this.Lm||(this.ira?this._parent.removeChild(this.dt):(this._parent.removeChild(this.oo),Q.a.removeHandler(this.oo,"load",this.Kga),this.Kga=null),this.TJc&&(Q.a.removeHandler(this.nr,"change",this.TJc),this.TJc=
null),this.iWe&&(this.ijb&&(Q.a.removeHandler(this.nr,"change",this.ijb),this.ijb=null),this.QTb=null),this.nr=this.dt=this._parent=this.oo=null,this.Lm=!0,this.fUc=null,e.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}hbh(xb){if(this.dt){var Vb;(Vb=this.dt.querySelector("input[name=__REQUESTDIGEST]"))?Vb.value=xb:(Vb=this.r5c(),Vb.type="hidden",Vb.id="__REQUESTDIGEST",Vb.name="__REQUESTDIGEST",Vb.value=xb,this.dt.appendChild(Vb))}}r5c(){return this.ira?
document.createElement("input"):this.oo.contentWindow.document.createElement("input")}jEd(){try{if(!this.oo.contentWindow.document.body)return}catch(Vb){this.w8h();return}if(!(this._initialized||this.a$a&&m.a.RF))this.T9c();else if(!this.a$a||!m.a.RF||this.qni){let Vb;Vb=m.a.Fv?this.oo.contentWindow.document.body.innerText:this.Vig?this.oo.contentWindow.document.body.firstChild.innerText:this.oo.contentWindow.document.body.firstChild.innerHTML;var xb=this.oo.contentWindow.document.body.innerText.toLowerCase();
const wb=0<=xb.indexOf("responses")||0<=xb.indexOf("wopisrc");xb=0<=xb.indexOf("http error");!wb&&xb&&e.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.oo.contentWindow.document.body.innerText);this.nab(Vb)}}T9c(){if(!this._initialized){var xb=this.ga("uploadForm");const Vb=this.ga("fileInput"),wb=this.iGe();this.Mah();this.dt.id=xb;this.dt.method="post";this.dt.encoding="multipart/form-data";this.dt.action=wb;this.nr.type="file";this.a4d&&(this.nr.accept=
this.a4d,this.Y5d&&(this.nr.capture=this.Y5d));this.nr.id=Vb;this.nr.name=Vb;this.vOg&&(this.nr.multiple=!0);!this.iWe||m.a.Fv||m.a.$H||(this.ijb=Object(G.a)(this,this.JDh,"fileInputChangedHandleAccessibility"),Q.a.addHandler(this.nr,"change",this.ijb),this.QTb=oa.a.Nte(this.dt,this.nr,"InputFileDescription"));this.U9d&&(this.ira||(xb=this.oo.contentWindow.document.body,xb.style.margin="0",xb.style.overflow="hidden"),xb=H.AFrameworkApplication.sa,this.nr.style.fontFamily=xb.o1,this.nr.style.fontSize=
xb.vCc,this.nr.style.margin="0");(xb=document.getElementById("__REQUESTDIGEST"))&&this.hbh(xb.value);this.dt.appendChild(this.nr);this._initialized=!0;this.Vvg(this)}}Mah(){if(this.ira)this.dt=document.createElement("form"),this._parent.appendChild(this.dt),this.nr=document.createElement("input");else{this.dt=this.oo.contentWindow.document.createElement("form");const xb=this.oo.contentWindow.document;xb.body.appendChild(this.dt);this.nr=xb.createElement("input")}}xPg(){this._parent.appendChild(this.oo);
this.a$a&&m.a.RF&&this.T9c()}iGe(){var xb=new ea.QueryStringBuilder(this.oWe);H.AFrameworkApplication.mZa(xb);this.Qsj(xb);xb=xb.toString();if(m.a.If||m.a.RF||m.a.$H)xb=ha.a.LZe(xb);return xb}voe(){const xb=new S.a(2,1,0,Object(G.a)(this,this.delayedDispose,"delayedDispose"),4);H.AFrameworkApplication.Gi.Eg(xb)}}Object(u.a)(ra,"UploadFrame",null,[2]);var pa=a(42),ba=a(116),fa=a(21);class Ka extends ra{constructor(xb,Vb,wb,cb,lb,Y,Oa=!1){super(xb,Vb,wb,cb,lb,"UploadFrame",Y.ea.sessionId,"image/*",
!1,null,Oa);this.$=Y;this.Vig=!0;this.Tdf()}ga(xb){return xb}Qsj(xb){e.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");ba.a.$Xc(xb,this.$.va);xb.Y9(t.a.sessionId,this.sessionId);var Vb=fa.h(this.$).ha;Vb=pa.o(Vb.ra.x4,this.$);xb.Y9(t.a.t6i,this.$.xa.oa.name);xb.Y9(t.a.s6i,Vb.FirstRow.toString());xb.Y9(t.a.r6i,Vb.FirstColumn.toString())}w8h(){this.PXf("ServerUploadError")}nab(xb){this.PXf(xb)}static oli(xb){return!xb||J.a.equals(xb,"ServerUploadError",!1)}}Object(u.a)(Ka,
"UploadFrameWrapper",ra,[]);class aa extends X{constructor(xb,Vb,wb,cb){super(xb,!1);this.xQ=null;this.QBa=!1;this.htmlSanitizationHelper=null;this.Boc=()=>{this.f0d("");this.JCc();return!1};this.$=Vb;this.WDc=xb;this.ZQ=sa.a.instance;this.fa=wb;this.htmlSanitizationHelper=cb;this.E4f();this.qnd();this.$.rb.uy=!0}D4f(xb,Vb){return new Ka(xb,Object(G.a)(Vb,Vb.JGb,"onUploadFrameInitialized"),Object(G.a)(Vb,Vb.jpa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.JCc();this.ZQ=this.WDc=null;
super.dispose()}hide(){super.hide();this.$.rb.uy=!1}validate(){var xb=this.WDc.A1d(this.Rj.qF.value,this.WDc.Deg(this.Rj));return 0!==xb?(xb=this.WDc.Hfd(xb).Description,this.f0d(xb),this.YWd(),!1):!0}isEnabled(){return!0}f0d(xb){D.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&D.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&this.htmlSanitizationHelper?this.htmlSanitizationHelper.B2f(this.xQ,xb):this.xQ.innerHTML=xb}qnd(){this.xQ=
document.getElementById("errorText");this.xQ.style.display="inline-block";this.QBa=!1;this.f0d("");this.jJa.style.maxWidth=this.jJa.currentStyle.minWidth}YWd(){this.ZQ.ta(I.a.click,this.Rj.qF,this.Boc);this.ZQ.ta(I.a.Pb,this.Rj.qF,this.Boc);this.QBa=!0}JCc(){this.QBa&&(this.ZQ.Ba(I.a.click,this.Rj.qF,this.Boc),this.ZQ.Ba(I.a.Pb,this.Rj.qF,this.Boc),this.QBa=!1)}}Object(u.a)(aa,"InsertImageDialogWrapper",X,[]);var ja=a(51),Va=a(55),bb=a(50),wa=a(37);class ka extends f.a{constructor(xb,Vb,wb,cb,lb=
!0){super(null,Vb,wb);this.cja=this.Wt=null;this.p8a=!1;this.OFd=null;this.jpa=Y=>{this.r2d.stop();this.m1b.cancel();if(Ka.oli(Y))this.IBc?this.d9e(4):(Y=new d.a(0,2,null,null,!1,null,null,null),Y.status=8,this.HZd(new h.a(Y),null,"InsertPictureWebMethod")),e.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.IBc}`);else{const Oa=ka.U_j(Y);0!==Oa?(e.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Y}`),this.d9e(Oa)):this.j8h(Y)}this.lqc();this.dispose()};
this.YNi=Y=>{this.LCa(Y,this.Rj)&&this.finalizeUpload(this.Rj,null)};this.JGb=Y=>{e.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Rj=Y;if(!this.q2a){if(this.a1d){if(this.zze()||this.a$a&&m.a.RF){Y.f8b(this.YNi);return}const Oa=Y.f8b(null);if(!this.LCa(Oa,Y))return}this.finalizeUpload(Y,null)}};this.lXi=()=>{this.IBc=!0};this.jb=xb;this.r2d=xb.Jb.Pg("WebServiceCall","InsertPictureOperation");this.m1b=A.a.instance.create(this.lXi,1E5,z.a.VSg,!1);this.IBc=!1;this.nmc=this.$.va.InsertPictureMaxFileSizeBytes;
cb&&(this.p8a="TestOnly"in cb);lb&&this.showDialog()}get $(){return this.jb}get dDi(){return this.nmc/1024/1024}dispose(){l.a.Ia(this.m1b);this.Rj&&this.Rj.voe();this.Rj=this.m1b=this.jb=null}b$i(xb){if(!this.$)return e.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),Va.Task.Ta(!0);if(!this.$.Qba)return Va.Task.Ta(!0);const Vb=new n.a,wb=new FileReader;xb=xb.qF.files[0];const cb=()=>{Vb.ox(!0)};wb.onload=()=>{this.OFd=wb.result;Vb.ox(!0)};wb.onerror=cb;wb.onabort=cb;
wb.readAsDataURL(xb);return Vb.task}Deg(xb){let Vb=-1;xb=xb.qF;(null===xb||void 0===xb?0:xb.files)&&0<xb.files.length&&(Vb=xb.files[0].size);return Vb}A1d(xb,Vb){let wb=ka.z8g(f.a.LCa(xb));0===wb?-1!==Vb&&(e.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${Vb}, maxAllowedSize: ${this.nmc}, remainingWorkbookSize: ${this.$.ea.aof}`),Vb>this.nmc?wb=3:Vb>this.$.ea.aof&&(wb=7)):6===wb&&this.VAi(xb);e.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${wb}`);
return wb}LCa(xb,Vb){xb=this.A1d(xb,this.Deg(Vb));return 0!==xb?(this.q2a||1===xb||this.BUd(xb),!1):!0}Wdg(xb){xb.JKj()}Hfd(xb){let Vb=0,wb=1,cb=-1100324317,lb="InsertPictureUnknownError",Y=null;switch(xb){case 1:Vb=1749;wb=0;cb=940870981;lb="InsertPictureNoFileSelected";break;case 3:wb=0;cb=1250467391;lb="InsertPicturePictureTooBig";Y=String.format(L.a.instance.nb(181),this.dDi.toLocaleString());break;case 6:Vb=1753;wb=0;cb=1380041209;lb="InsertPictureUnsupportedFormat";break;case 7:Vb=1750;wb=0;
cb=-903115058;lb="InsertPictureExceedWorkbookSize";break;case 4:Vb=1751;wb=0;cb=1218352119;lb="InsertPictureUploadTimeout";break;case 5:Vb=1752,wb=0,cb=1979899005,lb="InsertPictureServiceNonDeterministicError"}xb=ka.Zc(Vb,wb,cb,lb);Y&&(xb.Description=Y);return xb}showDialog(){if(this.zze())this.q2a=!1,this.Rj=new Ka(this.$.domElement,this.JGb,this.jpa,this.fa,!1,this.$,!0);else if(e.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.p8a&&(m.a.Jw||m.a.RF&&72>m.a.HBe))this.q2a=!1,
this.Rj=new Ka(this.$.domElement,this.JGb,this.jpa,this.fa,!1,this.$);else{this.q2a=!0;const xb=D.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&D.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")?bb.GetServiceTaskFactory.Oa(this.$.da,498,499,0):y.a.Ta(null);wa.TaskExtensions.Aa(xb,()=>{this.Rj=(new aa(this,this.$,this.fa,xb.result)).Rj},this.$.la,3)}}j8h(xb){let Vb={};try{if(Vb=r.a.li(xb),ja.b().OA(this.r2d.id,Vb.ServerCorrelationId,
"actions","ServerActions"),!x.a.ag(Vb.Errors)&&Vb.Result){this.$.ea.xX(Vb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const wb=Vb.Result;T.a(this.$).Lna(1,wb);const cb=this.$.da.za(277);cb&&cb.SVc(this.$,1,Vb.Result,Vb,"InsertPicture");e.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(wb){e.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${xb?xb.length:-1}, errror: ${wb}`)}this.kCc(Vb,
null,"InsertPictureWebMethod")}d9e(xb){xb=this.Hfd(xb);const Vb={};Vb.Errors=[xb];this.kCc(Vb,null,"InsertPictureWebMethod")}kCc(xb,Vb,wb){this.Wt(xb,Vb,wb)}HZd(xb,Vb,wb){this.cja(xb,Vb,wb)}BUd(xb){xb=this.Hfd(xb);D.EwaSettings.Iz()?new B.a(this.$,xb):(new v.ErrorDialog(this.$,xb)).vg()}VAi(xb){const Vb=this.$.va.InsertPicturUnsupportedExtensionsForLogging;xb=w.a.ul(xb);for(let wb=0;wb<Vb.length;++wb)if(xb.endsWith(Vb[wb])){e.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${Vb[wb]}`);
break}}static U_j(xb){return!xb||J.a.equals(xb,t.a.insertPictureUnknownError,!0)?2:J.a.equals(xb,t.a.insertPictureNoFileSelectedError,!0)?1:J.a.equals(xb,t.a.$fi,!0)?3:J.a.equals(xb,t.a.agi,!0)?5:0}static Zc(xb,Vb,wb,cb){return x.a.Zc(1,0,0,xb,Vb,wb,cb)}static z8g(xb){switch(xb){case 1:return 1;case 2:return 6}return 0}zze(){return this.p8a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(u.a)(ka,"BasePictureUploaderWrapper",f.a,[2]);class ta extends ka{constructor(xb,Vb,
wb,cb,lb,Y=!0){super(xb,Vb,wb,cb,!1);this.ODh=lb;this.J$b=xb.Jb.Pg("LoadResource","FileReaderUploaderLoadResource");Y&&this.showDialog()}lEj(){this.nmc=28E5;this.BUd(3)}Tbd(xb){e.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const Vb=new FileReader;xb=xb.qF.files;if(0==xb.length)e.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var wb=xb[0];Vb.onload=()=>{this.J$b.stop();this.ODh.HWi(Vb.result,
this);e.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${wb.type}, Size:${wb.size.toString()}`)};Vb.onerror=()=>{this.J$b.stop();e.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${wb.type}, Size:${wb.size.toString()}`)};Vb.onabort=()=>{this.J$b.stop();e.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${wb.type}, Size:${wb.size.toString()}`)};
this.J$b.start();Vb.readAsDataURL(wb)}}finalizeUpload(xb,Vb){this.Tbd(xb,Vb)}}Object(u.a)(ta,"FileReaderUploaderWrapper",ka,[578]);var qa=a(371),rb=a(188);class Za{constructor(xb,Vb){this.dataUri=this.sheetName=null;this.sheetName=xb;this.dataUri=Vb}getSheetName(){return this.sheetName}}Object(u.a)(Za,"MacroRecorderPictureInsertedPayload",null,[137]);class gb extends ka{constructor(xb,Vb,wb,cb,lb,Y=!0){super(xb,wb,cb,lb,!1);this.Wd=Vb;Y&&this.showDialog()}Tbd(xb,Vb){super.finalizeUpload(xb,Vb);qa.a(this.$.userOperationManager,
(wb,cb)=>{this.Wt=wb;this.cja=cb;this.r2d.start();this.m1b.sq();this.IBc=!1;this.Wdg(xb);return this.b$i(xb)},wb=>{const cb={};this.$.pk(cb);const lb=cb.SheetName;wb=new rb.a(510,0,wb,72,()=>new Za(lb,this.OFd?this.OFd:""));wb.nBa(()=>!0);wb.Wd=this.Wd;return wb},this.Wd)}finalizeUpload(xb,Vb){this.Tbd(xb,Vb)}}Object(u.a)(gb,"PictureUploaderWrapper",ka,[]);class mb{constructor(xb,Vb){this.filename=xb;this.blob=Vb}}Object(u.a)(mb,"UploadBlobParameters",null,[]);class Ga extends gb{constructor(xb,Vb,
wb,cb,lb,Y,Oa){super(xb,Vb,wb,cb,lb,!1);this.a1d=!1;this.e1=Oa;this.Ifc=Ga.GJh(Y);xb=this.A1d(this.Ifc.name,this.Ifc.size);0!==xb?(this.BUd(xb),this.e1.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Rj=new Ka(this.$.domElement,this.JGb,this.jpa,cb,!1,this.$)}HZd(xb,Vb,wb){super.HZd(xb,Vb,wb);this.e1.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}kCc(xb,Vb,wb){super.kCc(xb,Vb,wb);x.a.ag(xb.Errors)?this.e1.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${x.a.sc(xb.Errors)}`)):
this.e1.setResult(!0)}Wdg(xb){const Vb=new mb(this.Ifc.name,this.Ifc);xb.uag(Vb)}static GJh(xb){var Vb=xb.split(",");xb=Vb[0].includes("base64")?window.self.atob(Vb[1]):window.self.decodeURI(Vb[1]);Vb=Vb[0].split(":")[1].split(";")[0];const wb=new Uint8Array(xb.length);for(let cb=0;cb<xb.length;cb++)wb[cb]=xb.charCodeAt(cb);xb=new Blob([wb],{type:Vb});xb.name="Image.png";return xb}}Object(u.a)(Ga,"DataUrlUploaderWrapper",gb,[]);class ib{constructor(){}Lei(xb,Vb,wb,cb,lb){new gb(xb,Vb,wb,cb,lb,!0)}Ldi(xb,
Vb,wb,cb,lb,Y){new Ga(xb,null,Vb,wb,cb,lb,Y)}Wdi(xb,Vb,wb,cb,lb){new ta(xb,Vb,wb,cb,lb,!0)}}Object(u.a)(ib,"UploaderCreator",null,[554]);class cc extends b.a{constructor(xb){super();this.$=xb;this.Fb()}static ka(xb){xb.da.Ga(485,new cc(xb))}create(){var xb;this.ob(null!==(xb=this.$.da.za(484))&&void 0!==xb?xb:this.$.da.Ga(484,new ib))}}Object(u.a)(cc,"UploaderCreatorFactory",b.a,[]);a.d(E,"a",function(){return ic});const ic=()=>{c.a.Fa(xb=>{cc.ka(xb)})}},1191:function(u,E,a){var c=a(9);u=a(0);var b=
a(692),e=a(157),f=a(102),d=a(4),h=a(183),m=a(15),l=a(1362),w=a(30),n=a(97),y=a(82),t=a(556),r=a(170),v=a(42),B=a(371),A=a(188),z=a(283),x=a(29),D=a(282),J=a(11),L=a(13),T=a(281),O=a(103),G=a(21),C=a(146),H=a(86),I=a(95),M=a(164),Q=a(180),U=a(89),N=a(154),W=a(345),X=a(1),sa=a(1240),da=a(80);class S extends sa.a{constructor(ja,Va){super(ja,da.a.eba(Va))}ytc(ja,Va){this.isEnabled()&&this.tGa(this.targetOrigin)&&(this.so(ja),this.dm(ja,Va))}}Object(u.a)(S,"InsertMediaCrossDocumentMessenger",sa.a,[606,
197,2]);var oa=a(7);class K{}Object(u.a)(K,"OnlineMediaSearchResult",null,[]);var ea=a(315);class ya extends C.a{constructor(ja,Va,bb,wa,ka,ta){super();this.dic=!1;this.bDb=this.KR=this.$wa=null;this.TKi=()=>{this.ava(this.X_a)};this.bud=qa=>{qa.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==qa.target.id||qa.shiftKey?"KeepFocusStartDiv"===qa.target.id&&qa.shiftKey&&(qa.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(qa.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};
this.eSi=()=>{this.Rob&&(this.Rob.launchUpsellExperience("stockimages"),m.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.Pl=ta;this.$=ja;this.ief=Va;this.Rob=bb;this.XAa=[];this.duf=wa;this.kkh=ka;this.Jse=this.$.va.InsertOnlinePictureMaxCountOfImagesToInsert;this.qg=this.vbh()}LEj(ja){this.dic=!1;this.showDialog(this.Pl,null);this.$wa=document.getElementById(this.mi("InsertMediaFrame"));if(!this.$wa)throw this.ava(this.X_a),Error.invalidOperation("Couldn't get InsertMediaIframe.");
var Va=document.getElementById(this.mi("WACDialogPanel"));Va&&Va.setAttribute(H.a.Ld,H.a.n_a);Va=document.createElement("div");Va.id="KeepFocusStartDiv";Va.tabIndex=0;Va.className="keep-focus-start";this.$wa.parentNode.insertBefore(Va,this.$wa.parentNode.firstChild);Va=document.createElement("div");Va.id="KeepFocusDiv";Va.tabIndex=0;Va.className="keep-focus";this.$wa.parentNode.appendChild(Va);$addHandler(this.jJa,"keydown",this.bud);this.$wa.src=this.ief;this.$wa.frameBorder="0";Va=document.getElementById(this.mi("WACDialogButtonPanel"));
if(!Va)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");Va.className="display-none";Va=document.getElementById(this.mi("WACDialogTitleText"));if(!Va)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");Va.className="display-none";2===this.duf&&(document.getElementById(this.mi("WACDialogTitlePanel")).className="display-none",document.getElementById(this.mi("WACDialogBodyPanel")).className="padding-zero");I.FocusManager.instance().LQ().scope.IN=!0;this.KR=new S(this.$wa.contentWindow,
this.ief);this.KR.ytc(M.a.RGg,bb=>{this.JJi(bb,ja.jpa)});this.KR.ytc(M.a.insert,()=>{this.rRi(ja.jpa)});this.KR.ytc(M.a.s0c,this.TKi);2===this.duf&&0===this.kkh&&(this.KR.ytc(M.a.xvi,this.eSi),this.bDb=this.Rob.hna("MsoPremiumStockImages",bb=>{m.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");bb.isEnabled?this.KR.Pj(M.a.TYj,{["LicenseTier"]:bb.toString()}):m.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.XAa=
null;this.Rob&&this.bDb&&this.Rob.NKd("MsoPremiumStockImages",this.bDb);this.KR&&(this.KR.dispose(),this.KR=null);super.dispose()}hide(){super.hide();U.a.Lxc(this.$)}get y4(){return Q.a.z7b+"/InsertMediaDialog"}get RY(){return!1}JJi(ja,Va){ja=ja&&ja.Values?(ja=ja.Values)?Object(oa.a)(new K,{Action:ja.action||"",Caption:ja.caption||"",ContentType:ja.contentType||"",FileExtension:ja.extension||"",PageUrl:ja.pageUrl||"",SourceUrl:ja.sourceUrl||"",ThumbnailUrl:ja.thumbnailUrl||"",LicenseUrl:ja.licenseUrl||
"",LicenseDisplayName:ja.licenseDisplayName||"",Height:ja.height||0,Width:ja.width||0}):null:null;ja&&(this.XAa.push(ja),this.dic&&(m.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),Va(this.XAa),this.dic=!1,this.ava(this.X_a)))}rRi(ja){this.XAa&&0<this.XAa.length?this.XAa.length<=this.Jse?(ja(this.XAa),this.ava(this.X_a)):(this.fA(),m.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.XAa.length=
0):this.dic=!0}vbh(){const ja=document.createElement("div");ja.id="InsertMediaDialog";ja.className=X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const Va=document.createElement("div");Va.id="InsertMediaPanel";Va.className=X.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const bb=document.createElement("iframe");
bb.id="InsertMediaFrame";bb.className="insert-media-frame";ja.appendChild(Va);Va.appendChild(bb);return ea.b(ja)}fA(){const ja=x.a.Zc(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");ja.Description=String.format(L.a.instance.nb(206),this.Jse.toLocaleString());X.EwaSettings.Iz()?new W.a(this.$,ja):(new N.ErrorDialog(this.$,ja)).vg()}}Object(u.a)(ya,"InsertMediaDialog",C.a,[]);var ha=a(461),La=a(377);class Ia extends l.a{constructor(ja,Va,bb,wa,ka,ta){super(null,bb,wa);this.Erf=0;this.jpa=qa=>
{if(qa){var rb=Array(qa.length);for(var Za=0;Za<qa.length;Za++){const Ga=qa[Za];rb[Za]={};rb[Za].SourceUrl=Ga.SourceUrl;w.a.Bxa(Ga.LicenseUrl)&&w.a.Bxa(Ga.PageUrl)&&(rb[Za].LicenseUrl=Ga.LicenseUrl,rb[Za].LicenseDisplayName=Ga.LicenseDisplayName,rb[Za].PageUrl=Ga.PageUrl);rb[Za].AltText=-2053056795===this.Wd.command?Ga.Caption:""}var gb=-2009825598===this.Wd.command?"bing":"M365";Za=G.h(this.$);var mb=v.o(Za.ha.ra.activeCell,this.$);B.a(this.$.userOperationManager,(Ga,ib,cc)=>z.s(this.$.pa.ya,mb,
rb,gb,T.b(Ga,this.PTi),T.a(ib,this.OTi),cc,null),Ga=>new A.a(595,0,Ga),this.Wd);J.HelperMethods.s_?(Za=new Map,Za.set("MediaProvider",gb),Za.set("ImagesCount",qa.length.toString()),Za.set("TimeTakenToOpenDialog",this.Erf.toString()),n.Health.instance.recordKpiUsage(La.a.Xfi,1,ha.a.Sbg,Za)):m.ULS.sendTraceTag(537155805,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.lqc()}else m.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};
this.PTi=qa=>{D.a(qa)?m.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${x.a.sc(qa.Errors)}`):(m.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),qa.Result?O.a(this.$).Lna(1,qa.Result):m.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.OTi=()=>{m.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};
this.$=ja;this.Wd=Va;this.e1=ta;this.ute=y.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let ja=null;ja=this.$.Jb.Ac("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.Wd.command){case -2009825598:this.VDj();break;case -2053056795:this.ute.execute(Va=>{Va.isFeatureEnabled("MsoPremiumStockImages",!1).catch(bb=>m.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${bb}`)).then(bb=>
{this.WDj(bb);return null})})}ja.stop();this.Erf=ja.zc}VDj(){let ja=this.$.va.BingPictureEndpoint;const Va=t.a.qK(d.AFrameworkApplication.lcid),bb=r.a.create();ja?(ja=0<ja.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(ja,1,1):String.format(ja,1,d.AFrameworkApplication.lcid,Va?Va.name:"en-us",d.AFrameworkApplication.buildVersion,bb.toString(),1,this.$.va.DocumentHostInfo.LoggableUserId),this.x5b(ja,1,-1,L.a.instance.ga(1755))):(m.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),
this.e1.setException(Error.create("Failed to access the Bing service endpoint")))}WDj(ja){var Va=this.$.va.M365PictureEndpoint,bb=r.a.create();if(Va){var wa=this.$.va.DocumentHostInfo.UserId;wa=wa?w.a.mw(wa).toString():"0";var ka=this.ute.instance.isFreemiumUpsellEnabled();ja=ja?1:ka?0:-1;bb=bb.toString();ka=t.a.qK(d.AFrameworkApplication.lcid).name;Va=String.format(Va,d.AFrameworkApplication.lcid,ka,d.AFrameworkApplication.buildVersion,bb,1,wa,ja,1);this.x5b(Va,2,ja,L.a.instance.ga(1754))}else m.ULS.sendTraceTag(537155803,
0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.e1.setException(Error.create("Failed to access the M365 service endpoint"))}x5b(ja,Va,bb,wa){try{(new ya(this.$,ja,y.a.instance.Kh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),Va,bb,wa)).LEj(this),this.e1.setResult(!0)}catch(ka){m.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${ka}] [MediaProvider : ${Va}] [DialogLicenseTier : ${bb}]`),
this.e1.setException(ka)}}}Object(u.a)(Ia,"OnlinePictureUploaderWrapper",l.a,[2]);var ra=a(55);class pa{constructor(ja,Va){this.$=ja;this.uploaderCreator=Va}executeCommand(ja,Va,bb){ja=Va.command;switch(ja){case 1403967063:if(bb&&"dataUrl"in bb)return Va=new e.a,this.uploaderCreator&&this.uploaderCreator.Ldi(this.$,f.a.instance,d.AFrameworkApplication.fa,bb,bb.dataUrl,Va),Va.task;this.uploaderCreator&&this.uploaderCreator.Lei(this.$,Va,f.a.instance,d.AFrameworkApplication.fa,bb);return ra.Task.Ta(!0);
case -2053056795:case -2009825598:return ja=new e.a,new Ia(this.$,Va,f.a.instance,d.AFrameworkApplication.fa,bb,ja),ja.task;default:return h.a(ja)}}wc(ja,Va){if(ja=this.$.isEditMode)switch(Va.command){case 1403967063:ja=!0;break;case -2053056795:ja=!0;break;case -2009825598:ja=!0;break;default:ja=!1}return ja}Kc(){return!1}nc(){return!1}}Object(u.a)(pa,"PictureCommandHandler",null,[223]);var ba=a(37),fa=a(50);class Ka extends b.a{constructor(ja){super(ja)}ld(){ba.TaskExtensions.Aa(fa.GetServiceTaskFactory.Oa(this.$.da,
484,485,1),ja=>{this.Yc([new pa(this.$,ja.result)])},this.$.la,3)}static ka(ja){b.a.Nd(90,new Ka(ja))}}Object(u.a)(Ka,"PictureCommandHandlerFactory",b.a,[]);a.d(E,"a",function(){return aa});const aa=()=>{c.a.Fa(ja=>{Ka.ka(ja)})}},1216:function(u,E,a){var c=a(9);u=a(0);var b=a(222),e=a(15),f=a(511),d=a(38),h=a(4),m=a(60);class l{}l.$fd="GetFontPreviewData";Object(u.a)(l,"FontWebServiceMethods",null,[]);const w=(J,L,T,O,G=null)=>{const C=l.$fd;G=J.Na(5,G);G.locale=h.AFrameworkApplication.uiCulture;
return m.g(J,C,G,L,T,O,null,644)};var n=a(11),y=a(1),t=a(39),r=a(116),v=a(29);const B={xlyellow:"xlyellow"};class A extends d.a{constructor(J,L){super();this.$=J;this.wv=L;this.pva={};this.TO={};this.$ue=!1;this.styles=null;this.zOi=(T,O,G)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${G} has succeeded.`);this.U3i(T);this.$ue=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",
t.PageLoadTrackingInfo.instance.jwa(new Date));this.L7i()};this.AOi=(T,O,G)=>{T=r.a.Pe(T.data);T=v.a.sc(T);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${T} for method: ${G}`)};this.Hjj=()=>{this.Gl&&this.$fd(this.zOi,this.AOi)};this.Gl=y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.Hjj()}U3i(J){if(this.Fsi(J)){var L=n.HelperMethods.t6(()=>{const T=J.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${T.PreviewUrl}') format('truetype')}`;
const O=T.FontFacePropertiesList;let G,C,H;T.FontNameList.forEach((I,M)=>{this.pva[I]=O[M].Codepoint;let Q=`https://fs.microsoft.com/fs/${T.CatalogVersion}/rawguids/${O[M].FontGuid}`;this.styles=this.Mte(this.styles,I,Q,O[M].FontWeight);this.TO[I]=O[M].LocalizedFontName;"Segoe UI Semibold"===I&&(G=O[M].FontFamily,C=Q,H=O[M].FontWeight)});G&&(this.styles=this.Mte(this.styles,G,C,H));f.a.Oi(this.styles)});10<L&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${L}`)}}Fsi(J){if(!J.Result)return e.ULS.sendTraceTag(520710158,
1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),!1;J=J.Result;return J?J.PreviewUrl?J.FontFacePropertiesList?J.FontNameList?0===J.FontFacePropertiesList.length||J.FontFacePropertiesList.length!==J.FontNameList.length?(e.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),
!1):(e.ULS.sendTraceTag(520710155,1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}Mte(J,L,T,O){return J+`@font-face{font-family:"${L}";src:url('${T}');font-weight:${O};}`}$fd(J,L){return w(this.wv,
J,L,null,this.wv.Wb())}L7i(){this.Mhc&&this.raiseEvent(A.hYe)}get OAc(){return this.TO}get mHh(){return this.pva}get Mhc(){return this.$ue}isFontSupported(J){return this.Gl&&this.TO&&(!!this.TO[J]||!!B[J.replace(/\s/g,"").toLowerCase()])}$qe(J){this.addHandler(A.hYe,J)}}A.hYe="fsmFD";Object(u.a)(A,"FontServiceManager",d.a,[548]);var z=a(695);class x extends b.a{constructor(J){super();this.$=J;this.Fb()}static ka(J){J.da.Ga(505,new x(J))}create(){this.ob(Object(z.a)(this.$.da,504,()=>new A(this.$,
this.$.pa.wv)))}}Object(u.a)(x,"FontServiceManagerFactory",b.a,[]);a.d(E,"a",function(){return D});const D=()=>{c.a.Fa(J=>{x.ka(J)})}},1254:function(u,E,a){u=a(0);var c=a(107),b=a(222),e=a(15),f=a(14),d=a(38),h=a(174),m=a(91),l=a(1),w=a(21),n=a(5);class y extends d.a{constructor(A,z,x){super();this.statusBarManager=null;this.CLe=()=>{this.M7b()};this.Okh=()=>{this.M7b()};this.BLe=D=>{10===D&&this.M7b()};this.onKeyDown=D=>13===D.Ca.keyCode?(D=new m.a(237279923,1,2,6,null),this.$.Ja.Kb(D,{[n.a.skipClipboardAccess]:!0,
[n.a.xPe]:!0}),!0):!1;this.$=A;this.Ho=z;this.Gm=x;this.g$c=!1;(this.P6f=l.EwaSettings.getBooleanFeatureGate(h.a.xQa,!1))&&this.$.da.$a(29,D=>{this.statusBarManager=D;D.GJ(this)})}dispose(){this.gk();this.Gm=this.Ho=this.$=null;this.statusBarManager&&(this.statusBarManager.iG(this),this.statusBarManager=null)}Gn(){return this.P6f}ns(A,z){if("QueryPasteShortcutEnabledLabel"!==A&&!y.YJj.includes(A))return!1;const x=this.Go();"QueryPasteShortcutEnabledLabel"===A?(z.Visible=x,e.ULS.sendTraceTag(537167636,
0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${x} for commandId ${A}`)):(z.Visible=!x,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!x} for commandId ${A}`));return!0}Fph(){this.Lj();this.raiseEvent("pasteShortcutStatusChanged")}M7b(){this.gk();this.raiseEvent("pasteShortcutStatusChanged")}Go(){return this.g$c}Lq(A){this.addHandler("pasteShortcutStatusChanged",A)}fr(A){this.removeHandler("pasteShortcutStatusChanged",A)}Lj(){if(!this.Go()){this.g$c=
!0;w.h(this.$).Ai.Yk(this.CLe);this.Gm.ka("blur",this.Okh);const A=this.$.da.za(65);A&&A.z3&&A.z3.registerForCommentEvents(this.BLe);this.Ho.Ms(f.a.Pb,this.$.qu,this.onKeyDown,!0)}}gk(){if(this.Go()){this.g$c=!1;w.h(this.$).Ai.Hk(this.CLe);this.Gm.detach("blur");const A=this.$.da.za(65);A&&A.z3&&A.z3.unregisterForCommentEvents(this.BLe);this.Ho.Vs(f.a.Pb,this.$.qu,this.onKeyDown,!0)}}}y.YJj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(u.a)(y,"PasteShortcutManager",d.a,[625,211,
212,2]);var t=a(127);class r extends b.a{constructor(A){super();this.$=A;this.Fb()}create(){const A=this.$;this.ob(A.da.za(478)||this.$.da.Ga(478,new y(A,c.KeyInputManager.instance,t.a.instance.uH())))}static ka(A){A.da.Ga(479,new r(A))}}Object(u.a)(r,"PasteShortcutManagerFactory",b.a,[]);var v=a(9);a.d(E,"a",function(){return B});const B=()=>{v.a.Fa(A=>{r.ka(A)})}},1255:function(u,E,a){var c=a(9);u=a(0);var b=a(107),e=a(222),f=a(127),d=a(7),h=a(15),m=a(4),l=a(1400),w=a(14),n=a(5),y=a(899),t=a(47),
r=a(28),v=a(21),B=a(1),A=a(42),z=a(64),x=a(343),D=a(37),J=a(50),L=a(33);class T{constructor(C,H,I,M){this.recoveryUI=null;this.Xdg=(Q="Paste")=>{var U=z.d(this.$.xa.oa);U=new x.a(this.pasteRange,U);this.QZd(U,Q)};this.Xhg=()=>{this.recoveryUI&&(this.d2d=r.a.Qa.ve.m,this.hide(),t.a.instance.create(()=>{this.DXj()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.QLe=Q=>{10===Q&&this.pua()};this.flh=()=>{if(this.recoveryUI){const Q=document.getElementById("PasteRecoveryUI");Q&&
n.a.Bk===Q.getAttribute(n.a.JY)&&Q.click();this.documentHidden=!0;this.pua()}};this.RLe=()=>{this.pua()};this.SLe=()=>{this.pua()};this.onKeyUp=Q=>{if(this.recoveryUI){if(this.I_)return!1;if(17===Q.Ca.keyCode&&this.m$b){Q=document.getElementById("PasteRecoveryUI");if(!Q)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const U=Q.getAttribute(n.a.JY)||"";if(n.a.xr===U)return Q.click(),!0}}return!1};this.onKeyDown=Q=>{if(this.recoveryUI){this.m$b=
!1;this.I_=Q.ctrlKey;Q=Q.Ca.keyCode;if(27===Q)return this.pua(),B.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&(Q=this.$.da.za(254))&&Q.Ar("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===Q)return this.m$b=!0}return!1};this.XN=(Q,U)=>{this.tCb=Q=U.Wd;if(B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(Q.command){case -1027730316:case -1059615499:if(U.properties&&
U.properties.launcherId===this.m3e())return;break;case -847286761:if(U.properties&&(13===U.properties.CalloutName||18===U.properties.CalloutName))return}this.pua()}else-1027730316!==Q.command&&-1059615499!==Q.command?this.pua():(U=U.properties)&&U.launcherId!==this.m3e()&&this.pua()};this.$=C;this.Vsc=H;this.Ho=I;this.Gm=M;this.Fkc=this.tCb=this.jud=null;this.I_=this.m$b=this.R7b=this.Yec=!1;this.d2d=0;this.documentHidden=!1;this.grid=v.h(this.$);this.pasteRange=null;B.EwaSettings.nl()||this.$.da.Ga(406,
this)}dispose(){this.Rfg();this.Xfg();this.Fkc=this.jud=this.recoveryUI=this.Gm=this.Ho=this.Vsc=this.$=null;this.d2d=0}vTg(C){this.recoveryUI=C;this.jud=C.pNg;this.Fkc=C.iaj}pua(){this.recoveryUI&&(this.pasteRange=A.K(this.recoveryUI.rVe),this.LHj(),this.hide(),this.Rfg(),this.recoveryUI=null)}LHj(){const C=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];m.AFrameworkApplication.Ip("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");
B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.tCb&&C.includes(this.tCb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${y.a[this.tCb.command]}`),this.tCb=null):B.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.PasteCoOccurence",
!1)?h.ULS.sendTraceTag(509723927,306,50,"RecoveryUIController:smartViewOnPaste Format as table prompt already triggered with the paste recovery UI."):this.documentHidden?(h.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.G$a(()=>{this.Xdg("Paste")}))}DV(){return this.grid.Ea.EN(4,this.$.oa)}G$a(C){if(this.DV())C();else{h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state.");
const H=()=>{this.DV()&&(C(),this.grid.wcb(H))};this.grid.AZa(H)}}Api(){return!!this.recoveryUI&&this.Vsc.Dli}GFj(C){m.AFrameworkApplication.Ip("XLS-SmartView-PasteCoOccurence-Treatment;XLS-SmartView-PasteCoOccurence-Control");L.a.cri()&&(this.pasteRange=A.K(this.recoveryUI.rVe),this.G$a(()=>{this.Xdg("PasteCoOccurence")}));this.recoveryUI?this.show(C):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}m3e(){return this.recoveryUI?this.recoveryUI.Ovi:null}show(C){const H=
this.recoveryUI.iRh();H?(this.Vsc.showFloatie(Object(d.a)(new l.a,{x:H.x,y:H.y}),this.recoveryUI.UKa(),C),this.Lj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.Api()&&this.Vsc.gD();this.Xfg()}Lj(){if(!this.R7b){var C=v.h(this.$);C.view.nt(this.Xhg);C.Ai.Yk(this.RLe);this.Gm.ka("blur",this.flh);this.$.Ja.osa(this.XN);this.$.xa.Vf(this.SLe);(C=this.$.da.za(65))&&C.z3&&C.z3.registerForCommentEvents(this.QLe);this.R7b=!0}this.Yec||(this.Ho.Ms(w.a.Pb,this.$.domElement,
this.onKeyDown,!0),this.Ho.Ms(w.a.Fd,this.$.domElement,this.onKeyUp,!0),this.Yec=!0)}Rfg(){if(this.R7b){var C=v.h(this.$);C.view.gr(this.Xhg);C.Ai.Hk(this.RLe);this.Gm.detach("blur");this.$.Ja.BAa(this.XN);this.$.xa.Dg(this.SLe);(C=this.$.da.za(65))&&C.z3&&C.z3.unregisterForCommentEvents(this.QLe);this.R7b=!1}}Xfg(){this.Yec&&(this.Ho.Vs(w.a.Pb,this.$.domElement,this.onKeyDown,!0),this.Ho.Vs(w.a.Fd,this.$.domElement,this.onKeyUp,!0),this.Yec=this.I_=this.m$b=!1)}DXj(){this.recoveryUI&&250<=r.a.Qa.ve.m-
this.d2d&&this.show(-1)}QZd(C,H){D.TaskExtensions.Aa(J.GetServiceTaskFactory.Oa(this.$.da,426,427,1),I=>{void I.result.Lea(C,H);h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(u.a)(T,"RecoveryUIController",null,[361,2]);class O extends e.a{constructor(C){super();this.$=C;this.Fb()}create(){if(B.EwaSettings.nl())this.bHi();else{const C=this.$;C.ky(H=>{H.Ufc().then(I=>{this.ob(this.$.da.za(406)||
new T(C,I,b.KeyInputManager.instance,f.a.instance.uH()))})})}}bHi(){const C=this.$;let H=this.$.da.za(406);H?this.ob(H):C.ky(I=>{I.Ufc().then(M=>{H=new T(C,M,b.KeyInputManager.instance,f.a.instance.uH());this.$.da.Ga(406,H);this.ob(H)})})}static ka(C){C.da.Ga(405,new O(C))}}Object(u.a)(O,"RecoveryUIControllerFactory",e.a,[]);a.d(E,"a",function(){return G});const G=()=>{c.a.Fa(C=>{O.ka(C)})}},1265:function(u,E,a){u=a(0);var c=a(58),b=a(15),e=a(252);class f{constructor(l,w){this.testName=null;this.startTimeMs=
0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=l;this.caller=w;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(u.a)(f,"NetworkTestResult",null,[]);var d=a(580);class h{constructor(l,w,n,y,t){this.url="";this.u6a=!1;this.i8=-1;this.testIteration=0;this.baseUrl=
n;this.Kzf=y;this.Pld=w;this.result=new f(w,t)}runTest(){try{if(this.u6a)return b.ULS.sendTraceTag(537155206,0,50,`NetworkTestReq.RunTest: a test for the host ${this.Pld} is already mid way, not starting a new one.`),!1;this.reset();this.u6a=!0;this.result.startTimeMs=Date.now();const l=new e.QueryStringBuilder(this.baseUrl);l.Y9("tid",this.result.startTimeMs.toString());this.url=l.toString();this.Jqj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(l){return this.hvb("Exeption: "+
l.message),!1}}reset(){this.url="";this.result.reset();this.u6a=!1;this.i8=-1}clearTimeout(){-1!==this.i8&&(window.clearTimeout(this.i8),this.i8=-1)}Jqj(){try{const l=new XMLHttpRequest;l.onreadystatechange=()=>{4===l.readyState&&(200===l.status?this.EFh():this.hvb(`Error when downloading resource. status code: ${l.status}, status text: ${l.statusText}`,l.status.toString()))};l.onerror=()=>{this.hvb(`Client error when attempting to download resource. status code: ${l.status}, response: ${l.statusText}`)};
this.i8=window.setTimeout(()=>{this.i8=-1;this.hvb("Request timeout")},1E4);l.open("GET",this.url,!0);l.send(null)}catch(l){this.hvb("Exeption: "+l.message)}}EFh(){this.u6a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=d.a(this.url),this.result.isSuccess=!0,this.v4b())}hvb(l,w=null){this.u6a&&(this.clearTimeout(),this.result.errorMessage=l,this.result.isSuccess=!1,this.result.errorStatusCode=w,this.v4b())}v4b(){this.u6a=!1;
this.Kzf&&this.Kzf(this.result,this.Pld)}}Object(u.a)(h,"NetworkTestReq",null,[]);a.d(E,"a",function(){return m});class m{static Xdd(l,w,n,y=null){m.hnc||(m.hnc=Array.isArray(c.a.li(n.va.NetworkMeasurementUrlList))?c.a.li(n.va.NetworkMeasurementUrlList):null);const t=[];for(let r=0;r<m.hnc.length;r++){const v=m.hnc[r];let B=v.key;B||(B=v.Key);if(y&&!y.includes(B))continue;let A=v.value;A||(A=v.Value);B&&A&&t.push(new h(n,B,A,l,w))}return t}}m.hnc=null;Object(u.a)(m,"NetworkConnectionHelpers",null,
[])},1362:function(u,E,a){u=a(0);var c=a(15),b=a(84);a(106);var e=a(27);class f{constructor(y,t,r){this.Rj=this.iEd=null;this.BFa=this.H9=0;this.STb=null;this.XS=y;this.he=t;this.lb=r;this.q2a=!1;this.a1d=!0;this.Akj();this.a$a=this.fa.qa("NativeFileOpenDialogIsEnabled")}get context(){return this.XS}get fa(){return this.lb}get retryCount(){return this.H9}get YNd(){return this.BFa}JGb(y){this.Rj=y;if(!this.q2a){if(this.a1d){if(this.a$a&&e.a.RF){this.STb=y.f8b(Object(b.a)(this,this.uCd,"onFileChosen"));
return}this.STb=y.f8b(null);if(!this.LCa(this.STb,y))return}this.finalizeUpload(y,null)}}uCd(y){if(this.LCa(y,this.Rj)){if(e.a.RF||e.a.If)this.STb=y;this.finalizeUpload(this.Rj,null)}}lqc(){this.iEd&&this.iEd()}Akj(){this.H9=0;this.BFa=this.fa.rd("Box4UploadRetryDelayStart",200);this.Rj&&(this.Rj.dispose(),this.Rj=null)}}Object(u.a)(f,"FileUploader",null,[]);var d=a(4),h=a(320),m=a(783),l=a(134),w=a(30);a.d(E,"a",function(){return n});class n extends f{constructor(y,t,r){super(y,t,r);this.vWb=this.Sra=
null}get QO(){return d.AFrameworkApplication.sa.iE}z1e(y){switch(y){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}Kjg(y){return n.LCa(y,this.C3h())}C3h(){return n.lme}LCa(y,t=null){y=this.Kjg(y);return 0!==y?(t&&t.voe(),2===y&&this.vj(0,this.z1e(y)),!1):!0}finalizeUpload(y,t){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.iEd=t;this.TEj();h.a.mark(5576);this.vWb=this.QO.Ac("LoadResource",
"PictureUploadTime")}vj(y,t){const r=new l.StandardDialog;r.Rb=0;r.fA(y,CommonUIStrings.l_ImageUploadFailedTitle,t,null)}lqc(){c.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");super.lqc();this.vWb&&(this.vWb.stop(),this.vWb=null);this.y3g()}TEj(){this.Sra=(new m.a).create();this.Sra.message=CommonUIStrings.l_ImageUploadWait;this.Sra.Rb=5;this.Sra.It=!1;this.Sra.EBa(null,null,null)}y3g(){this.Sra&&(this.Sra.close(),this.Sra=null)}static G9h(y,t){y=w.a.ul(y);for(let r=0;r<t.length;++r)if(y.endsWith(t[r]))return!0;
return!1}static LCa(y,t=null){t||(t=n.lme);return y?n.G9h(y,t)?0:2:1}}n.lme=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(u.a)(n,"PictureUploader",f,[])},1434:function(u,E,a){a.r(E);var c=a(1155),b=a(0),e=a(15),f=a(4),d=a(119),h=a(397);class m extends h.a{constructor(ec){super(ec)}get m5b(){return!1}createElement(){const ec=document.createElement("link");ec.setAttribute("rel","stylesheet");ec.setAttribute("type","text/css");ec.setAttribute("href",this.Tt);return ec}m5c(){return null}Jtc(){this.element.setAttribute("href",
"");this.element.setAttribute("href",this.Zz.Tt)}}Object(b.a)(m,"CssResource",h.a,[]);var l=a(374),w=a(228),n=a(30),y=a(55);class t{constructor(){this.BWb=this.XTb=null}Vwi(){this.XTb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.XTb=y.Task.WAA(t.$wi(),t.Swi()),this.XTb.continueWith(ec=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",n.a.Ifd(ec.exception))},5));return this.XTb}Xwi(){if(!this.BWb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),
this.BWb=y.Task.WAA(t.M9c(w.a.create(f.AFrameworkApplication.fa.Xa("DimeUrl"),null,null))),this.BWb.continueWith(ec=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",n.a.Ifd(ec.exception))},5)}catch(ec){e.ULS.sendTraceTag(594874951,324,10,"{0}",n.a.Ifd(ec))}return this.BWb}static $wi(){var ec=t.Bdc("inproductmessaging.js");ec=w.a.create(ec,null,null);return t.M9c(ec)}static Swi(){var ec=t.Bdc("inproductmessaging.css");ec=new m(ec);return t.M9c(ec)}static Bdc(ec){return d.a.s4b(String.format("ipm/{0}",ec))}static M9c(ec){l.a.Sia(ec);
return ec.k9a}}Object(b.a)(t,"DependencyDownloader",null,[907]);class r{}r.VZi="inProductMessagingOverlayDiv";r.N1i="PlayButtonImage";r.yij="ReplayButtonImage";Object(b.a)(r,"Constants",null,[]);class v{constructor(){this.cke=this.xee=this.a5d=!0;this.zij=this.O1i=null;this.dGi=!1;this.locale=null;this.nfg={}}get qwe(){return this.a5d}set qwe(ec){this.a5d=ec}get Ouf(){return this.xee}set Ouf(ec){this.xee=ec}get Q7f(){return this.cke}set Q7f(ec){(this.cke=ec)&&this.pwj()}pwj(){this.Mpe(r.N1i,this.O1i);
this.Mpe(r.yij,this.zij)}Mpe(ec,Vc){Vc&&(this.nfg[ec]=Vc)}}Object(b.a)(v,"FirstRunExperienceUISettings",null,[906]);class B{constructor(){this.completed=this.adj=!1}}Object(b.a)(B,"FirstRunExperienceViewData",null,[905]);var A=a(84),z=a(175),x=a(105),D=a(25);class J{constructor(ec,Vc,td){this.La=ec;this.ef=Vc;this.AUb=td}Hg(){this.La.Ne(D.a.$Fh,x.a.frame,Object(A.a)(this,this.YFh,"firstRunExperienceHandler"),64);this.La.Nb(D.a.sXe,x.a.frame,Object(A.a)(this,this.wbi,"inProductMessagingTabHandler"));
this.La.Nb(D.a.rXe,x.a.frame,Object(A.a)(this,this.vbi,"inProductMessagingShiftTabHandler"));this.La.Nb(D.a.Bkh,x.a.frame,Object(A.a)(this,this.Ckh,"dimeLaunchHandler"));this.La.Nb(D.a.eWf,x.a.frame,z.ActionManager.rg);this.La.Nb(D.a.Xij,x.a.frame,z.ActionManager.rg);this.La.Nb(D.a.Yij,x.a.frame,z.ActionManager.rg);this.ef&&this.ef.updateCommandUI()}YFh(ec,Vc,td,he,ne){2===td&&this.AUb.vvi(ne);return 32}Ckh(ec,Vc,td,he,ne){2===td&&this.AUb.svi(ne);return 32}wbi(ec,Vc,td){return 2===td?this.AUb.ezd():
32}vbi(ec,Vc,td){return 2===td?this.AUb.czd():32}}Object(b.a)(J,"InProductMessagingActor",null,[]);var L=a(83);class T{constructor(){this.GSf=this.GXf=this.Fbg=this.Vkc=this.instance=null}}Object(b.a)(T,"DimeExperienceUISettings",null,[]);var O=a(137),G=a(466);class C{constructor(ec,Vc,td,he,ne){this.Jac=!1;this.ztb=null;this.La=ec;this.WFa=Vc;this.cXb=td;this.D1=he;this.yGc=ne}kei(ec){O.b("getHeaderApi")?ec.isFeatureEnabled("MsoPremiumBadge",!0).then(Vc=>{const td=ec.isFreemiumUpsellEnabled();td&&
(appChrome.getHeaderApi().then(he=>{he.updatePremiumStatus(Vc,td);return null}),ec.hna("MsoPremiumBadge",he=>{appChrome.getHeaderApi().then(ne=>{ne.updatePremiumStatus(he.isEnabled,td);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}vvi(ec){this.cXb.Vwi().continueWith(()=>{this.WFa.iGj(ec)})}svi(ec){let Vc="gopremium",td=null,he=()=>{};ec?(ec.experience&&""!==Object(L.a)(String,ec.experience)&&(Vc=Object(L.a)(String,ec.experience)),ec.onTaskComplete&&
(he=ec.onTaskComplete),ec.campaignId&&""!==Object(L.a)(String,ec.campaignId)&&(td=Object(L.a)(String,ec.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.uof(Vc,he,td)}uof(ec,Vc,td=null){if(this.Jac&&this.ztb){const he={};he.experience=ec||"gopremium";he.campaignId=td||G.b(this.D1,this.yGc,Object(L.a)(String,he.experience),!0);this.La.processAction(D.a.eWf,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+he.experience);
try{const ne=Object.assign(new T,{instance:this.ztb,Vkc:he,Fbg:Vc||(()=>{}),GXf:Te=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+Te.status)},GSf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.Jac=!1;this.ztb=null}});this.WFa.wEj(ne)}catch(ne){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+ne.message),this.Jac=!1,this.ztb=null,this.La.ae(D.a.Kac,2,{["experience"]:he.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),
this.La.ae(D.a.Kac,2,{["experience"]:ec})}ipf(){this.cXb.Xwi().continueWith(()=>{try{var ec=n.a.ul(f.AFrameworkApplication.uiCulture);const he=G.c(this.D1);if(he){var Vc={};Vc.partnerId=he;Vc.language=ec;Vc.sessionId=f.AFrameworkApplication.userSessionId;Vc.authHint=f.AFrameworkApplication.fa.Xa("UserPrincipalName");var td=f.AFrameworkApplication.fa.Xa("Puid")||"";""!==td&&(ec={},ec.puid=td,Vc.userInfo=ec);this.ztb=new Dime(Vc);this.Jac=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,
324,15,"App not supported")}catch(he){e.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+he.message)}},3)}ezd(){return this.WFa.ezd()}czd(){return this.WFa.czd()}}Object(b.a)(C,"InProductMessagingUIManager",null,[904]);class H{constructor(){this.Cle=0;this.wXa=Array(5);this.wXa[0]=10;this.wXa[1]=15;this.wXa[2]=50;this.wXa[3]=100;this.wXa[4]=200}Init(ec){this.Cle=ec}SendTrace(ec,Vc){e.ULS.sendTraceTag(34182235,this.Cle,this.wXa[ec],"{0}",Vc)}}Object(b.a)(H,"DefaultNetworkingManager",
null,[923]);var I=a(260),M=a(316),Q=a(95);class U{constructor(ec){this.Yb=ec}iGj(ec){ec&&(InProductMessaging.Networking.NetworkingMgr=new H,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(ec.Q7f,ec.Ouf,ec.qwe,ec.dGi,ec.locale,Object(A.a)(this,this.dNi,"onDismissFirstRunExperience"),ec.nfg),this.GSa(r.VZi,!0))}wEj(ec){if(ec&&ec.instance&&ec.Vkc){let Vc=document.getElementById("wacDimeContainer");Vc||(Vc=document.createElement("div"),Vc.id="wacDimeContainer",document.body.appendChild(Vc));
f.AFrameworkApplication.fa.qa("DimeFocusManagerIsEnabled")&&this.GSa("wacDimeContainer",!1);ec.Vkc.parentElementId="wacDimeContainer";ec.instance.launch(ec.Vkc,ec.Fbg).then(td=>{this.tJb();document.body.removeChild(Vc);ec.GXf(td)}).catch(td=>{this.tJb();document.body.removeChild(Vc);ec.GSf(td)})}else throw Error.argument("DimeExperienceUISettings");}GSa(ec,Vc){if(this.Yb&&ec&&(ec=document.getElementById(ec),this.cei(ec),ec=this.Yb.lN("InProductMessagingFocusId"))){const td=this.Yb.gi;td&&"InProductMessagingFocusId"===
td.name||this.Yb.MR("InProductMessagingFocusId",!1);Vc&&this.OQf(ec.scope)}}cei(ec){var Vc=this.Yb.Ci("InProductMessagingFocusId");Vc.parent=I.AFrame.TT;const td=new M.DOMFocusListing(()=>ec);td.jcb=!1;td.to(3);td.to(2);td.to(4);Vc=this.Yb.Tsa(()=>ec,Vc,td);Vc.lJb();Vc.N_=!0;Vc.pIa=!0}OQf(ec){ec.Ik(Q.FocusManager.instance().u2);ec.Ik(Q.FocusManager.instance().v2);ec.bindAction(Q.FocusManager.instance().u2,D.a.sXe);ec.bindAction(Q.FocusManager.instance().v2,D.a.rXe)}tJb(){this.Yb&&(this.Yb.jda("InProductMessagingFocusId"),
this.Yb.kRa("InProductMessagingFocusId"))}dNi(ec,Vc){this.tJb();ec=Object.assign(new B,{completed:ec,adj:Vc});f.AFrameworkApplication.ub.ae(D.a.XFh,2,ec)}ezd(){const ec=document.activeElement,Vc=this.Yb.LQ();return ec&&Vc&&Vc.jf&&ec===Vc.jf.Nw?(Vc.jf.Ll(ec),Vc.Pya()?32:8):4}czd(){const ec=document.activeElement,Vc=this.Yb.LQ();return ec&&Vc&&Vc.jf&&ec===Vc.jf.firstElement?(Vc.jf.Ll(ec),Vc.ZOa()?32:8):4}}Object(b.a)(U,"InProductMessagingUIWrapper",null,[903]);var N=a(135),W=a(248),X=a(27);class sa{constructor(){this.gb=
null}get name(){return"Common.App.InProductMessaging"}Wh(ec){ec.register(t,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").xc().Fc(()=>new t);ec.register(U,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").xc().Fc(()=>new U(Q.FocusManager.instance()));ec.register(C,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").xc().Fc(()=>new C(f.AFrameworkApplication.ub,
ec.resolve("Common.IInProductMessagingUIWrapper"),ec.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.sa.Pa.Gj,f.AFrameworkApplication.sa.Pa.B6));ec.register(J,"Common.App.InProductMessaging.InProductMessagingActor").xc().Fc(()=>new J(f.AFrameworkApplication.ub,f.AFrameworkApplication.sa,ec.resolve("Common.IInProductMessagingUIManager")));ec.register(v,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").xc().Fc(()=>
new v);ec.register(B,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").xc().Fc(()=>new B);this.gb=ec}init(){this.gb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Hg();f.AFrameworkApplication.fa.Dv(()=>{f.AFrameworkApplication.sa.Pa.Es&&N.a.get_instance().Xj(15,()=>{this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ec=>{this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").kei(ec)})});
f.AFrameworkApplication.fa.qa("FreemiumUpsellShowDialogIsEnabled")&&G.a()&&!X.a.fla&&1!==f.AFrameworkApplication.sa.Pa.Gj&&this.gb.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ec=>{ec.isFeatureEnabled("MsoPremiumBadge",!0).then(Vc=>{!Vc&&ec.isFreemiumUpsellEnabled()&&this.gb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").ipf();return null})})})}dispose(){}static main(){W.a.instance.Fi(new sa)}}Object(b.a)(sa,"InProductMessagingPackage",null,[4,
5]);var da=a(187),S=a(41);class oa{constructor(ec,Vc,td,he=null,ne=null){this.dw=ec;this.Cjb=Vc;this.yjb=td;this.Vge=he;this.Hlb=ne}f$b(ec){const Vc=new Sys.StringBuilder(this.dw.RKb);Vc.append("RoamingServiceHandler.ashx?action=");Vc.append("getFirstRunExperienceSettings");Vc.append("&");Vc.append(this.Dhd(ec));Vc.append("&");Vc.append(f.AFrameworkApplication.Ii);f.AFrameworkApplication.Dd.Pm(Vc.toString(),1,null,null,!0,2,Object(A.a)(this,this.dka,"getRequestSuccessCallback"),Object(A.a)(this,this.H4,
"getRequestFailureCallback"),null)}t3a(ec){var Vc=new Sys.StringBuilder(this.dw.RKb);Vc.append("RoamingServiceHandler.ashx?action=");Vc.append("saveFirstRunExperienceSettings");Vc.append("&");Vc.append(f.AFrameworkApplication.Ii);Vc=Vc.toString();ec=S.c(ec);f.AFrameworkApplication.Dd.Pm(Vc,2,ec,null,!0,4,Object(A.a)(this,this.m3i,"postRequestSuccessCallback"),Object(A.a)(this,this.rW,"postRequestFailureCallback"),null)}dka(ec){let Vc=!1,td=null;try{if(0<ec.data.ue.length){const he=Object(L.a)(Object,
S.a(ec.data.ue)),ne=he?he[this.dw.VXc]:null;ne&&(td=Object(L.a)(Object,S.a(ne.toString())))}Vc=!0}catch(he){this.H4(null)}Vc&&this.Cjb&&this.Cjb(ec.data,td)}H4(ec){this.yjb&&this.yjb(ec?ec.data:null)}m3i(ec){this.Vge&&this.Vge(ec?ec.data:null)}rW(ec){this.Hlb&&this.Hlb(ec?ec.data:null)}Dhd(ec){const Vc=new Sys.StringBuilder("requestedsettings=");for(let td=0;td<ec.count;td++)Vc.append(ec.na(td)),td<ec.count-1&&Vc.append(";");return Vc.toString()}}Object(b.a)(oa,"FirstRunExperienceRequestHandler",
null,[]);var K=a(232),ea=a(82);class ya{constructor(){this.pjb=this.YTb=this.dw=null}vUd(ec){ec?(this.dw=ec,this.Fni()&&(e.ULS.sendTraceTag(51675532,306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),ec=new da.a,ec.add(this.dw.VXc),this.YTb=new oa(this.dw,Object(A.a)(this,this.dka,"getRequestSuccessCallback"),Object(A.a)(this,this.H4,"getRequestFailureCallback"),null,Object(A.a)(this,this.rW,"postRequestFailureCallback")),this.YTb.f$b(ec)),(this.dw.p8a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",
!1))&&this.wUd()):e.ULS.sendTraceTag(51675531,306,10,"Invalid launcherSettings")}Fni(){try{if(this.dw.p8a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.qa("IsAnonymousUser"))return!1;if(this.dw.uki||this.dw.r8a||f.AFrameworkApplication.fa.qa("IsO365ConsumerHost"))return!0;const ec=f.AFrameworkApplication.fa.Xa("FlightId");return-1!==(ec?ec.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(ec){e.ULS.sendTraceTag(576582624,
306,10,"Error checking setting {0}",ec?ec.toString():null)}return!1}MZf(ec){const Vc={},td={};td.FREDisplayedDate=(new Date).toUTCString();td.VersionDisplayed=ec;td.RemindMeLater=!1;Vc[this.dw.VXc]=S.c(td);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.YTb&&this.YTb.t3a(Vc)}dka(ec,Vc){ec=ec?+ec.C3-+ec.LF:-1;ec>this.dw.BYf?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
ec,this.dw.BYf):Vc?this.jDj(Vc)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.dw.Fuf),this.wUd()):(this.f8c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.wUd())}H4(ec){this.f8c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",ec?ec.httpStatus:-1)}rW(ec){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",ec?ec.httpStatus:-1)}wUd(){this.f8c(!0);var ec=ea.a.instance.Kh("Common.ISystemInitiatedFeedback");ec?this.D7f(ec):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((ec=ea.a.instance.Ub("Common.ISystemInitiatedFeedback"))?ec.execute(Vc=>{this.D7f(Vc)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}D7f(ec){if(ec){var Vc=this.dw.lGh;Vc&&(f.AFrameworkApplication.qya(Vc),f.AFrameworkApplication.Ip(Vc));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Vc);ec.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.pjb=Object(A.a)(this,this.gOi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.pjb,!0),window.addEventListener("FRELaunchedEvent",this.pjb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.MZf(this.dw.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}gOi(ec){if(ec){var Vc=ec.detail;ec=ec.type;var td=this.dw&&this.dw.campaignId?this.dw.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===ec||td&&Vc&&Vc.id&&-1!==Vc.id.indexOf(td))Vc.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.MZf(this.dw.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.pjb,!0),window.removeEventListener("FRELaunchedEvent",this.pjb,!0))}}jDj(ec){if("RemindMeLater"in ec&&"FREDisplayedDate"in ec){if("true"===ec.RemindMeLater.toString()&&(+new Date-+new Date(ec.FREDisplayedDate.toString()))/36E5>this.dw.Fuf)return!0}else if(f.AFrameworkApplication.fa.qa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in ec&&ec.VersionDisplayed<this.dw.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}f8c(ec){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&K.a.dispatch("FREDecisionEvent",{["show"]:ec})}}Object(b.a)(ya,"FirstRunExperienceLauncher",null,[888]);class ha{constructor(){this.gb=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Wh(ec){this.gb=
ec;this.gb.register(888,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").xc().Fc(()=>new ya)}init(){}dispose(){}static main(){W.a.instance.Fi(new ha)}}Object(b.a)(ha,"FirstRunExperienceLauncherPackage",null,[4,5]);var La=a(1111),Ia=a(1112),ra=a(1139),pa=a(1254),ba=a(9),fa=a(222);class Ka{constructor(ec){this.$=ec}get VXc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get uki(){return this.isEnabled()&&
this.$.ma(332)}get r8a(){return this.isEnabled()&&this.$.ma(334)}get p8a(){return this.$.ma(333)}get lGh(){return null}get Fuf(){return 24}get BYf(){return 4E3}get RKb(){return this.$.va.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.qa("IsAnonymousUser"):1)return!1;const ec=f.AFrameworkApplication.Qb?Object(L.a)(String,f.AFrameworkApplication.Qb.AudienceGroup):"";return"Unknown"!==ec&&"Automation"!==ec}}Object(b.a)(Ka,"FirstRunExperienceLauncherSettings",
null,[902]);class aa{constructor(ec,Vc){this.tXe=ec;this.ZFh=Vc}vUd(){this.tXe&&this.tXe.vUd(this.ZFh)}}Object(b.a)(aa,"FirstRunExperienceManager",null,[901]);var ja=a(695);class Va extends fa.a{constructor(ec){super();this.$=ec;this.Fb()}create(){const ec=Object(ja.a)(this.$.da,311,()=>this.Gah());this.ob(ec)}Gah(){var ec=new Ka(this.$);ec=new aa(ea.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),ec);ec.vUd();return ec}static ka(ec){ec.da.Ga(312,new Va(ec))}}
Object(b.a)(Va,"FirstRunExperienceManagerFactory",fa.a,[]);var bb=a(59);class wa extends fa.a{constructor(ec){super();this.Imd=null;this.$=ec;this.Fb()}create(){const ec=Object(ja.a)(this.$.da,361,()=>this.tbh());this.ob(ec)}tbh(){this.Imd=ea.a.instance.Kh("Common.IInProductMessagingUIManager");bb.a.zg.Es?N.a.get_instance().Xj(16,()=>{this.Wdf()}):this.Wdf();return this.Imd}Wdf(){ea.a.instance.Ub("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(ec=>{ec.isFeatureEnabled("MsoPremiumBadge",
!0).then(Vc=>{!Vc&&ec.isFreemiumUpsellEnabled()&&this.Imd.ipf();return null})})}static ka(ec){ec.da.Ga(362,new wa(ec))}}Object(b.a)(wa,"InProductMessagingManagerFactory",fa.a,[]);var ka=a(1191),ta=a(1114),qa=a(47),rb=a(416),Za=a(78),gb=a(1),mb=a(528),Ga=a(21),ib=a(574);class cc extends mb.a{constructor(ec){super(1);this.Tfa=!1;this.azf=()=>{this.refresh()};this.bzf=()=>{this.refresh()};this.gridView=Ga.h(ec);this.gridView.Vb.Yk(this.bzf);this.gridView.Vb.Rm(this.azf);this.refresh()}get tI(){return this.Emc(this.Tfa)}fSd(ec){this.Tfa!==
ec&&(this.Tfa=ec,this.vIb())}get name(){return ib.a.cellEdit}dispose(){this.gridView.Vb.Hk(this.bzf);this.gridView.Vb.em(this.azf);this.gridView=null;super.dispose()}vIb(){this.CId(this.Tfa)}refresh(){this.fSd(!this.gridView.eb)}}Object(b.a)(cc,"CellEditSafeStatePublisher",mb.a,[]);var ic=a(38),xb=a(109);class Vb{constructor(ec,Vc){this.handler=null;this.publisher=ec;this.tI=Vc}}Object(b.a)(Vb,"SafeStatePublisherState",null,[]);var wb=a(609);const cb=ec=>ec?`${ec.Current} / ${ec.Pending} @${ec.SuspensionStartTimestamp}`:
null,lb=ec=>(null===ec||void 0===ec?void 0:ec.SuspensionStartTimestamp)&&ec.Pending>ec.Current;class Y extends ic.a{constructor(ec,Vc){super();this.cof=null;this.S8a=!1;this.bGb=(td,he)=>{3===he.ruf&&this.S8a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.S8a=!0;this.Jbb()};this.XRa=new da.a;this.Kya=ec;this.Rma=Vc;this.kAb=gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.Y7a=gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.kAb&&(this.Rma.EZa(this.rza.bind(this)),this.Y7a?this.Kya.Qqe(this.bGb):this.Kya.fLg(this.RDf.bind(this)))}get jUj(){return xb.f(xb.c(this.XRa.toArray(),ec=>0!=ec.tI),ec=>ec.publisher.name)}V_b(ec){this.addHandler(Y.WRa,ec)}Duc(ec){this.removeHandler(Y.WRa,ec)}xAa(ec,Vc){const td=new Vb(ec,Vc);this.XRa.add(td);Vc=(he,ne)=>{td.tI=ne.tI;this.Jbb()};ec.V_b(Vc);td.handler=Vc;this.Jbb()}L_d(ec){let Vc=
null;for(let td of this.XRa)if(td.publisher===ec){this.mgg(td);Vc=td;break}Vc&&(this.XRa.remove(Vc),this.Jbb())}dispose(){for(let ec of this.XRa)this.mgg(ec);this.XRa.clear();this.kAb&&(this.Rma.zcb(this.rza.bind(this)),this.Y7a?this.Kya.LUf(this.bGb):this.Kya.mgj(this.RDf.bind(this)));super.dispose()}jbc(){let ec=hb.jbc(this.XRa.toArray().map(Vc=>Vc.tI));return this.S8a&&1===ec?2:ec}mgg(ec){ec.publisher.Duc(ec.handler)}Jbb(){const ec=this.jbc();ec!==this.cof&&(this.raiseEvent(Y.WRa,new wb.a(ec)),
this.cof=ec)}RDf(){this.S8a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.S8a=!0;this.Jbb()}rza(ec,Vc){ec=Vc.zca;(Vc=!lb(ec))||(Vc=this.Oui,Vc=(null===ec||void 0===ec?void 0:ec.SuspensionStartTimestamp)!==(null===Vc||void 0===Vc?void 0:Vc.SuspensionStartTimestamp));Vc&&(this.S8a=!1);this.Oui=ec;this.Jbb()}}Y.WRa="SSC";Object(b.a)(Y,"ClientStateMonitor",ic.a,[]);var Oa=a(6),Wa=a(69);class Ca extends mb.a{constructor(ec,
Vc=null){super(1);this.Tfa=!1;this.$N=()=>{this.refresh()};this.fAf=()=>{this.refresh()};this.$=ec;this.T$d=Vc||Wa.a(ec).JQ(Oa.a.idle);Wa.a(ec).yWc(this.fAf);this.k6a.Lq(this.$N);this.refresh()}get tI(){return this.Emc(this.Tfa)}fSd(ec){ec!==this.Tfa&&(this.Tfa=ec,this.vIb())}get name(){return ib.a.k6a}get k6a(){return this.T$d}dispose(){Wa.a(this.$).iuc(this.fAf);this.k6a.fr(this.$N);this.T$d=null;super.dispose()}vIb(){this.CId(this.Tfa)}refresh(){this.fSd(1===this.k6a.yu||Wa.a(this.$).fi===this.k6a)}}
Object(b.a)(Ca,"IdleActivitySafeStatePublisher",mb.a,[]);var Ra=a(317),la=a(3),ua=a(22);class xa extends Za.a{constructor(){super()}nc(){return!1}executeCommand(){return y.Task.Ta(!0)}wc(ec,Vc){return 1905775613===Vc.command}Kc(){return!1}}Object(b.a)(xa,"ToggleMergeSuspensionSafeState",Za.a,[223]);class fb extends ic.a{constructor(ec,Vc){super();this.statusBarManager=null;this.hAd=!1;this.rza=(td,he)=>{td=`${he.zca.Current===he.zca.Pending?"\u26ad":"\u26ae"}${he.zca.Current}`;ua.a.equals(this.knc,
td,!1)||(this.knc=td,this.Oz())};this.JPa=(td,he)=>{td=0==he.tI;this.hAd!==td&&(this.hAd=td,this.Oz())};this.mergeSuspensionManager=Vc;this.mergeSuspensionManager.Rma.EZa(this.rza);this.knc="";Ra.a.W9(1905775613,la.a.lc,0,1);this.Ja=ec.Ja;this.fPb=new xa;ec.da.$a(29,td=>{this.mergeSuspensionManager&&(this.statusBarManager=td,td.GJ(this),this.mergeSuspensionManager.Yha.V_b(this.JPa))});this.Ja.J2(this.fPb)}Lq(ec){this.addHandler(fb.Hyd,ec)}fr(ec){this.removeHandler(fb.Hyd,ec)}Oz(){this.raiseEvent(fb.Hyd)}Gn(ec){return ec===
fb.B6i&&!!this.mergeSuspensionManager}ns(ec,Vc){if(!this.Gn(ec))return!1;this.mergeSuspensionManager&&(Vc.LabelText=this.knc,Vc.On=this.hAd);return!0}dispose(){this.fPb&&(this.Ja.mcb(this.fPb),this.fPb.dispose(),this.fPb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.Rma.zcb(this.rza),this.mergeSuspensionManager.Yha.Duc(this.JPa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.iG(this),this.statusBarManager=null);this.knc=null;super.dispose()}}fb.Hyd=
"MSMSC";fb.B6i="QueryMergeSuspensionStatus";Object(b.a)(fb,"MergeSuspensionIndicatorManager",ic.a,[211,212,2]);var Jb=a(7),Ob=a(874);class eb extends Sys.EventArgs{constructor(ec){super();this.Gxa=ec}}Object(b.a)(eb,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ma{}Object(b.a)(Ma,"SuspensionState",null,[]);class va extends Ma{constructor(ec){super();this.Hse=!1;this.Hse=ec}}Object(b.a)(va,"ReadyForPendingMergeState",Ma,[]);const Pa=new Ma,Ha=new Ma,tb=new va(!1),Ya=new va(!0);
var V=a(875);class za extends V.a{constructor(ec,Vc,td){super(ec);this.wOg=Vc;this.QGj=td}}Object(b.a)(za,"ReadyForPendingMergesUpdatedEventArgs",V.a,[]);class yb extends ic.a{constructor(ec,Vc,td){super();this.rza=(he,ne)=>{he=this.getState();const Te=this.S_;this.S_=ne.zca;ne=this.getState();this.Pzi(he,ne,Te);this.raiseEvent(yb.Cyd);this.dXe(he,ne)};this.JPa=(he,ne)=>{he=this.getState();this.tI=ne.tI;ne=this.getState();this.dXe(he,ne)};this.bGb=(he,ne)=>{this.Y7a&&4===ne.ruf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",cb(this.S_),cb(ne.S_)),this.lPf(this.getState(),!0))};this.kAb=gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.Y7a=gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1);this.Yha=ec;this.Yha.V_b(this.JPa);this.Rma=Vc;this.Rma.EZa(this.rza);this.Y7a&&(this.Kya=td,this.Kya.Qqe(this.bGb));
this.S_=Object(Jb.a)(new Ob.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.tI=this.Aci()}Aci(){return Object(rb.a)(Y,this.Yha)?Object(L.a)(Y,this.Yha).jbc():1}$_b(ec){this.addHandler(yb.TYd,ec)}Huc(ec){this.removeHandler(yb.TYd,ec)}TLg(ec){this.addHandler(yb.nJd,ec)}Pgj(ec){this.removeHandler(yb.nJd,ec)}eLg(ec){this.addHandler(yb.Cyd,ec)}lgj(ec){this.removeHandler(yb.Cyd,ec)}x8i(){this.zId(this.getState()===Ha)}dispose(){this.Yha.Duc(this.JPa);this.Yha=null;this.Rma.zcb(this.rza);this.Rma=
null;this.Y7a&&(this.Kya.LUf(this.bGb),this.Kya=null);super.dispose()}Sgd(){return Object(Jb.a)(new Ob.a,{Current:this.S_.Current,Pending:this.S_.Pending,SuspensionStartTimestamp:this.S_.SuspensionStartTimestamp})}getState(){return lb(this.S_)?0==this.tI?Ya:this.kAb&&1==this.tI?tb:Ha:Pa}dXe(ec,Vc){ec!==Vc&&(Vc===Ha?this.zId(!0):ec===Ha&&this.zId(!1));this.lPf(Vc)}lPf(ec,Vc=!1){ec instanceof va&&this.raiseEvent(yb.nJd,new za(this.S_,ec.Hse||!this.kAb,Vc))}Pzi(ec,Vc,td){ec===Pa&&Vc!==Pa?(ec=Vc===Ha,
Vc=Vc===tb,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${Vc} publisher: ${Vc||ec?this.Yha.jUj.join(","):""} counter: ${cb(this.S_)} isBlockingAllMerges: ${ec}`)):ec!==Pa&&Vc===Pa&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${cb(td)}`)}zId(ec){this.raiseEvent(yb.TYd,new eb(ec))}}yb.TYd="TPMBBC";yb.nJd="RFPMU";yb.Cyd="MCC";Object(b.a)(yb,
"MergeSuspensionStateHandler",ic.a,[]);class jc extends ic.a{constructor(ec){super();this.h2=null;this.Akc=0;this.hEb=(Vc,td)=>{(null===td||void 0===td?0:td.zca)&&this.EPa(td.zca,jc.u2d)};this.mxc=()=>{this.uXf();this.bPf(this.h2,jc.rkj)};this.M$a=(Vc,td)=>{td.Jrb&&this.h2.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${cb(this.h2)}`)};this.uXf();this.$=ec;this.$.ea.Uj(this.mxc);this.$.ea.uM(this.mxc);Ga.h(this.$).Vb.Rm(this.M$a);
this.$.da.$a(292,Vc=>{Vc.EZa(this.hEb);e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}EZa(ec){this.addHandler("MCU",ec)}zcb(ec){this.removeHandler("MCU",ec)}get S_(){return this.h2}EPa(ec,Vc=""){const td=this.h2.Current<ec.Current||this.h2.Pending<ec.Pending;if(ec.SuspensionStartTimestamp&&this.Akc!==ec.SuspensionStartTimestamp){if(this.Akc>ec.SuspensionStartTimestamp){td&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${Vc}. S: ${jc.gEb(ec)}, C: ${jc.gEb(this.h2)}`);
return}td||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${jc.gEb(ec)}, C: ${jc.gEb(this.h2)}`)}else if(!td)return;this.h2=ec;this.bPf(ec,Vc)}dispose(){this.$.ea.uk(this.mxc);this.$.ea.VR(this.mxc);Ga.h(this.$).Vb.em(this.M$a);const ec=this.$.da.za(292);ec&&ec.zcb(this.hEb);super.dispose()}bPf(ec,Vc=""){lb(ec)&&ec.SuspensionStartTimestamp>this.Akc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${cb(ec)}, Origin: ${Vc}`),
this.Akc=ec.SuspensionStartTimestamp);this.raiseEvent("MCU",new V.a(ec))}uXf(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${jc.gEb(this.h2)}`);this.h2=Object(Jb.a)(new Ob.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static gEb(ec){return ec?`(${ec.Current}/${ec.Pending} @${ec.SuspensionStartTimestamp})`:"null"}}jc.u2d="PMM.RTC";jc.E8b="PMM.EwaResult";jc.rkj="PMM.resetMergeCounter";Object(b.a)(jc,"PendingMergeMonitor",ic.a,[]);class Cc{}Object(b.a)(Cc,
"ClientRevisions",null,[]);var Sa=a(46),na=a(60);const jb=(ec,Vc,td,he,ne,Te,Me,Ye=null)=>{Ye=ec.Na(1,Ye);Ye.viewportState=Vc;Ye.allowViewAdjustment=td;return na.g(ec,"DoPendingMerge",Ye,he,ne,Te,Me,0)},Ib=(ec,Vc,td,he,ne,Te,Me=null)=>{Me=ec.Na(1,Me);Me.suspensionStartTimestamp=Vc;return na.g(ec,"KeepBlockingPendingMerges",Me,td,he,ne,Te,0)};class dc extends ic.a{constructor(ec,Vc,td,he){super();this.rJa=null;this.hCb=0;this.iCb=this.H8a=null;this.BFf=(ne,Te)=>{this.rJa.TRg(Te.zca,Te.wOg,Te.QGj)};
this.FGb=(ne,Te)=>{Te.Gxa?this.hJj():this.vAc()};this.QDf=()=>{this.hCb=0};this.J0f=()=>{const ne=this.u6.Sgd();Ib(this.ya,null!=ne.SuspensionStartTimestamp?ne.SuspensionStartTimestamp:0,null,()=>{this.RRi(ne)},null,null,this.ya.Wb())};this.UCa=(ne,Te)=>{if(Te){Te.Hob.MergeCount=this.u6.Sgd();let Me;({min:ne,max:Me}=Ga.h(this.$).OEi());gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?Te.Hob.ClientRevisions=Object(Jb.a)(new Cc,{Min:ne,Max:Me,MaxFromBlockCache:Ga.h(this.$).Ea.Rtf}):
Te.Hob.ClientRevisions=Object(Jb.a)(new Cc,{Min:ne,Max:Me})}};this.$=ec;this.u_a=td;this.u6=Vc;this.u6.TLg(this.BFf);this.u6.$_b(this.FGb);this.u6.eLg(this.QDf);this.$.pa.gha(this.UCa);this.ya=this.$.pa.ya;this.WMd=this.$.va.MergeSuspensionRequestThrottlingTimeInMs;this.hui=this.$.va.KeepBlockingPendingMergesRequestIntervalMs;this.rJa=he;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.pa.sna(this.UCa);this.vAc();this.u6.Pgj(this.BFf);this.u6.Huc(this.FGb);this.u6.lgj(this.QDf);
this.u6=null;super.dispose()}hJj(){this.vAc();if(this.oLe()){const ec=this.u6.Sgd();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${cb(ec)} fail count: ${this.hCb}`)}else this.iCb=this.u_a.create(this.J0f,this.WMd,Sa.a.iCb),this.H8a=this.u_a.ZC(this.J0f,this.hui,Sa.a.H8a)}vAc(){this.H8a&&(this.iCb.cancel(),this.H8a.cancel(),this.H8a=this.iCb=null)}RRi(ec){let Vc;
Vc=" fail count: "+this.hCb;this.hCb++;this.oLe()&&this.vAc();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${cb(ec)}${Vc}`)}oLe(){return this.hCb>dc.uDi}}dc.uDi=5;Object(b.a)(dc,"RequestController",ic.a,[]);var ob=a(157),Fa=a(196),Ab=a(28),$b=a(281);class Cb extends Sys.EventArgs{constructor(ec,Vc){super();this.ruf=ec;this.S_=Vc}}Object(b.a)(Cb,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class Rb extends ic.a{constructor(ec,Vc,td=null,
he=null,ne=null){super();this.zkc=null;this.pEd=0;this.documentVisibilityObserver=null;this.unf=!1;this.Cmc=null;this.ya=ec;this.WMd=Vc.va.MergeSuspensionRequestThrottlingTimeInMs;const Te=Vc.va.GetRangeContentPrefetchDelayForMergeInMs;this.My=()=>{Vc.s_f(Te)};this.Oh=td||Ab.a.Qa;this.njg=0;this.KL=he;this.YAa=ne;Vc.da.$a(291,Me=>{this.documentVisibilityObserver=Me})}get IMa(){return 0<this.pEd}fLg(ec){this.addHandler(Rb.Iyd,ec)}mgj(ec){this.removeHandler(Rb.Iyd,ec)}Qqe(ec){this.addHandler(Rb.Dyd,
ec)}LUf(ec){this.removeHandler(Rb.Dyd,ec)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.ti}TRg(ec,Vc,td=!1){this.lNb(ec,Vc,td)?(new ob.a).setResult(!0):(Vc=this.S0i(ec,Vc),this.zkc=ec,this.pEd++,Vc.continueWith(()=>{this.hNi()},0,Fa.a.none,this.KL))}S0i(ec,Vc){this.njg=this.Oh.Yea;this.unf=Vc;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${ec.Current} / ${ec.Pending} @${ec.SuspensionStartTimestamp}. allowSelectionAdjustment: ${Vc}`);
this.isDocumentHidden||this.My();return this.Sqj(Vc,ec)}lNb(ec,Vc,td=!1){if(this.YAa&&!Vc&&!this.YAa.mri())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.zkc||ec.SuspensionStartTimestamp>this.zkc.SuspensionStartTimestamp)return this.IMa&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${ec.Current} / ${ec.Pending} @${ec.SuspensionStartTimestamp}`),
!1;if(this.IMa)return!0;if(td)return!1;td=this.zkc;const he=this.Oh.Yea-this.njg<this.WMd;Vc=this.unf===Vc;return(ec||td?ec&&td?ec.Current===td.Current&&ec.Pending===td.Pending&&ec.SuspensionStartTimestamp===td.SuspensionStartTimestamp:!1:!0)&&he&&Vc}Sqj(ec,Vc){const td=this.ya.Wb(),he=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${Vc.Current} / ${Vc.Pending} @${Vc.SuspensionStartTimestamp}`)};return this.YAa?this.YAa.Anj(this.lRh(ec,he,td)):
this.kze(null,!0,void 0,he,td)}lRh(ec,Vc,td){return(he,ne,Te)=>{let Me=void 0;e.ULS.shipAssertTag(523317955,0,null!=he||ec,"!allowSelectionAdjustment requires a non-null initialViewportState.");Me=this.iNi.bind(this);ne&&(Me=$b.b.call(null,Ye=>{const pf=Ye.Result;let Be=null===pf||void 0===pf?void 0:pf.AdjustedViewportState;3===(null===pf||void 0===pf?void 0:pf.MergeResultState)&&(Be=void 0);ne(Be,Ye.StateId)},Me));Te&&(Vc=$b.a.call(null,Te,Vc));return this.kze(he,ec,Me,Vc,td)}}kze(ec,Vc,td,he,ne){return jb(this.ya,
ec,Vc,td,he,null,null,ne)}iNi(ec){var Vc=ec.Result;void 0!=Vc&&(Vc=Vc.MergeResultState,gb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RetryDoPendingMergeAfterBailout",!1)&&2!==Vc?this.Cmc=[Vc,ec.MergeCount]:3===Vc&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.$7i()))}$7i(){this.raiseEvent(Rb.Iyd,new Sys.EventArgs)}Z7i(ec,Vc){this.raiseEvent(Rb.Dyd,new Cb(ec,Vc))}hNi(){this.pEd--;if(this.Cmc){const ec=this.Cmc;this.Cmc=null;
this.Z7i(...ec)}}}Rb.Iyd="MWA";Rb.Dyd="MDO";Object(b.a)(Rb,"DoPendingMergeSender",ic.a,[921,922]);class uc{constructor(ec=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.tbi=ec}get reportName(){return this.tbi?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(uc,"SelectionAdjustSessionEndsReport",
null,[280]);var nb=a(42);class Fb{constructor(ec,Vc,td,he,ne,Te){this.jb=ec;this.MG=Vc;this.J9=td;this.KXb=he;this.k4d=ne;this.fM=Te}get activeCell(){return this.MG}get selectedRanges(){return this.J9}get Bs(){let ec=!1;if(null===this.fM||void 0===this.fM)ec=!0;else if(this.fM>=this.selectedRanges.length||!this.selectedRanges[this.fM].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.fM}, selectedRangesLength: ${this.selectedRanges.length}`),
ec=!0;ec&&(this.fM=this.NYg());return this.fM}get activeRange(){return 0>this.Bs?this.activeCell:this.selectedRanges[this.Bs]}get sheetName(){return this.KXb}get activeItemName(){return this.k4d}get Hng(){return 1===this.selectedRanges.length}wkg(ec){let Vc=this.selectedRanges.map(td=>this.FRj(td,this.k4d));for(let td of Vc)if(td)for(let he of td)if(he.Qk&&he.pe.Revision<ec)return!1;return!0}LOj(){var ec;return{SheetName:this.sheetName,ActiveCell:null===(ec=this.activeCell)||void 0===ec?void 0:ec.toString(),
TopLeft:void 0,SelectedRanges:nb.r(this.selectedRanges,this.jb)}}toString(){var ec,Vc;return`active cell: ${null!==(Vc=null===(ec=this.activeCell)||void 0===ec?void 0:ec.toString())&&void 0!==Vc?Vc:"null"} selection: ${xb.f(this.selectedRanges,td=>{var he;return null!==(he=null===td||void 0===td?void 0:td.toString())&&void 0!==he?he:"null"}).join(",")}`}equals(ec){return ec?this.activeCell.equals(ec.activeCell)&&nb.Q(this.selectedRanges,ec.selectedRanges)&&this.sheetName===ec.sheetName:!1}NYg(){for(let [ec,
Vc]of this.selectedRanges.entries())if(null===Vc||void 0===Vc?0:Vc.contains(this.activeCell))return ec;return-1}FRj(ec,Vc){var td;const he=Ga.h(this.jb).Ea.t4a(ec,Vc);he||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(td=null===ec||void 0===ec?void 0:ec.toString())&&void 0!==td?td:"null"} ; activeItemNameIsDefined: ${!!Vc}`);return he}}Object(b.a)(Fb,"SelectionState",null,[]);var Jc=a(201),Fc=a(737);class zb{constructor(ec){this.qAc=
0;this.jH=this.HF=null;this.A4d=new uc;this.B4d=new uc(!0);this.jI=0;this.VMj=!1;this.SEi=1E4;this.dd=()=>{this.nIe()};this.Hj=()=>{this.YYc(!0,!1)};this.D$a=()=>{this.YYc(!1,!1)};this.$=ec;this.gridView=Ga.h(this.$);this.gridView.Ea.hw(this.Hj);this.gridView.Ea.mt(this.D$a);this.gridView.Ea.Zpe(this.D$a);this.gridView.Ea.cha(this.D$a);this.$.ml(this.dd);this.nIe()}Anj(ec){let Vc=null,td=null,he=()=>{this.LJi()};this.rff()?(this.MP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.jH}`)):
(Vc=(ne,Te)=>{this.MJi(ne,Te)},td=this.vwj());return null===ec||void 0===ec?void 0:ec(td,Vc,he)}mri(){return!this.rff()&&this.Xaa().Hng}vwj(){var ec;e.ULS.shipAssertTag(525135961,0,0===this.jI,"SelectionAdjustManager.setPreRequestState: unexpected state");this.jH&&(this.MP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.jH.toString()}`));this.jH=null;this.HF=this.Xaa();let Vc=null;const td=null===(ec=this.HF)||
void 0===ec?void 0:ec.LOj();td&&(Vc={ActiveSheetName:this.HF.sheetName,SheetViewportStateChanges:[td]});this.jI=1;return Vc}LJi(){e.ULS.shipAssertTag(525135960,0,1===this.jI,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.MP.errors++;this.jI=2;this.Ar()}MJi(ec,Vc){try{e.ULS.shipAssertTag(525135959,0,1===this.jI,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.qAc=Vc,Vc=2,this.HF?ec?(this.jH=this.Uzj(ec))?(Vc=7,this.HF.equals(this.jH)?this.HF.equals(this.Xaa())?
(this.MP.adjustedDidntChange++,Vc=4):(this.MP.adjustedDidntChangeWithDivergence++,Vc=5):this.HF.sheetName!=this.jH.sheetName?(this.MP.differentSheetAdjust++,Vc=10):this.HF.equals(this.Xaa())||(this.MP.divergenceOnResponse++,Vc=6,this.$Vf())):this.MP.errors++:(this.MP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.HF.toString()}`)):(this.MP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
ec||void 0===ec?void 0:ec.ActiveCell}`)),this.jI=Vc}catch(td){this.jI=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${td}`)}finally{7!=this.jI?this.Ar():this.YYc(!1,!0)}}dispose(){this.gridView.Ea.gx(this.Hj);this.gridView.Ea.er(this.D$a);this.gridView.Ea.$Tf(this.D$a);this.gridView.Ea.qcb(this.D$a);this.$.Jl(this.dd)}rff(){return 1===this.jI||7===this.jI}Uzj(ec){let Vc;if(!({range:Vc}=nb.Z(ec.ActiveCell,this.$.xa)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${ec.ActiveCell}`),null;let td=[];const he=this.$.oa,ne=!!he&&2===he.tG;if(ec.SelectedRanges)td=nb.g(ec.SelectedRanges.Ranges);else if(!ne)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!he}`),null;return new Fb(this.$,Vc,td,ec.SheetName,this.HF.activeItemName,this.HF.Bs)}Xaa(){const ec=this.$.oa;if((null===
ec||void 0===ec?0:ec.activeCell)&&ec.selectedRanges&&ec.sheetName)return new Fb(this.$,ec.activeCell,ec.selectedRanges,ec.sheetName,this.$.activeItemName,ec.Bs);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!ec}, activeCell null: ${!(null===ec||void 0===ec?0:ec.activeCell)}, selectedRanges null: ${!(null===ec||void 0===ec?0:ec.selectedRanges)}, sheetName null: ${!(null===ec||void 0===ec?0:ec.sheetName)}`);return null}nIe(){this.$.da.$a(276,
()=>{const ec=Jc.a(this.$);ec.CY(this.A4d);ec.CY(this.B4d)})}YYc(ec,Vc){var td;if(this.vpi(ec))if(8===this.jI)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{Vc&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.jI,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.HF.equals(this.Xaa())?(null===(td=
this.gridView)||void 0===td?0:td.eb)?(this.MP.editBoxDivergence++,this.jI=11):(ec=0,ec=this.jH.Bs,-1==ec?(this.MP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.MP.adjusted++,this.jI=8,this.gridView.ha.mx(this.jH.selectedRanges,ec,this.jH.activeCell,0,void 0,"SelectionAdjust"))):(this.MP.divergenceOnViewportReady++,this.$Vf(),this.jI=9)}catch(he){this.jI=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${he}`)}finally{this.Ar()}}}vpi(ec){if(!this.jH)return!1;
if(!this.HF)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.jH.toString()}`),!1;if(Ga.h(this.$).Ea.Rtf<this.qAc)return!1;if(ec||this.VMj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.HF.wkg(this.qAc)||!this.jH.wkg(this.qAc))return!1;return!0}Ar(){this.HF=this.jH=
null;this.jI=0}$Vf(){const ec=this.Xaa();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.HF.toString()} current: ${ec?ec.toString():""} adjusted: ${this.jH.toString()} sheetSameBetweenInitialAndAdjusted: ${this.HF.sheetName===this.jH.sheetName} sheetSameBetweenInitialAndCurrent: ${this.HF.sheetName===(ec?ec.sheetName:null)}`)}get MP(){return Fc.a.xD(this.SEi)?this.B4d:this.A4d}}Object(b.a)(zb,"SelectionAdjustManager",null,[919,2]);class hb extends Za.a{constructor(ec,
Vc,td=null){super();this.DDa=this.Rfc=this.l6a=this.A0a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=ec;this.QXa=new jc(ec);this.YAa=new zb(this.$);this.rJa=new Rb(this.$.pa.ya,this.$,void 0,void 0,this.YAa);this.Vci(ec,td);this.aga=new yb(this.DDa,this.QXa,this.rJa);this.RMd=new dc(ec,this.aga,Vc,this.rJa);gb.EwaSettings.ma(252)&&(this.Rfc=new fb(ec,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}$_b(ec){this.aga.$_b(ec)}Huc(ec){this.aga&&
this.aga.Huc(ec)}get Yha(){return this.DDa}get Rma(){return this.QXa}get u6(){return this.aga}xAa(ec,Vc){this.DDa.xAa(ec,Vc)}L_d(ec){this.DDa.L_d(ec)}EPa(ec,Vc=""){this.QXa.EPa(ec,Vc)}dispose(){this.Rfc&&(this.Rfc.dispose(),this.Rfc=null);this.YAa&&this.YAa.dispose();this.rJa.dispose();this.RMd&&(this.RMd.dispose(),this.RMd=null);this.aga&&(this.aga.dispose(),this.aga=null);this.QXa.dispose();this.QXa=null;this.DDa.dispose();this.DDa=null;this.A0a&&(this.A0a.dispose(),this.A0a=null);this.l6a&&(this.l6a.dispose(),
this.l6a=null);this.$=null;super.dispose()}vIb(){this.aga.x8i()}static jbc(ec){let Vc=0;for(let td of ec){if(2==td)return 2;1==td&&(Vc=1)}return Vc}Vci(ec,Vc){this.DDa=new Y(this.rJa,this.QXa);Vc?Object(rb.a)(Ca,Vc)?this.xAa(Vc,Object(L.a)(Ca,Vc).tI):Object(rb.a)(cc,Vc)?this.xAa(Vc,Object(L.a)(cc,Vc).tI):this.xAa(Vc,0):(this.A0a=new cc(ec),this.l6a=new Ca(ec),this.xAa(this.A0a,this.A0a.tI),this.xAa(this.l6a,this.l6a.tI))}}Object(b.a)(hb,"MergeSuspensionManager",Za.a,[897,2]);class Pb extends fa.a{constructor(ec){super();
this.Lc=ec;this.Fb()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.ob(this.Lc.da.za(343)||this.Lc.da.Ga(343,new hb(this.Lc,qa.a.instance)))}static ka(ec){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");ec.da.Ga(344,new Pb(ec))}}Object(b.a)(Pb,"MergeSuspensionFactory",fa.a,[]);var ud=a(50),Ub=a(37),Ac=a(87),Ic=a(97),dd=a(58),Ud=a(13);class Hd{}Hd.Jwi=3;Hd.connected=0;Object(b.a)(Hd,"ConnectionStateConstants",null,[]);var me=a(110),xe=a(118),Ke=
a(44);class vd{constructor(ec,Vc,td){var he;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.Lyf=(ne,Te)=>{this.blockedOperationsCount++;ne=`${Te.componentName}_${Te.actionName}_${Te.details})`;
this.blockedActions[ne]=this.blockedActions[ne]?this.blockedActions[ne]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.lEd=ne=>{this.durationUntilUserInactive=me.getElapsedSeconds(this.startTime,Ab.a.Qa.zb);ne.ZLd(this.lEd)};this.aW=()=>{this.hasTabbedOut=!0};this.Xca=(ne,Te)=>{Te.uKf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=xe.a(Ab.a.Qa,this.startTime),this.toastRaiser=Te.toastRaiser,this.isToastShown=!0)};this.startTime=ec;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=td;if(null===(he=Vc.ea)||void 0===he?0:he.Re)this.wasUserActiveOnPIStart=Vc.ea.Re.Hr;this.Lj(Vc);this.isDialogShown=0<Vc.rb.GR;ec=Vc.da.za(183);this.isTaskPaneShown=!!ec&&ec.isVisible&&!ec.isCollapsed;this.isTaskPaneCollapsed=!!ec&&ec.isVisible&&ec.isCollapsed}A2f(){this.durationMs=xe.a(Ab.a.Qa,this.startTime)}tDd(ec){var Vc;this.A2f();Ke.a(ec).Buc(this.Lyf);Ke.a(ec).Yf.Cuc(this.Xca);ec.da.$a(291,td=>{td.scb(this.aW)});if(null===(Vc=ec.ea)||void 0===Vc?0:
Vc.Re)ec.ea.Re.ZLd(this.lEd),this.wasUserActiveOnPIEnd=ec.ea.Re.Hr}Lj(ec){Ke.a(ec).Q_b(this.Lyf);this.isToastShown?this.toastRaiser="Immediate":Ke.a(ec).Yf.QWc(this.Xca);ec.da.$a(291,Vc=>{this.hasTabbedOut=Vc.ti;Vc.BGa(this.aW)});this.wasUserActiveOnPIStart&&ec.ea.Re.Gre(this.lEd)}}Object(b.a)(vd,"PartialInteractivityData",null,[]);var Qe=a(1116);class bc extends vd{constructor(ec,Vc,td,he,ne,Te){super(ec,Vc,he);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=td;this.disconnectionSource=Enum.toString(Qe.a,ne);this.triggeringRequest=Te}eMi(ec,Vc){this.swappedByOffline=Vc;this.tDd(ec)}luj(ec){this.errorDataDuringConnectivityIssuesMode=ec}J$i(ec){10>this.failedRequests.length&&(ec=ec+"_"+me.getElapsedSeconds(this.startTime,
Ab.a.Qa.zb).toString(),this.failedRequests.push(ec))}}Object(b.a)(bc,"ConnectivityIssuesData",vd,[]);var Zc=a(159),gd=a(124),Sc=a(112);class Gd{}Gd.Gnh="DuringWork";Gd.connectivityIssues="ConnectivityIssues";Gd.offline="Offline";Object(b.a)(Gd,"UnavailabilityTypes",null,[]);var Vd=a(51);class Ed{constructor(ec){this.tkc=this.data=null;this.pbd=0;this.YEe=null;this.Uzf=(Vc,td)=>{td.pM?(this.data=new bc(Ab.a.Qa.zb,this.$,5===td.Eoa,0!==td.Eoa,this.$.Te.disconnectionSource,this.YEe),this.tkc=this.$.Te.kof,
this.pbd=1,this.$.pa.Te.WMg(this.zm),Zc.a(this.$).zWc(this.KZf)):(this.data.eMi(this.$,5===td.Eoa),this.$.pa.Te.hVf(this.zm),this.data.lastFailedRequestToOnlineTimeGapSec=me.getElapsedSeconds(this.tkc,Ab.a.Qa.zb),gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?Vd.b().RLb(557682689,0,50,Gd.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",dd.a.hc(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${dd.a.hc(this.data)}`),this.data&&this.data.isToastShown&&Ic.Health.instance.recordQosError(gd.a.T2g,[Sc.a.elc],!0,!1,!1,!1,null),Zc.a(this.$).vLd(this.KZf),this.data=null)};this.KZf=(Vc,td)=>{this.data.luj(td.QU)};this.zm=(Vc,td)=>{this.data.J$i(td.context.methodName);Vc=Ab.a.Qa.zb;td=me.getElapsedSeconds(this.tkc,Vc);this.tkc=Vc;td>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=td);this.pbd++;this.data.averageDurationBetweenFailedRequestsSec=this.BYg(td)};this.Rzf=(Vc,td)=>{this.YEe=td.dRj};this.$=ec;Ke.a(this.$).Yf.iqe(this.Uzf);this.$.Te.hqe(this.Rzf)}dispose(){this.$&&(Ke.a(this.$).Yf.kUf(this.Uzf),this.$.Te&&this.$.Te.jUf(this.Rzf));this.data&&this.$.pa.Te.hVf(this.zm);this.$=null}BYg(ec){const Vc=this.pbd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Vc-1)+ec)/Vc}}Object(b.a)(Ed,"ConnectivityIssuesTelemetryManager",
null,[2]);var Od=a(850),se=a(8),Le=a(1265),Id=a(1115);class fe{constructor(ec){this.MYf=null;this.qud=this.Qyd=this.fFb=this.gFb=0;this.BTd=!1;this.w3c=this.BTa=this.Tzc=this.g$a=null;this.K3c=0;this.Nqj=()=>{if(12E4>this.$.ea.Re.Cfb)for(let Vc of this.Tzc)Vc.runTest();else this.AWd("UserInactive")};this.tjj=Vc=>{Vc=Sys.Serialization.JavaScriptSerializer.serialize(Vc);e.ULS.sendTraceTag(388821830,0,50,Vc)};this.Lij=Vc=>{if(Vc){var td=this.w3c[Vc.testIteration.toString()];td?td.push(Vc):(td=[Vc],this.w3c[Vc.testIteration.toString()]=
td);if(td.length===this.MYf.length){td=Sys.Serialization.JavaScriptSerializer.serialize(td);if(this.$&&this.$.Te){if(Vc.EstimatedLatency=this.$.Te.vwe,this.$.Te.vwe>this.$.mv.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${td}, consequtive slow ping iteration #: ${this.K3c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${td}`);this.K3c=1}}};this.gh=(Vc,td)=>{Vc=td.context.methodName;if(Vc===se.a.txb||Vc===se.a.iwa)this.fFb++,Vc=Date.now(),this.wBj(Vc)&&(this.fFb=0,this.qud=Vc,this.AJj())};this.Wca=()=>{this.dWd("OnThrottledUserActivity")};this.aW=()=>{this.AWd("OnDocumentHidden")};this.zR=()=>{this.dWd("OnDocumentUnhidden")};this.$=ec;if(this.CTd=this.e1g())this.MYf=[Id.a.kFc],this.K3c=1,this.w3c={},this.$.ea.Re.fha(this.Wca),this.$.da.$a(291,Vc=>{Vc.BGa(this.aW);Vc.CGa(this.zR)})}dispose(){this.$&&
(this.BTd&&this.$.pa&&0<this.g$a.count&&this.$.pa.Lr(this.gh),this.CTd&&(this.AWd("Dispose"),this.$.ea.Re.EAa(this.Wca)))}zci(){gb.EwaSettings.ma(210)&&this.I3i();this.CTd&&this.J3i()}Wci(){this.fFb=this.gFb;this.qud=0;var ec={};if(!this.g$a){this.g$a=new da.a;const Vc=Le.a.Xdd(this.tjj,"InitSampleMeasurement",this.$);for(const td of Vc)ec[td.Pld]=td.baseUrl,this.g$a.add(td)}ec=Sys.Serialization.JavaScriptSerializer.serialize(ec);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.gFb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.fFb}, testParams: ${ec} `);
0<this.g$a.count&&this.$.pa.Mq(this.gh)}AJj(){for(let ec of this.g$a)ec.runTest()}dWd(ec){this.BTa&&this.BTa.Ep||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${ec}`),this.BTa=qa.a.instance.ZC(this.Nqj,5E3,Sa.a.uHj),this.BTa.yV())}AWd(ec){this.BTa&&this.BTa.Ep&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${ec}`),this.BTa.cancel())}wBj(ec){return this.fFb>=this.gFb&&ec-this.qud>
this.Qyd}e1g(){return fe.CYf(this.$.va.SlowNetworkMeasurementsSamplePercentage)}I3i(){this.gFb=this.$.va.NumberOfRequestToWaitPerNetworkMeasurement;this.Qyd=1E3*this.$.va.MinTimeBetweenNetworkMeasurementInSec;const ec=this.$.va.NetworkMeasurementsSamplePercentage;0<this.gFb&&0<this.Qyd&&(this.BTd=fe.CYf(ec))&&this.Wci()}J3i(){if(!this.Tzc){this.Tzc=new da.a;const ec=Le.a.Xdd(this.Lij,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[Id.a.kFc]);for(const Vc of ec)this.Tzc.add(Vc);this.$.ea.Re.Hr&&
this.dWd("PrepareAndInitSlowNetworkTests")}}static CYf(ec){return 100*Math.random()<ec}}Object(b.a)(fe,"NetworkMeasurement",null,[2]);var Yd=a(127),Ce=a(750);class ye{constructor(ec){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=ec}get count(){return this._count}get sU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}EVj(){this.sU&&
this.sU.A2f()}uHg(ec){this.allOfflinePartialInteractivitiesDataInSession.push(ec);this._count++}}Object(b.a)(ye,"OfflinePartialInteractivitiesDataForLog",null,[]);class Ae extends vd{constructor(ec,Vc,td){super(ec,Vc,td);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}Pxj(ec){this.timeFromLastOffline=ec}muj(ec){this._errorDataDuringOfflineMode=ec}}Object(b.a)(Ae,"OfflinePartialInteractivityData",vd,[]);class He{constructor(ec,Vc){this.kPa=this.sU=
null;this.jHd=-1;this.xvb=null;this.eof=y.Task.delay(0);this.cab=(td,he)=>{he.pM?this.tTi(he.Eoa):this.uTi()};this.Xca=(td,he)=>{5===he.uKf&&this.N3a()};this.LZf=(td,he)=>{this.sU.muj(he.QU)};this.N3a=()=>{this.kPa.EVj();this.soj(He.oFd,Sys.Serialization.JavaScriptSerializer.serialize(this.kPa))};this.jjj=td=>{if(td=td.result)this.Okg=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${td}`)};
this.xdj=()=>{this.Okg&&(this.$?Ub.TaskExtensions.Aa(this.indexedDB.n7b(He.oFd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.qPa=()=>{if(this.kPa&&0<this.kPa.count){const td=Sys.Serialization.JavaScriptSerializer.serialize(this.kPa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${td}`)}};this.$=ec;this.indexedDB=Vc;this.Okg=!1;this.indexedDB.se()&&(this.indexedDB.initialize(He.ozb,He.pzb),this.Gij(),this.kPa=new ye(this.$.va.UserSessionId),Ke.a(this.$).Yf.IWc(this.cab));this.Gm=Yd.a.instance.uH();this.Gm.ka("beforeunload",this.qPa)}dispose(){this.$&&Ke.a(this.$)&&Ke.a(this.$).Yf.GLd(this.cab);Ac.a.Ia(this.xvb);this.$=this.xvb=null}tTi(ec){this.sU=
new Ae(Ab.a.Qa.zb,this.$,0!==ec);this.sU.Pxj(-1!==this.jHd?window.performance.now()-this.jHd:-1);this.kPa.uHg(this.sU);Ke.a(this.$).Yf.QWc(this.Xca);this.N3a();this.xvb=qa.a.instance.ZC(this.N3a,He.GGh,Sa.a.N3a);Zc.a(this.$).zWc(this.LZf)}uTi(){this.sU.tDd(this.$);this.N3a();Ac.a.Ia(this.xvb);this.xvb=null;this.jHd=window.performance.now();Ke.a(this.$).Yf.Cuc(this.Xca);Zc.a(this.$).vLd(this.LZf);this.Mij()}soj(ec,Vc){this.$?this.eof=Ub.TaskExtensions.Aa(this.eof,()=>{this.indexedDB.Gna(new Ce.a(ec,
Vc))},this.$.la):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}Gij(){const ec=this.$.la;Ub.TaskExtensions.Aa(Ub.TaskExtensions.Aa(this.indexedDB.Sja(He.oFd),this.jjj,ec),this.xdj,ec)}Mij(){if(this.sU){const ec=Sys.Serialization.JavaScriptSerializer.serialize(this.sU);gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?Vd.b().RLb(560791645,0,50,Gd.offline,this.sU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",ec):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${ec}`)}this.sU&&this.sU.isToastShown&&Ic.Health.instance.recordQosError(gd.a.zZj,[Sc.a.elc],!0,!1,!1,!1,null)}}He.ozb="NetworkAvailability";He.pzb="NetworkAvailabilityData";He.oFd="partialInteractivityData";He.GGh=3E3;Object(b.a)(He,
"OfflineModeTelemetryManager",null,[2]);class gf{constructor(ec,Vc){this.ama=this.Vzd=this.Exf=null;this.$=ec;gb.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&X.a.If||(this.Exf=new He(ec,Vc));gb.EwaSettings.ma(210)&&(this.Vzd=new fe(this.$),this.Vzd.zci());!gb.EwaSettings.ma(550)||gb.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&X.a.If||(this.ama=new Od.NetworkConnectionHealthChecker(this.$));this.E6g=new Ed(this.$)}dispose(){Ac.a.Ia(this.Exf);
Ac.a.Ia(this.Vzd);Ac.a.Ia(this.ama);Ac.a.Ia(this.E6g);this.$=null}}Object(b.a)(gf,"NetworkConnectionTelemetryManager",null,[2]);class Xe extends vd{constructor(ec,Vc,td,he){super(ec,Vc,td);this.wasInteruptedByOfflineMode=!1;this.type=he;this.wasInteruptedByOfflineMode=!1}cab(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(Xe,"SilentReopenData",vd,[]);class $a{constructor(ec){this.W7=null;this.xHf=(Vc,td)=>{this.uHf(td,3)};this.KDf=(Vc,td)=>{this.uHf(td,2)};this.$=ec;this.Yf=Ke.a(this.$).Yf;this.Yf.Nqe(this.KDf);
this.Yf.xMg(this.xHf)}dispose(){this.Yf.JUf(this.KDf);this.Yf.phj(this.xHf);this.W7=this.Yf=this.$=null}uHf(ec,Vc){ec.pM?this.W7=new Xe(Ab.a.Qa.zb,this.$,0!==ec.Eoa,Vc):(5===ec.Eoa&&(this.W7.wasInteruptedByOfflineMode=!0),3!==ec.Eoa&&2!==ec.Eoa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.W7.tDd(this.$),2===Vc?gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?
Vd.b().SLb(571289604,0,50,Gd.offline,this.W7.durationMs,this.W7):e.ULS.sendTraceTag(571289604,0,50,dd.a.hc(this.W7)):gb.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?Vd.b().SLb(542782150,0,50,Gd.Gnh,this.W7.durationMs,this.W7):e.ULS.sendTraceTag(542782150,0,50,dd.a.hc(this.W7)),this.W7=null)}}Object(b.a)($a,"SilentReopenPartialInteractivityTelemetryManager",null,[2]);class ac extends ic.a{constructor(ec,Vc,td=!0){super();this.Z0=this.I4b=this.lPa=
this.ooa=this.wTa=null;this.Qvf=0;this.Ftc=this.gcb=this.hcb=!1;this.Rvf=this.documentVisibilityObserver=null;this.Hqa=!1;this.Kmd=this.g8=0;this.mBb=!1;this.Y8f=0;this.tTd=!1;this.k1=null;this.vEf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.Nmc(1,!1)};this.zR=()=>{this.ala||this.CDb?window.setTimeout(()=>{this.SYd()},this.Qvf):this.SYd();this.documentVisibilityObserver.mRa(this.zR);this.mBb=!1};this.jg=()=>{e.ULS.sendTraceTag(537155218,
0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.CDb}, IsInDuringWorkSilentReopenMode:${this.Mlc&&!this.Hqa}`);this.CDb&&this.hne();this.Mlc&&!this.Hqa&&this.ene();Ga.h(this.$).fc.em(this.jg);this.hcb=this.gcb=!1};this.wEf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.Nmc(1,!0);this.gcb&&!this.hcb&&Ga.h(this.$).fc.em(this.jg);this.gcb=!1};this.Wca=(he,ne)=>{this.Kmd=this.g8;this.g8=ne.DBc};
this.wHf=()=>{this.$&&(this.Ftc||(Wa.a(this.$).JQ(Oa.a.VPa).fKg(this.FEf),this.$.ml(this.dd),this.Ftc=!0),this.Hqa=this.Mii(),this.Nmc(2,!1))};this.FEf=()=>{var he=Wa.a(this.$).fi;const ne=he.nQg();he=xb.f(he.Zs.hd.errors,Te=>Te.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${ne}, IsB2W:${this.Hqa}, Errors: ${dd.a.hc(he)}`);ne&&(this.wTa?(this.Hqa=!1,this.KJe(),this.GCc()):this.ooa&&(this.LJe(),this.GCc()))};
this.dd=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.Hqa=!1,this.Z0&&this.Z0.Ep&&(Ac.a.Ia(this.Z0),this.Z0=null),this.k1&&this.k1.Ep&&(Ac.a.Ia(this.k1),this.k1=null),this.Nmc(2,!0),this.GCc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.Szf=()=>{this.Puf(!0)};this.Tzf=()=>{this.Puf(!1)};this.CXb=Hd.Jwi;this.G3c=Hd.connected;this.$=ec;this.Te=
ec.pa.Te;td&&(this.Rvf=new gf(ec,Vc));this.$.da.$a(291,he=>{this.documentVisibilityObserver=he});this.Qvf=this.$.va.ExcelNetworkCheckAfterTabActivationDelayMs;this.Te.Tqe(this.vEf);this.Te.nob(this.wEf);this.Te.hqe(this.Szf);this.Te.LJg(this.Tzf);new $a(this.$,this);this.wrf=this.$.va.LongInactivityTimePeriodSeconds;this.$.ea.aXc(this.wHf);this.$.ea.Re.fha(this.Wca);this.Y8f=this.$.va.SilentReopenDuringWorkDelayMs}get Lki(){return this.Hqa}get CDb(){return!(this.CXb&1)}get Mlc(){return!(this.CXb&
2)}get ala(){return!!(this.G3c&2)}dispose(){this.Te&&(this.Te.OUf(this.vEf),this.Te.RJb(this.wEf),this.Te.jUf(this.Szf),this.Te.cfj(this.Tzf));this.mBb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.mRa(this.zR),this.mBb=!1);this.$&&(this.Ftc&&this.GCc(),this.$.ea&&(this.$.ea.aVf(this.wHf),this.$.ea.Re&&this.$.ea.Re.EAa(this.Wca)));this.k1&&(this.k1.dispose(),this.k1=null);Ac.a.Ia(this.Rvf);this.$=null;super.dispose()}TCi(){this.tTd=!0}ene(){this.ooa||(this.ooa=Ke.a(this.$).Yf.cZa(3,
"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}Mii(){if(this.tTd)return this.tTd=!1,!0;const ec=this.g8>this.wrf||this.Kmd>this.wrf&&10>this.g8;e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.g8}, Time gap between last two activities: ${this.Kmd}. return value:${ec}`);return ec}vjj(){this.k1=qa.a.instance.create(()=>{Ic.Health.instance.recordQosError(gd.a.zHj,[Sc.a.elc],
!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}VEg(){this.ooa||this.Z0?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):this.Z0=qa.a.instance.create(()=>{this.$?this.ooa?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):
Ga.h(this.$).eb?(this.gcb||(Ga.h(this.$).fc.Rm(this.jg),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.hcb=!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.ene():e.ULS.sendTraceTag(537155222,
0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.Y8f,Sa.a.wGj,void 0,!0)}Puf(ec){this.G3c=this.Qye(2,ec,!0);this.dse()}Nmc(ec,Vc){this.CXb=this.Qye(ec,Vc,!1);this.dse()}Qye(ec,Vc,td){td=td?this.G3c:this.CXb;return Vc?td|ec:td&~ec}SYd(){const ec=!!this.lPa,Vc=!!this.wTa,td=!!this.ooa,he=!!this.I4b;this.CDb&&!ec?this.UEg():!this.CDb&&ec&&this.ghh();!this.Mlc||Vc||td?this.Mlc||(Vc?this.KJe():(td||this.Z0&&this.Z0.Ep)&&this.LJe()):this.Hqa?this.SEg():
this.Z0||this.VEg();this.ala&&!he?this.bdg(!0):!this.ala&&he&&this.bdg(!1)}UEg(){this.$?this.lPa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):Ga.h(this.$).eb?(this.hcb||(Ga.h(this.$).fc.Rm(this.jg),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),
this.gcb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.hne():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}hne(){this.lPa||(this.lPa=Ke.a(this.$).Yf.cZa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}ghh(){this.lPa&&(Ac.a.Ia(this.lPa),this.lPa=
null)}KJe(){this.wTa&&(Ac.a.Ia(this.wTa),this.wTa=null);this.k1&&this.k1.Ep&&this.k1.cancel();this.k1=null}LJe(){this.ooa&&(Ac.a.Ia(this.ooa),this.ooa=null);this.Z0&&(Ac.a.Ia(this.Z0),this.Z0=null);this.hcb&&!this.gcb&&Ga.h(this.$).fc.em(this.jg);this.hcb=!1}SEg(){this.wTa||(this.wTa=Ke.a(this.$).Yf.cZa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",void 0,Ud.a.instance.ga(2184)));this.vjj()}bdg(ec){ec?(this.I4b=Ke.a(this.$).Yf.cZa(4,"NetworkConnectionStateManager.ConnectivityIssues"),
this.C6i()):(Ac.a.Ia(this.I4b),this.I4b=null)}C6i(){if(this.$&&this.$.pa){const ec=this.$.pa.ya.Wb();na.I(this.$.pa.ya,null,null,null,ec)}}GCc(){Wa.a(this.$).JQ(Oa.a.VPa).fr(this.FEf);this.$.Jl(this.dd);this.Ftc=!1}dse(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");this.documentVisibilityObserver&&this.documentVisibilityObserver.ti?this.mBb||
(this.documentVisibilityObserver.CGa(this.zR),this.mBb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.SYd()}}Object(b.a)(ac,"NetworkConnectionStateManager",ic.a,[900,2]);class Da extends fa.a{constructor(ec){super();this.$=ec;this.Fb()}create(){Ub.TaskExtensions.Aa(ud.GetServiceTaskFactory.Oa(this.$.da,395,396,this.Ya),ec=>{let Vc=Object(ja.a)(this.$.da,
400,()=>new ac(this.$,ec.result));this.ob(Vc)},this.$.la,3)}static ka(ec){ec.da.Ga(401,new Da(ec))}}Object(b.a)(Da,"NetworkConnectionStateManagerFactory",fa.a,[]);var Na=a(1255),sb=a(1158),Kb=a(1216),Yb=a(120),vc=a(106),ad=a(147),ld=a(323);class md{constructor(ec){this.HOa=this.wxd=this.KOa=this.Ylc=0;this.pxd=this.Hsf=null;ec?(this.fmc=ec,this.ktb=Date.now,this.Rch(),this.acj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}iwj(){this.Hsf=
"Office.Excel.Online.Data.Activity.PenMinutes"}acj(){window.document.body.addEventListener("pointerenter",Object(A.a)(this,this.Fpc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(A.a)(this,this.f0,"onPointerLeave"));ea.a.instance.Ub("Common.App.VisibilityManagement.IVisibilityManager").execute(ec=>{ec.gre(Object(A.a)(this,this.cyb,"handleVisibilityChange"))})}Fpc(ec){"pen"!==ec.pointerType||this.KOa||(this.KOa=Math.floor(this.ktb()/1E3),this.KOa<=this.Ylc&&(this.KOa=
this.Ylc),this.wxd=0)}f0(){this.N9e()}N9e(){const ec=Math.ceil(this.ktb()/1E3);this.KOa&&ec>this.Ylc&&(this.wxd=ec,this.HOa+=this.wxd-this.KOa);this.Ylc=ec;this.KOa=0}cyb(ec,Vc){0!==Vc.newState&&this.N9e()}Rch(){this.pxd=new vc.a(4,2,6E4,Object(A.a)(this,this.Ozi,"logPenUsage"));this.fmc.Eg(this.pxd)}Ozi(){0<this.HOa&&this.R0f(this.HOa);this.HOa=0}R0f(ec){const Vc=new ld.a;Vc.name=this.Hsf;const td=[];(ec=Yb.a.ph("PenInputSec",ec.toString(),3))&&Array.add(td,ec);Vc.dataFields=td;ad.a.sendActivityEvent(Vc)}dispose(){0<
this.HOa&&this.R0f(this.HOa);this.fmc.np(this.pxd)}}Object(b.a)(md,"PenMinutesManager",null,[691]);class Qd{constructor(){this.fQc=this.gb=null}get name(){return"Common.App.PenMinutesManager"}Wh(ec){this.gb=ec;const Vc=f.AFrameworkApplication.Gi;this.gb.register(691,"Common.App.PenMinutesManager.IPenMinutesManager").xc().Fc(()=>new md(Vc))}init(){this.fQc=this.gb.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.fQc&&this.fQc.dispose()}static main(){W.a.instance.Fi(new Qd)}}
Object(b.a)(Qd,"PenMinutesManagerPackage",null,[4,5]);class ce extends fa.a{constructor(ec){super();this.$=ec;this.Fb()}static ka(ec){ec.da.Ga(514,new ce(ec))}create(){this.ob(Object(ja.a)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");Qd.main();const ec=ea.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");ec.iwj();return ec}))}}Object(b.a)(ce,"PenMinutesFactory",fa.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");
Object(c.a)();Object(La.a)();Object(Ia.a)();Object(ra.a)();Object(pa.a)();Object(ka.a)();Object(ta.a)();Object(Kb.a)();Type.registerNamespace("Common.App.InProductMessaging");sa.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ha.main();(()=>{ba.a.Fa(()=>{ba.a.Fa(Va.ka)})})();(()=>{ba.a.Fa(()=>{ba.a.Fa(wa.ka)})})();ba.a.Fa(Pb.ka);ba.a.Fa(Da.ka);(()=>{ba.a.Fa(ec=>{ce.ka(ec)})})();Object(Na.a)();Object(sb.a)()},850:function(u,E,a){a.r(E);u=a(0);var c=a(7),b=a(15),e=a(321),f=a(29),
d=a(11),h=a(314);class m{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(u.a)(m,"ConnectionErrorLogInfo",null,[]);var l=a(1115),w=a(1265);class n{constructor(t){this.Xld=[l.a.mmg,l.a.kFc];this.Wn=(r,v)=>{this.xO[v]=r;this.u9h()&&this.ojj("OnNetworkDownImmediatePing"===r.caller)};this.ama=t;this.$=t.$;this.xO={}}gvi(){const t=w.a.Xdd(this.Wn,"OnNetworkDownImmediatePing",this.$,this.Xld);for(const r of t)r.runTest()}u9h(){for(const t of this.Xld)if(void 0===
this.xO[t]||null===this.xO[t])return!1;return!0}ojj(t){const r=this.$.Te.C5;t&&this.xKj(r);for(var v of this.Xld)this.xO[v]=Sys.Serialization.JavaScriptSerializer.serialize(this.xO[v]);t=Date.now();v=this.ama.Tid(a(850).NetworkConnectionHealthChecker.KEb).returnValue;const B=this.ama.Tid(a(850).NetworkConnectionHealthChecker.ULb).returnValue;this.xO.isOfflineMode=r;this.xO.networkDownBBAge=-1===v?v:t-v;this.xO.transientServerCommunicationFailuresBBAge=-1===B?B:t-B;this.ama.businessBar?(this.xO.isNetworkDownBBShown=
this.ama.businessBar.$E(56).toString(),this.xO.isServerErrorBBShown=this.ama.businessBar.$E(21).toString()):(this.xO.isNetworkDownBBShown="unknown",this.xO.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.xO)}`)}xKj(t){const {NetworkConnectionHealthChecker:r}=a(850),v={};for(const B of Object.keys(this.xO)){const A=this.xO[B];v[A.testName]=A.isSuccess}v.isOfflineMode=t;this.ama.PWd(r.F3c,
Sys.Serialization.JavaScriptSerializer.serialize(v))}}Object(u.a)(n,"ConnectionHealthTestsRunner",null,[]);a.d(E,"NetworkConnectionHealthChecker",function(){return y});class y{constructor(t){this.businessBar=this.Q8a=null;this.EKi=(r,v)=>{v.k8c?this.GKi(v):this.FKi(v)};this.gh=(r,v)=>{r=v.context.methodName;this.Q8a&&r===this.Q8a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.Q8a}" has now succeeded. Querying local storage for BB showings.`),
this.o9a(y.ULb,!0),this.Q8a=null);this.Jqf(!1);this.H4b=!1};this.zm=(r,v)=>{f.a.dh(v.errors,[-1387426400])&&!this.H4b&&(this.H4b=!0,this.n6f()&&window.performance.mark(y.Dxf),(new n(this)).gvi())};this.ig=()=>{this.Jqf(!0);this.o9a(y.KEb,!1);this.o9a(y.ULb,!1)};this.sza=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.o9a(y.KEb,!0)};this.$=t;this.pa=this.$.pa;this.localStorage=new h.a;
this.H4b=!1;this.$.ea.Ak(this.ig);this.pa.Te.nob(this.sza);this.pa.Mq(this.gh);this.$.da.$a(5,r=>{this.businessBar=r;r.rJg(this.EKi)});this.pa.iw(this.zm)}dispose(){this.$&&(this.$.ea&&this.$.ea.jo(this.ig),this.pa&&(this.pa.Te.RJb(this.sza),this.pa.hx(this.zm),this.pa.Lr(this.gh)))}GKi(t){const r={};r.Timestamp=Date.now().toString();switch(t.f0a){case 21:this.Q8a=t.data.FailedMethod;r.FailedMethod=this.Q8a;this.PWd(y.ULb,JSON.stringify(r));break;case 56:this.PWd(y.KEb,JSON.stringify(r))}}FKi(t){switch(t.f0a){case 21:this.o9a(y.ULb,
!0);break;case 56:this.o9a(y.KEb,!0)}}PWd(t,r){try{this.localStorage.se()&&this.localStorage.setItem(t,r)}catch(v){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${v.message||"Unknown"}`)}}Tid(t){if(this.localStorage.se()&&(t=this.localStorage.V4a(t))&&"null"!==t){var r=JSON.parse(t);t=parseInt(r.Timestamp,10);r=Sys.Serialization.JavaScriptSerializer.serialize(r);return{returnValue:t,rawData:r}}return{returnValue:-1,
rawData:null}}Jqf(t){if(this.localStorage.se()){const r=this.localStorage.V4a(y.F3c);if(r&&"null"!==r){let v=-1;this.H4b&&(v=this.xRh(y.Dxf,y.qJi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(r)}, Period offline: ${v}, New session: ${t}`);this.localStorage.removeItem(y.F3c)}}}xRh(t,r){if(!this.n6f())return-1;window.performance.measure(r,t);t=window.performance.getEntriesByName(r);
return t.length&&t[t.length-1]?t[t.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${r} returned no measures.`),-1)}o9a(t,r){try{let v;const B=({rawData:v}=this.Tid(t)).returnValue;if(-1!==B){const A=Object(c.a)(new m,{timeElapsed:Date.now()-B,scenario:t,isNewSession:!r,rawData:v});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(A)}`)}this.localStorage.removeItem(t)}catch(v){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${v.message||"Unknown"}`)}}n6f(){return d.HelperMethods.j_c&&e.a.eqb}}y.KEb="NetworkDownBBShown";y.ULb="ServerCommunicationFailureBBShown";y.F3c="ConnectionHealthPingRsults";y.Dxf="offMoStMa";y.qJi="offMoDuMea";Object(u.a)(y,"NetworkConnectionHealthChecker",null,[2])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/a0eca7779d7e3191a1daf1194ef2291e/EwaDSEsNext.pi.js.map