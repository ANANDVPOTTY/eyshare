'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1230:function(u,E,a){u=a(0);var c=a(944),b=a(4);class e{}Object(u.a)(e,"LokiTokenResult",null,[]);class f{constructor(n){this.WVb=n}Ngd(){const n=this.TVh();return n?f.drd?new Promise((y,t)=>{this.WVb.continueWith(()=>{this.WVb.Ch||this.WVb.Xf?t(Error.create("Error downloading auth library")):this.WVb.result.PL("Loki",n).then(r=>{r=b.AFrameworkApplication.fa.qa("ForceLokiFallbackToACLPTokenIsEnabled")?this.WVh():
r.IsSuccess&&r.Token?Object.assign(new e,{isSuccess:!0,token:r.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(r)});y(r);return r})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.r_e())}))}WVh(){const n=
b.AFrameworkApplication.fa.Xa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:n,errorMessage:null})}TVh(){let n=null;const y=c.a.nbc();2===y?n=b.AFrameworkApplication.fa.Xa("LokiAADAppId"):1===y&&(n=b.AFrameworkApplication.fa.Xa("LokiMSAAppId"));return n}static get drd(){return b.AFrameworkApplication.fa.qa("IsO365CommercialHost")||b.AFrameworkApplication.fa.qa("IsO365ConsumerHost")}}Object(u.a)(f,"LokiTokenManager",null,[662]);var d=a(248),h=a(82),m=a(518);class l{get name(){return"Common.App.LivePersonaUtils"}init(){h.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Wh(n){n.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").xc().Fc(()=>new f(m.a.kr(n.Ub("Common.App.OAuth.IOAuthManager"))))}static main(){d.a.instance.Fi(new l)}}Object(u.a)(l,"LivePersonaUtilsPackage",null,[4,5]);a.d(E,"a",function(){return w});const w=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");l.main()}},1253:function(u,E,a){var c=a(9);u=a(0);var b=a(82),e=a(222),f=a(7),d=a(15),h=a(764);class m{constructor(y){this.oAuthManager=y}PL(y,t){return this.oAuthManager?
this.oAuthManager.PL(y,t).then(r=>{r.IsSuccess||d.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+r.ErrorMessage+" Error code: "+r.ErrorCode+" App name: "+y);return Object(f.a)(new h.a,{IsSuccess:r.IsSuccess,Token:r.Token,ErrorCode:r.ErrorCode,ErrorMessage:r.ErrorMessage})}):(d.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new h.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}PMa(){return this.oAuthManager?
this.oAuthManager.PMa():null}}Object(u.a)(m,"OAuthManagerWrapper",null,[639]);var l=a(695);class w extends e.a{constructor(y){super();this.$=y;this.Fb()}create(){this.ob(Object(l.a)(this.$.da,349,()=>new m(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static ka(y){y.da.Ga(350,new w(y))}}Object(u.a)(w,"OAuthManagerFactory",e.a,[]);a.d(E,"a",function(){return n});const n=()=>{c.a.Fa(y=>{w.ka(y)})}},1279:function(u,E,a){u=a(0);var c=a(15),b=a(840),e=a(920),f=a(4),d=a(97),h=a(729),m=a(248),
l=a(41),w=a(40),n=a(27),y=a(111),t=a(82),r=a(189);class v{get name(){return"Common.App.OAuth.OAuthPackage"}Wh(A){A.register(620,"Common.App.OAuth.IOAuthManager").xc().Fc(()=>new b.OAuthManager)}init(){const A=t.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.CSj(A)}CSj(A){const z=f.AFrameworkApplication.fa.Xa("FileSource");if(f.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.qa("IsO365CommercialHost")||"WopiTest"===z){var x=h.a.U8g;if(x&&x.IsEnabled){var D=
x.Application,J=h.a.authority;if(void 0!==D&&null!==D&&D.length&&void 0!==J&&null!==J&&J.length){var L=e.a[A.PS],T=n.a.vHa,O=A.zv();try{var G=new Map;void 0!==G&&null!==G?(G.set("SupportStatus",L),G.set("Browser",T),G.set("AuthStrategy",O)):G=null}catch(H){G=null}d.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",G);var C=w.a.Ud();A.PL("Core",D).then(H=>{const I=Math.floor(w.a.Ud()-C);L=e.a[A.PS];T=n.a.vHa;O=A.zv();c.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
I,H.IsSuccess,L,H.ErrorCode,z,T,O);G&&(G.set("SupportStatus",L),G.set("Browser",T),G.set("AuthStrategy",O));var M=Object.assign(new r.a,{durationMs:I,extendedProperties:G});if(H.IsSuccess){if(d.Health.instance.recordKpiSuccess("WacCorePFT",M),M=x.Endpoint){var Q=w.a.Ud();f.AFrameworkApplication.Dd.dob(M,1,null,{["Authorization"]:"Bearer "+H.Token},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(U=>{var N=Math.floor(w.a.Ud()-Q),W=null;U.Ch?U="Canceled":U.Xf?U="Faulted":(W=U.result,
U=W.succeeded?"Completed":"Failed");N={["TaskResult"]:U,["BrowserTokenDurationMS"]:I,["BrowserValidationDurationMS"]:N};W&&(N.HttpStatus=W.Jg.data.httpStatus,W.succeeded&&(W=l.a(W.Jg.data.ue),N.ServerValidationDurationMS=W.ElapsedMilliseconds,N.ServerValidationResult=W.ValidatedToken,N.KMSI=W.KMSI,N.Scopes=W.Scopes,N.TokenExpirationS=Math.floor(parseInt(W.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===U?50:15,y.a.toJSON(N))})}}else d.Health.instance.recordKpiFailure("WacCorePFT",
H.ErrorCode,!1,!1,M)}).catch(H=>{var I=Math.floor(w.a.Ud()-C);I=Object.assign(new r.a,{durationMs:I,extendedProperties:G});d.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+H.toString(),!1,!1,I)})}}}}dispose(){}static main(){m.a.instance.Fi(new v)}static Zbj(){m.a.instance.Fi(new v,0,!0)}}Object(u.a)(v,"OAuthPackage",null,[4,5]);a.d(E,"a",function(){return B});const B=A=>{Type.registerNamespace("Common.App.OAuth");A?v.Zbj():v.main()}},1466:function(u,E,a){a.r(E);u=a(1279);E=a(1230);
a=a(1253);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(u.a)();Object(E.a)();Object(a.a)()},840:function(u,E,a){a.r(E);u=a(0);var c=a(15);const b=(S,oa)=>{var K=S.Npg;if(!K){K=[];for(var ea in S)"string"===typeof ea&&K.push({key:ea,value:S[ea]});K.sort((ya,ha)=>ya.value-ha.value);S.Npg=K}K=[];for(ea=1;0<oa;)oa&1&&S[ea]&&K.push(S[ea]),ea<<=1,oa>>=1;if(K.length&&0===oa)return K.reverse().join(", ")};var e=a(920),f;(function(S){S[S.external=0]="external";
S[S.msa=1]="msa";S[S.aad=2]="aad"})(f||(f={}));Object(u.b)("AuthorityType",f);class d{}Object(u.a)(d,"OAuthResult",null,[]);class h{constructor(S){this.dyg=S}initialize(){return Promise.resolve(0)}nlc(){return Promise.resolve(0)}PL(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new d,{IsSuccess:!0,Token:this.dyg}))}qCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",
ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}SAc(){return!1}Fxb(){return"MockAuthTokenStrategy"}}Object(u.a)(h,"MockAuthTokenStrategy",null,[796]);var m=a(944);class l{static get(S,oa,K){if(!K)return S;let ea=0;return Promise.race([S,new Promise(ya=>{ea=window.setTimeout(()=>{ya(oa)},K)})]).then(ya=>{window.clearTimeout(ea);return Promise.resolve(ya)}).catch(()=>{window.clearTimeout(ea);return Promise.resolve(oa)})}}Object(u.a)(l,"PromiseWithTimeout",
null,[]);var w=a(4),n=a(729);class y{constructor(S,oa,K,ea,ya){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=S;this.scope=oa;this.silentLogin=K;this.options=ea;this.correlationId=ya}}Object(u.a)(y,"TokenRequestParameters",null,[762]);var t=a(27),r=a(82);class v{constructor(){this.Dme=null;let S=w.AFrameworkApplication.fa.Xa(w.AFrameworkApplication.o8),oa=w.AFrameworkApplication.fa.Xa(w.AFrameworkApplication.mfg);this.BYa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",
S&&""!==S?S:"Unspecified",oa&&""!==oa?oa:"Unspecified")}initialize(){return new Promise(S=>{r.a.instance.Ub("Common.App.WopiIdentity.IWopiIdentity").execute(oa=>{this.Dme=oa;S(0)})})}Ci(S){const oa=["HTTPS:","API:"];let K=!1;const ea=S.toLocaleUpperCase();for(const ya of oa)if(ea.startsWith(ya)){K=!0;break}return K||this.qmi(S)?S+"/.default":S}qmi(S){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(S)}nlc(){return Promise.resolve(0)}PL(S,oa,K,ea,ya,
ha,La){if(t.a.Rxa){ya=n.a.$0j;if(!ya)return oa=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(oa);if(!Array.contains(ya,S))return oa=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+S}),Promise.resolve(oa)}S=this.Ci(K);K=new y(K,S,!ea,null,w.AFrameworkApplication.userSessionId);return this.Dme.getAccessToken(K,oa,La).then(Ia=>Object.assign(new d,{IsSuccess:!0,Token:Ia.accessToken}),
Ia=>Object.assign(new d,{IsSuccess:!1,ErrorCode:Ia}))}qCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}SAc(){return!1}Fxb(){return this.BYa}}Object(u.a)(v,"ParentFrameTokenStrategy",null,[796]);var B=a(84),A=a(848),z=a(187);class x{constructor(){this.reject=this.resolve=null;this.startTime=0;this.eOf=this.Dwe=null}}Object(u.a)(x,"PromiseWrapper",
null,[]);class D{constructor(S=0){this.iC=0;this.Alb=!1;this.Om=new z.a;this._timeout=S}enqueue(S){return new Promise((oa,K)=>{this.Om.add(Object.assign(new x,{eOf:S,resolve:oa,reject:K}));this.process()})}process(){if(this.Alb||this.iC===this.Om.count)return!1;const S=this.Om.na(this.iC++);try{this.Alb=!0,S.eOf().then(oa=>{this.Alb=!1;this.t3c(S,oa,null,!0)}).catch(oa=>{this.Alb=!1;this.t3c(S,null,oa,!1)})}catch(oa){this.Alb=!1,this.t3c(S,null,oa,!1)}return!0}t3c(S,oa,K,ea){if(ea){const ya=()=>{S.resolve(oa);
this.process()};0<this._timeout?window.setTimeout(()=>{ya()},this._timeout):ya()}else{const ya=()=>{S.reject(K);this.process()};0<this._timeout?window.setTimeout(()=>{ya()},this._timeout):ya()}}}Object(u.a)(D,"PromiseQueue",null,[]);class J{constructor(){this.correlationId=this.resolve=null}}Object(u.a)(J,"ResolveWithCorrelation",null,[]);var L=a(83),T=a(146),O=a(821),G=a(164);class C extends T.a{constructor(S,oa,K,ea,ya,ha){super(!1,!1,!0);this.$7d=this.N1=null;this.oY=S;this.Gzg=K;this.Yv=ea;this.oDg=
ya;this.zEa=ha;this.it=document.createElement("iframe");this.it.id="SharedAuthInteractiveFrame";this.it.setAttribute("name","SharedAuthInteractiveFrame");this.it.setAttribute("title","SharedAuthInteractiveFrame");this.it.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.it.style.border="0";this.it.style.height="48px";this.it.style.width="190px";$addHandler(this.it,"error",Object(B.a)(this,this.ZVi,"onSharedAuthFrameError"));S=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",
this.oY,oa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",w.AFrameworkApplication.userType);this.it.src=S;this.ltg=new Promise(La=>{this.$7d=La});this.a8d=!1}hzc(){this.N1={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.Gzg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:w.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(B.a)(this,this.Oah,"createFrame"),["resolveDialogStyles"]:this.$7d}};this.Rb=
5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(B.a)(this,this.xzj,"sharedAuthConsentDialogHandler"),this.N1)}GDc(S=!1,oa=!1,K=5){this.N1&&this.N1.bodyControls&&(S!==Object(L.a)(Object,this.N1.bodyControls).frameLoaded&&(Object(L.a)(Object,this.N1.bodyControls).frameLoaded=S),oa!==Object(L.a)(Object,this.N1.bodyControls).frameLoadSuccess&&(Object(L.a)(Object,this.N1.bodyControls).frameLoadSuccess=oa),K!==this.N1.dialogButtonsOption&&(this.N1.dialogButtonsOption=null,this.Rb=K),this.update(this.N1))}SFj(S,
oa){const K=new O.a(G.a.Bzj);K.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,["rtl"]:w.AFrameworkApplication.isRtl,["messageCorrelationId"]:S,["dialogStyles"]:oa};this.Yv.sSa(K,this.it.contentWindow,this.oY)}mYe(){this.GDc(!0,!1,6)}get p5f(){return this.it}get skh(){return this.ltg.then(S=>{this.a8d=!0;return S})}get tkh(){return this.a8d}ZVi(){this.mYe()}Oah(){return this.it}xzj(S){0===S&&(this.oDg.reject(Object.assign(new d,{ErrorCode:"UserCancelled",
ErrorMessage:"The interactive flow was cancelled by the user"})),this.zEa(null))}}Object(u.a)(C,"SharedAuthConsentDialog",T.a,[831]);var H=a(1240),I=a(97),M=a(136),Q=a(40),U=a(170),N=a(189);class W{constructor(){this.it=null;this.sUb=0;this.Kkb=this.QYa=this.IGc=this.zEa=this.oM=this.Dle=null;this.Yv=new H.a(null,null);this.BYa="SharedAuthTokenStrategy Unloaded";this.oY=n.a.zzj;this.Fje=n.a.yzj;this.L8d=n.a.enableConsoleLogging;this.Ctg=w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",
!1);this.QBg=w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",!1);this.tra={};this.cwg=new D(1500)}Fxb(){return this.BYa}initialize(){var {OAuthManager:S}=a(840);if("loadFrame"in this.tra)return this.tra.loadFrame.Dwe;if(!this.oY)return I.Health.instance.recordKpiFailure(S.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);
S=this.zAc("loadFrame");this.sUb=Q.a.Ud();var oa=this.oY+this.Fje+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+w.AFrameworkApplication.userSessionId+"&WacUserType="+w.AFrameworkApplication.userType;this.it=document.createElement("iframe");this.Pdi(this.it);this.it.style.cssText="height:0;width:0;display:none;";this.it.id="SharedAuthFrame";this.it.setAttribute("name","SharedAuthFrame");this.it.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");
this.it.setAttribute("title","SharedAuthFrame");this.it.src=oa;document.body.appendChild(this.it);oa=Q.a.Ud()-this.sUb;c.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",oa,this.it.src);return S}nlc(S){this.IGc=S;const oa=new O.a(G.a.s5f);oa.Values=this.fwe(S);S=this.zAc("initFrame");this.Yv.sSa(oa,this.it.contentWindow,this.oY);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");
return S}PL(S,oa,K,ea,ya,ha){const La=new O.a(G.a.Czj),Ia=this.B5e();La.Values=this.Heg(S,oa,K,ea,ya,ha,Ia);S=this.zAc(Ia);ea&&w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.cwg.enqueue(()=>new Promise(ra=>{this.TRj(ha,La,ra,Ia)})):(this.Yv.sSa(La,this.it.contentWindow,this.oY),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",oa));return S}TRj(S,oa,K,ea){const ya=this.tra[ea];
ya&&(this.QYa=oa,this.zEa=Object.assign(new J,{resolve:K,correlationId:ea}),this.oM=new C(this.oY,this.Fje,S,this.Yv,ya,K),this.oM.hzc())}B5e(){return U.a.create().toString()}Heg(S,oa,K,ea,ya,ha,La){const Ia={};Ia.appName=S;Ia.appId=oa;Ia.target=K;Ia.withPopup=ea;Ia.claims=ya;Ia.promptMessage=ha;Ia.messageCorrelationId=La;return Ia}Pdi(S){$addHandler(S,"load",Object(B.a)(this,this.aRi,"onIFrameLoaded"));$addHandler(S,"error",Object(B.a)(this,this.Woc,"onIFrameError"));this.Yv.tGa(this.oY);this.Yv.so(G.a.v5f);
this.Yv.dm(G.a.v5f,Object(B.a)(this,this.qVi,"onScriptLoaded"));this.Yv.so(G.a.u5f);this.Yv.dm(G.a.u5f,Object(B.a)(this,this.pVi,"onScriptInitialized"));this.Yv.so(G.a.q5f);this.Yv.dm(G.a.q5f,Object(B.a)(this,this.CQi,"onGetTokenResponse"));this.Yv.so(G.a.w5f);this.Yv.dm(G.a.w5f,Object(B.a)(this,this.uSi,"onLoginResponse"));this.Yv.so(G.a.t5f);this.Yv.dm(G.a.t5f,Object(B.a)(this,this.xRi,"onInteractiveFlowReady"));this.Yv.so(G.a.r5f);this.Yv.dm(G.a.r5f,Object(B.a)(this,this.UQi,"onHideDialog"));this.Yv.so(G.a.o5f);
this.Yv.dm(G.a.o5f,Object(B.a)(this,this.NLi,"onCloseDialog"))}zAc(S){const oa=new x;oa.startTime=Q.a.Ud();const K=new Promise((ea,ya)=>{oa.resolve=ea;oa.reject=ya});oa.Dwe=K;this.tra[S]=oa;return K}aRi(){const S=Q.a.Ud()-this.sUb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",S)}Woc(S){const {OAuthManager:oa}=a(840),K=Q.a.Ud()-this.sUb,ea=Object.assign(new N.a,{durationMs:K});I.Health.instance.recordKpiFailure(oa.kpiName,"SharedAuthWACOAuthAspxFrameError",
!1,!0,ea);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",K,this.L8d?JSON.stringify(S):"")}qVi(S){const {OAuthManager:oa}=a(840),K=this.tra.loadFrame;var ea=Q.a.Ud()-K.startTime,ya=S.Values.AuthLibrary.toString();S=S.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",S,ya,ea);ya&&(this.BYa="SharedAuthTokenStrategy "+ya);ya=Boolean.parse(S);ya||(S=M.a.fs(),void 0!==
S&&null!==S&&(S.set("AuthLibrary",this.Fxb()),ea=Object.assign(new N.a,{durationMs:ea,extendedProperties:S}),I.Health.instance.recordKpiFailure(oa.kpiName,"SharedAuthStrategyInitFailed",!1,!0,ea)));K.resolve(ya?0:1)}pVi(S){if(S.Values.interactive&&this.QYa&&this.QYa.Values.messageCorrelationId){const K=this.QYa.Values.messageCorrelationId.toString();if(S.Values.interactive&&this.oM){this.oM.skh.then(ea=>{this.Yv.sSa(this.QYa,this.oM.p5f.contentWindow,this.oY);this.oM.SFj(K,ea);this.oM.GDc(!0,!0);
this.QYa=null});return}}S=this.tra.initFrame;const oa=Q.a.Ud()-S.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",oa);S.resolve(0)}CQi(S){if(S.Values.messageCorrelationId&&S.Values.messageCorrelationId.toString()){var oa=S.Values.messageCorrelationId.toString(),K=this.tra[oa];if(K){var ea=Q.a.Ud()-K.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ea);S.Values.isSuccess&&S.Values.isSuccess?
K.resolve(S.Values.response):K.reject(S.Values.response);this.Weg(oa)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}xRi(){if(this.oM.tkh)this.oM.mYe();else if(this.IGc&&this.oM){const S=new O.a(G.a.s5f);S.Values=this.fwe(this.IGc,!0);this.Yv.sSa(S,this.oM.p5f.contentWindow,this.oY)}}UQi(){this.oM&&
this.oM.Pyb()}NLi(S){S.Values.cancelled&&S.Values.cancelled&&S.Values.messageCorrelationId&&this.Weg(S.Values.messageCorrelationId.toString());this.oM&&this.oM.hide()}fwe(S,oa=!1){const K={};K.appIds=this.sMh();K.upn=S.loginHint;K.authority=S.authority;K.authorityType=b(f,S.authorityType);K.tenantId=S.tenantId;K.correlationId=w.AFrameworkApplication.userSessionId;K.enableConsoleLogging=this.L8d;K.enablePopupFlash=this.Ctg;K.skipUpnCheck=this.QBg;K.interactive=oa;return K}sMh(){const S=[],oa=n.a.UXc;
for(let K in oa)Array.add(S,oa[K]);return S}qCc(S,oa,K,ea,ya,ha){const La=new O.a(G.a.Azj),Ia=this.B5e();La.Values=this.Heg(S,oa,K,ea,ya,ha,Ia);this.Dle=La;S=this.zAc(Ia);c.ULS.sendTraceTag(555049437,3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",oa);this.BDj();return S}SAc(){return!0}BDj(){this.Kkb||(this.Kkb=new A.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Kkb.id=16,this.Kkb.Xqd=!1,this.Kkb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,
()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Yv.sSa(this.Dle,this.it.contentWindow,this.oY)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}uSi(S){if(S.Values.messageCorrelationId&&S.Values.messageCorrelationId.toString()){var oa=this.tra[S.Values.messageCorrelationId.toString()];if(oa){var K=Q.a.Ud()-oa.startTime;c.ULS.sendTraceTag(555049441,
3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",K);S.Values.isSuccess&&S.Values.isSuccess?oa.resolve(S.Values.response):oa.reject(S.Values.response)}else c.ULS.sendTraceTag(555049440,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}Weg(S){this.zEa&&this.zEa.correlationId===S&&(this.zEa.resolve(null),this.zEa=null)}}
Object(u.a)(W,"SharedAuthTokenStrategy",null,[796]);class X{constructor(S){this.XQc=S;this.BYa="UnsupportedAuthTokenStrategy Reason="+e.a[this.XQc]}initialize(){return Promise.resolve(0)}nlc(){return Promise.resolve(0)}PL(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:e.a[this.XQc],ErrorMessage:"Unable to get a token. Reason: ["+e.a[this.XQc]+"]"}))}qCc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}SAc(){return!1}Fxb(){return this.BYa}}
Object(u.a)(X,"UnsupportedAuthTokenStrategy",null,[796]);var sa=a(718);a.d(E,"OAuthManager",function(){return da});class da{constructor(S=null){this.PS=0;this.qP=null;this.nAg=0;const oa=Q.a.Ud();this.Tvg=this.Gjh(S).then(K=>K?this.fci():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-oa)),K=M.a.fs(),void 0!==K&&null!==K&&(K.set("AuthLibrary",this.zv()),K=Object.assign(new N.a,{durationMs:Math.floor(Q.a.Ud()-
oa),extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"StrategyPickFailed",!1,!0,K)),Promise.resolve(1))).then(K=>0!==K?Promise.resolve(K):this.Nwi())}Hjh(){var S=n.a.fFi;S&&0<S.length?(this.PS=1,this.qP=new h(S)):w.AFrameworkApplication.fa.qa("IsO365ConsumerHost")||w.AFrameworkApplication.fa.qa("IsO365CommercialHost")?w.AFrameworkApplication.fa.qa("IsAnonymousUser")?(this.PS=2,this.qP=new X(this.PS)):(S=m.a.getAuthContext().loginHint)&&S.length?n.a.Uyb?(this.PS=1,this.qP=new v):
(this.PS=1,this.qP=new W):(this.PS=3,this.qP=new X(this.PS)):(this.PS=4,this.qP=new X(this.PS))}zv(){return this.qP?this.qP.Fxb()||"Unknown":"None"}Gjh(S=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const oa=Q.a.Ud();return w.AFrameworkApplication.fa.ggd().then(K=>{K?(this.Hjh(),S&&(this.qP=S),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",n.a.clientVersion,n.a.appVersion,n.a.Dmh,
this.zv(),Math.floor(Q.a.Ud()-oa))):c.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(Q.a.Ud()-oa));return Promise.resolve(K)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(Q.a.Ud()-oa));return Promise.resolve(!1)})}fci(){c.ULS.sendTraceTag(573390991,3E3,50,
"Initializing {0}",this.zv());const S=Q.a.Ud();return l.get(this.qP.initialize(),2,n.a.WHd).then(oa=>{if(0===oa)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.zv(),Math.floor(Q.a.Ud()-S));else if(1===oa){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-S));var K=M.a.fs();void 0!==K&&null!==K&&(K.set("AuthLibrary",this.zv()),K=Object.assign(new N.a,{durationMs:Math.floor(Q.a.Ud()-
S),extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"StrategyInitFailed",!1,!0,K))}else 2===oa&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-S)),K=M.a.fs(),void 0!==K&&null!==K&&(K.set("AuthLibrary",this.zv()),K=Object.assign(new N.a,{durationMs:Math.floor(Q.a.Ud()-S),extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"StrategyInitTimedOut",!1,!0,K)));
return Promise.resolve(oa)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-S));return Promise.resolve(1)})}Nwi(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.zv());const S=Q.a.Ud();return l.get(this.qP.nlc(m.a.getAuthContext()),2,n.a.WHd).then(oa=>{if(0===oa)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.zv(),Math.floor(Q.a.Ud()-S));else if(1===oa){c.ULS.sendTraceTag(562128583,
3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-S));var K=M.a.fs();void 0!==K&&null!==K&&(K.set("AuthLibrary",this.zv()),K=Object.assign(new N.a,{durationMs:Math.floor(Q.a.Ud()-S),extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"StrategyLoadFailed",!1,!0,K))}else 2===oa&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-
S)),K=M.a.fs(),void 0!==K&&null!==K&&(K.set("AuthLibrary",this.zv()),K=Object.assign(new N.a,{durationMs:Math.floor(Q.a.Ud()-S),extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"StrategyLoadTimedOut",!1,!0,K)));return Promise.resolve(oa)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.zv(),Math.floor(Q.a.Ud()-S));return Promise.resolve(1)})}PL(S,oa,K=null){return this.oCc(S,oa,!1,null,"",K)}Ieg(S,oa,
K,ea,ya=null){return this.oCc(S,oa,!0,K,ea,ya)}oCc(S,oa,K,ea,ya,ha,La=0){La+=1;c.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",S,this.ZRa(S,oa),this.zv(),La);var Ia=M.a.fs();void 0!==Ia&&null!==Ia&&(Ia.set("AuthLibrary",this.zv()),Ia.set("AppName",S),Ia.set("Target",this.ZRa(S,oa)),I.Health.instance.recordKpiUsage(da.kpiName,0,"WacOAuthFC",Ia));if(!n.a.isEnabled){var ra;return this.awd((ra=new d,ra.IsSuccess=!1,ra.Token=
null,ra.ErrorCode="NotEnabled",ra.ErrorMessage="OAuthManager is disabled.",ra),S)}const pa=n.a.UXc[S];if(void 0===pa||null===pa){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",S);var ba;return this.awd((ba=new d,ba.IsSuccess=!1,ba.Token=null,ba.ErrorCode="DisallowedApp",ba.ErrorMessage="Disallowed appName: "+S,ba),S)}const fa=Q.a.Ud(),Ka=this;Ia=this.Tvg.then(bb=>Ka.Phi(S,pa,oa,K,ea,ya,ha,bb));ra=K?0:n.a.WHd;
let aa;ba=(aa=new d,aa.IsSuccess=!1,aa.Token=null,aa.ErrorCode="authTokenStrategy_timeout",aa.ErrorMessage="Auth Strategy timed out after ["+ra+"] ms when fetching token",aa);let ja=this,Va=this;return l.get(Ia,ba,ra).then(bb=>La<=da.MDi&&(bb.ErrorCode===da.Ocg||bb.ErrorCode===da.AKj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",La,Math.floor(Q.a.Ud()-fa)),ja.oCc(S,oa,K,ea,ya,ha,La)):bb.ErrorCode===da.Hmf&&!K&&(c.ULS.sendTraceTag(561517645,3E3,50,
"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",La,da.wOe),da.Eph&&ja.qP.SAc()&&ja.qP.qCc(S,pa,oa,K,ea,ya).then(wa=>Promise.resolve(ja.Elc(wa,S,oa,pa,fa))).catch(()=>{let wa;const ka=(wa=new d,wa.IsSuccess=!1,wa.Token=null,wa.ErrorCode="authTokenStrategy_failure",wa.ErrorMessage="LoginPopup failed, GetToken could not be called",wa);return Promise.resolve(ja.Elc(ka,S,oa,pa,fa))}),da.wOe)?ja.oCc(S,oa,!0,ea,ya,ha,La):Promise.resolve(ja.Elc(bb,S,oa,pa,fa))).catch(()=>
{let bb;const wa=(bb=new d,bb.IsSuccess=!1,bb.Token=null,bb.ErrorCode="authTokenStrategy_failure",bb.ErrorMessage="Auth Strategy failed with an unknown error",bb);return Promise.resolve(Va.Elc(wa,S,oa,pa,fa))})}Phi(S,oa,K,ea,ya,ha,La,Ia){return 1===Ia||2===Ia?this.awd(Object.assign(new d,{IsSuccess:!1,Token:null,ErrorCode:1===Ia?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),S):this.qP.PL(S,oa,K,ea,ya,ha,La).then(ra=>Promise.resolve(this.rwf(ra,!0,S))).catch(ra=>
Promise.resolve(this.rwf(ra,!1,S)))}Elc(S,oa,K,ea,ya){const ha={};ya=Q.a.Ud()-ya;ha.IsSuccess=S.IsSuccess;ha.ErrorCode=S.IsSuccess?"Success":S.ErrorCode||"";ha.ErrorMessage=S.IsSuccess?"Success":this.ZRa(oa,S.ErrorMessage||"");ha.Target=this.ZRa(oa,K||"");ha.TimeInMS=Math.floor(ya);ha.AuthLibrary=this.zv();ha.AppName=oa;ha.AuthorityType=b(f,m.a.nbc());ha.UserType=this.y3h(m.a.getAuthContext());ha.IsAuthSupportedInSession=e.a[this.PS];ha.RequestCount=++this.nAg;ha.AppId=ea;c.ULS.sendTraceTag(593863640,
3E3,50,JSON.stringify(ha));S.IsSuccess||(K=M.a.fs(),void 0!==K&&null!==K&&(K.set("AppName",oa),K.set("AuthLibrary",this.zv()),K.set("ErrorCode",S.ErrorCode),K.set("ErrorMessage",this.ZRa(oa,S.ErrorMessage)),oa=Object.assign(new N.a,{durationMs:ya,extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"TryGetTokenFailure",!1,!0,oa)));return S}awd(S,oa){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",oa,this.ZRa(oa,S.ErrorMessage));
const K=M.a.fs();void 0!==K&&null!==K&&(K.set("AppName",oa),K.set("AuthLibrary",this.zv()),K.set("ErrorCode",S.ErrorCode),K.set("ErrorMessage",this.ZRa(oa,S.ErrorMessage)),oa=Object.assign(new N.a,{extendedProperties:K}),I.Health.instance.recordKpiFailure(da.kpiName,"FailureBeforeGetToken",!1,!0,oa));return Promise.resolve(S)}Ihf(S){return S===sa.a.zBc}ZRa(S,oa){return this.Ihf(S)&&oa?"REDACTED":oa}y3h(S){return w.AFrameworkApplication.fa.qa("IsAnonymousUser")?"anonymous":!S.loginHint||1>S.loginHint.length?
"empty":-1<S.loginHint.indexOf("guest#")?"guest":-1<S.loginHint.indexOf("ext#")?"external":0>S.upn.indexOf("@")?"no-at":"supported"}PMa(){return 1===this.PS}rwf(S,oa,K){let ea=null,ya=null,ha=null,La=null;S?S.ErrorCode||S.ErrorMessage?(ya=S.ErrorCode?S.ErrorCode:da.LUe,ha=S.ErrorMessage?S.ErrorMessage:"No message"):S.Token?oa?ea=S.Token:(ya=da.Tcj,ha="A rejected promise returned a token."):(ya=da.LUe,ha=JSON.stringify(S)):(ya=da.zHi,ha="No result came from Auth Token Strategy");S&&S.Telemetry&&!this.Ihf(K)&&
(La=S.Telemetry,c.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(La)));if(ya===da.qFi||ya===da.iPj)ya=da.Ocg,ha="Auth Library Timed Out";ya===da.bSg&&-1<ha.indexOf(da.hEg)&&(ya=da.Hmf);if(ya||ha)ea=null;return Object.assign(new d,{IsSuccess:!!ea,Token:ea,ErrorCode:ya,ErrorMessage:ha,Telemetry:La})}static get wOe(){return w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get Eph(){return w.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}da.iPj="token_renewal_error";da.LUe="Exception";da.zHi="NoResult";da.Tcj="RejectToken";da.qFi="monitor_window_timeout";da.Ocg="Timeout";da.AKj="authTokenStrategy_timeout";da.bSg="login_required";da.hEg="AADSTS50058";da.Hmf="Cookies Disabled";da.kpiName="OAuthManager";da.MDi=2;Object(u.a)(da,"OAuthManager",null,[620])},920:function(u,E,a){a.d(E,"a",function(){return c});u=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
b[b.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(u.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/8cb539e5917cacc906d7fd8eb42b8209/EwaDSEsNext.oauth.js.map